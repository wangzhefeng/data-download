/* Office runtime JavaScript library */

/*
	Copyright (c) Microsoft Corporation.  All rights reserved.
*/


/*
    Your use of this file is governed by the Microsoft Services Agreement http://go.microsoft.com/fwlink/?LinkId=266419.

    This file also contains the following Promise implementation (with a few small modifications):
        * @overview es6-promise - a tiny implementation of Promises/A+.
        * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
        * @license   Licensed under MIT license
        *            See https://raw.githubusercontent.com/jakearchibald/es6-promise/master/LICENSE
        * @version   2.3.0
*/
var OfficeExt;(function(b){var a=function(){var a=true;function b(){}b.prototype.isMsAjaxLoaded=function(){var b="function",c="undefined";if(typeof Sys!==c&&typeof Type!==c&&Sys.StringBuilder&&typeof Sys.StringBuilder===b&&Type.registerNamespace&&typeof Type.registerNamespace===b&&Type.registerClass&&typeof Type.registerClass===b&&typeof Function._validateParams===b&&Sys.Serialization&&Sys.Serialization.JavaScriptSerializer&&typeof Sys.Serialization.JavaScriptSerializer.serialize===b)return a;else return false};b.prototype.loadMsAjaxFull=function(b){var a=(window.location.protocol.toLowerCase()==="https:"?"https:":"http:")+"//ajax.aspnetcdn.com/ajax/3.5/MicrosoftAjax.js";OSF.OUtil.loadScript(a,b)};Object.defineProperty(b.prototype,"msAjaxError",{"get":function(){var a=this;if(a._msAjaxError==null&&a.isMsAjaxLoaded())a._msAjaxError=Error;return a._msAjaxError},"set":function(a){this._msAjaxError=a},enumerable:a,configurable:a});Object.defineProperty(b.prototype,"msAjaxString",{"get":function(){var a=this;if(a._msAjaxString==null&&a.isMsAjaxLoaded())a._msAjaxString=String;return a._msAjaxString},"set":function(a){this._msAjaxString=a},enumerable:a,configurable:a});Object.defineProperty(b.prototype,"msAjaxDebug",{"get":function(){var a=this;if(a._msAjaxDebug==null&&a.isMsAjaxLoaded())a._msAjaxDebug=Sys.Debug;return a._msAjaxDebug},"set":function(a){this._msAjaxDebug=a},enumerable:a,configurable:a});return b}();b.MicrosoftAjaxFactory=a})(OfficeExt||(OfficeExt={}));var OsfMsAjaxFactory=new OfficeExt.MicrosoftAjaxFactory,OSF=OSF||{},OfficeExt;(function(b){var a=function(){function a(a){this._internalStorage=a}a.prototype.getItem=function(a){try{return this._internalStorage&&this._internalStorage.getItem(a)}catch(b){return null}};a.prototype.setItem=function(b,a){try{this._internalStorage&&this._internalStorage.setItem(b,a)}catch(c){}};a.prototype.clear=function(){try{this._internalStorage&&this._internalStorage.clear()}catch(a){}};a.prototype.removeItem=function(a){try{this._internalStorage&&this._internalStorage.removeItem(a)}catch(b){}};a.prototype.getKeysWithPrefix=function(d){var b=[];try{for(var e=this._internalStorage&&this._internalStorage.length||0,a=0;a<e;a++){var c=this._internalStorage.key(a);c.indexOf(d)===0&&b.push(c)}}catch(f){}return b};return a}();b.SafeStorage=a})(OfficeExt||(OfficeExt={}));OSF.XdmFieldName={ConversationUrl:"ConversationUrl",AppId:"AppId"};OSF.TestFlightStart=1e3;OSF.TestFlightEnd=1009;OSF.FlightNames={UseOriginNotUrl:0,CheckReceiverOrigin:1,AddinEnforceHttps:2,RibbonNativeGroupControl:3,RibbonTabPosition:4,RibbonTabAutoFocus:5,FirstPartyAnonymousProxyReadyCheckTimeout:6,SdxOnWacCDNIsEnabled:7,AddinRibbonControlsOverriddenByApi:8,AddinRibbonIdAllowUnknown:9,AdvancedUrlParsing:10,IgnoreWindowName:11,PostMessageParentOnlyOnce:12,RemoveOptionNotEnforceAppDomains:13,DialogPromptCleanDisplay:14,ManifestParserDevConsoleLog:15,LegacyRibbonAddinCommandsEnableDisableControls:16,AddInsInSupportedIrmDocsIsEnabled:17,AddinActionDefinitionHybridMode:18,NotifyHostOnlyWithOrigin:19,OSFTestFlight1000:OSF.TestFlightStart,OSFTestFlight1001:OSF.TestFlightStart+1,OSFTestFlight1002:OSF.TestFlightStart+2,OSFTestFlight1003:OSF.TestFlightStart+3,OSFTestFlight1004:OSF.TestFlightStart+4,OSFTestFlight1005:OSF.TestFlightStart+5,OSFTestFlight1006:OSF.TestFlightStart+6,OSFTestFlight1007:OSF.TestFlightStart+7,OSFTestFlight1008:OSF.TestFlightStart+8,OSFTestFlight1009:OSF.TestFlightEnd};OSF.Flights=[];OSF.Settings={};OSF.WindowNameItemKeys={BaseFrameName:"baseFrameName",HostInfo:"hostInfo",XdmInfo:"xdmInfo",SerializerVersion:"serializerVersion",AppContext:"appContext",Flights:"flights"};OSF.OUtil=function(){var l="focus",f="/",i="https:",k="on",r="configurable",q="writable",j="enumerable",d="",g="undefined",c=false,a=true,m="string",n=2147483647,b=null,h="#",e=-1,x=e,D="&_xdm_Info=",A="&_serializer_version=",C="&_flights=",B="_xdm_",G="_serializer_version=",H="_flights=",t=h,z="&",o="class",w={},F=3e4,s=b,v=b,p=(new Date).getTime();function E(){var a=n*Math.random();a^=p^(new Date).getMilliseconds()<<Math.floor(Math.random()*(31-10));return a.toString(16)}function u(){if(!s){try{var a=window.sessionStorage}catch(c){a=b}s=new OfficeExt.SafeStorage(a)}return s}function y(e){for(var c=[],b=[],f=e.length,a,d=0;d<f;d++){a=e[d];if(a.tabIndex)if(a.tabIndex>0)b.push(a);else a.tabIndex===0&&c.push(a);else c.push(a)}b=b.sort(function(d,c){var a=d.tabIndex-c.tabIndex;if(a===0)a=b.indexOf(d)-b.indexOf(c);return a});return [].concat(b,c)}return {set_entropy:function(a){if(typeof a==m)for(var b=0;b<a.length;b+=4){for(var d=0,c=0;c<4&&b+c<a.length;c++)d=(d<<8)+a.charCodeAt(b+c);p^=d}else if(typeof a=="number")p^=a;else p^=n*Math.random();p&=n},extend:function(b,a){var c=function(){};c.prototype=a.prototype;b.prototype=new c;b.prototype.constructor=b;b.uber=a.prototype;if(a.prototype.constructor===Object.prototype.constructor)a.prototype.constructor=a},setNamespace:function(b,a){if(a&&b&&!a[b])a[b]={}},unsetNamespace:function(b,a){if(a&&b&&a[b])delete a[b]},serializeSettings:function(b){var d={};for(var c in b){var a=b[c];try{if(JSON)a=JSON.stringify(a,function(a,b){return OSF.OUtil.isDate(this[a])?OSF.DDA.SettingsManager.DateJSONPrefix+this[a].getTime()+OSF.DDA.SettingsManager.DataJSONSuffix:b});else a=Sys.Serialization.JavaScriptSerializer.serialize(a);d[c]=a}catch(e){}}return d},deserializeSettings:function(c){var f={};c=c||{};for(var d in c){var b=c[d];try{if(JSON)b=JSON.parse(b,function(c,a){var b;if(typeof a===m&&a&&a.length>6&&a.slice(0,5)===OSF.DDA.SettingsManager.DateJSONPrefix&&a.slice(e)===OSF.DDA.SettingsManager.DataJSONSuffix){b=new Date(parseInt(a.slice(5,e)));if(b)return b}return a});else b=Sys.Serialization.JavaScriptSerializer.deserialize(b,a);f[d]=b}catch(g){}}return f},loadScript:function(f,g,h){if(f&&g){var k=window.document,d=w[f];if(!d){var e=k.createElement("script");e.type="text/javascript";d={loaded:c,pendingCallbacks:[g],timer:b};w[f]=d;var i=function(){if(d.timer!=b){clearTimeout(d.timer);delete d.timer}d.loaded=a;for(var e=d.pendingCallbacks.length,c=0;c<e;c++){var f=d.pendingCallbacks.shift();f()}},j=function(){delete w[f];if(d.timer!=b){clearTimeout(d.timer);delete d.timer}for(var c=d.pendingCallbacks.length,a=0;a<c;a++){var e=d.pendingCallbacks.shift();e()}};if(e.readyState)e.onreadystatechange=function(){if(e.readyState=="loaded"||e.readyState=="complete"){e.onreadystatechange=b;i()}};else e.onload=i;e.onerror=j;h=h||F;d.timer=setTimeout(j,h);e.setAttribute("crossOrigin","anonymous");e.src=f;k.getElementsByTagName("head")[0].appendChild(e)}else if(d.loaded)g();else d.pendingCallbacks.push(g)}},loadCSS:function(c){if(c){var b=window.document,a=b.createElement("link");a.type="text/css";a.rel="stylesheet";a.href=c;b.getElementsByTagName("head")[0].appendChild(a)}},parseEnum:function(b,c){var a=c[b.trim()];if(typeof a==g){OsfMsAjaxFactory.msAjaxDebug.trace("invalid enumeration string:"+b);throw OsfMsAjaxFactory.msAjaxError.argument("str")}return a},delayExecutionAndCache:function(){var a={calc:arguments[0]};return function(){if(a.calc){a.val=a.calc.apply(this,arguments);delete a.calc}return a.val}},getUniqueId:function(){x=x+1;return x.toString()},formatString:function(){var a=arguments,b=a[0];return b.replace(/{(\d+)}/gm,function(d,b){var c=parseInt(b,10)+1;return a[c]===undefined?"{"+b+"}":a[c]})},generateConversationId:function(){return [E(),E(),(new Date).getTime().toString()].join("_")},getFrameName:function(a){return B+a+this.generateConversationId()},addXdmInfoAsHash:function(b,a){return OSF.OUtil.addInfoAsHash(b,D,a,c)},addSerializerVersionAsHash:function(c,b){return OSF.OUtil.addInfoAsHash(c,A,b,a)},addFlightsAsHash:function(c,b){return OSF.OUtil.addInfoAsHash(c,C,b,a)},addInfoAsHash:function(b,g,c,i){b=b.trim()||d;var f=b.split(t),h=f.shift(),e=f.join(t),a;if(i)a=[g,encodeURIComponent(c),e].join(d);else a=[e,g,c].join(d);return [h,t,a].join(d)},parseHostInfoFromWindowName:function(a,b){return OSF.OUtil.parseInfoFromWindowName(a,b,OSF.WindowNameItemKeys.HostInfo)},parseXdmInfo:function(b){var a=OSF.OUtil.parseXdmInfoWithGivenFragment(b,window.location.hash);if(!a)a=OSF.OUtil.parseXdmInfoFromWindowName(b,window.name);return a},parseXdmInfoFromWindowName:function(a,b){return OSF.OUtil.parseInfoFromWindowName(a,b,OSF.WindowNameItemKeys.XdmInfo)},parseXdmInfoWithGivenFragment:function(a,b){return OSF.OUtil.parseInfoWithGivenFragment(D,B,c,a,b)},parseSerializerVersion:function(b){var a=OSF.OUtil.parseSerializerVersionWithGivenFragment(b,window.location.hash);if(isNaN(a))a=OSF.OUtil.parseSerializerVersionFromWindowName(b,window.name);return a},parseSerializerVersionFromWindowName:function(a,b){return parseInt(OSF.OUtil.parseInfoFromWindowName(a,b,OSF.WindowNameItemKeys.SerializerVersion))},parseSerializerVersionWithGivenFragment:function(b,c){return parseInt(OSF.OUtil.parseInfoWithGivenFragment(A,G,a,b,c))},parseFlights:function(b){var a=OSF.OUtil.parseFlightsWithGivenFragment(b,window.location.hash);if(a.length==0)a=OSF.OUtil.parseFlightsFromWindowName(b,window.name);return a},checkFlight:function(a){return OSF.Flights&&OSF.Flights.indexOf(a)>=0},pushFlight:function(b){if(OSF.Flights.indexOf(b)<0){OSF.Flights.push(b);return a}return c},getBooleanSetting:function(a){return OSF.OUtil.getBooleanFromDictionary(OSF.Settings,a)},getBooleanFromDictionary:function(b,a){var d=b&&a&&b[a]!==undefined&&b[a]&&(typeof b[a]===m&&b[a].toUpperCase()==="TRUE"||typeof b[a]==="boolean"&&b[a]);return d!==undefined?d:c},parseFlightsFromWindowName:function(a,b){return OSF.OUtil.parseArrayWithDefault(OSF.OUtil.parseInfoFromWindowName(a,b,OSF.WindowNameItemKeys.Flights))},parseFlightsWithGivenFragment:function(b,c){return OSF.OUtil.parseArrayWithDefault(OSF.OUtil.parseInfoWithGivenFragment(C,H,a,b,c))},parseArrayWithDefault:function(b){var a=[];try{a=JSON.parse(b)}catch(c){}if(!Array.isArray(a))a=[];return a},parseInfoFromWindowName:function(g,h,f){try{var a=JSON.parse(h),c=a!=b?a[f]:b,d=u();if(!g&&d&&a!=b){var e=a[OSF.WindowNameItemKeys.BaseFrameName]+f;if(c)d.setItem(e,c);else c=d.getItem(e)}return c}catch(i){return b}},parseInfoWithGivenFragment:function(m,j,k,i,l){var f=l.split(m),a=f.length>1?f[f.length-1]:b;if(k&&a!=b){if(a.indexOf(z)>=0)a=a.split(z)[0];a=decodeURIComponent(a)}var c=u();if(!i&&c){var d=window.name.indexOf(j);if(d>e){var g=window.name.indexOf(";",d);if(g==e)g=window.name.length;var h=window.name.substring(d,g);if(a)c.setItem(h,a);else a=c.getItem(h)}}return a},getConversationId:function(){var c=window.location.search,a=b;if(c){var d=c.indexOf("&");a=d>0?c.substring(1,d):c.substr(1);if(a&&a.charAt(a.length-1)==="="){a=a.substring(0,a.length-1);if(a)a=decodeURIComponent(a)}}return a},getInfoItems:function(b){var a=b.split("$");if(typeof a[1]==g)a=b.split("|");if(typeof a[1]==g)a=b.split("%7C");return a},getXdmFieldValue:function(f,e){var b=d,c=OSF.OUtil.parseXdmInfo(e);if(c){var a=OSF.OUtil.getInfoItems(c);if(a!=undefined&&a.length>=3)switch(f){case OSF.XdmFieldName.ConversationUrl:b=a[2];break;case OSF.XdmFieldName.AppId:b=a[1]}}return b},validateParamObject:function(f,e){var b=Function._validateParams(arguments,[{name:"params",type:Object,mayBeNull:c},{name:"expectedProperties",type:Object,mayBeNull:c},{name:"callback",type:Function,mayBeNull:a}]);if(b)throw b;for(var d in e){b=Function._validateParameter(f[d],e[d],d);if(b)throw b}},writeProfilerMark:function(a){if(window.msWriteProfilerMark){window.msWriteProfilerMark(a);OsfMsAjaxFactory.msAjaxDebug.trace(a)}},outputDebug:function(a){typeof OsfMsAjaxFactory!==g&&OsfMsAjaxFactory.msAjaxDebug&&OsfMsAjaxFactory.msAjaxDebug.trace&&OsfMsAjaxFactory.msAjaxDebug.trace(a)},defineNondefaultProperty:function(e,f,b,c){b=b||{};for(var g in c){var d=c[g];if(b[d]==undefined)b[d]=a}Object.defineProperty(e,f,b);return e},defineNondefaultProperties:function(c,a,d){a=a||{};for(var b in a)OSF.OUtil.defineNondefaultProperty(c,b,a[b],d);return c},defineEnumerableProperty:function(c,b,a){return OSF.OUtil.defineNondefaultProperty(c,b,a,[j])},defineEnumerableProperties:function(b,a){return OSF.OUtil.defineNondefaultProperties(b,a,[j])},defineMutableProperty:function(c,b,a){return OSF.OUtil.defineNondefaultProperty(c,b,a,[q,j,r])},defineMutableProperties:function(b,a){return OSF.OUtil.defineNondefaultProperties(b,a,[q,j,r])},finalizeProperties:function(e,d){d=d||{};for(var g=Object.getOwnPropertyNames(e),i=g.length,f=0;f<i;f++){var h=g[f],b=Object.getOwnPropertyDescriptor(e,h);if(!b.get&&!b.set)b.writable=d.writable||c;b.configurable=d.configurable||c;b.enumerable=d.enumerable||a;Object.defineProperty(e,h,b)}return e},mapList:function(a,c){var b=[];if(a)for(var d in a)b.push(c(a[d]));return b},listContainsKey:function(d,e){for(var b in d)if(e==b)return a;return c},listContainsValue:function(b,d){for(var e in b)if(d==b[e])return a;return c},augmentList:function(a,b){var d=a.push?function(c,b){a.push(b)}:function(c,b){a[c]=b};for(var c in b)d(c,b[c])},redefineList:function(a,b){for(var d in a)delete a[d];for(var c in b)a[c]=b[c]},isArray:function(a){return Object.prototype.toString.apply(a)==="[object Array]"},isFunction:function(a){return Object.prototype.toString.apply(a)==="[object Function]"},isDate:function(a){return Object.prototype.toString.apply(a)==="[object Date]"},addEventListener:function(a,b,d){if(a.addEventListener)a.addEventListener(b,d,c);else if(Sys.Browser.agent===Sys.Browser.InternetExplorer&&a.attachEvent)a.attachEvent(k+b,d);else a[k+b]=d},removeEventListener:function(a,d,e){if(a.removeEventListener)a.removeEventListener(d,e,c);else if(Sys.Browser.agent===Sys.Browser.InternetExplorer&&a.detachEvent)a.detachEvent(k+d,e);else a[k+d]=b},getCookieValue:function(b){var a=RegExp(b+"[^;]+").exec(document.cookie);return a.toString().replace(/^[^=]+./,d)},xhrGet:function(f,e,c){var b;try{b=new XMLHttpRequest;b.onreadystatechange=function(){if(b.readyState==4)if(b.status==200)e(b.responseText);else c(b.status)};b.open("GET",f,a);b.send()}catch(d){c(d)}},xhrGetFull:function(h,f,g,c){var b,e=f;try{b=new XMLHttpRequest;b.onreadystatechange=function(){if(b.readyState==4)if(b.status==200)g(b,e);else c(b.status)};b.open("GET",h,a);b.send()}catch(d){c(d)}},encodeBase64:function(c){if(!c)return c;var o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",m=[],b=[],i=0,k,h,j,e,f,g,a,n=c.length;do{k=c.charCodeAt(i++);h=c.charCodeAt(i++);j=c.charCodeAt(i++);a=0;e=k&255;f=k>>8;g=h&255;b[a++]=e>>2;b[a++]=(e&3)<<4|f>>4;b[a++]=(f&15)<<2|g>>6;b[a++]=g&63;if(!isNaN(h)){e=h>>8;f=j&255;g=j>>8;b[a++]=e>>2;b[a++]=(e&3)<<4|f>>4;b[a++]=(f&15)<<2|g>>6;b[a++]=g&63}if(isNaN(h))b[a-1]=64;else if(isNaN(j)){b[a-2]=64;b[a-1]=64}for(var l=0;l<a;l++)m.push(o.charAt(b[l]))}while(i<n);return m.join(d)},getSessionStorage:function(){return u()},getLocalStorage:function(){if(!v){try{var a=window.localStorage}catch(c){a=b}v=new OfficeExt.SafeStorage(a)}return v},convertIntToCssHexColor:function(b){var a=h+(Number(b)+16777216).toString(16).slice(-6);return a},attachClickHandler:function(a,b){a.onclick=function(){b()};a.ontouchend=function(a){b();a.preventDefault()}},getQueryStringParamValue:function(a,e){var f=Function._validateParams(arguments,[{name:"queryString",type:String,mayBeNull:c},{name:"paramName",type:String,mayBeNull:c}]);if(f){OsfMsAjaxFactory.msAjaxDebug.trace("OSF_Outil_getQueryStringParamValue: Parameters cannot be null.");return d}var b=new RegExp("[\\?&]"+e+"=([^&#]*)","i");if(!b.test(a)){OsfMsAjaxFactory.msAjaxDebug.trace("OSF_Outil_getQueryStringParamValue: The parameter is not found.");return d}return b.exec(a)[1]},getHostnamePortionForLogging:function(e){var f=Function._validateParams(arguments,[{name:"hostname",type:String,mayBeNull:c}]);if(f)return d;var a=e.split("."),b=a.length;if(b>=2)return a[b-2]+"."+a[b-1];else if(b==1)return a[0]},isiOS:function(){return window.navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?a:c},isChrome:function(){return window.navigator.userAgent.indexOf("Chrome")>0&&!OSF.OUtil.isEdge()},isEdge:function(){return window.navigator.userAgent.indexOf("Edge")>0},isIE:function(){return window.navigator.userAgent.indexOf("Trident")>0},isFirefox:function(){return window.navigator.userAgent.indexOf("Firefox")>0},startsWith:function(b,a,c){if(c)return b.substr(0,a.length)===a;else return b.startsWith(a)},containsPort:function(d,e,c,b){return this.startsWith(d,e+"//"+c+":"+b,a)||this.startsWith(d,c+":"+b,a)},getRedundandPortString:function(b,a){if(!b||!a)return d;if(a.protocol==i&&this.containsPort(b,i,a.hostname,"443"))return ":443";else if(a.protocol=="http:"&&this.containsPort(b,"http:",a.hostname,"80"))return ":80";return d},removeChar:function(a,b){if(b<a.length-1)return a.substring(0,b)+a.substring(b+1);else if(b==a.length-1)return a.substring(0,a.length-1);else return a},cleanUrlOfChar:function(a,c){for(var b=0;b<a.length;b++)if(a.charAt(b)===c)if(b+1>=a.length)return this.removeChar(a,b);else if(c===f){if(a.charAt(b+1)==="?"||a.charAt(b+1)===h)return this.removeChar(a,b)}else if(c==="?")if(a.charAt(b+1)===h)return this.removeChar(a,b);return a},cleanUrl:function(a){a=this.cleanUrlOfChar(a,f);a=this.cleanUrlOfChar(a,"?");a=this.cleanUrlOfChar(a,h);if(a.substr(0,8)=="https://"){var b=a.indexOf(":443");if(b!=e)if(b==a.length-4||a.charAt(b+4)==f||a.charAt(b+4)=="?"||a.charAt(b+4)==h)a=a.substring(0,b)+a.substring(b+4)}else if(a.substr(0,7)=="http://"){var b=a.indexOf(":80");if(b!=e)if(b==a.length-3||a.charAt(b+3)==f||a.charAt(b+3)=="?"||a.charAt(b+3)==h)a=a.substring(0,b)+a.substring(b+3)}return a},parseUrl:function(h,k){var l=this;if(k===void 0)k=c;if(typeof h===g||!h)return undefined;var j="NotHttps",p="InvalidUrl",n=l.isIE(),s=l.isEdge(),b={protocol:undefined,hostname:undefined,host:undefined,port:undefined,pathname:undefined,search:undefined,hash:undefined,isPortPartOfUrl:undefined};if(OSF.OUtil.checkFlight(OSF.FlightNames.AdvancedUrlParsing))try{if(n){var a=document.createElement("a");a.href=h;if(!a||!a.protocol||!a.host||!a.hostname||!a.href||l.cleanUrl(a.href)!==l.cleanUrl(h))throw p;if(OSF.OUtil.checkFlight(OSF.FlightNames.AddinEnforceHttps))if(k&&a.protocol!=i)throw new Error(j);var o=l.getRedundandPortString(h,a);b.protocol=a.protocol;b.hostname=a.hostname;b.port=o==d?a.port:d;b.host=o!=d?a.hostname:a.host;b.pathname=(n?f:d)+a.pathname;b.search=a.search;b.hash=a.hash;b.isPortPartOfUrl=l.containsPort(h,a.protocol,a.hostname,a.port)}else{var e=new URL(h);if(e&&e.protocol&&e.host&&e.hostname){if(OSF.OUtil.checkFlight(OSF.FlightNames.AddinEnforceHttps))if(k&&e.protocol!=i)throw new Error(j);b.protocol=e.protocol;b.hostname=e.hostname;b.port=e.port;b.host=e.host;b.pathname=e.pathname;b.search=e.search;b.hash=e.hash;b.isPortPartOfUrl=e.host.lastIndexOf(":"+e.port)==e.host.length-e.port.length-1}}}catch(m){if(m.message===j)throw m}else try{if(n)throw"Browser doesn't support new URL library";else if(s)throw"Browser has inconsistent URL library";var e=new URL(h);if(e){b.protocol=e.protocol;b.hostname=e.hostname;b.port=e.port;if(OSF.OUtil.checkFlight(OSF.FlightNames.AddinEnforceHttps))if(k&&e.protocol!=i)throw new Error(j)}}catch(m){if(m.message===j)throw m;var a=document.createElement("a");a.href=h;if((a.pathname==d||a.pathname==f)&&!(h.substring(h.length-1,h.length)===f))h+=f;if(OSF.OUtil.checkFlight(OSF.FlightNames.AddinEnforceHttps))if(k&&a.protocol!=i)throw new Error(j);var q=a.protocol+"//"+a.hostname+(n?f:d)+a.pathname+a.search+a.hash,r=a.protocol+"//"+a.host+(n?f:d)+a.pathname+a.search+a.hash;if(h==q||h==r){b.protocol=a.protocol;b.hostname=a.hostname;b.port=a.port}}return b},shallowCopy:function(a){if(a==b)return b;else if(!(a instanceof Object))return a;else if(Array.isArray(a)){for(var e=[],d=0;d<a.length;d++)e.push(a[d]);return e}else{var f=a.constructor();for(var c in a)if(a.hasOwnProperty(c))f[c]=a[c];return f}},createObject:function(a){var d=b;if(a){d={};for(var e=a.length,c=0;c<e;c++)d[a[c].name]=a[c].value}return d},addClass:function(a,b){if(!OSF.OUtil.hasClass(a,b)){var c=a.getAttribute(o);if(c)a.setAttribute(o,c+" "+b);else a.setAttribute(o,b)}},removeClass:function(b,c){if(OSF.OUtil.hasClass(b,c)){var a=b.getAttribute(o),e=new RegExp("(\\s|^)"+c+"(\\s|$)");a=a.replace(e,d);b.setAttribute(o,a)}},hasClass:function(c,b){var a=c.getAttribute(o);return a&&a.match(new RegExp("(\\s|^)"+b+"(\\s|$)"))},focusToFirstTabbable:function(d,i){var g,h=c,f,j=function(){h=a},k=function(c,a,b){if(a<0||a>c)return e;else if(a===0&&b)return e;else if(a===c-1&&!b)return e;if(b)return a-1;else return a+1};d=y(d);g=i?d.length-1:0;if(d.length===0)return b;while(!h&&g>=0&&g<d.length){f=d[g];window.focus();f.addEventListener(l,j);f.focus();f.removeEventListener(l,j);g=k(d.length,g,i);if(!h&&f===document.activeElement)h=a}if(h)return f;else return b},focusToNextTabbable:function(f,o,m){var j,d,h=c,g,k=function(){h=a},n=function(b,c){for(var a=0;a<b.length;a++)if(b[a]===c)return a;return e},i=function(c,a,b){if(a<0||a>c)return e;else if(a===0&&b)return e;else if(a===c-1&&!b)return e;if(b)return a-1;else return a+1};f=y(f);j=n(f,o);d=i(f.length,j,m);if(d<0)return b;while(!h&&d>=0&&d<f.length){g=f[d];g.addEventListener(l,k);g.focus();g.removeEventListener(l,k);d=i(f.length,d,m);if(!h&&g===document.activeElement)h=a}if(h)return g;else return b},isNullOrUndefined:function(d){if(typeof d===g)return a;if(d===b)return a;return c},stringEndsWith:function(d,b){if(!OSF.OUtil.isNullOrUndefined(d)&&!OSF.OUtil.isNullOrUndefined(b)){if(b.length>d.length)return c;if(d.substr(d.length-b.length)===b)return a}return c},hashCode:function(b){var a=0;if(!OSF.OUtil.isNullOrUndefined(b)){var c=0,d=b.length;while(c<d)a=(a<<5)-a+b.charCodeAt(c++)|0}return a},getValue:function(a,b){if(OSF.OUtil.isNullOrUndefined(a))return b;return a},externalNativeFunctionExists:function(a){return a==="unknown"||a!==g}}}();OSF.OUtil.Guid=function(){var a=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return {generateNewGuid:function(){for(var c="",d=(new Date).getTime(),b=0;b<32&&d>0;b++){if(b==8||b==12||b==16||b==20)c+="-";c+=a[d%16];d=Math.floor(d/16)}for(;b<32;b++){if(b==8||b==12||b==16||b==20)c+="-";c+=a[Math.floor(Math.random()*16)]}return c}}}();try{(function(){OSF.Flights=OSF.OUtil.parseFlights(true)})()}catch(ex){}window.OSF=OSF;var OfficeExt;(function(g){var c="\n",d=true,a=null,b="undefined",j=function(){function c(){}c.isInstanceOfType=function(f,e){if(typeof e===b||e===a)return false;if(e instanceof f)return d;var c=e.constructor;if(!c||typeof c!=="function"||!c.__typeName||c.__typeName==="Object")c=Object;return !!(c===f)||c.__typeName&&f.__typeName&&c.__typeName===f.__typeName};return c}();g.MsAjaxTypeHelper=j;var h=function(){var e="Parameter name: {0}";function d(){}d.create=function(c,b){var a=new Error(c);a.message=c;if(b)for(var d in b)a[d]=b[d];a.popStackFrame();return a};d.parameterCount=function(a){var c="Sys.ParameterCountException: "+(a?a:"Parameter count mismatch."),b=d.create(c,{name:"Sys.ParameterCountException"});b.popStackFrame();return b};d.argument=function(a,g){var b="Sys.ArgumentException: "+(g?g:"Value does not fall within the expected range.");if(a)b+=c+f.format(e,a);var h=d.create(b,{name:"Sys.ArgumentException",paramName:a});h.popStackFrame();return h};d.argumentNull=function(a,g){var b="Sys.ArgumentNullException: "+(g?g:"Value cannot be null.");if(a)b+=c+f.format(e,a);var h=d.create(b,{name:"Sys.ArgumentNullException",paramName:a});h.popStackFrame();return h};d.argumentOutOfRange=function(i,g,j){var h="Sys.ArgumentOutOfRangeException: "+(j?j:"Specified argument was out of the range of valid values.");if(i)h+=c+f.format(e,i);if(typeof g!==b&&g!==a)h+=c+f.format("Actual value was {0}.",g);var k=d.create(h,{name:"Sys.ArgumentOutOfRangeException",paramName:i,actualValue:g});k.popStackFrame();return k};d.argumentType=function(h,g,b,i){var a="Sys.ArgumentTypeException: ";if(i)a+=i;else if(g&&b)a+=f.format("Object of type '{0}' cannot be converted to type '{1}'.",g.getName?g.getName():g,b.getName?b.getName():b);else a+="Object cannot be converted to the required type.";if(h)a+=c+f.format(e,h);var j=d.create(a,{name:"Sys.ArgumentTypeException",paramName:h,actualType:g,expectedType:b});j.popStackFrame();return j};d.argumentUndefined=function(a,g){var b="Sys.ArgumentUndefinedException: "+(g?g:"Value cannot be undefined.");if(a)b+=c+f.format(e,a);var h=d.create(b,{name:"Sys.ArgumentUndefinedException",paramName:a});h.popStackFrame();return h};d.invalidOperation=function(a){var c="Sys.InvalidOperationException: "+(a?a:"Operation is not valid due to the current state of the object."),b=d.create(c,{name:"Sys.InvalidOperationException"});b.popStackFrame();return b};return d}();g.MsAjaxError=h;var f=function(){function a(){}a.format=function(c){for(var b=[],a=1;a<arguments.length;a++)b[a-1]=arguments[a];var d=c;return d.replace(/{(\d+)}/gm,function(d,a){var c=parseInt(a,10);return b[c]===undefined?"{"+a+"}":b[c]})};a.startsWith=function(b,a){return b.substr(0,a.length)===a};return a}();g.MsAjaxString=f;var i=function(){function a(){}a.trace=function(){};return a}();g.MsAjaxDebug=i;if(!OsfMsAjaxFactory.isMsAjaxLoaded()){var e=function(b,d,c){if(b.__typeName===undefined||b.__typeName===a)b.__typeName=d;if(b.__class===undefined||b.__class===a)b.__class=c};e(Function,"Function",d);e(Error,"Error",d);e(Object,"Object",d);e(String,"String",d);e(Boolean,"Boolean",d);e(Date,"Date",d);e(Number,"Number",d);e(RegExp,"RegExp",d);e(Array,"Array",d);if(!Function.createCallback)Function.createCallback=function(b,a){var c=Function._validateParams(arguments,[{name:"method",type:Function},{name:"context",mayBeNull:d}]);if(c)throw c;return function(){var e=arguments.length;if(e>0){for(var d=[],c=0;c<e;c++)d[c]=arguments[c];d[e]=a;return b.apply(this,d)}return b.call(this,a)}};if(!Function.createDelegate)Function.createDelegate=function(b,c){var a=Function._validateParams(arguments,[{name:"instance",mayBeNull:d},{name:"method",type:Function}]);if(a)throw a;return function(){return c.apply(b,arguments)}};if(!Function._validateParams)Function._validateParams=function(i,g,e){var c,f=g.length;e=e||typeof e===b;c=Function._validateParameterCount(i,g,e);if(c){c.popStackFrame();return c}for(var d=0,k=i.length;d<k;d++){var h=g[Math.min(d,f-1)],j=h.name;if(h.parameterArray)j+="["+(d-f+1)+"]";else if(!e&&d>=f)break;c=Function._validateParameter(i[d],h,j);if(c){c.popStackFrame();return c}}return a};if(!Function._validateParameterCount)Function._validateParameterCount=function(m,f,l){var b,e,c=f.length,g=m.length;if(g<c){var i=c;for(b=0;b<c;b++){var j=f[b];if(j.optional||j.parameterArray)i--}if(g<i)e=d}else if(l&&g>c){e=d;for(b=0;b<c;b++)if(f[b].parameterArray){e=false;break}}if(e){var k=h.parameterCount();k.popStackFrame();return k}return a};if(!Function._validateParameter)Function._validateParameter=function(e,c,j){var d,i=c.type,n=!!c.integer,m=!!c.domElement,o=!!c.mayBeNull;d=Function._validateParameterType(e,i,n,m,o,j);if(d){d.popStackFrame();return d}var g=c.elementType,h=!!c.elementMayBeNull;if(i===Array&&typeof e!==b&&e!==a&&(g||!h))for(var l=!!c.elementInteger,k=!!c.elementDomElement,f=0;f<e.length;f++){var p=e[f];d=Function._validateParameterType(p,g,l,k,h,j+"["+f+"]");if(d){d.popStackFrame();return d}}return a};if(!Function._validateParameterType)Function._validateParameterType=function(d,e,j,i,h,f){var c,k;if(typeof d===b)if(h)return a;else{c=g.MsAjaxError.argumentUndefined(f);c.popStackFrame();return c}if(d===a)if(h)return a;else{c=g.MsAjaxError.argumentNull(f);c.popStackFrame();return c}if(e&&!g.MsAjaxTypeHelper.isInstanceOfType(e,d)){c=g.MsAjaxError.argumentType(f,typeof d,e);c.popStackFrame();return c}return a};if(!window.Type)window.Type=Function;if(!Type.registerNamespace)Type.registerNamespace=function(d){for(var c=d.split("."),b=window,a=0;a<c.length;a++){b[c[a]]=b[c[a]]||{};b=b[c[a]]}};if(!Type.prototype.registerClass)Type.prototype.registerClass=function(a){a={}};typeof Sys===b&&Type.registerNamespace("Sys");if(!Error.prototype.popStackFrame)Error.prototype.popStackFrame=function(){var d=this;if(arguments.length!==0)throw h.parameterCount();if(typeof d.stack===b||d.stack===a||typeof d.fileName===b||d.fileName===a||typeof d.lineNumber===b||d.lineNumber===a)return;var e=d.stack.split(c),g=e[0],j=d.fileName+":"+d.lineNumber;while(typeof g!==b&&g!==a&&g.indexOf(j)===-1){e.shift();g=e[0]}var i=e[1];if(typeof i===b||i===a)return;var f=i.match(/@(.*):(\d+)$/);if(typeof f===b||f===a)return;d.fileName=f[1];d.lineNumber=parseInt(f[2]);e.shift();d.stack=e.join(c)};OsfMsAjaxFactory.msAjaxError=h;OsfMsAjaxFactory.msAjaxString=f;OsfMsAjaxFactory.msAjaxDebug=i}})(OfficeExt||(OfficeExt={}));OSF.OUtil.setNamespace("Microsoft",window);OSF.OUtil.setNamespace("Office",Microsoft);OSF.OUtil.setNamespace("Common",Microsoft.Office);Microsoft.Office.Common.InvokeType={async:0,sync:1,asyncRegisterEvent:2,asyncUnregisterEvent:3,syncRegisterEvent:4,syncUnregisterEvent:5};OSF.SerializerVersion={MsAjax:0,Browser:1};var OfficeExt;(function(b){function a(){return false}b.appSpecificCheckOrigin=a})(OfficeExt||(OfficeExt={}));Microsoft.Office.Common.InvokeType={async:0,sync:1,asyncRegisterEvent:2,asyncUnregisterEvent:3,syncRegisterEvent:4,syncUnregisterEvent:5};Microsoft.Office.Common.InvokeResultCode={noError:0,errorInRequest:-1,errorHandlingRequest:-2,errorInResponse:-3,errorHandlingResponse:-4,errorHandlingRequestAccessDenied:-5,errorHandlingMethodCallTimedout:-6};Microsoft.Office.Common.MessageType={request:0,response:1};Microsoft.Office.Common.ActionType={invoke:0,registerEvent:1,unregisterEvent:2};Microsoft.Office.Common.ResponseType={forCalling:0,forEventing:1};Microsoft.Office.Common.HostTrustStatus={unknown:0,untrusted:1,nothttps:2,trusted:3};Microsoft.Office.Common.MethodObject=function(c,b,a){this._method=c;this._invokeType=b;this._blockingOthers=a};Microsoft.Office.Common.MethodObject.prototype={getMethod:function(){return this._method},getInvokeType:function(){return this._invokeType},getBlockingFlag:function(){return this._blockingOthers}};Microsoft.Office.Common.EventMethodObject=function(b,a){this._registerMethodObject=b;this._unregisterMethodObject=a};Microsoft.Office.Common.EventMethodObject.prototype={getRegisterMethodObject:function(){return this._registerMethodObject},getUnregisterMethodObject:function(){return this._unregisterMethodObject}};Microsoft.Office.Common.ServiceEndPoint=function(c){var a=this,b=Function._validateParams(arguments,[{name:"serviceEndPointId",type:String,mayBeNull:false}]);if(b)throw b;a._methodObjectList={};a._eventHandlerProxyList={};a._Id=c;a._conversations={};a._policyManager=null;a._appDomains={};a._onHandleRequestError=null};Microsoft.Office.Common.ServiceEndPoint.prototype={registerMethod:function(g,h,b,e){var c="invokeType",a=false,d=Function._validateParams(arguments,[{name:"methodName",type:String,mayBeNull:a},{name:"method",type:Function,mayBeNull:a},{name:c,type:Number,mayBeNull:a},{name:"blockingOthers",type:Boolean,mayBeNull:a}]);if(d)throw d;if(b!==Microsoft.Office.Common.InvokeType.async&&b!==Microsoft.Office.Common.InvokeType.sync)throw OsfMsAjaxFactory.msAjaxError.argument(c);var f=new Microsoft.Office.Common.MethodObject(h,b,e);this._methodObjectList[g]=f},unregisterMethod:function(b){var a=Function._validateParams(arguments,[{name:"methodName",type:String,mayBeNull:false}]);if(a)throw a;delete this._methodObjectList[b]},registerEvent:function(f,d,c){var a=false,b=Function._validateParams(arguments,[{name:"eventName",type:String,mayBeNull:a},{name:"registerMethod",type:Function,mayBeNull:a},{name:"unregisterMethod",type:Function,mayBeNull:a}]);if(b)throw b;var e=new Microsoft.Office.Common.EventMethodObject(new Microsoft.Office.Common.MethodObject(d,Microsoft.Office.Common.InvokeType.syncRegisterEvent,a),new Microsoft.Office.Common.MethodObject(c,Microsoft.Office.Common.InvokeType.syncUnregisterEvent,a));this._methodObjectList[f]=e},registerEventEx:function(h,f,d,e,c){var a=false,b=Function._validateParams(arguments,[{name:"eventName",type:String,mayBeNull:a},{name:"registerMethod",type:Function,mayBeNull:a},{name:"registerMethodInvokeType",type:Number,mayBeNull:a},{name:"unregisterMethod",type:Function,mayBeNull:a},{name:"unregisterMethodInvokeType",type:Number,mayBeNull:a}]);if(b)throw b;var g=new Microsoft.Office.Common.EventMethodObject(new Microsoft.Office.Common.MethodObject(f,d,a),new Microsoft.Office.Common.MethodObject(e,c,a));this._methodObjectList[h]=g},unregisterEvent:function(b){var a=Function._validateParams(arguments,[{name:"eventName",type:String,mayBeNull:false}]);if(a)throw a;this.unregisterMethod(b)},registerConversation:function(c,g,b,f){var d="appDomains",a=true,e=Function._validateParams(arguments,[{name:"conversationId",type:String,mayBeNull:false},{name:"conversationUrl",type:String,mayBeNull:false,optional:a},{name:d,type:Object,mayBeNull:a,optional:a},{name:"serializerVersion",type:Number,mayBeNull:a,optional:a}]);if(e)throw e;if(b){if(!(b instanceof Array))throw OsfMsAjaxFactory.msAjaxError.argument(d);this._appDomains[c]=b}this._conversations[c]={url:g,serializerVersion:f}},unregisterConversation:function(b){var a=Function._validateParams(arguments,[{name:"conversationId",type:String,mayBeNull:false}]);if(a)throw a;delete this._conversations[b]},setPolicyManager:function(a){var b="policyManager",c=Function._validateParams(arguments,[{name:b,type:Object,mayBeNull:false}]);if(c)throw c;if(!a.checkPermission)throw OsfMsAjaxFactory.msAjaxError.argument(b);this._policyManager=a},getPolicyManager:function(){return this._policyManager},dispose:function(){var a=null,b=this;b._methodObjectList=a;b._eventHandlerProxyList=a;b._Id=a;b._conversations=a;b._policyManager=a;b._appDomains=a;b._onHandleRequestError=a}};Microsoft.Office.Common.ClientEndPoint=function(g,c,h,e){var d="targetWindow",b=false,a=this,f=Function._validateParams(arguments,[{name:"conversationId",type:String,mayBeNull:b},{name:d,mayBeNull:b},{name:"targetUrl",type:String,mayBeNull:b},{name:"serializerVersion",type:Number,mayBeNull:true,optional:true}]);if(f)throw f;try{if(!c.postMessage)throw OsfMsAjaxFactory.msAjaxError.argument(d)}catch(i){if(!Object.prototype.hasOwnProperty.call(c,"postMessage"))throw OsfMsAjaxFactory.msAjaxError.argument(d)}a._conversationId=g;a._targetWindow=c;a._targetUrl=h;a._callingIndex=0;a._callbackList={};a._eventHandlerList={};if(e!=null)a._serializerVersion=e;else a._serializerVersion=OSF.SerializerVersion.Browser;a._checkReceiverOriginAndRun=null;a._hostTrustCheckStatus=Microsoft.Office.Common.HostTrustStatus.unknown;a._checkStatusLogged=b};Microsoft.Office.Common.ClientEndPoint.prototype={invoke:function(d,c,b){var f=Function._validateParams(arguments,[{name:"targetMethodName",type:String,mayBeNull:false},{name:"callback",type:Function,mayBeNull:true},{name:"param",mayBeNull:true}]);if(f)throw f;var a=this,e=function(){var e=a._callingIndex++,j=new Date,f={callback:c,createdOn:j.getTime()};if(b&&typeof b==="object"&&typeof b.__timeout__==="number"){f.timeout=b.__timeout__;delete b.__timeout__}a._callbackList[e]=f;try{if(a._hostTrustCheckStatus!==Microsoft.Office.Common.HostTrustStatus.trusted)if(d!=="ContextActivationManager_getAppContextAsync")throw"Access Denied";var h=new Microsoft.Office.Common.Request(d,Microsoft.Office.Common.ActionType.invoke,a._conversationId,e,b),i=Microsoft.Office.Common.MessagePackager.envelope(h,a._serializerVersion);a._targetWindow.postMessage(i,a._targetUrl);Microsoft.Office.Common.XdmCommunicationManager._startMethodTimeoutTimer()}catch(g){try{c!==null&&c(Microsoft.Office.Common.InvokeResultCode.errorInRequest,g)}finally{delete a._callbackList[e]}}};if(a._checkReceiverOriginAndRun)a._checkReceiverOriginAndRun(e);else{a._hostTrustCheckStatus=Microsoft.Office.Common.HostTrustStatus.trusted;e()}},registerForEvent:function(d,g,c,i){var a=this,f=Function._validateParams(arguments,[{name:"targetEventName",type:String,mayBeNull:false},{name:"eventHandler",type:Function,mayBeNull:false},{name:"callback",type:Function,mayBeNull:true},{name:"data",mayBeNull:true,optional:true}]);if(f)throw f;var b=a._callingIndex++,k=new Date;a._callbackList[b]={callback:c,createdOn:k.getTime()};try{var h=new Microsoft.Office.Common.Request(d,Microsoft.Office.Common.ActionType.registerEvent,a._conversationId,b,i),j=Microsoft.Office.Common.MessagePackager.envelope(h,a._serializerVersion);a._targetWindow.postMessage(j,a._targetUrl);Microsoft.Office.Common.XdmCommunicationManager._startMethodTimeoutTimer();a._eventHandlerList[d]=g}catch(e){try{c!==null&&c(Microsoft.Office.Common.InvokeResultCode.errorInRequest,e)}finally{delete a._callbackList[b]}}},unregisterForEvent:function(d,c,h){var a=this,f=Function._validateParams(arguments,[{name:"targetEventName",type:String,mayBeNull:false},{name:"callback",type:Function,mayBeNull:true},{name:"data",mayBeNull:true,optional:true}]);if(f)throw f;var b=a._callingIndex++,j=new Date;a._callbackList[b]={callback:c,createdOn:j.getTime()};try{var g=new Microsoft.Office.Common.Request(d,Microsoft.Office.Common.ActionType.unregisterEvent,a._conversationId,b,h),i=Microsoft.Office.Common.MessagePackager.envelope(g,a._serializerVersion);a._targetWindow.postMessage(i,a._targetUrl);Microsoft.Office.Common.XdmCommunicationManager._startMethodTimeoutTimer()}catch(e){try{c!==null&&c(Microsoft.Office.Common.InvokeResultCode.errorInRequest,e)}finally{delete a._callbackList[b]}}finally{delete a._eventHandlerList[d]}}};Microsoft.Office.Common.XdmCommunicationManager=function(){var n="serviceEndPointId",d=true,e="a",c="null",m="channel is not ready.",h="conversationId",l="Unknown conversation Id.",a=false,b=null,s=[],r=b,i=b,w=10,k=a,j=b,B=2e3,v=65000,y=v,g={},f={},z=a;function C(b){for(var a in g)if(g[a]._conversations[b])return g[a];OsfMsAjaxFactory.msAjaxDebug.trace(l);throw OsfMsAjaxFactory.msAjaxError.argument(h)}function D(b){var a=f[b];!a&&OsfMsAjaxFactory.msAjaxDebug.trace(l);return a}function G(e,c){var a=e._methodObjectList[c._actionName];if(!a){OsfMsAjaxFactory.msAjaxDebug.trace("The specified method is not registered on service endpoint:"+c._actionName);throw OsfMsAjaxFactory.msAjaxError.argument("messageObject")}var d=b;if(c._actionType===Microsoft.Office.Common.ActionType.invoke)d=a;else if(c._actionType===Microsoft.Office.Common.ActionType.registerEvent)d=a.getRegisterMethodObject();else d=a.getUnregisterMethodObject();return d}function J(a){s.push(a)}function I(){if(i!==b){if(!k)if(s.length>0){var a=s.shift();x(a)}else{clearInterval(i);i=b}}else OsfMsAjaxFactory.msAjaxDebug.trace(m)}function x(a){k=a.getInvokeBlockingFlag();a.invoke();r=(new Date).getTime()}function F(){if(j){var c,e=0,i=new Date,d;for(var h in f){c=f[h];for(var g in c._callbackList){var a=c._callbackList[g];d=a.timeout?a.timeout:y;if(d>=0&&Math.abs(i.getTime()-a.createdOn)>=d)try{a.callback&&a.callback(Microsoft.Office.Common.InvokeResultCode.errorHandlingMethodCallTimedout,b)}finally{delete c._callbackList[g]}else e++}}if(e===0){clearInterval(j);j=b}}else OsfMsAjaxFactory.msAjaxDebug.trace(m)}function E(){k=a}function H(b){if(window.addEventListener)window.addEventListener("message",b,a);else if(navigator.userAgent.indexOf("MSIE")>-1&&window.attachEvent)window.attachEvent("onmessage",b);else{OsfMsAjaxFactory.msAjaxDebug.trace("Browser doesn't support the required API.");throw OsfMsAjaxFactory.msAjaxError.argument("Browser")}}function K(d,b){var h=a;if(!d||!b||d===c||b===c||!d.length||!b.length)return h;if(OSF.OUtil.checkFlight(OSF.FlightNames.AddinEnforceHttps))h=u(d,b);else{var g,f;g=document.createElement(e);f=document.createElement(e);g.href=d;f.href=b;h=t(g,f);delete g,f}return h}function p(b,d){var f=a;if(!d||d===c||!d.length||!b||!(b instanceof Array)||!b.length)return f;var i=document.createElement(e),h=document.createElement(e);i.href=d;for(var g=0;g<b.length&&!f;g++)if(b[g].indexOf("://")!==-1)if(OSF.OUtil.checkFlight(OSF.FlightNames.AddinEnforceHttps))f=u(d,b[g]);else{h.href=b[g];f=t(i,h)}delete i,h;return f}function q(b){if(!b||b===c)return a;var d=["^office-int\\.com$","^officeapps\\.live-int\\.com$","^.*\\.dod\\.online\\.office365\\.us$","^.*\\.gov\\.online\\.office365\\.us$","^.*\\.officeapps\\.live\\.com$","^.*\\.officeapps\\.live-int\\.com$","^.*\\.officeapps-df\\.live\\.com$","^.*\\.online\\.office\\.de$","^.*\\.partner\\.officewebapps\\.cn$","^.*\\.office\\.net$","^"+document.domain.replace(new RegExp("\\.","g"),"\\.")+"$"],e=new RegExp(d.join("|"));return e.test(b)}function o(h,i){if(!h||!i||h===c||i===c)return a;var b,f;if(OSF.OUtil.checkFlight(OSF.FlightNames.AddinEnforceHttps)){b=OSF.OUtil.parseUrl(h,d);f=OSF.OUtil.parseUrl(i,d)}else{b=document.createElement(e);b.href=h;f=document.createElement(e);f.href=i}var n=b.protocol===f.protocol,o=b.port===f.port,j=f.hostname,g=b.hostname,k=j===g,l=a;if(!k&&j.length>g.length+1)l=j.slice(-(g.length+1))==="."+g;var m=k||l;return o&&n&&m}function u(c,e){var a=OSF.OUtil.parseUrl(c,d),b=OSF.OUtil.parseUrl(e,d);return t(a,b)}function t(a,b){return a.hostname==b.hostname&&a.protocol==b.protocol&&a.port==b.port}function L(g){var t="Access Denied";if(!OSF)return;if(g.data!=""){var f,h=OSF.SerializerVersion.Browser,Q=g.data;try{f=Microsoft.Office.Common.MessagePackager.unenvelope(Q,OSF.SerializerVersion.Browser);h=f._serializerVersion!=b?f._serializerVersion:h}catch(m){return}if(f._messageType===Microsoft.Office.Common.MessageType.request){var F=g.origin==b||g.origin===c?f._origin:g.origin;try{var j=C(f._conversationId),s=j._conversations[f._conversationId];h=s.serializerVersion!=b?s.serializerVersion:h;var z=[s.url].concat(j._appDomains[f._conversationId]);if(!p(z,g.origin))if(!OfficeExt.appSpecificCheckOrigin(z,g,f._origin,p)){var P=o(s.url,g.origin);if(!P)throw"Failed origin check"}var u=f._data!=b?f._data:{};u.SecurityOrigin=g.origin;var B=j.getPolicyManager();if(B&&!B.checkPermission(f._conversationId,f._actionName,u))throw t;var T=G(j,f),O=new Microsoft.Office.Common.InvokeCompleteCallback(g.source,F,f._actionName,f._conversationId,f._correlationId,E,h),M=new Microsoft.Office.Common.Invoker(T,u,O,j._eventHandlerProxyList,f._conversationId,f._actionName,h),H=d;if(i==b)if((r==b||(new Date).getTime()-r>w)&&!k){x(M);H=a}else i=setInterval(I,w);H&&J(M)}catch(m){j&&j._onHandleRequestError&&j._onHandleRequestError(f,m);var L=Microsoft.Office.Common.InvokeResultCode.errorHandlingRequest;if(m==t)L=Microsoft.Office.Common.InvokeResultCode.errorHandlingRequestAccessDenied;var S=new Microsoft.Office.Common.Response(f._actionName,f._conversationId,f._correlationId,L,Microsoft.Office.Common.ResponseType.forCalling,m),R=Microsoft.Office.Common.MessagePackager.envelope(S,h),A=a;try{A=!!(g.source&&g.source.postMessage)}catch(m){}var n=a;if(window.location.href&&g.origin&&g.origin!==c&&o(window.location.href,g.origin))n=d;else if(g.origin&&g.origin!==c)if(OSF.OUtil.checkFlight(OSF.FlightNames.AddinEnforceHttps)){var U=OSF.OUtil.parseUrl(g.origin,d).hostname;n=q(U)}else{var N=document.createElement(e);N.href=g.origin;n=q(N.hostname)}A&&n&&g.source.postMessage(R,F)}}else if(f._messageType===Microsoft.Office.Common.MessageType.response){var l=D(f._conversationId);if(!l)return;l._serializerVersion=h;if(!K(l._targetUrl,g.origin))throw"Failed orgin check";if(f._responseType===Microsoft.Office.Common.ResponseType.forCalling){var v=l._callbackList[f._correlationId];if(v)try{v.callback&&v.callback(f._errorCode,f._data)}finally{delete l._callbackList[f._correlationId]}}else{var y=l._eventHandlerList[f._actionName];y!==undefined&&y!==b&&y(f._data)}}else return}}function A(){if(!z){H(L);z=d}}return {connect:function(b,d,e,c){var a=f[b];if(!a){A();a=new Microsoft.Office.Common.ClientEndPoint(b,d,e,c);f[b]=a}return a},getClientEndPoint:function(c){var b=Function._validateParams(arguments,[{name:h,type:String,mayBeNull:a}]);if(b)throw b;return f[c]},createServiceEndPoint:function(a){A();var b=new Microsoft.Office.Common.ServiceEndPoint(a);g[a]=b;return b},getServiceEndPoint:function(c){var b=Function._validateParams(arguments,[{name:n,type:String,mayBeNull:a}]);if(b)throw b;return g[c]},deleteClientEndPoint:function(c){var b=Function._validateParams(arguments,[{name:h,type:String,mayBeNull:a}]);if(b)throw b;delete f[c]},deleteServiceEndPoint:function(c){var b=Function._validateParams(arguments,[{name:n,type:String,mayBeNull:a}]);if(b)throw b;delete g[c]},checkUrlWithAppDomains:function(a,b){return p(a,b)},isTargetSubdomainOfSourceLocation:function(a,b){return o(a,b)},_setMethodTimeout:function(b){var c=Function._validateParams(arguments,[{name:"methodTimeout",type:Number,mayBeNull:a}]);if(c)throw c;y=b<=0?v:b},_startMethodTimeoutTimer:function(){if(!j)j=setInterval(F,B)},isHostNameValidWacDomain:function(a){return q(a)}}}();Microsoft.Office.Common.Message=function(g,h,e,f,c){var b=false,a=this,d=Function._validateParams(arguments,[{name:"messageType",type:Number,mayBeNull:b},{name:"actionName",type:String,mayBeNull:b},{name:"conversationId",type:String,mayBeNull:b},{name:"correlationId",mayBeNull:b},{name:"data",mayBeNull:true,optional:true}]);if(d)throw d;a._messageType=g;a._actionName=h;a._conversationId=e;a._correlationId=f;a._origin=window.location.origin;if(typeof c=="undefined")a._data=null;else a._data=c};Microsoft.Office.Common.Message.prototype={getActionName:function(){return this._actionName},getConversationId:function(){return this._conversationId},getCorrelationId:function(){return this._correlationId},getOrigin:function(){return this._origin},getData:function(){return this._data},getMessageType:function(){return this._messageType}};Microsoft.Office.Common.Request=function(c,d,a,b,e){Microsoft.Office.Common.Request.uber.constructor.call(this,Microsoft.Office.Common.MessageType.request,c,a,b,e);this._actionType=d};OSF.OUtil.extend(Microsoft.Office.Common.Request,Microsoft.Office.Common.Message);Microsoft.Office.Common.Request.prototype.getActionType=function(){return this._actionType};Microsoft.Office.Common.Response=function(d,a,b,e,c,f){Microsoft.Office.Common.Response.uber.constructor.call(this,Microsoft.Office.Common.MessageType.response,d,a,b,f);this._errorCode=e;this._responseType=c};OSF.OUtil.extend(Microsoft.Office.Common.Response,Microsoft.Office.Common.Message);Microsoft.Office.Common.Response.prototype.getErrorCode=function(){return this._errorCode};Microsoft.Office.Common.Response.prototype.getResponseType=function(){return this._responseType};Microsoft.Office.Common.MessagePackager={envelope:function(a){if(typeof a==="object")a._serializerVersion=OSF.SerializerVersion.Browser;return JSON.stringify(a)},unenvelope:function(a){return JSON.parse(a)}};Microsoft.Office.Common.ResponseSender=function(f,i,k,g,h,j,e){var c=false,a=this,d=Function._validateParams(arguments,[{name:"requesterWindow",mayBeNull:c},{name:"requesterUrl",type:String,mayBeNull:c},{name:"actionName",type:String,mayBeNull:c},{name:"conversationId",type:String,mayBeNull:c},{name:"correlationId",mayBeNull:c},{name:"responsetype",type:Number,maybeNull:c},{name:"serializerVersion",type:Number,maybeNull:true,optional:true}]);if(d)throw d;a._requesterWindow=f;a._requesterUrl=i;a._actionName=k;a._conversationId=g;a._correlationId=h;a._invokeResultCode=Microsoft.Office.Common.InvokeResultCode.noError;a._responseType=j;var b=a;a._send=function(f){try{var d=new Microsoft.Office.Common.Response(b._actionName,b._conversationId,b._correlationId,b._invokeResultCode,b._responseType,f),c=Microsoft.Office.Common.MessagePackager.envelope(d,e);b._requesterWindow.postMessage(c,b._requesterUrl)}catch(a){OsfMsAjaxFactory.msAjaxDebug.trace("ResponseSender._send error:"+a.message)}}};Microsoft.Office.Common.ResponseSender.prototype={getRequesterWindow:function(){return this._requesterWindow},getRequesterUrl:function(){return this._requesterUrl},getActionName:function(){return this._actionName},getConversationId:function(){return this._conversationId},getCorrelationId:function(){return this._correlationId},getSend:function(){return this._send},setResultCode:function(a){this._invokeResultCode=a}};Microsoft.Office.Common.InvokeCompleteCallback=function(e,h,i,f,g,d,c){var b=this;Microsoft.Office.Common.InvokeCompleteCallback.uber.constructor.call(b,e,h,i,f,g,Microsoft.Office.Common.ResponseType.forCalling,c);b._postCallbackHandler=d;var a=b;b._send=function(g,b){if(b!=undefined)a._invokeResultCode=b;try{var f=new Microsoft.Office.Common.Response(a._actionName,a._conversationId,a._correlationId,a._invokeResultCode,a._responseType,g),e=Microsoft.Office.Common.MessagePackager.envelope(f,c);a._requesterWindow.postMessage(e,a._requesterUrl);a._postCallbackHandler()}catch(d){OsfMsAjaxFactory.msAjaxDebug.trace("InvokeCompleteCallback._send error:"+d.message)}}};OSF.OUtil.extend(Microsoft.Office.Common.InvokeCompleteCallback,Microsoft.Office.Common.ResponseSender);Microsoft.Office.Common.Invoker=function(i,j,e,f,h,k,g){var c=true,b=false,a=this,d=Function._validateParams(arguments,[{name:"methodObject",mayBeNull:b},{name:"paramValue",mayBeNull:c},{name:"invokeCompleteCallback",mayBeNull:b},{name:"eventHandlerProxyList",mayBeNull:c},{name:"conversationId",type:String,mayBeNull:b},{name:"eventName",type:String,mayBeNull:b},{name:"serializerVersion",type:Number,mayBeNull:c,optional:c}]);if(d)throw d;a._methodObject=i;a._param=j;a._invokeCompleteCallback=e;a._eventHandlerProxyList=f;a._conversationId=h;a._eventName=k;a._serializerVersion=g};Microsoft.Office.Common.Invoker.prototype={invoke:function(){var a=this;try{var b;switch(a._methodObject.getInvokeType()){case Microsoft.Office.Common.InvokeType.async:a._methodObject.getMethod()(a._param,a._invokeCompleteCallback.getSend());break;case Microsoft.Office.Common.InvokeType.sync:b=a._methodObject.getMethod()(a._param);a._invokeCompleteCallback.getSend()(b);break;case Microsoft.Office.Common.InvokeType.syncRegisterEvent:var d=a._createEventHandlerProxyObject(a._invokeCompleteCallback);b=a._methodObject.getMethod()(d.getSend(),a._param);a._eventHandlerProxyList[a._conversationId+a._eventName]=d.getSend();a._invokeCompleteCallback.getSend()(b);break;case Microsoft.Office.Common.InvokeType.syncUnregisterEvent:var g=a._eventHandlerProxyList[a._conversationId+a._eventName];b=a._methodObject.getMethod()(g,a._param);delete a._eventHandlerProxyList[a._conversationId+a._eventName];a._invokeCompleteCallback.getSend()(b);break;case Microsoft.Office.Common.InvokeType.asyncRegisterEvent:var c=a._createEventHandlerProxyObject(a._invokeCompleteCallback);a._methodObject.getMethod()(c.getSend(),a._invokeCompleteCallback.getSend(),a._param);a._eventHandlerProxyList[a._callerId+a._eventName]=c.getSend();break;case Microsoft.Office.Common.InvokeType.asyncUnregisterEvent:var f=a._eventHandlerProxyList[a._callerId+a._eventName];a._methodObject.getMethod()(f,a._invokeCompleteCallback.getSend(),a._param);delete a._eventHandlerProxyList[a._callerId+a._eventName]}}catch(e){a._invokeCompleteCallback.setResultCode(Microsoft.Office.Common.InvokeResultCode.errorInResponse);a._invokeCompleteCallback.getSend()(e)}},getInvokeBlockingFlag:function(){return this._methodObject.getBlockingFlag()},_createEventHandlerProxyObject:function(a){return new Microsoft.Office.Common.ResponseSender(a.getRequesterWindow(),a.getRequesterUrl(),a.getActionName(),a.getConversationId(),a.getCorrelationId(),Microsoft.Office.Common.ResponseType.forEventing,this._serializerVersion)}};OSF.OUtil.setNamespace("OSF",window);OSF.MessageIDs={FetchBundleUrl:0,LoadReactBundle:1,LoadBundleSuccess:2,LoadBundleError:3};OSF.AppName={Unsupported:0,Excel:1,Word:2,PowerPoint:4,Outlook:8,ExcelWebApp:16,WordWebApp:32,OutlookWebApp:64,Project:128,AccessWebApp:256,PowerpointWebApp:512,ExcelIOS:1024,Sway:2048,WordIOS:4096,PowerPointIOS:8192,Access:16384,Lync:32768,OutlookIOS:65536,OneNoteWebApp:131072,OneNote:262144,ExcelWinRT:524288,WordWinRT:1048576,PowerpointWinRT:2097152,OutlookAndroid:4194304,OneNoteWinRT:8388608,ExcelAndroid:8388609,VisioWebApp:8388610,OneNoteIOS:8388611,WordAndroid:8388613,PowerpointAndroid:8388614,Visio:8388615,OneNoteAndroid:4194305};OSF.InternalPerfMarker={DataCoercionBegin:"Agave.HostCall.CoerceDataStart",DataCoercionEnd:"Agave.HostCall.CoerceDataEnd"};OSF.HostCallPerfMarker={IssueCall:"Agave.HostCall.IssueCall",ReceiveResponse:"Agave.HostCall.ReceiveResponse",RuntimeExceptionRaised:"Agave.HostCall.RuntimeExecptionRaised"};OSF.AgaveHostAction={Select:0,UnSelect:1,CancelDialog:2,InsertAgave:3,CtrlF6In:4,CtrlF6Exit:5,CtrlF6ExitShift:6,SelectWithError:7,NotifyHostError:8,RefreshAddinCommands:9,PageIsReady:10,TabIn:11,TabInShift:12,TabExit:13,TabExitShift:14,EscExit:15,F2Exit:16,ExitNoFocusable:17,ExitNoFocusableShift:18,MouseEnter:19,MouseLeave:20,UpdateTargetUrl:21,InstallCustomFunctions:22,SendTelemetryEvent:23,UninstallCustomFunctions:24,SendMessage:25,LaunchExtensionComponent:26,StopExtensionComponent:27,RestartExtensionComponent:28,EnableTaskPaneHeaderButton:29,DisableTaskPaneHeaderButton:30,TaskPaneHeaderButtonClicked:31,RemoveAppCommandsAddin:32,RefreshRibbonGallery:33,GetOriginalControlId:34,OfficeJsReady:35,InsertDevManifest:36,InsertDevManifestError:37};OSF.SharedConstants={NotificationConversationIdSuffix:"_ntf"};OSF.DialogMessageType={DialogMessageReceived:0,DialogParentMessageReceived:1,DialogClosed:12006};OSF.OfficeAppContext=function(B,x,s,p,u,y,t,w,A,k,z,m,l,o,i,h,g,f,j,c,e,v,r,b,n,q,d){var a=this;a._id=B;a._appName=x;a._appVersion=s;a._appUILocale=p;a._dataLocale=u;a._docUrl=y;a._clientMode=t;a._settings=w;a._reason=A;a._osfControlType=k;a._eToken=z;a._correlationId=m;a._appInstanceId=l;a._touchEnabled=o;a._commerceAllowed=i;a._appMinorVersion=h;a._requirementMatrix=g;a._hostCustomMessage=f;a._hostFullVersion=j;a._isDialog=false;a._clientWindowHeight=c;a._clientWindowWidth=e;a._addinName=v;a._appDomains=r;a._dialogRequirementMatrix=b;a._featureGates=n;a._officeTheme=q;a._initialDisplayMode=d;a.get_id=function(){return this._id};a.get_appName=function(){return this._appName};a.get_appVersion=function(){return this._appVersion};a.get_appUILocale=function(){return this._appUILocale};a.get_dataLocale=function(){return this._dataLocale};a.get_docUrl=function(){return this._docUrl};a.get_clientMode=function(){return this._clientMode};a.get_bindings=function(){return this._bindings};a.get_settings=function(){return this._settings};a.get_reason=function(){return this._reason};a.get_osfControlType=function(){return this._osfControlType};a.get_eToken=function(){return this._eToken};a.get_correlationId=function(){return this._correlationId};a.get_appInstanceId=function(){return this._appInstanceId};a.get_touchEnabled=function(){return this._touchEnabled};a.get_commerceAllowed=function(){return this._commerceAllowed};a.get_appMinorVersion=function(){return this._appMinorVersion};a.get_requirementMatrix=function(){return this._requirementMatrix};a.get_dialogRequirementMatrix=function(){return this._dialogRequirementMatrix};a.get_hostCustomMessage=function(){return this._hostCustomMessage};a.get_hostFullVersion=function(){return this._hostFullVersion};a.get_isDialog=function(){return this._isDialog};a.get_clientWindowHeight=function(){return this._clientWindowHeight};a.get_clientWindowWidth=function(){return this._clientWindowWidth};a.get_addinName=function(){return this._addinName};a.get_appDomains=function(){return this._appDomains};a.get_featureGates=function(){return this._featureGates};a.get_officeTheme=function(){return this._officeTheme};a.get_initialDisplayMode=function(){return this._initialDisplayMode?this._initialDisplayMode:0}};OSF.OsfControlType={DocumentLevel:0,ContainerLevel:1};OSF.ClientMode={ReadOnly:0,ReadWrite:1};OSF.OUtil.setNamespace("Microsoft",window);OSF.OUtil.setNamespace("Office",Microsoft);OSF.OUtil.setNamespace("Client",Microsoft.Office);OSF.OUtil.setNamespace("WebExtension",Microsoft.Office);Microsoft.Office.WebExtension.InitializationReason={Inserted:"inserted",DocumentOpened:"documentOpened"};Microsoft.Office.WebExtension.ValueFormat={Unformatted:"unformatted",Formatted:"formatted"};Microsoft.Office.WebExtension.FilterType={All:"all"};Microsoft.Office.WebExtension.Parameters={BindingType:"bindingType",CoercionType:"coercionType",ValueFormat:"valueFormat",FilterType:"filterType",Columns:"columns",SampleData:"sampleData",GoToType:"goToType",SelectionMode:"selectionMode",Id:"id",PromptText:"promptText",ItemName:"itemName",FailOnCollision:"failOnCollision",StartRow:"startRow",StartColumn:"startColumn",RowCount:"rowCount",ColumnCount:"columnCount",Callback:"callback",AsyncContext:"asyncContext",Data:"data",Rows:"rows",OverwriteIfStale:"overwriteIfStale",FileType:"fileType",EventType:"eventType",Handler:"handler",SliceSize:"sliceSize",SliceIndex:"sliceIndex",ActiveView:"activeView",Status:"status",PlatformType:"platformType",HostType:"hostType",ForceConsent:"forceConsent",ForceAddAccount:"forceAddAccount",AuthChallenge:"authChallenge",AllowConsentPrompt:"allowConsentPrompt",ForMSGraphAccess:"forMSGraphAccess",AllowSignInPrompt:"allowSignInPrompt",EnableNewHosts:"enableNewHosts",AccountTypeFilter:"accountTypeFilter",Reserved:"reserved",Tcid:"tcid",Xml:"xml",Namespace:"namespace",Prefix:"prefix",XPath:"xPath",Text:"text",ImageLeft:"imageLeft",ImageTop:"imageTop",ImageWidth:"imageWidth",ImageHeight:"imageHeight",TaskId:"taskId",FieldId:"fieldId",FieldValue:"fieldValue",ServerUrl:"serverUrl",ListName:"listName",ResourceId:"resourceId",ViewType:"viewType",ViewName:"viewName",GetRawValue:"getRawValue",CellFormat:"cellFormat",TableOptions:"tableOptions",TaskIndex:"taskIndex",ResourceIndex:"resourceIndex",CustomFieldId:"customFieldId",Url:"url",MessageHandler:"messageHandler",Width:"width",Height:"height",RequireHTTPs:"requireHTTPS",MessageToParent:"messageToParent",DisplayInIframe:"displayInIframe",MessageContent:"messageContent",HideTitle:"hideTitle",UseDeviceIndependentPixels:"useDeviceIndependentPixels",PromptBeforeOpen:"promptBeforeOpen",EnforceAppDomain:"enforceAppDomain",UrlNoHostInfo:"urlNoHostInfo",AppCommandInvocationCompletedData:"appCommandInvocationCompletedData",Base64:"base64",FormId:"formId"};OSF.OUtil.setNamespace("DDA",OSF);OSF.DDA.DocumentMode={ReadOnly:1,ReadWrite:0};OSF.DDA.PropertyDescriptors={AsyncResultStatus:"AsyncResultStatus"};OSF.DDA.EventDescriptors={};OSF.DDA.ListDescriptors={};OSF.DDA.UI={};OSF.DDA.getXdmEventName=function(b,a){if(a==Microsoft.Office.WebExtension.EventType.BindingSelectionChanged||a==Microsoft.Office.WebExtension.EventType.BindingDataChanged||a==Microsoft.Office.WebExtension.EventType.DataNodeDeleted||a==Microsoft.Office.WebExtension.EventType.DataNodeInserted||a==Microsoft.Office.WebExtension.EventType.DataNodeReplaced)return b+"_"+a;else return a};OSF.DDA.MethodDispId={dispidMethodMin:64,dispidGetSelectedDataMethod:64,dispidSetSelectedDataMethod:65,dispidAddBindingFromSelectionMethod:66,dispidAddBindingFromPromptMethod:67,dispidGetBindingMethod:68,dispidReleaseBindingMethod:69,dispidGetBindingDataMethod:70,dispidSetBindingDataMethod:71,dispidAddRowsMethod:72,dispidClearAllRowsMethod:73,dispidGetAllBindingsMethod:74,dispidLoadSettingsMethod:75,dispidSaveSettingsMethod:76,dispidGetDocumentCopyMethod:77,dispidAddBindingFromNamedItemMethod:78,dispidAddColumnsMethod:79,dispidGetDocumentCopyChunkMethod:80,dispidReleaseDocumentCopyMethod:81,dispidNavigateToMethod:82,dispidGetActiveViewMethod:83,dispidGetDocumentThemeMethod:84,dispidGetOfficeThemeMethod:85,dispidGetFilePropertiesMethod:86,dispidClearFormatsMethod:87,dispidSetTableOptionsMethod:88,dispidSetFormatsMethod:89,dispidExecuteRichApiRequestMethod:93,dispidAppCommandInvocationCompletedMethod:94,dispidCloseContainerMethod:97,dispidGetAccessTokenMethod:98,dispidGetAuthContextMethod:99,dispidOpenBrowserWindow:102,dispidCreateDocumentMethod:105,dispidInsertFormMethod:106,dispidDisplayRibbonCalloutAsyncMethod:109,dispidGetSelectedTaskMethod:110,dispidGetSelectedResourceMethod:111,dispidGetTaskMethod:112,dispidGetResourceFieldMethod:113,dispidGetWSSUrlMethod:114,dispidGetTaskFieldMethod:115,dispidGetProjectFieldMethod:116,dispidGetSelectedViewMethod:117,dispidGetTaskByIndexMethod:118,dispidGetResourceByIndexMethod:119,dispidSetTaskFieldMethod:120,dispidSetResourceFieldMethod:121,dispidGetMaxTaskIndexMethod:122,dispidGetMaxResourceIndexMethod:123,dispidCreateTaskMethod:124,dispidAddDataPartMethod:128,dispidGetDataPartByIdMethod:129,dispidGetDataPartsByNamespaceMethod:130,dispidGetDataPartXmlMethod:131,dispidGetDataPartNodesMethod:132,dispidDeleteDataPartMethod:133,dispidGetDataNodeValueMethod:134,dispidGetDataNodeXmlMethod:135,dispidGetDataNodesMethod:136,dispidSetDataNodeValueMethod:137,dispidSetDataNodeXmlMethod:138,dispidAddDataNamespaceMethod:139,dispidGetDataUriByPrefixMethod:140,dispidGetDataPrefixByUriMethod:141,dispidGetDataNodeTextMethod:142,dispidSetDataNodeTextMethod:143,dispidMessageParentMethod:144,dispidSendMessageMethod:145,dispidExecuteFeature:146,dispidQueryFeature:147,dispidMethodMax:147};OSF.DDA.EventDispId={dispidEventMin:0,dispidInitializeEvent:0,dispidSettingsChangedEvent:1,dispidDocumentSelectionChangedEvent:2,dispidBindingSelectionChangedEvent:3,dispidBindingDataChangedEvent:4,dispidDocumentOpenEvent:5,dispidDocumentCloseEvent:6,dispidActiveViewChangedEvent:7,dispidDocumentThemeChangedEvent:8,dispidOfficeThemeChangedEvent:9,dispidDialogMessageReceivedEvent:10,dispidDialogNotificationShownInAddinEvent:11,dispidDialogParentMessageReceivedEvent:12,dispidObjectDeletedEvent:13,dispidObjectSelectionChangedEvent:14,dispidObjectDataChangedEvent:15,dispidContentControlAddedEvent:16,dispidActivationStatusChangedEvent:32,dispidRichApiMessageEvent:33,dispidAppCommandInvokedEvent:39,dispidOlkItemSelectedChangedEvent:46,dispidOlkRecipientsChangedEvent:47,dispidOlkAppointmentTimeChangedEvent:48,dispidOlkRecurrenceChangedEvent:49,dispidOlkAttachmentsChangedEvent:50,dispidOlkEnhancedLocationsChangedEvent:51,dispidOlkInfobarClickedEvent:52,dispidTaskSelectionChangedEvent:56,dispidResourceSelectionChangedEvent:57,dispidViewSelectionChangedEvent:58,dispidDataNodeAddedEvent:60,dispidDataNodeReplacedEvent:61,dispidDataNodeDeletedEvent:62,dispidEventMax:63};OSF.Constants={FileVersion:"0.0.0.0",ThreePartsFileVersion:"0.0.0",OmexAnonymousServiceName:"__omexExtensionAnonymousProxy",OmexAnonymousServiceExtension:"/anonymousserviceextension.aspx",OmexGatedServiceName:"__omexExtensionGatedProxy",OmexGatedServiceExtension:"/gatedserviceextension.aspx",OmexUnGatedServiceName:"__omexExtensionProxy",OmexUnGatedServiceExtension:"/ungatedserviceextension.aspx",OmexConsentNotificationPage:"/client/consentnotification.aspx",Http:"http",Https:"https",ProtocolSeparator:"://",SignInRedirectUrl:"/logontoliveforwac.aspx?returnurl=",ETokenParameterName:"et",ActivatedCacheKey:"__OSF_RUNTIME_.Activated.{0}.{1}.{2}",AuthenticatedConnectMaxTries:3,IgnoreSandBoxSupport:"Ignore_SandBox_Support",IEUpgradeUrl:"https://office.microsoft.com/redir/HA102789344.aspx",OmexForceAnonymousParamName:"SKAV",OmexForceAnonymousParamValue:"274AE4CD-E50B-4342-970E-1E7F36C70037",EndPointInternalSuffix:"_internal",PreloadOfficeJsId:"OFFICEJSPRELOAD",DisplayLanguageParameterName:"_office.displayLanguage",PreloadOfficeJsUrl:"//appsforoffice.microsoft.com/preloading/preloadoffice.js",StringResourceFile:"osfruntime_strings.js"};var OfficeExt;(function(a){var b=function(){function b(){}b.init=function(b){return a.ShortcutsMappingTableManager.init(b)};b.getActionFromShortcutKey=function(c,b){if(b<1||b>255)throw OSF.OUtil.formatString(Strings.OfficeOM.L_InvalidParameters,b);return a.ShortcutsMappingTableManager.getShortcutsInfoDeprecated(c,b)};b.getShortcutInfoArrayFromShortcutKey=function(c,b){if(b<1||b>255)throw OSF.OUtil.formatString(Strings.OfficeOM.L_InvalidParameters,b);return a.ShortcutsMappingTableManager.getShortcutsInfo(c,b)};return b}();a.ActionMetadataManager=b})(OfficeExt||(OfficeExt={}));var OfficeExt;(function(a){var b=-1;a.TelemetryProperties={ariaTenantToken:"db334b301e7b474db5e0f02f07c51a47-a1b5bc36-1bbe-482f-a64a-c2d9cb606706-7439",nexusTenantToken:1755};var c=function(){var e="Error: Invalid key combination",c=null;function d(){}d.getKeyCodeFromVirtualKey=function(f){if(!d.s_stringToKeyCodeMap){d.s_stringToKeyCodeMap={};var e=Object.keys(d.keyCodes);for(var g in e){var a=e[g],c=d.keyCodes[a],b=d.specialCharacters[c];if(b)d.s_stringToKeyCodeMap[b]=a;d.s_stringToKeyCodeMap[c.toUpperCase()]=a}}return d.s_stringToKeyCodeMap[f.toUpperCase()]};d.convertModifierKeyToNumber=function(b){b=b.trim();var a=b.toUpperCase();if(d.modifierKeys[a]==c)if(a.length==1||d.keyCodes[a]){Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Error: Multiple virtual key",c,c,0);return c}else{Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Error: Invalid modifier key",c,c,0);return c}return d.modifierKeys[a]};d.convertModifierKeys=function(e){for(var f=0,a=0;a<e.length;a++){if(e[a]==c)return b;f=f|d.convertModifierKeyToNumber(e[a])}return f};d.convertStringToKeys=function(k){var a=k.split("+");if(a.length<2){Telemetry.RuntimeTelemetryHelper.LogExceptionTag(e,c,c,c);return c}var h=a.splice(0,a.length-1),i=a[a.length-1],f=d.convertModifierKeys(h),g=d.convertVirtualKeyToInt(i);if(g==b||f==b){Telemetry.RuntimeTelemetryHelper.LogExceptionTag(e,c,c,0);return c}var j={modifierKeys:f,virtualKey:g};return j};d.convertVirtualKeyToInt=function(a){a=a.trim();var c=a.toUpperCase();if(c.length==1)return c.charCodeAt(0);var e=d.getKeyCodeFromVirtualKey(c);if(e)return e;return b};d.getShortcutsInfoDeprecated=function(e,b){if(d.s_shortcutsMappingTable[b]==c)return c;var a=d.s_shortcutsMappingTable[b][e];if(a==c)return c;return {addinId:a[0].addinId,actionId:a[0].actionId}};d.getShortcutsInfo=function(g,f){var b=[];if(d.s_shortcutsMappingTable[f]==c)return b;var a=d.s_shortcutsMappingTable[f][g];if(a==c)return b;for(var e in a)b.push({addinId:a[e].addinId,actionId:a[e].actionId});return b};d.getShortcutText=function(e,b,f){var a=d.keyCodes[b];if(!a)a=String.fromCharCode(b);var c=d.getModifierKeyString(e,f);return c+"+"+a};d.getModifierKeyString=function(f,e){var c=[],a=1;while(a<=f){if(f&a){var b=void 0;if(a==d.modifierKeys[d.s_optionKey.toUpperCase()]){if(!e)e=d.s_shortcutPlatformWin32;if(e.toLowerCase()==d.s_shortcutPlatformMac)b=d.s_optionKey;else b=d.s_altKey}else b=d.keyCodesToModifierKeys[a];b&&c.push(b)}a=a<<1}c=c.sort();return c.join("+")};d.getShortcutsMappingTableString=function(){if(d.s_shortcutsMappingTable==c)return c;var a=JSON.stringify(d.s_shortcutsMappingTable);return a};d.getKeysFromShortcutPlatformAvailability=function(a){if(typeof a==="object")if(a[d.s_shortcutPlatformWeb])return a[d.s_shortcutPlatformWeb];else if(a[d.s_shortcutPlatformDefault])return a[d.s_shortcutPlatformDefault];else return c;else return c};d.validateExtendedManifestShortcutKeys=function(g,f,b){return a.OsfCache.get(a.OsfCache.c_osfCacheTableName,d.s_shortcutsTableCacheKey).then(function(n){var j="Error: Duplicate key combination in the same add-in",i="Error: Cannot parse shortcut table cache",l=g.shortcuts;if(l){var h={},m={};try{if(n)m=JSON.parse(n)}catch(p){Telemetry.RuntimeTelemetryHelper.LogExceptionTag(i,c,c,0);if(b)throw i}for(var k=0;k<l.length;k++){var q=d.getKeysFromShortcutPlatformAvailability(l[k].key),a=d.convertStringToKeys(q);if(a==c){Telemetry.RuntimeTelemetryHelper.LogExceptionTag(e,c,c,0);if(b)throw e}if(m[a.virtualKey])if(m[a.virtualKey][a.modifierKeys]){m[a.virtualKey][a.modifierKeys].push({actionId:l[k].action,addinId:f});Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Warning: Duplicate key combination in existing cache",c,c,0)}if(h[a.virtualKey]==c)h[a.virtualKey]={};if(h[a.virtualKey][a.modifierKeys]){for(var o in h[a.virtualKey][a.modifierKeys])if(h[a.virtualKey][a.modifierKeys][o].addinId==f)if(h[a.virtualKey][a.modifierKeys][o].actionId==l[k].action)Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Error: Duplicate shortcut entry",c,c,0);else{Telemetry.RuntimeTelemetryHelper.LogExceptionTag(j,c,c,0);if(b)throw j}}else h[a.virtualKey][a.modifierKeys]=[];h[a.virtualKey][a.modifierKeys].push({actionId:l[k].action,addinId:f})}}})};d.rebuildMappingTable=function(g){d.s_shortcutsMappingTable={};for(var f=0;f<g.length;f++){var b=g[f].extendedManifest.shortcuts,h=g[f].addinId;if(b){for(var e=0;e<b.length;e++){var j=d.getKeysFromShortcutPlatformAvailability(b[e].key),a=d.convertStringToKeys(j);if(a==c)return;var i={modifierKeys:a.modifierKeys,virtualKey:a.virtualKey,actionId:b[e].action,addinId:h};if(d.s_shortcutsMappingTable[a.virtualKey]==c)d.s_shortcutsMappingTable[a.virtualKey]={};if(d.s_shortcutsMappingTable[a.virtualKey][a.modifierKeys]==c)d.s_shortcutsMappingTable[a.virtualKey][a.modifierKeys]=[];d.s_shortcutsMappingTable[a.virtualKey][a.modifierKeys].push(i)}d.sendShortcutTelemetry(h,b.length)}}};d.sendShortcutTelemetry=function(d,b){setTimeout(function(){if(typeof Otel!=="undefined"&&Otel.Telemetry&&Otel.Telemetry.sendOtelEvent){var e={otelEvent:{eventName:"Office.Extensibility.Shortcuts.InstallationInfo",dataFields:[{name:"addinId",dataType:1,value:d},{name:"shortcutsCount",dataType:2,value:b}],telemetryProperties:a.TelemetryProperties}};Otel.Telemetry.sendOtelEvent(e)}else Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("The Otel isn't available, couldn't call sendOtelEvent for logging the shortcuts telemetry",c,0)},0)};d.getAllExtendedManifestAndBuildMappingTable=function(){return a.OsfExtendedManifestCache.getAll().then(function(b){d.rebuildMappingTable(b);return a.OsfCache.set(a.OsfCache.c_osfCacheTableName,d.s_shortcutsTableCacheKey,a.ShortcutsMappingTableManager.getShortcutsMappingTableString())})};d.init=function(b){if(b)return a.OsfCache.get(a.OsfCache.c_osfCacheTableName,d.s_shortcutsTableCacheKey).then(function(a){if(a==c)return d.getAllExtendedManifestAndBuildMappingTable();else d.s_shortcutsMappingTable=JSON.parse(a)});else return d.getAllExtendedManifestAndBuildMappingTable()};d.s_shortcutPlatformMac="macintosh";d.s_shortcutPlatformWin32="windows";d.s_shortcutsTableCacheKey="shortcutstablecache";d.s_shortcutsMappingTable={};d.s_shortcutPlatformWeb="web";d.s_shortcutPlatformDefault="default";d.s_altKey="Alt";d.s_optionKey="Option";d.s_stringToKeyCodeMap=c;d.keyCodes={18:"Alt",192:"BackQuote",220:"\\",8:"BackSpace",20:"CapsLock",188:",",17:"Ctrl",189:"-",46:"Del",40:"Down",35:"End",13:"Enter",187:"=",27:"Esc",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",36:"Home",45:"Ins",37:"Left",219:"[",91:"Meta",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",96:"NumPad0",97:"NumPad1",98:"NumPad2",99:"NumPad3",100:"NumPad4",101:"NumPad5",102:"NumPad6",103:"NumPad7",104:"NumPad8",105:"NumPad9",111:"NumPadDivide",110:"NumPadDot",109:"NumPadMinus",106:"NumPadMultiply",107:"NumPadPlus",34:"PageDown",33:"PageUp",179:"Pause",190:".",44:"PrintScreen",39:"Right",221:"]",145:"ScrollLock",186:";",222:"'",191:"/",32:"Space",9:"Tab",38:"Up",16:"Shift"};d.specialCharacters={"/":"SLASH","'":"SINGLEQUOTE",";":"SEMICOLON",".":"PERIOD","[":"LEFTBRACKET","]":"RIGHTBRACKET","=":"EQUALSIGN","-":"DASH",",":"COMMA","\\":"BACKSLASH"};d.modifierKeys={SHIFT:4,CTRL:8,CONTROL:8,ALT:32,OPTION:32,COMMAND:256};d.keyCodesToModifierKeys={4:"Shift",8:"Ctrl",32:"Alt",256:"Command"};return d}();a.ShortcutsMappingTableManager=c})(OfficeExt||(OfficeExt={}));var __extends=this&&this.__extends||function(b,a){for(var c in a)if(a.hasOwnProperty(c))b[c]=a[c];function d(){this.constructor=b}b.prototype=a===null?Object.create(a):(d.prototype=a.prototype,new d)},OfficeExt;(function(a){var b;(function(s){var q="ov:Control",g="IsReactRibbonEnabled",p="ov:SourceLocation",e="resid",l="OfficeGroup",k="ov:Description",j="ov:Title",d=true,c=false,o="bt:Image",n="ov:VersionOverrides",m="o:OfficeApp",b=null,f="OfficeControl",I=f,h=function(){function a(a){this.name="AddinManifestError";this.message=this.name+": "+a}return a}(),G=function(){function a(a){this.name="AddinInternalError";this.message=a}return a}();function i(c,a){if(c==b)throw new h(a)}var z=function(){function a(b){var c="bt:String",a=this;a.Images={};a.Urls={};a.LongStrings={};a.ShortStrings={};var e=b.manifest._xmlProcessor.selectSingleNode(m),d=b.selectSingleNode(e,[n,"ov:Resources"]);a.parseCollection(b,b.selectChildNodes(o,d,["bt:Images"]),a.Images);a.parseCollection(b,b.selectChildNodes("bt:Url",d,["bt:Urls"]),a.Urls);a.parseCollection(b,b.selectChildNodes(c,d,["bt:LongStrings"]),a.LongStrings);a.parseCollection(b,b.selectChildNodes(c,d,["bt:ShortStrings"]),a.ShortStrings)}a.prototype.parseCollection=function(d,b,f){for(var e=b.length,a=0;a<e;a++){var c=b[a],g=c.getAttribute("id");f[g]=d.parseLocaleAwareSettingsAndGetValue(c)}};return a}();s.ManifestResourceManager=z;var r=function(){function a(d,c,b,e){var a=this;a.hostType=d;a.formFactor=c;a.entitlement=b;a.manifest=e;a.resources=new z(a);a.officeGroupCount=0;a.officeControlCount=0}a.prototype.shouldParseNode=function(e){if(OSF.OUtil.checkFlight(OSF.FlightNames.AddinRibbonControlsOverriddenByApi)){var a=this.manifest._xmlProcessor.selectSingleNode("ov:OverriddenByRibbonApi",e);if(a!=b&&this.manifest._parseBooleanNode(a))return c}return d};a.prototype.parseIdRequired=function(b){var a=b.getAttribute("id");i(a,"Id required");return a};a.prototype.parseLabel=function(c){var a=this.manifest._xmlProcessor.selectSingleNode("ov:Label",c);if(a!=b)return this.getShortString(a);return b};a.prototype.parseLabelRequired=function(b){var a=this.parseLabel(b);i(a,"Label required");return a};a.prototype.parseRequiredSuperTip=function(b){var a=this.parseSuperTip(b);i(a,"SuperTip required");return a};a.prototype.parseSuperTip=function(h){var c=this,e=b,a=c.manifest._xmlProcessor.selectSingleNode("ov:Supertip",h);if(a!=b){var f=a,g,d;a=c.manifest._xmlProcessor.selectSingleNode(j,f);i(a,"Title is necessary for SuperTip.");g=c.getShortString(a);a=c.manifest._xmlProcessor.selectSingleNode(k,f);i(a,"Description is necessary for SuperTip.");d=c.getLongString(a);e={title:g,description:d}}return e};a.prototype.parseRequiredIcon=function(b){var a=this.parseIcon(b);i(a,"Icon required");return a};a.prototype.parseIcon=function(g){var c=this.selectChildNodes(o,g,["ov:Icon"]),f=c.length;if(f==0)return b;for(var e={},a=0;a<f;a++){var d=c[a],h=d.getAttribute("size");e[h]=this.getImageResource(d)}return e};a.prototype.parseMultipleChildControls=function(d,b,e){for(var c=[],a=0;a<b.childNodes.length;a++)d.indexOf(b.childNodes[a].nodeName)!==-1&&c.push(b.childNodes[a]);return this.parseControls(c,e)};a.prototype.parseChildControls=function(a,d,c){var b=this.manifest._xmlProcessor.selectNodes(a,d);return this.parseControls(b,c)};a.prototype.parseControls=function(d,f){for(var b=[],g=d.length,a=0;a<g;a++){var e=d[a];if(this.shouldParseNode(e)){var c=f(this,e);i(c,"parser must return a control.");b.push(c)}}return b};a.prototype.parseGroupUnderTab=function(b){var a;switch(b.nodeName){case l:a=new Q;this.officeGroupCount++;break;default:a=new x}a.parse(this,b);return a};a.prototype.parseControlInGroup=function(e){var b="Unsupported control type.",d=e.getAttribute(a.typeAttributeName),c;if(OSF.OUtil.checkFlight(OSF.FlightNames.RibbonNativeGroupControl)){if(!d&&e.nodeName===I)d=f;switch(d){case "Menu":c=new w;break;case "Button":c=new D(d);break;case f:c=new O;this.officeControlCount++;break;default:throw new h(b)}}else switch(d){case "Menu":c=new w;break;case "Button":c=new D(d);break;default:throw new h(b)}c.parse(this,e);return c};a.prototype.parseMenuItem=function(b){var a=new S;a.parse(this,b);return a};a.prototype.parseLocaleAwareSettingsAndGetValue=function(c){var b=this,a={},f=c.getAttribute("DefaultValue");a[b.manifest._defaultLocale]=f;a[b.manifest._defaultLocale.toLocaleLowerCase()]=f;var d=b.manifest._xmlProcessor.selectNodes("bt:Override",c);if(d)for(var i=d.length,e=0;e<i;e++){var c=d[e],g=c.getAttribute("Locale"),h=c.getAttribute("Value");a[g]=h;a[g.toLocaleLowerCase()]=h}return b.manifest._getDefaultValue(a)};a.prototype.selectSingleNode=function(a,c){if(c==b)return a;for(var d=0;d<c.length;d++){a=this.manifest._xmlProcessor.selectSingleNode(c[d],a);if(a==b)break}return a};a.prototype.selectChildNodes=function(c,a,d){a=this.selectSingleNode(a,d);if(a==b)return [];return this.manifest._xmlProcessor.selectNodes(c,a)};a.prototype.getSingleNodeValue=function(c,b){var a=this.manifest._xmlProcessor.selectSingleNode(c,b);if(a)return this.manifest._xmlProcessor.getNodeValue(a);return ""};a.prototype.getResourceByNode=function(d,c){var a=c.getAttribute(e),b=d[a];i(b,"resid: "+a+" not found");return b};a.prototype.getImageResource=function(a){return this.getResourceByNode(this.resources.Images,a)};a.prototype.getUrlResource=function(a){return this.getResourceByNode(this.resources.Urls,a)};a.prototype.getLongString=function(a){return this.getResourceByNode(this.resources.LongStrings,a)};a.prototype.getShortString=function(a){return this.getResourceByNode(this.resources.ShortStrings,a)};a.typeAttributeName="xsi:type";return a}();s.ParsingContext=r;var t=function(){function a(){}a.buildControls=function(c,b){for(var e=b.length,a=0;a<e;a++){var d=b[a];d.apply(c)}};return a}(),J=function(){function a(d,e,b){var a=this;if(b===void 0)b=c;a.multipleCustomTabsEnabled=c;a.functionFile=d;a.builder=e;a.multipleCustomTabsEnabled=b}return a}(),M=function(){function a(){}a.prototype.parse=function(a,c){var b=a.manifest._xmlProcessor,e=b.selectSingleNode(j,c);i(e,"Title is necessary for GetStarted.");this.title=a.getShortString(e);var d=b.selectSingleNode(k,c);i(d,"Description is necessary for GetStarted.");this.description=a.getLongString(d);var f=b.selectSingleNode("ov:LearnMoreUrl",c);this.learnMoreUrl=a.getUrlResource(f)};return a}(),B=function(){function a(a){this.type=a}a.prototype.buildAction=function(){};a.prototype.parse=function(){};return a}(),P=function(c){__extends(a,c);function a(){c.apply(this,arguments);this.title=b}a.prototype.parse=function(a,c){var b=a.manifest._xmlProcessor.selectSingleNode(p,c);i(b,"SourceLocation is necessary for ShowTaskpane action");this.sourceLocation=a.getUrlResource(b);a.manifest.addManifestUrl(this.sourceLocation)};return a}(B),L=function(c){__extends(a,c);function a(){c.apply(this,arguments)}a.prototype.buildAction=function(a){return a.actionBuilder.buildShowTaskpane(this.sourceLocation,this.title,this.taskpaneId)};a.prototype.parse=function(d,g){var f=this;c.prototype.parse.call(f,d,g);var a=d.manifest._xmlProcessor.selectSingleNode("ov:TaskpaneId",g);if(a!=b)f.taskpaneId=a.firstChild.nodeValue;a=d.manifest._xmlProcessor.selectSingleNode("ov:SourceLocation ",g);if(a!=b)f.sourceLocationResid=a.getAttribute(e);a=d.manifest._xmlProcessor.selectSingleNode(j,g);if(a!=b)f.title=d.getShortString(a)};return a}(P),H=function(b){__extends(a,b);function a(){b.apply(this,arguments)}a.prototype.buildAction=function(a){i(a.functionFile,"Function file source url is necessary for ExecuteFunctionAction.");return a.actionBuilder.buildCallFunction(a.functionFile,this.functionName,this.controlId)};a.prototype.parse=function(a,c){var b=a.manifest._xmlProcessor.selectSingleNode("ov:FunctionName",c);i(b,"FunctionName is necessary for ExecuteFunctionAction.");this.functionName=a.manifest._xmlProcessor.getNodeValue(b)};return a}(B),u=function(){function a(){}a.prototype.parse=function(a,b){this.id=a.parseIdRequired(b);this.label=a.parseLabelRequired(b)};return a}(),w=function(b){__extends(a,b);function a(){b.apply(this,arguments)}a.prototype.apply=function(a){a.controlBuilder.startBuildMenu(this);t.buildControls(a,this.children);a.controlBuilder.endBuildMenu()};a.prototype.parse=function(a,c){var d=this;if(!a.shouldParseNode(c))return;b.prototype.parse.call(d,a,c);d.icon=a.parseRequiredIcon(c);d.superTip=a.parseRequiredSuperTip(c);var e=a.selectChildNodes("ov:Item",c,["ov:Items"]);d.children=a.parseControls(e,function(a,b){return a.parseMenuItem(b)})};return a}(u);s.MenuControl=w;var v=function(c){__extends(a,c);function a(a){c.call(this);this.enabled=d;this.controlType=a}a.prototype.apply=function(b){var a=this,d=a.action.buildAction(b),c={id:a.id,label:a.label,icon:a.icon,superTip:a.superTip,actionType:a.actionType,action:d,enabled:a.enabled};a.applyControl(b,c)};a.prototype.parse=function(d,e){var a=this;c.prototype.parse.call(a,d,e);a.icon=a.parseIcon(d,e);a.superTip=d.parseRequiredSuperTip(e);var j=d.manifest._xmlProcessor.selectSingleNode("ov:Action",e);i(j,"Action is necessary for itemControl.");var f=j.getAttribute(r.typeAttributeName),g;switch(f){case "ShowTaskpane":g=new L(f);break;case "ExecuteFunction":var l=g=new H(f);l.controlId=a.id;break;default:throw new h("Unsupported action type.")}g.parse(d,j);a.actionType=f;a.action=g;var k=d.manifest._xmlProcessor.selectSingleNode("ov:Enabled",e);if(k!=b)a.enabled=d.manifest._parseBooleanNode(k)};a.prototype.applyControl=function(){throw new G("Not implemented method applyControl for ItemControl.")};a.prototype.parseIcon=function(a,b){return a.parseIcon(b)};return a}(u),D=function(b){__extends(a,b);function a(){b.apply(this,arguments)}a.prototype.applyControl=function(a,b){a.controlBuilder.addButton(b)};a.prototype.parseIcon=function(a,b){return a.parseRequiredIcon(b)};return a}(v),S=function(b){__extends(a,b);function a(){b.call(this,"MenuItem")}a.prototype.applyControl=function(a,b){a.controlBuilder.addMenuItem(b)};return a}(v),O=function(c){__extends(a,c);function a(){var a=this;c.call(a,f);a.label=b;a.icon=b;a.superTip=b;a.actionType=b;a.action=b;a.enabled=d}a.prototype.apply=function(b){var a=this,c={id:a.id,label:a.label,icon:a.icon,superTip:a.superTip,actionType:a.actionType,action:a.action,enabled:a.enabled};a.applyControl(b,c)};a.prototype.parse=function(b,c){var a=this;try{a.id=b.parseIdRequired(c)}catch(d){throw new h("Required id attribute missing for OfficeControl.")}if(OSF.RibbonControlIdMap&&OSF.RibbonControlIdMap[a.id])a.id=OSF.RibbonControlIdMap[a.id];else if(!OSF.OUtil.checkFlight(OSF.FlightNames.AddinRibbonIdAllowUnknown))throw new h("Unsupported control id for OfficeControl.")};a.prototype.applyControl=function(a,b){a.controlBuilder.addNativeControl(b)};return a}(v),C=function(){function a(e){var a=this;a.label=b;a.isOfficeTab=c;a.visible=d;a.children=[];a.tabType="default";a.insertBefore="";a.insertAfter="";a.autoFocus=c;a.isOfficeTab=e}a.prototype.apply=function(a){a.builder.ribbonBuilder.startBuildTab(this);for(var d=this.children.length,b=0;b<d;b++){var c=this.children[b];c.apply(a)}a.builder.ribbonBuilder.endBuildTab()};a.prototype.parse=function(b,c){var a=this;a.id=b.parseIdRequired(c);if(!a.isOfficeTab){a.label=b.parseLabelRequired(c);if(OSF.OUtil.checkFlight(OSF.FlightNames.RibbonTabPosition)&&OSF.Settings[g]){a.insertBefore=b.getSingleNodeValue("ov:InsertBefore",c);a.insertAfter=b.getSingleNodeValue("ov:InsertAfter",c);if(a.insertBefore)b.insertBefore=a.insertBefore;if(a.insertAfter)b.insertAfter=a.insertAfter}if(OSF.OUtil.checkFlight(OSF.FlightNames.RibbonTabAutoFocus)&&OSF.Settings[g])if(a.insertBefore==="TabHome")a.autoFocus=d}if(OSF.OUtil.checkFlight(OSF.FlightNames.RibbonNativeGroupControl))if(OSF.Settings[g])a.children=b.parseMultipleChildControls(["Group",l],c,function(a,b){return a.parseGroupUnderTab(b)});else a.children=b.parseMultipleChildControls(["Group"],c,function(a,b){return a.parseGroupUnderTab(b)});else a.children=b.parseChildControls("ov:Group",c,function(b,c){var a=new x;a.parse(b,c);return a})};return a}(),x=function(b){__extends(a,b);function a(){b.apply(this,arguments);this.groupType="Custom"}a.prototype.parse=function(a,c){var d=this;if(!a.shouldParseNode(c))return;b.prototype.parse.call(d,a,c);d.icon=a.parseRequiredIcon(c);if(OSF.OUtil.checkFlight(OSF.FlightNames.RibbonNativeGroupControl))if(OSF.Settings[g])d.children=a.parseMultipleChildControls(["Control",f],c,function(a,b){return a.parseControlInGroup(b)});else d.children=a.parseMultipleChildControls(["Control"],c,function(a,b){return a.parseControlInGroup(b)});else d.children=a.parseChildControls(q,c,function(a,b){return a.parseControlInGroup(b)})};a.prototype.apply=function(a){a.builder.ribbonBuilder.startBuildGroup(this);t.buildControls({functionFile:a.functionFile,actionBuilder:a.builder.actionBuilder,controlBuilder:a.builder.ribbonBuilder},this.children);a.builder.ribbonBuilder.endBuildGroup()};return a}(u),Q=function(c){__extends(a,c);function a(){var a=this;c.call(a);a.children=b;a.label=b;a.icon=b;a.groupType=l}a.prototype.parse=function(b,c){var a=this;try{a.id=b.parseIdRequired(c)}catch(d){throw new h("Required id attribute missing for OfficeGroup.")}if(OSF.RibbonGroupIdMap&&OSF.RibbonGroupIdMap[a.id])a.id=OSF.RibbonGroupIdMap[a.id];else if(!OSF.OUtil.checkFlight(OSF.FlightNames.AddinRibbonIdAllowUnknown))throw new h("Unsupported id for OfficeGroup.")};a.prototype.apply=function(a){a.builder.ribbonBuilder.addNativeGroup(this)};return a}(x),K=function(){function a(a){this.type=a;this.tabs=[]}a.prototype.apply=function(a){if(this.type==a.builder.commandSurface)for(var f=this.tabs.length,e=0,d=0,c=0;c<f;c++){var b=this.tabs[c];if(OSF.OUtil.checkFlight(OSF.FlightNames.OSFTestFlight1001)){if(b.isOfficeTab&&e<1)e++;else if(!b.isOfficeTab&&(d<1||a.multipleCustomTabsEnabled))d++;else break;b.apply(a)}else{b.apply(a);if(!a.multipleCustomTabsEnabled)break}}};a.prototype.parse=function(a,i){var e=a.manifest._xmlProcessor.selectSingleNode("ov:OfficeTab",i);if(e!=b){var f=new C(d);f.parse(a,e);this.tabs.push(f)}var g=a.manifest._xmlProcessor.selectNodes("ov:CustomTab",i);if(g)for(var j=g.length,h=0;h<j;h++){e=g[h];if(e!=b){var f=new C(c);f.parse(a,e);this.tabs.push(f)}}OSF.OUtil.checkFlight(OSF.FlightNames.OSFTestFlight1000)&&!!otel&&!!otel.sendTelemetryEvent&&otel.sendTelemetryEvent({name:"Office.Online.Extensibility.Ribbon.OfficeGroupControlCount",dataFields:[{name:"OfficeControlCount",int64:a.officeControlCount},{name:"OfficeGroupCount",int64:a.officeGroupCount},{name:"InsertBefore",string:JSON.stringify(a.insertBefore)},{name:"InsertAfter",string:JSON.stringify(a.insertAfter)}]})};return a}(),N=function(){function a(){}a.prototype.parse=function(a,b){if(!a.shouldParseNode(b))return;this.id=a.parseIdRequired(b);this.children=a.parseChildControls(q,b,function(a,b){return a.parseControlInGroup(b)})};a.prototype.apply=function(a){a.controlBuilder.startBuildMenu({id:this.id,label:b,superTip:b});t.buildControls(a,this.children);a.controlBuilder.endBuildMenu()};return a}(),F=function(){function a(a){this.type=a}a.prototype.apply=function(a){this.type==a.builder.commandSurface&&t.buildControls({functionFile:a.functionFile,actionBuilder:a.builder.actionBuilder,controlBuilder:a.builder.contextMenuBuilder},this.children)};a.prototype.parse=function(a,b){this.children=a.parseChildControls("ov:OfficeMenu",b,function(b,c){var a=new N;a.parse(b,c);return a})};return a}(),y=function(){function a(a){this.type=a}a.prototype.apply=function(){};a.prototype.parse=function(b,c){var a=this,d=b.manifest._xmlProcessor.selectSingleNode("ov:Namespace",c);if(d)a.namespaceResId=d.getAttribute(e);var g=b.manifest._xmlProcessor.selectSingleNode("ov:Script",c);if(g)a.scriptResId=a._parseSourceLocationResId(b,g);if(!a.scriptResId)throw new h("Missing required <Script> element under element <ExtensionPoint xsi:type='CustomFunctions'>.");var i=b.manifest._xmlProcessor.selectSingleNode("ov:Page",c);if(i)a.pageResId=a._parseSourceLocationResId(b,i);if(!a.pageResId)throw new h("Missing required <Page> element under element <ExtensionPoint xsi:type='CustomFunctions'>.");var f=b.manifest._xmlProcessor.selectSingleNode("ov:Metadata",c);if(f)a.metadataResId=a._parseSourceLocationResId(b,f);if(!a.metadataResId)throw new h("Missing required <Metadata> element under element <ExtensionPoint xsi:type='CustomFunctions'>.")};a.prototype._parseSourceLocationResId=function(b,c){var a=b.manifest._xmlProcessor.selectSingleNode(p,c);if(a)return a.getAttribute(e);return undefined};return a}();s.CustomFunctionsExtensionPoint=y;var A=function(){function d(){var a=this;a.getStartedNode=b;a.functionFile=b;a.functionFileResid=b;a.cacheableUrls=[];a.ExtensionPoints=[]}d.prototype.cacheableResources=function(){return this.cacheableUrls};d.prototype.apply=function(f,i,e){var b=this;if(e===void 0)e=c;try{f.startApplyAddin({entitlement:b.extensionEntitlement,manifest:b.extensionManifest,startedNode:b.getStartedNode,overrides:{type:b.type,description:b.description}});for(var j=new J(b.functionFile,f,e),l=b.ExtensionPoints.length,g=0;g<l;g++){var k=b.ExtensionPoints[g];k.apply(j)}f.endApplyAddin()}catch(d){d instanceof h&&i.setErrorMessageForAddin(b.extensionEntitlement.assetId,Strings.OsfRuntime.L_AddinCommands_AddinNotSupported_Message);OSF.OUtil.checkFlight(OSF.FlightNames.ManifestParserDevConsoleLog)&&a.DevConsole.log(d);throw d}};d.prototype.parse=function(a,l){var c=this;c.type=l.getAttribute(r.typeAttributeName);var f=a.manifest._xmlProcessor.selectSingleNode(k,l);if(f!=b)c.description=a.getLongString(f);for(var p=a.selectChildNodes("ov:Host",l,["ov:Hosts"]),d=b,n=p.length,g=0;g<n;g++){var m=p[g],u=m.getAttribute(r.typeAttributeName);if(u==a.hostType){d=a.manifest._xmlProcessor.selectSingleNode("ov:"+a.formFactor,m);if(d==b)d=a.manifest._xmlProcessor.selectSingleNode("ov:AllFormFactors",m);break}}var o=a.manifest._xmlProcessor.selectSingleNode("ov:GetStarted",d);if(o!=b){c.getStartedNode=new M;c.getStartedNode.parse(a,o)}f=a.manifest._xmlProcessor.selectSingleNode("ov:FunctionFile",d);if(f!=b){c.functionFileResid=f.getAttribute(e);c.functionFile=a.getUrlResource(f);a.manifest.addManifestUrl(c.functionFile)}var q=a.manifest._xmlProcessor.selectNodes("ov:ExtensionPoint",d);n=q.length;for(var g=0;g<n;g++){var s=q[g],j=s.getAttribute(r.typeAttributeName),i;switch(j){case "Events":throw"Not Implemented";case "PrimaryCommandSurface":i=new K(j);break;case "ContextMenu":i=new F(j);break;case "CustomFunctions":i=new y(j);break;default:throw new h("Unsupported extension type.")}i.parse(a,s);c.ExtensionPoints.push(i)}var t=a.resources.Images;for(var v in t)c.cacheableUrls.push(t[v]);c.extensionEntitlement=a.entitlement;c.extensionManifest=a.manifest};return d}();s.VersionOverrides=A;var R=function(){function a(){}a.prototype.cacheableResources=function(){return []};a.prototype.apply=function(){};return a}(),E=function(){function c(b,a){this.hostType=b;this.formFactor=a}c.prototype.parseExtensions=function(g,d,j){try{var i=d._xmlProcessor.selectSingleNode(m),f=d._xmlProcessor.selectSingleNode(n,i);if(f==b)return new R;var e=new A;e.parse(new r(this.hostType,this.formFactor,g,d),f);return e}catch(c){c instanceof h&&j.setErrorMessageForAddin(g.assetId,Strings.OsfRuntime.L_AddinCommands_AddinNotSupported_Message);OSF.OUtil.checkFlight(OSF.FlightNames.ManifestParserDevConsoleLog)&&a.DevConsole.log(c);throw c}};return c}();s.AddinCommandsManifestParser=E})(b=a.Parser||(a.Parser={}))})(OfficeExt||(OfficeExt={}));var OfficeExt;(function(a){var b;(function(b){var a="[Add-in Dev Message]: ";function c(b){OSF.OUtil.getBooleanSetting("DevConsoleEnabled")&&console.log({ErrorSource:a,"Error:":b})}b.log=c})(b=a.DevConsole||(a.DevConsole={}))})(OfficeExt||(OfficeExt={}));var OfficeExt;(function(a){var b;(function(j){var c="Button",f="MenuItem",b=false,e="ShowTaskpane",a=null,l;(function(a){var c="LongString",b="ShortString";a[a["Image"]=0]="Image";a[a["Url"]=1]="Url";a[a[b]=2]=b;a[a[c]=3]=c})(l||(l={}));var d=function(){function a(a){this.name="AddinManifestError";this.message=this.name+": "+a}return a}(),x=function(){function a(a){this.name="AddinInternalError";this.message=a}return a}();function h(b,c){if(typeof b!==undefined&&b===a)throw new d(c)}function g(b,c){if(typeof b!==undefined&&b===a&&b==="")throw new d(c)}var k=function(){function b(f,d,c,g,b,e){var a=this;a.hostType=f;a.formFactor=d;a.entitlement=c;a.manifest=g;a.ribbonData=b;a.runtimeId=e;a.actions=a.parseActions(b.actions);h(a.actions,"actions is required")}b.prototype.parseActions=function(g){for(var f={},c=0;c<g.length;c++){var b=g[c];if(b.id&&b.type){var a;switch(b.type){case e:a=new s;a.parse(this,b);break;case "ExecuteFunction":a=new q;a.parse(this,b);break;default:throw new d("Unknown action type")}if(!a.runtimeId)a.runtimeId=this.runtimeId;f[b.id]=a}}return f};b.prototype.parseIdRequired=function(b){var c=b.id?b.id:a;g(c,"Id required");return c};b.prototype.parseLabelRequired=function(b){var a=this.parseLabel(b);h(a,"Label required");return a};b.prototype.parseLabel=function(b){var c=b.label?b.label:a;return c};b.prototype.parseSuperTipRequired=function(a){if(!a.superTip)throw new d("Supertip required");return this.parseSuperTip(a)};b.prototype.parseSuperTip=function(a){var b={title:"",description:""};if(a.superTip){b.title=a.superTip.title?a.superTip.title:"";b.description=a.superTip.description?a.superTip.description:""}return b};b.prototype.parseIconRequired=function(a){if(a.icon)return this.parseIcon(a);else throw new d("Icon required")};b.prototype.parseIcon=function(c){var d={};if(c.icon)for(var b=0,e=c.icon;b<e.length;b++){var a=e[b];if(a.size&&a.sourceLocation)d[a.size]=a.sourceLocation}return d};b.typeAttributeName="xsi:type";return b}();j.ParsingContext=k;var n=function(){function a(){}a.prototype.buildAction=function(){};a.prototype.parse=function(b,a){g(a.type,"Action type required.");this.type=a.type};return a}(),s=function(d){__extends(c,d);function c(){var c=this;d.apply(c,arguments);c.type=e;c.title=a;c.supportsPinning=b}c.prototype.buildAction=function(b){var a=this;return b.buildShowTaskpane(a.sourceLocation,a.title,a.taskpaneId,a.runtimeId)};c.prototype.parse=function(c,a){var b=this;d.prototype.parse.call(b,c,a);g(a.taskpaneId,"Taskpane ID required");b.taskpaneId=a.taskpaneId;g(a.sourceLocation,"Source Location required");b.sourceLocation=a.sourceLocation;h(a.title,"Title required");b.title=a.title;if(!a.supportPinning)b.supportsPinning=a.supportPinning};return c}(n),q=function(b){__extends(a,b);function a(){b.apply(this,arguments)}a.prototype.buildAction=function(a){return a.buildCallFunction(this.functionFile,this.functionName,this.controlId)};a.prototype.parse=function(c,a){b.prototype.parse.call(this,c,a);this.functionFile=a.functionFile;this.functionName=a.functionName};return a}(n),m=function(){function a(){}a.prototype.parse=function(a,b){this.id=a.parseIdRequired(b);this.label=a.parseLabelRequired(b)};return a}(),i=function(e){__extends(a,e);function a(){e.call(this);this.enabled=true}a.prototype.apply=function(){};a.prototype.parse=function(h,a){var g=this;e.prototype.parse.call(g,h,a);g.icon=h.parseIconRequired(a);g.superTip=h.parseSuperTipRequired(a);g.enabled=!a.enabled?b:true;if(a.type){g.controlType=a.type;if(a.type==f||a.type==c)if(a.actionId&&a.actionId in h.actions){g.actionParsed=h.actions[a.actionId];g.actionType=h.actions[a.actionId].type;g.actionParsed.controlId=g.id}else throw new d("Action is required")}};return a}(m),o=function(a){__extends(b,a);function b(){a.call(this);this.children=[];this.controlType="Menu"}b.prototype.apply=function(b,d){a.prototype.apply.call(this,b,d);b.ribbonBuilder.startBuildMenu(this);for(var c=0,e=this.children;c<e.length;c++){var f=e[c];f.apply(b,d)}b.ribbonBuilder.endBuildMenu()};b.prototype.parse=function(f,b){a.prototype.parse.call(this,f,b);if(b.items&&b.items instanceof Array)for(var c=0,g=b.items;c<g.length;c++){var h=g[c],e=new v;e.parse(f,h);this.children.push(e)}else throw new d("Menu items required.")};return b}(i);j.Menu=o;var v=function(b){__extends(a,b);function a(){b.call(this);this.controlType=f}a.prototype.apply=function(c,d){var a=this;b.prototype.apply.call(a,c,d);var f=a.actionParsed.buildAction(c.actionBuilder),e={id:a.id,label:a.label,icon:a.icon,superTip:a.superTip,actionType:a.actionType,action:f,enabled:a.enabled};c.ribbonBuilder.addMenuItem(e)};return a}(i),w=function(b){__extends(a,b);function a(){b.call(this);this.controlType=c}a.prototype.apply=function(c,d){var a=this;b.prototype.apply.call(a,c,d);var f=a.actionParsed.buildAction(c.actionBuilder),e={id:a.id,label:a.label,icon:a.icon,superTip:a.superTip,actionType:a.actionType,action:f,enabled:a.enabled};c.ribbonBuilder.addButton(e)};return a}(i),t=function(b){__extends(a,b);function a(){b.apply(this,arguments);this.children=[]}a.prototype.parse=function(a,h){var f=this;b.prototype.parse.call(f,a,h);f.icon=a.parseIconRequired(h);for(var i=0,l=h.controls;i<l.length;i++){var e=l[i];g(e.type,"Control type required.");switch(e.type){case c:var j=new w;j.parse(a,e);f.children.push(j);break;case "Menu":var k=new o;k.parse(a,e);f.children.push(k);break;default:throw new d("Unknown control type.")}}};a.prototype.apply=function(a,d){a.ribbonBuilder.startBuildGroup(this);for(var b=0,c=this.children;b<c.length;b++){var e=c[b];e.apply(a,d)}a.ribbonBuilder.endBuildGroup()};return a}(m),u=function(){function c(){var c=this;c.label=a;c.isOfficeTab=b;c.visible=true;c.children=[];c.tabType="contextual";c.insertBefore="";c.insertAfter=""}c.prototype.apply=function(a,d){a.ribbonBuilder.startBuildTab(this);for(var b=0,c=this.children;b<c.length;b++){var e=c[b];e.apply(a,d)}a.ribbonBuilder.endBuildTab()};c.prototype.parse=function(f,c){var a=this;a.id=c.id;a.visible=c.visible||b;a.label=f.parseLabelRequired(c);for(var d=0,g=c.groups;d<g.length;d++){var h=g[d],e=new t;e.parse(f,h);a.children.push(e)}};return c}(),r=function(){function b(c,a,b){this.entitlement=a;this.manifest=b;this.tabs=c}b.prototype.cacheableResources=function(){return []};b.prototype.apply=function(b,e){var f={entitlement:this.entitlement,manifest:this.manifest,overrides:a,startedNode:a};b.startApplyAddin(f);for(var c=0,d=this.tabs;c<d.length;c++){var g=d[c];g.apply(b,e)}b.endApplyAddin()};return b}(),p=function(){function a(c,b){var a=this;a.hostType=c;a.formFactor=b;a.tabs=[];a.maxTabCount=10}a.prototype.parse=function(a,f,b,l,m){var i=[];try{var g=new k(this.hostType,this.formFactor,a,f,b,m);g.parseActions(b.actions);for(var e=0,j=b.tabs.slice(0,this.maxTabCount);e<j.length;e++){var n=j[e],h=new u;h.parse(g,n);i.push(h)}}catch(c){c instanceof d&&l.setErrorMessageForAddin(a.assetId,Strings.OsfRuntime.L_AddinCommands_AddinNotSupported_Message);throw c}return new r(i,a,f)};return a}();j.AddinCommandsJsonParser=p})(b=a.JsonParser||(a.JsonParser={}))})(OfficeExt||(OfficeExt={}));var OfficeExt;(function(b){var a=function(){function a(){}a.createManifestForAddinAction=function(d,i,h,f){var b=null,c=new OSF.Manifest.ExtensionSettings,k=OSF.FormFactor.Default,e={},g=d._UILocale.toLocaleLowerCase();e[g]=h;c._defaultHeight=b;c._defaultWidth=b;c._sourceLocations={};c._sourceLocations[g]=i;var a=d,j=new OSF.Manifest.Manifest(function(d){d._xmlProcessor=a._xmlProcessor;d._displayNames=h!=b?e:a._displayNames;d._iconUrls=a._iconUrls;d._extensionSettings={formFactor:c};d._highResolutionIconUrls=a._highResolutionIconUrls;d._target=a._target;d._id=f!=b?f:a._id;d._version=a._version;d._providerName=a._providerName;d._idIssuer=a._idIssuer;d._alternateId=a._alternateId;d._defaultLocale=a._defaultLocale;d._signature=a._signature;d._capabilities=a._capabilities;d._hosts=a._hosts;d._descriptions=a._descriptions;d._appDomains=a._appDomains;d._permissions=a._permissions;d._requirements=a._requirements;d._webApplicationResource=a._webApplicationResource;d._webApplicationId=a._webApplicationId;d._webApplicationMsaId=a._webApplicationMsaId;d._webApplicationScopes=a._webApplicationScopes;d._webApplicationAuthorizations=a._webApplicationAuthorizations;d._ribbonExtensionControls=a._ribbonExtensionControls;d._equivalentAddins=a._equivalentAddins;d._versionOverrides=a._versionOverrides},a._UILocale);return j};a.cacheManifestForAction=function(b,c,a){OSF.OsfManifestManager.cacheManifest(c,a,b)};a.purgeManifestForAction=function(b,a){OSF.OsfManifestManager.purgeManifest(b,a)};return a}();b.AddinCommandsManifestManager=a})(OfficeExt||(OfficeExt={}));var OfficeExt;(function(b){var d="##UILessContainer##",a=null;b.AddinActionContextMap={};b.AutoShowTaskPaneControlIdMap={};var g={};(function(a){var c="ExclusiveForNew",b="ExclusiveForCur";a[a["Default"]=1]="Default";a[a[b]=2]=b;a[a[c]=3]=c})(b.CommandInvokeMode||(b.CommandInvokeMode={}));var f=b.CommandInvokeMode,c;(function(a){var d="ooeOperationNotSupported",c="ooeSuccess",b="ooeTimeout";a[a[b]=-1]=b;a[a[c]=0]=c;a[a[d]=5e3]=d})(c||(c={}));var j=function(){function f(a,c,b){this.contextProvider=a;this.manifest=b;this.entitlement=c}f.prototype.buildShowTaskpane=function(a,d,b,c){return this.CreateManifestAndActivationContextForTaskpaneCommand(a,d,b,c)};f.prototype.buildCallFunction=function(a,b,c){return this.CreateManifestAndActivationContextForUILessCommand(a,b,c)};f.prototype.CreateManifestAndActivationContextForTaskpaneCommand=function(e,i,b,h){var f=function(d,e){if(e!=c.ooeSuccess)return;if(b!=a)g[b]=d},d=function(e,d){var c=g[e];if(c==a)return false;var b=d.getOsfControl(c);if(b==a)return false;b._sharedRuntimeId==a&&b._refresh();return true};return this.CreateManifestAndActivationContext(e,i,b,h,function(h,c,g,e){b!=a&&d(b,c);h.showTaskpane(g,e,f)})};f.prototype.CreateManifestAndActivationContext=function(f,i,d,g,h){var e=this,c=b.AddinCommandsManifestManager.createManifestForAddinAction(this.manifest,f,i,a);return function(i){var k=e.contextProvider.createActionContext(i,function(r,k){var m=e.entitlement.assetId,l={assetId:m+(d||i),appVersion:e.entitlement.appVersion,storeId:e.entitlement.storeId,storeType:OSF.StoreType.InMemory,targetType:OSF.OsfControlTarget.TaskPane};c._inMemoryEToken=e.entitlement.eToken;var q=l.assetId,n=k==a?OSF.ManifestHostType.Workbook:OSF.getManifestHostType(k._hostType),o=i;if(k!=a){var p={ownerAssetId:m,controlId:i,originalControlId:""};k._notifyHost("0",OSF.AgaveHostAction.GetOriginalControlId,p);if(p.originalControlId!=a)o=p.originalControlId}var j=a;if(OSF.OUtil.checkFlight(OSF.FlightNames.AddinActionDefinitionHybridMode))if(f!=a)j=c.getSharedRuntimeForTaskpane(n,d||o);else{j=c.getSharedRuntimeById(n,g);d=c.getTaskpaneIdByRuntimeId(n,g);l.assetId=m+d}else j=c.getSharedRuntimeForTaskpane(n,d||o);if(j!=a&&j.Resid!=a&&j.Resid.length>0)q=OSF.OsfManifestManager.getSharedRuntimeManifestCacheKey(m,j.Resid);b.AddinCommandsManifestManager.cacheManifestForAction(c,q,l.appVersion);h(r,k,l,c,d)});b.AddinActionContextMap[i]=k;var j=b.AutoShowTaskPaneControlIdMap[e.entitlement.assetId];if(j==a&&d=="Office.AutoShowTaskpaneWithDocument")b.AutoShowTaskPaneControlIdMap[e.entitlement.assetId]=i}};f.prototype.CreateManifestAndActivationContextForUILessCommand=function(i,j,h){var f=this,k=function(a,b){if(b!=c.ooeSuccess)return;var d={source:{id:h}};e.invokeAppCommand(a,j,d,function(){})},g=b.AddinCommandsManifestManager.createManifestForAddinAction(this.manifest,i,a,a);return function(h){var i=f.contextProvider.createActionContext(h,function(n,j){var l=f.entitlement.assetId,i={assetId:l+d,appVersion:f.entitlement.appVersion,storeId:f.entitlement.storeId,storeType:OSF.StoreType.InMemory,targetType:OSF.OsfControlTarget.TaskPane},m=i.assetId,o=j==a?OSF.ManifestHostType.Workbook:OSF.getManifestHostType(j._hostType),h=g.getSharedRuntimeForAppCmdsExecuteFunction(o);if(h!=a&&h.Resid!=a&&h.Resid.length>0)m=OSF.OsfManifestManager.getSharedRuntimeManifestCacheKey(l,h.Resid);b.AddinCommandsManifestManager.cacheManifestForAction(g,m,i.appVersion);n.createUILessSandbox(i,g,function(a,b){if(b==c.ooeSuccess)var d=e.ensureOsfHostEntry(a,n);k(a,b)})});b.AddinActionContextMap[h]=i}};return f}(),h=function(){function a(a,b){this.contextProvider=a;this.entitlement=b}a.prototype.buildShowTaskpane=function(){var a=this;return function(c){delete b.AddinActionContextMap[c];b.AddinCommandsManifestManager.purgeManifestForAction(a.entitlement.assetId+c,a.entitlement.appVersion)}};a.prototype.buildCallFunction=function(){var a=this;return function(c){delete b.AddinActionContextMap[c];b.AddinCommandsManifestManager.purgeManifestForAction(a.entitlement.assetId+d,a.entitlement.appVersion)}};return a}(),i=function(){function a(){}a.createActionBuilder=function(a,c,b){return new j(a,c,b)};a.createDeleterActionBuilder=function(a,b){return new h(a,b)};a.bindAction=function(a,c){var b=c;b(a)};a.retrieveActionContext=function(a){return b.AddinActionContextMap[a]};a.retrieveAutoShowTaskPaneControlIdMap=function(){return b.AutoShowTaskPaneControlIdMap};return a}();b.DefaultControlActionBinder=i;var k=function(){function b(){this.invocationQueue={}}b.prototype.invokeAppCommand=function(l,i,d,m,e){var g=this,h={dispid:OSF.DDA.EventDispId.dispidAppCommandInvokedEvent,controlId:g.osfControlId};h[0]=l;h[1]=i;h[2]=JSON.stringify(d);e=e?e:b.defaultTimeout;var j=d&&d.commandMode?d.commandMode:f.Default,k={args:h,onComplete:m,timeout:e,timeoutTimer:a},c=g.invocationQueue[i];if(c==a){c=[];g.invocationQueue[i]=c}!(j==f.ExclusiveForCur&&c.length>0)&&!(j==f.ExclusiveForNew&&c.length>1)&&c.push(k);c.length==1&&g.trySendInvocation(k)};b.prototype.invocationCompleted=function(f,g,i){var c=this,h=c;for(var e in c.invocationQueue){var d=c.invocationQueue[e],b=d[0];if(f==b.args[0]){if(d.length>1){d.splice(0,1);var j=d[0];window.setTimeout(function(){h.trySendInvocation(j)},0)}else delete c.invocationQueue[e];if(b.timeoutTimer!=a){window.clearTimeout(b.timeoutTimer);b.timeoutTimer=a}b.onComplete(g,i);return}}};b.prototype.sendInvocations=function(c){var b=this;b.eventHandler=c;if(c==a)return;for(var d in b.invocationQueue){var e=b.invocationQueue[d],f=e[0];b.sendInvocation(c,f)}};b.prototype.trySendInvocation=function(c){var b=this.eventHandler;b!=a&&this.sendInvocation(b,c)};b.prototype.sendInvocation=function(c,a){var d=this,b=a.args;c(b);a.timeoutTimer=window.setTimeout(function(){d.invocationTimeout(b[0])},a.timeout)};b.prototype.invocationTimeout=function(b){this.invocationCompleted(b,c.ooeTimeout,a)};b.prototype.disposeHost=function(){var b=this;for(var c in b.invocationQueue)return;b.host.disposeHost(b.osfControlId);b.onDisposed!=a&&b.onDisposed(b)};b.defaultTimeout=300*1e3;return b}(),e=function(){var f="targetId",e="controlId",d="eventDispId";function b(){}b.registerEvent=function(g,c,a){b.registerEventInternal(a[d],a[e],a[f],g,function(a){c&&c(a==0)})};b.unregisterEvent=function(g,c,a){b.unregisterEventInternal(a[d],a[e],a[f],g,function(a){c&&c(a==0)})};b.invokeAppCommand=function(d,c,f,e){var g=b.getOrCreateOsfHostEntry(d),a=b.getNextAppCommandId();g.invokeAppCommand(a,c,f,e)};b.invocationCompleted=function(e,c){var g=b.getOrCreateOsfHostEntry(e),d=c[0],f=c[1],h=c[2]?JSON.parse(c[2]):a;g.invocationCompleted(d,f,h)};b.ensureOsfHostEntry=function(d,e){var c=b.getOrCreateOsfHostEntry(d);if(c.host==a)c.host=e;return c};b.getNextAppCommandId=function(){return "AppCmd"+b._nextAppCommandId++};b.getOrCreateOsfHostEntry=function(d){var c=b._invocationQueues[d];if(c==a){c=new k;c.osfControlId=d;c.onDisposed=function(a){delete b._invocationQueues[a.osfControlId]};b._invocationQueues[d]=c}return c};b.registerEventInternal=function(d,e,h,f,a){switch(d){case OSF.DDA.EventDispId.dispidAppCommandInvokedEvent:var g=b.getOrCreateOsfHostEntry(e);a(c.ooeSuccess);g.sendInvocations(f);return}a(c.ooeOperationNotSupported)};b.unregisterEventInternal=function(f,g,i,h,d){switch(f){case OSF.DDA.EventDispId.dispidAppCommandInvokedEvent:var e=b.getOrCreateOsfHostEntry(g);if(e.eventHandler==h)e.eventHandler=a;d(c.ooeSuccess);return}d(c.ooeOperationNotSupported)};b._nextAppCommandId=0;b._invocationQueues={};return b}();b.AddinCommandsRuntimeManager=e})(OfficeExt||(OfficeExt={}));OSF.ShowWindowDialogParameterKeys={Url:"url",Width:"width",Height:"height",DisplayInIframe:"displayInIframe",HideTitle:"hideTitle",UseDeviceIndependentPixels:"useDeviceIndependentPixels",PromptBeforeOpen:"promptBeforeOpen",EnforceAppDomain:"enforceAppDomain",UrlNoHostInfo:"urlNoHostInfo"};OSF.HostThemeButtonStyleKeys={ButtonBorderColor:"buttonBorderColor",ButtonBackgroundColor:"buttonBackgroundColor"};OSF.OmexPageParameterKeys={AppName:"client",AppVersion:"cv",AppUILocale:"ui",AppDomain:"appDomain",StoreLocator:"rs",AssetId:"assetid",NotificationType:"notificationType",AppCorrelationId:"corr",AuthType:"authType",AppId:"appid",Scopes:"scopes"};OSF.AuthType={Anonymous:0,MSA:1,OrgId:2,ADAL:3};OSF.OmexMessageKeys={MessageType:"messageType",MessageValue:"messageValue"};OSF.OmexRemoveAddinMessageKeys={RemoveAddinResultCode:"resultCode",RemoveAddinResultValue:"resultValue"};OSF.OmexRemoveAddinResultCode={Success:0,ClientError:400,ServerError:500,UnknownError:600};var OfficeExt;(function(a){var b;(function(a){var b="undefined",m="^https://[a-z0-9-]+.(officeapps.live|officeapps-df.live|partner.officewebapps).com/";function g(a,b){return OSF.OUtil.parseInfoFromWindowName(a,b,OSF.WindowNameItemKeys.AppContext)}a.parseAppContextFromWindowName=g;function d(a){if(typeof JSON!==b)try{return JSON.stringify(a)}catch(c){}return ""}a.serializeObjectToString=d;function o(){return (new RegExp(m)).test(OSF.getClientEndPoint()._targetUrl.toLowerCase())}a.isHostTrusted=o;function i(b,e){if(!b)return null;b=b.trim()||"";var f="?",k="_host_Info=",j="&_host_Info=",d="#",i=b.split(d),c=i.shift(),h=i.join(d),g=c.split(f),a;if(g.length>1)a=c+j+e;else if(g.length>0)a=c+f+k+e;if(h)return [a,d,h].join("");else return a}a.addHostInfoAsQueryParam=i;function j(b){if(!b)return null;var a=document.createElement("a");a.href=b;return a.protocol+"//"+a.host}a.getDomainForUrl=j;function f(){try{for(var b=["Windows NT 6.1","Windows NT 6.2","Windows NT 6.3","Windows NT 10.0"],f=window.navigator.userAgent,a=0,g=b.length;a<g;a++)if(f.indexOf(b[a])>-1)return e();return false}catch(d){c("Error happens in shouldUseLocalStorageToPassMessage.",d);return false}}a.shouldUseLocalStorageToPassMessage=f;function e(){try{var a=window.navigator.userAgent;return a.indexOf("MSIE ")>-1||a.indexOf("Trident/")>-1||a.indexOf("Edge/")>-1}catch(b){c("Error happens in isInternetExplorer.",b);return false}}a.isInternetExplorer=e;function h(c){for(var d=OSF.OUtil.getLocalStorage(),e=d.getKeysWithPrefix(""),a=0,h=e.length;a<h;a++)for(var f=e[a],b=0,g=c.length;b<g;b++)if(c[b].test(f)){d.removeItem(f);break}}a.removeMatchesFromLocalStorage=h;function c(b,a){OsfMsAjaxFactory.msAjaxDebug.trace(b+" Exception details: "+d(a))}a.logExceptionToBrowserConsole=c;function l(){var a=navigator.userAgent;return /Teams\/((?:(\d+)\.)?(?:(\d+)\.)?(?:(\d+)\.\d+)).* Electron\/((?:(\d+)\.)?(?:(\d+)\.)?(?:(\d+)\.\d+))/.test(a)}a.isTeamsWebView=l;function n(c){if(typeof c===b||!c)return undefined;var e=undefined,g="https:";try{var d=new URL(c);if(d)e=d.host;if(!d.protocol)throw"fallback";else if(d.protocol!==g)return undefined}catch(i){try{var a=document.createElement("a");a.href=c;if(a.protocol!==g)return undefined;var f=c.match(new RegExp("^https://[^/?#]+","i")),h=f&&f.length==1?f[0].toLowerCase():"",j=(a.protocol+"//"+a.hostname).toLowerCase(),k=(a.protocol+"//"+a.host).toLowerCase();if(k===h||j==h)e=a.port=="443"?a.hostname:a.host}catch(i){return undefined}}return e?e.toLowerCase():undefined}a.getHostSecure=n;var k=function(){function a(){}a.GatedCacheKeyPrefix="__OSF_GATED_OMEX.";a.AnonymousCacheKeyPrefix="__OSF_ANONYMOUS_OMEX.";a.UngatedCacheKeyPrefix="__OSF_OMEX.";a.ActivatedCacheKeyPrefix="__OSF_RUNTIME_.Activated.";a.AppinstallAuthenticated="appinstall_authenticated.";a.Entitlement="entitle.";a.AppState="appState.";a.AppDetails="appDetails.";a.AppInstallInfo="appInstallInfo.";a.AuthenticatedAppInstallInfoCacheKey=a.GatedCacheKeyPrefix+a.AppinstallAuthenticated+"{0}.{1}.{2}.{3}";a.EntitlementsKey=a.Entitlement+"{0}.{1}";a.AppStateCacheKey="{0}"+a.AppState+"{1}.{2}";a.AppDetailKey="{0}"+a.AppDetails+"{1}";a.AppInstallInfoKey="{0}"+a.AppInstallInfo+"{1}.{2}";a.ActivatedCacheKey=a.ActivatedCacheKeyPrefix+"{0}.{1}.{2}";return a}();a.CacheConstants=k})(b=a.WACUtils||(a.WACUtils={}))})(OfficeExt||(OfficeExt={}));OSF.XmlConstants={MaxXmlSize:1048576,MaxElementDepth:64};OSF.Xpath3Provider=function(f,e){var a=this;a._xmldoc=(new DOMParser).parseFromString(f,"text/xml");a._evaluator=new XPathEvaluator;a._namespaceMapping={};a._defaultNamespace=null;for(var d=e.split(" "),b,c=0;c<d.length;++c){b=/xmlns="([^"]*)"/g.exec(d[c]);if(b){a._defaultNamespace=b[1];continue}b=/xmlns:([^=]*)="([^"]*)"/g.exec(d[c]);if(b){a._namespaceMapping[b[1]]=b[2];continue}}a._resolver=a};OSF.Xpath3Provider.prototype={lookupNamespaceURI:function(a){var b=this._namespaceMapping[a];return b||this._defaultNamespace},addNamespaceMapping:function(a,b){var c=this._namespaceMapping[a];if(c)return false;else{this._namespaceMapping[a]=b;return true}},selectSingleNode:function(d,a){var c=(a?"./":"/")+d;a=a||this.getDocumentElement();var b=this._evaluator.evaluate(c,a,this._resolver,XPathResult.FIRST_ORDERED_NODE_TYPE,null);if(b)return b.singleNodeValue;else return null},selectNodes:function(f,a){var e=(a?"./":"/")+f;a=a||this.getDocumentElement();var b=this._evaluator.evaluate(e,a,this._resolver,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null),d=[];if(b){var c=b.iterateNext();while(c){d.push(c);c=b.iterateNext()}}return d},selectNodesByXPath:function(e,d){var a=this._evaluator.evaluate(e,d,this._resolver,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null),c=[];if(a){var b=a.iterateNext();while(b){c.push(b);b=a.iterateNext()}}return c},getDocumentElement:function(){return this._xmldoc.documentElement}};OSF.IEXpathProvider=function(f,e){for(var a=null,c=["MSXML2.DOMDocument.6.0"],b=0;b<c.length;b++)try{a=new ActiveXObject(c[b]);a.setProperty("ResolveExternals",false);a.setProperty("ValidateOnParse",false);a.setProperty("ProhibitDTD",true);a.setProperty("MaxXMLSize",OSF.XmlConstants.MaxXmlSize);a.setProperty("MaxElementDepth",OSF.XmlConstants.MaxElementDepth);a.async=false;a.loadXML(f);a.setProperty("SelectionLanguage","XPath");a.setProperty("SelectionNamespaces",e);break}catch(d){OsfMsAjaxFactory.msAjaxDebug.trace("xml doc creating error:"+d)}this._xmldoc=a};OSF.IEXpathProvider.prototype={selectSingleNode:function(c,a){var b=(a?"./":"/")+c;a=a||this.getDocumentElement();return a.selectSingleNode(b)},addNamespaceMapping:function(b,f){var c="SelectionNamespaces",a=this._xmldoc.getProperty(c),e="xmlns:"+b+"=",d="xmlns:"+b+'="'+f+'"';if(a.indexOf(e)!=-1)return false;a=a+" "+d;this._xmldoc.setProperty(c,a);return true},selectNodes:function(c,a){var b=(a?"./":"/")+c;a=a||this.getDocumentElement();return a.selectNodes(b)},selectNodesByXPath:function(b,a){return a.selectNodes(b)},getDocumentElement:function(){return this._xmldoc.documentElement},getActiveXObject:function(){return this._xmldoc}};OSF.DomParserProvider=function(g,f){var b=this;try{b._xmldoc=(new DOMParser).parseFromString(g,"text/xml")}catch(e){Sys.Debug.trace("xml doc creating error:"+e)}b._namespaceMapping={};b._defaultNamespace=null;for(var d=f.split(" "),a,c=0;c<d.length;++c){a=/xmlns="([^"]*)"/g.exec(d[c]);if(a){b._defaultNamespace=a[1];continue}a=/xmlns:([^=]*)="([^"]*)"/g.exec(d[c]);if(a){b._namespaceMapping[a[1]]=a[2];continue}}};OSF.DomParserProvider.prototype={addNamespaceMapping:function(a,b){var c=this._namespaceMapping[a];if(c)return false;else{this._namespaceMapping[a]=b;return true}},selectSingleNode:function(d,c){var b=c||this._xmldoc,a=this._selectNodes(d,b);if(a.length===0)return null;return a[0]},selectNodes:function(c,b){var a=b||this._xmldoc;return this._selectNodes(c,a)},selectNodesByXPath:function(){return null},_selectNodes:function(h,g){var d=[];if(!h)return d;var a=h.split(":"),f,e;if(a.length===1){f=null;e=a[0]}else if(a.length===2){f=this._namespaceMapping[a[0]];e=a[1]}else throw OsfMsAjaxFactory.msAjaxError.argument("name");if(!g.hasChildNodes)return d;for(var c=g.childNodes,b=0;b<c.length;b++)e===this._removeNodePrefix(c[b].nodeName)&&f===c[b].namespaceURI&&d.push(c[b]);return d},_removeNodePrefix:function(b){var a=b.split(":");if(a.length===1)return b;else return a[1]},getDocumentElement:function(){return this._xmldoc.documentElement}};OSF.XmlProcessor=function(c,b){var a=this,d=Function._validateParams(arguments,[{name:"xml",type:String,mayBeNull:false},{name:"xmlNamespaces",type:String,mayBeNull:false}]);if(d)throw d;if(document.implementation&&document.implementation.hasFeature("XPath","3.0"))a._provider=new OSF.Xpath3Provider(c,b);else{a._provider=new OSF.IEXpathProvider(c,b);if(!a._provider.getActiveXObject())a._provider=new OSF.DomParserProvider(c,b)}};OSF.XmlProcessor.prototype={addNamespaceMapping:function(b,c){var a=Function._validateParams(arguments,[{name:"namespacePrefix",type:String,mayBeNull:false},{name:"namespaceUri",type:String,mayBeNull:false}]);if(a)throw a;return this._provider.addNamespaceMapping(b,c)},selectSingleNode:function(c,b){var a=Function._validateParams(arguments,[{name:"name",type:String,mayBeNull:false},{name:"contextNode",mayBeNull:true,optional:true}]);if(a)throw a;return this._provider.selectSingleNode(c,b)},selectNodes:function(c,b){var a=Function._validateParams(arguments,[{name:"name",type:String,mayBeNull:false},{name:"contextNode",mayBeNull:true,optional:true}]);if(a)throw a;return this._provider.selectNodes(c,b)},selectNodesByXPath:function(c,a){var b=Function._validateParams(arguments,[{name:"xpath",type:String,mayBeNull:false},{name:"contextNode",mayBeNull:true,optional:true}]);if(b)throw b;a=a||this._provider.getDocumentElement();return this._provider.selectNodesByXPath(c,a)},getDocumentElement:function(){return this._provider.getDocumentElement()},getNodeValue:function(b){var c=Function._validateParams(arguments,[{name:"node",type:Object,mayBeNull:false}]);if(c)throw c;var a;if(b.text)a=b.text;else a=b.textContent;return a},getNodeText:function(a){var c=Function._validateParams(arguments,[{name:"node",type:Object,mayBeNull:false}]);if(c)throw c;if(this.getNodeType(a)==9)return this.getNodeText(this.getDocumentElement());var b;if(a.text)b=a.text;else b=a.textContent;return b},setNodeText:function(b,c){var a=false,d=Function._validateParams(arguments,[{name:"node",type:Object,mayBeNull:a},{name:"text",type:String,mayBeNull:a}]);if(d)throw d;if(this.getNodeType(b)==9)return a;try{if(b.text)b.text=c;else b.textContent=c}catch(e){return a}return true},getNodeXml:function(b){var c=Function._validateParams(arguments,[{name:"node",type:Object,mayBeNull:false}]);if(c)throw c;var a;if(b.xml)a=b.xml;else{a=(new XMLSerializer).serializeToString(b);if(this.getNodeType(b)==2)a=this.getNodeBaseName(b)+'="'+a+'"'}return a},setNodeXml:function(c,e){var d=Function._validateParams(arguments,[{name:"node",type:Object,mayBeNull:false},{name:"xml",type:String,mayBeNull:false}]);if(d)throw d;var a=new OSF.XmlProcessor(e,"");if(!a.isValidXml())return null;var b=a.getDocumentElement();try{c.parentNode.replaceChild(b,c)}catch(f){return null}return b},getNodeNamespaceURI:function(b){var a=Function._validateParams(arguments,[{name:"node",type:Object,mayBeNull:false}]);if(a)throw a;return b.namespaceURI},getNodePrefix:function(b){var a=Function._validateParams(arguments,[{name:"node",type:Object,mayBeNull:false}]);if(a)throw a;return b.prefix},getNodeBaseName:function(a){var c=Function._validateParams(arguments,[{name:"node",type:Object,mayBeNull:false}]);if(c)throw c;var b;if(a.nodeType&&(a.nodeType==1||a.nodeType==2))if(a.baseName)b=a.baseName;else b=a.localName;else b=a.nodeName;return b},getNodeType:function(b){var a=Function._validateParams(arguments,[{name:"node",type:Object,mayBeNull:false}]);if(a)throw a;return b.nodeType},appendChild:function(e,d){var c=Function._validateParams(arguments,[{name:"node",type:Object,mayBeNull:false},{name:"childXml",type:String,mayBeNull:false}]);if(c)throw c;var b=new OSF.XmlProcessor(d,"");if(!b.isValidXml())return null;var a=b.getDocumentElement();e.appendChild(a);return a},_getAttributeLocalName:function(a){var b;if(a.localName)b=a.localName;else b=a.baseName;return b},readAttributes:function(e,c,h){var f=Function._validateParams(arguments,[{name:"node",type:Object,mayBeNull:false},{name:"attributesToRead",type:Object,mayBeNull:false},{name:"objectToFill",type:Object,mayBeNull:false}]);if(f)throw f;for(var a,d,b=0;b<e.attributes.length;b++){a=e.attributes[b];d=this._getAttributeLocalName(a);for(var g in c)if(d===g)h[c[g]]=a.value}},isValidXml:function(){var a="parsererror",b=this.getDocumentElement();if(b==null)return false;else if(this._provider._xmldoc.getElementsByTagName(a).length>0){var e=new DOMParser,d=e.parseFromString("<","text/xml"),c=d.getElementsByTagName(a)[0].namespaceURI;return this._provider._xmldoc.getElementsByTagNameNS(c,a).length<=0}return true}};var OfficeExt;(function(a){var d=function(){function a(){}a.prototype.Serialize=function(a){try{return JSON.stringify(a)}catch(b){return null}};a.prototype.Deserialize=function(a){try{return JSON.parse(a)}catch(b){return null}};return a}();a.SafeSerializer=d;var b=function(){function a(a,b){this._localStorage=a;this._serializer=b}a.prototype.GetCacheItem=function(j,h,f,i,g){var c="cacheExpired",b=true,e=this;if(h===void 0)h=b;if(g===void 0)g=b;e.ValidateCurrentCache();var k=e._localStorage.getItem(j);if(k){var d=e._serializer.Deserialize(k);if(typeof i!="undefined"&&i>0&&i-d.createdOn>0){e._localStorage.removeItem(j);if(f)f[c]=b}else if(h){var l=new Date;if(Math.abs(l.getTime()-d.createdOn)<a.msPerDay*d.refreshRate)return d.data;else if(g){e._localStorage.removeItem(j);if(f)f[c]=b}}else return d.data}};a.prototype.SetCacheItem=function(e,d,b){b=b||a.defaultRefreshRateInDays;var f=new Date,c={data:d,createdOn:f.getTime(),refreshRate:b};this._localStorage.setItem(e,this._serializer.Serialize(c))};a.prototype.RemoveCacheItem=function(a){this._localStorage.removeItem(a)};a.prototype.RemoveAll=function(c){for(var b=this._localStorage.getKeysWithPrefix(c),a=0,d=b.length;a<d;a++)this._localStorage.removeItem(b[a])};a.prototype.RemoveMatches=function(c){for(var d=this._localStorage.getKeysWithPrefix(""),a=0,g=d.length;a<g;a++)for(var e=d[a],b=0,f=c.length;b<f;b++)if(c[b].test(e)){this._localStorage.removeItem(e);break}};a.prototype.ValidateCurrentCache=function(){var b=this._localStorage.getItem(a.cacheVersionKey);if(b!=a.currentSchemaVersion){this.RemoveMatches([new RegExp("__OSF_(?!.*activated).*$","i")]);this._localStorage.setItem(a.cacheVersionKey,a.currentSchemaVersion)}};a.defaultRefreshRateInDays=3;a.msPerDay=8.64e7;a.currentSchemaVersion="1";a.checkedCache=false;a.cacheVersionKey="osfCacheVersion";return a}();a.AppsDataCacheManager=b;var c=function(b){__extends(a,b);function a(a,c){b.call(this,a,c)}a.prototype.GetRefreshToken=function(d,c){var e=OSF.OUtil.formatString(a._refreshTokenCacheKey,d,c);return b.prototype.GetCacheItem.call(this,e)};a.prototype.AddRefreshToken=function(c,e,d){var f=OSF.OUtil.formatString(a._refreshTokenCacheKey,e,d);b.prototype.SetCacheItem.call(this,f,c)};a.prototype.RemoveAll=function(){b.prototype.RemoveAll.call(this,a._refreshTokenCachePrefixKey)};a.prototype.RemoveRefreshToken=function(d,c){var e=OSF.OUtil.formatString(a._refreshTokenCacheKey,d,c);b.prototype.RemoveCacheItem.call(this,e)};a._refreshTokenCacheKey="_OSF_PRIVATECATALOG_REFRESHTOKEN_{0}_{1}";a._refreshTokenCachePrefixKey="_OSF_PRIVATECATALOG_REFRESHTOKEN";return a}(b);a.TokenCacheManager=c})(OfficeExt||(OfficeExt={}));var OSFLog;(function(j){var b="Error",f="ResponseTime",e="Result",h="OperationMetadata",d="ErrorResult",g="AssetId",c="CorrelationId",a=true,i=function(){function b(a){this._table=a;this._fields={}}Object.defineProperty(b.prototype,"Fields",{"get":function(){return this._fields},enumerable:a,configurable:a});Object.defineProperty(b.prototype,"Table",{"get":function(){return this._table},enumerable:a,configurable:a});b.prototype.SerializeFields=function(){};b.prototype.SetSerializedField=function(b,a){if(typeof a!=="undefined"&&a!==null)this._serializedFields[b]=a.toString()};b.prototype.SerializeRow=function(){var a=this;a._serializedFields={};a.SetSerializedField("Table",a._table);a.SerializeFields();return JSON.stringify(a._serializedFields)};return b}();j.BaseUsageData=i;var t=function(t){var s="Stage11Time",r="Stage10Time",q="Stage9Time",p="Stage8Time",o="Stage7Time",n="Stage6Time",m="Stage5Time",l="Stage4Time",k="Stage3Time",j="Stage2Time",i="Stage1Time",h="InstanceId",f="ActivationInfo",e="AppInfo";__extends(b,t);function b(){t.call(this,"AppLoadTime")}Object.defineProperty(b.prototype,c,{"get":function(){return this.Fields[c]},"set":function(a){this.Fields[c]=a},enumerable:a,configurable:a});Object.defineProperty(b.prototype,e,{"get":function(){return this.Fields[e]},"set":function(a){this.Fields[e]=a},enumerable:a,configurable:a});Object.defineProperty(b.prototype,f,{"get":function(){return this.Fields[f]},"set":function(a){this.Fields[f]=a},enumerable:a,configurable:a});Object.defineProperty(b.prototype,h,{"get":function(){return this.Fields[h]},"set":function(a){this.Fields[h]=a},enumerable:a,configurable:a});Object.defineProperty(b.prototype,g,{"get":function(){return this.Fields[g]},"set":function(a){this.Fields[g]=a},enumerable:a,configurable:a});Object.defineProperty(b.prototype,i,{"get":function(){return this.Fields[i]},"set":function(a){this.Fields[i]=a},enumerable:a,configurable:a});Object.defineProperty(b.prototype,j,{"get":function(){return this.Fields[j]},"set":function(a){this.Fields[j]=a},enumerable:a,configurable:a});Object.defineProperty(b.prototype,k,{"get":function(){return this.Fields[k]},"set":function(a){this.Fields[k]=a},enumerable:a,configurable:a});Object.defineProperty(b.prototype,l,{"get":function(){return this.Fields[l]},"set":function(a){this.Fields[l]=a},enumerable:a,configurable:a});Object.defineProperty(b.prototype,m,{"get":function(){return this.Fields[m]},"set":function(a){this.Fields[m]=a},enumerable:a,configurable:a});Object.defineProperty(b.prototype,n,{"get":function(){return this.Fields[n]},"set":function(a){this.Fields[n]=a},enumerable:a,configurable:a});Object.defineProperty(b.prototype,o,{"get":function(){return this.Fields[o]},"set":function(a){this.Fields[o]=a},enumerable:a,configurable:a});Object.defineProperty(b.prototype,p,{"get":function(){return this.Fields[p]},"set":function(a){this.Fields[p]=a},enumerable:a,configurable:a});Object.defineProperty(b.prototype,q,{"get":function(){return this.Fields[q]},"set":function(a){this.Fields[q]=a},enumerable:a,configurable:a});Object.defineProperty(b.prototype,r,{"get":function(){return this.Fields[r]},"set":function(a){this.Fields[r]=a},enumerable:a,configurable:a});Object.defineProperty(b.prototype,s,{"get":function(){return this.Fields[s]},"set":function(a){this.Fields[s]=a},enumerable:a,configurable:a});Object.defineProperty(b.prototype,d,{"get":function(){return this.Fields[d]},"set":function(a){this.Fields[d]=a},enumerable:a,configurable:a});b.prototype.SerializeFields=function(){var a=this;a.SetSerializedField(c,a.CorrelationId);a.SetSerializedField(e,a.AppInfo);a.SetSerializedField(f,a.ActivationInfo);a.SetSerializedField(h,a.InstanceId);a.SetSerializedField(g,a.AssetId);a.SetSerializedField(i,a.Stage1Time);a.SetSerializedField(j,a.Stage2Time);a.SetSerializedField(k,a.Stage3Time);a.SetSerializedField(l,a.Stage4Time);a.SetSerializedField(m,a.Stage5Time);a.SetSerializedField(n,a.Stage6Time);a.SetSerializedField(o,a.Stage7Time);a.SetSerializedField(p,a.Stage8Time);a.SetSerializedField(q,a.Stage9Time);a.SetSerializedField(r,a.Stage10Time);a.SetSerializedField(s,a.Stage11Time);a.SetSerializedField(d,a.ErrorResult)};return b}(i);j.AppLoadTimeUsageData=t;var s=function(f){var b="NotificationClickInfo";__extends(e,f);function e(){f.call(this,"AppNotification")}Object.defineProperty(e.prototype,c,{"get":function(){return this.Fields[c]},"set":function(a){this.Fields[c]=a},enumerable:a,configurable:a});Object.defineProperty(e.prototype,d,{"get":function(){return this.Fields[d]},"set":function(a){this.Fields[d]=a},enumerable:a,configurable:a});Object.defineProperty(e.prototype,b,{"get":function(){return this.Fields[b]},"set":function(a){this.Fields[b]=a},enumerable:a,configurable:a});e.prototype.SerializeFields=function(){var a=this;a.SetSerializedField(c,a.CorrelationId);a.SetSerializedField(d,a.ErrorResult);a.SetSerializedField(b,a.NotificationClickInfo)};return e}(i);j.AppNotificationUsageData=s;var r=function(c){__extends(b,c);function b(){c.call(this,"AppManagementMenu")}Object.defineProperty(b.prototype,g,{"get":function(){return this.Fields[g]},"set":function(a){this.Fields[g]=a},enumerable:a,configurable:a});Object.defineProperty(b.prototype,h,{"get":function(){return this.Fields[h]},"set":function(a){this.Fields[h]=a},enumerable:a,configurable:a});Object.defineProperty(b.prototype,d,{"get":function(){return this.Fields[d]},"set":function(a){this.Fields[d]=a},enumerable:a,configurable:a});b.prototype.SerializeFields=function(){var a=this;a.SetSerializedField(g,a.AssetId);a.SetSerializedField(h,a.OperationMetadata);a.SetSerializedField(d,a.ErrorResult)};return b}(i);j.AppManagementMenuUsageData=r;var p=function(i){var f="LastActiveTabCount",e="LastActiveTab",d="DialogState",c="TrustPageSessionTime",b="TotalSessionTime";__extends(h,i);function h(){i.call(this,"InsertionDialogSession")}Object.defineProperty(h.prototype,g,{"get":function(){return this.Fields[g]},"set":function(a){this.Fields[g]=a},enumerable:a,configurable:a});Object.defineProperty(h.prototype,b,{"get":function(){return this.Fields[b]},"set":function(a){this.Fields[b]=a},enumerable:a,configurable:a});Object.defineProperty(h.prototype,c,{"get":function(){return this.Fields[c]},"set":function(a){this.Fields[c]=a},enumerable:a,configurable:a});Object.defineProperty(h.prototype,d,{"get":function(){return this.Fields[d]},"set":function(a){this.Fields[d]=a},enumerable:a,configurable:a});Object.defineProperty(h.prototype,e,{"get":function(){return this.Fields[e]},"set":function(a){this.Fields[e]=a},enumerable:a,configurable:a});Object.defineProperty(h.prototype,f,{"get":function(){return this.Fields[f]},"set":function(a){this.Fields[f]=a},enumerable:a,configurable:a});h.prototype.SerializeFields=function(){var a=this;a.SetSerializedField(g,a.AssetId);a.SetSerializedField(b,a.TotalSessionTime);a.SetSerializedField(c,a.TrustPageSessionTime);a.SetSerializedField(d,a.DialogState);a.SetSerializedField(e,a.LastActiveTab);a.SetSerializedField(f,a.LastActiveTabCount)};return h}(i);j.InsertionDialogSessionUsageData=p;var q=function(e){__extends(b,e);function b(){e.call(this,"UploadFileDevCatelog")}Object.defineProperty(b.prototype,c,{"get":function(){return this.Fields[c]},"set":function(a){this.Fields[c]=a},enumerable:a,configurable:a});Object.defineProperty(b.prototype,h,{"get":function(){return this.Fields[h]},"set":function(a){this.Fields[h]=a},enumerable:a,configurable:a});Object.defineProperty(b.prototype,d,{"get":function(){return this.Fields[d]},"set":function(a){this.Fields[d]=a},enumerable:a,configurable:a});b.prototype.SerializeFields=function(){var a=this;a.SetSerializedField(c,a.CorrelationId);a.SetSerializedField(h,a.OperationMetadata);a.SetSerializedField(d,a.ErrorResult)};return b}(i);j.UploadFileDevCatelogUsageData=q;var o=function(k){var j="AppSizeHeight",i="AppSizeWidth",h="IsAppCommand",g="AppTargetType",f="AppVersion",e="AppId",d="StoreType";__extends(b,k);function b(){k.call(this,"UploadFileDevCatalogUsage")}Object.defineProperty(b.prototype,c,{"get":function(){return this.Fields[c]},"set":function(a){this.Fields[c]=a},enumerable:a,configurable:a});Object.defineProperty(b.prototype,d,{"get":function(){return this.Fields[d]},"set":function(a){this.Fields[d]=a},enumerable:a,configurable:a});Object.defineProperty(b.prototype,e,{"get":function(){return this.Fields[e]},"set":function(a){this.Fields[e]=a},enumerable:a,configurable:a});Object.defineProperty(b.prototype,f,{"get":function(){return this.Fields[f]},"set":function(a){this.Fields[f]=a},enumerable:a,configurable:a});Object.defineProperty(b.prototype,g,{"get":function(){return this.Fields[g]},"set":function(a){this.Fields[g]=a},enumerable:a,configurable:a});Object.defineProperty(b.prototype,h,{"get":function(){return this.Fields[h]},"set":function(a){this.Fields[h]=a},enumerable:a,configurable:a});Object.defineProperty(b.prototype,i,{"get":function(){return this.Fields[i]},"set":function(a){this.Fields[i]=a},enumerable:a,configurable:a});Object.defineProperty(b.prototype,j,{"get":function(){return this.Fields[j]},"set":function(a){this.Fields[j]=a},enumerable:a,configurable:a});b.prototype.SerializeFields=function(){var a=this;a.SetSerializedField(c,a.CorrelationId);a.SetSerializedField(d,a.StoreType);a.SetSerializedField(e,a.AppId);a.SetSerializedField(f,a.AppVersion);a.SetSerializedField(g,a.AppTargetType);a.SetSerializedField(h,a.IsAppCommand);a.SetSerializedField(i,a.AppSizeWidth);a.SetSerializedField(j,a.AppSizeHeight)};return b}(i);j.UploadFileDevCatalogUsageUsageData=o;var k=function(d){__extends(c,d);function c(){d.call(this,"OneDriveCatalogGetAccessToken")}Object.defineProperty(c.prototype,e,{"get":function(){return this.Fields[e]},"set":function(a){this.Fields[e]=a},enumerable:a,configurable:a});Object.defineProperty(c.prototype,f,{"get":function(){return this.Fields[f]},"set":function(a){this.Fields[f]=a},enumerable:a,configurable:a});Object.defineProperty(c.prototype,b,{"get":function(){return this.Fields[b]},"set":function(a){this.Fields[b]=a},enumerable:a,configurable:a});c.prototype.SerializeFields=function(){var a=this;a.SetSerializedField(e,a.Result);a.SetSerializedField(f,a.ResponseTime);a.SetSerializedField(b,a.Error)};return c}(i);j.OneDriveCatalogGetAccessTokenUsageData=k;var m=function(d){__extends(c,d);function c(){d.call(this,"OneDriveCatalogGetManifests")}Object.defineProperty(c.prototype,e,{"get":function(){return this.Fields[e]},"set":function(a){this.Fields[e]=a},enumerable:a,configurable:a});Object.defineProperty(c.prototype,f,{"get":function(){return this.Fields[f]},"set":function(a){this.Fields[f]=a},enumerable:a,configurable:a});Object.defineProperty(c.prototype,b,{"get":function(){return this.Fields[b]},"set":function(a){this.Fields[b]=a},enumerable:a,configurable:a});c.prototype.SerializeFields=function(){var a=this;a.SetSerializedField(e,a.Result);a.SetSerializedField(f,a.ResponseTime);a.SetSerializedField(b,a.Error)};return c}(i);j.OneDriveCatalogGetManifestsUsageData=m;var n=function(g){var c="id";__extends(d,g);function d(){g.call(this,"OneDriveCatalogGetManifest")}Object.defineProperty(d.prototype,c,{"get":function(){return this.Fields[c]},"set":function(a){this.Fields[c]=a},enumerable:a,configurable:a});Object.defineProperty(d.prototype,e,{"get":function(){return this.Fields[e]},"set":function(a){this.Fields[e]=a},enumerable:a,configurable:a});Object.defineProperty(d.prototype,f,{"get":function(){return this.Fields[f]},"set":function(a){this.Fields[f]=a},enumerable:a,configurable:a});Object.defineProperty(d.prototype,b,{"get":function(){return this.Fields[b]},"set":function(a){this.Fields[b]=a},enumerable:a,configurable:a});d.prototype.SerializeFields=function(){var a=this;a.SetSerializedField(c,a.id);a.SetSerializedField(e,a.Result);a.SetSerializedField(f,a.ResponseTime);a.SetSerializedField(b,a.Error)};return d}(i);j.OneDriveCatalogGetManifestUsageData=n;var l=function(d){__extends(c,d);function c(){d.call(this,"OneDriveCatalogInsertManifest")}Object.defineProperty(c.prototype,e,{"get":function(){return this.Fields[e]},"set":function(a){this.Fields[e]=a},enumerable:a,configurable:a});Object.defineProperty(c.prototype,f,{"get":function(){return this.Fields[f]},"set":function(a){this.Fields[f]=a},enumerable:a,configurable:a});Object.defineProperty(c.prototype,b,{"get":function(){return this.Fields[b]},"set":function(a){this.Fields[b]=a},enumerable:a,configurable:a});c.prototype.SerializeFields=function(){var a=this;a.SetSerializedField(e,a.Result);a.SetSerializedField(f,a.ResponseTime);a.SetSerializedField(b,a.Error)};return c}(i);j.OneDriveCatalogInsertManifestUsageData=l})(OSFLog||(OSFLog={}));var Telemetry;(function(b){var a=null;"use strict";(function(a){var c="verboseEx",b="unexpected";a[a[b]=10]=b;a[a["warning"]=15]="warning";a[a["info"]=50]="info";a[a["verbose"]=100]="verbose";a[a[c]=200]=c})(b.ULSTraceLevel||(b.ULSTraceLevel={}));var c=b.ULSTraceLevel;(function(a){var h="msoulscat_Osf_UploadFileDevCatalogUsage",g="msoulscat_Osf_UploadFileDevCatelog",f="msoulscat_Osf_InsertionDialogSession",e="msoulscat_Osf_AppManagementMenu",d="msoulscat_Osf_Runtime",c="msoulscat_Osf_Notification",b="msoulscat_Osf_Latency";a[a[b]=1401]=b;a[a[c]=1402]=c;a[a[d]=1403]=d;a[a[e]=1404]=e;a[a[f]=1405]=f;a[a[g]=1406]=g;a[a[h]=1411]=h})(b.ULSCat||(b.ULSCat={}));var f=b.ULSCat,h;(function(a){var d="IsAnonymous",c="InsertionDialogClosed",b="ConfirmationDialogCancel";a[a[b]=256]=b;a[a[c]=512]=c;a[a[d]=1024]=d})(h||(h={}));var g;(function(a){var e="TrustPageVisited",d="Canceled",c="Inserted",b="Undefined";a[a[b]=0]=b;a[a[c]=1]=c;a[a[d]=2]=d;a[a["Closed"]=3]="Closed";a[a[e]=8]=e})(g||(g={}));var e=function(){var a=true;function b(){this.timeValue=0}b.prototype.Start=function(){this.timeValue=-(new Date).getTime();this.finishedMeasurement=false};b.prototype.Stop=function(){if(this.timeValue<0){this.timeValue+=(new Date).getTime();this.finishedMeasurement=a}};Object.defineProperty(b.prototype,"Finished",{"get":function(){return this.finishedMeasurement},enumerable:a,configurable:a});Object.defineProperty(b.prototype,"ElapsedTime",{"get":function(){var a=this.timeValue;if(!this.Finished&&a<0)a=Math.abs(a)-(new Date).getTime();return a},enumerable:a,configurable:a});return b}();b.LatencyStopwatch=e;var v=function(){function a(){}return a}();b.Context=v;var d=function(){function a(){}a.SendULSTraceTag=function(a,b,d,c){if(!Microsoft.Office.WebExtension.FULSSupported)return;Diag.UULS.trace(c,a,b,d)};return a}(),m=function(){function a(){}a.Instance=function(){if(!a.instance)a.instance=new a;return a.instance};a.prototype.LogData=function(b){d.SendULSTraceTag(a.category,a.level,b.SerializeRow(),6062431)};a.category=f.msoulscat_Osf_Notification;a.level=c.info;return a}();b.NotificationLogger=m;var l=function(){function a(){}a.Instance=function(){if(!a.instance)a.instance=new a;return a.instance};a.prototype.LogData=function(b){d.SendULSTraceTag(a.category,a.level,b.SerializeRow(),17085957)};a.category=f.msoulscat_Osf_AppManagementMenu;a.level=c.info;return a}();b.AppManagementMenuLogger=l;var k=function(){function a(){}a.Instance=function(){if(!a.instance)a.instance=new a;return a.instance};a.prototype.LogData=function(b){d.SendULSTraceTag(a.category,a.level,b.SerializeRow(),17085958)};a.category=f.msoulscat_Osf_UploadFileDevCatelog;a.level=c.info;return a}();b.UploadFileDevCatelogLogger=k;var i=function(){function a(){}a.Instance=function(){if(!a.instance)a.instance=new a;return a.instance};a.prototype.LogData=function(b){d.SendULSTraceTag(a.category,a.level,b.SerializeRow(),17834653)};a.category=f.msoulscat_Osf_UploadFileDevCatalogUsage;a.level=c.info;return a}();b.UploadFileDevCatalogUsageLogger=i;var n=function(){function a(){}a.Instance=function(){if(!a.instance)a.instance=new a;return a.instance};a.prototype.LogData=function(b){d.SendULSTraceTag(a.category,a.level,b.SerializeRow(),4748055)};a.category=f.msoulscat_Osf_Latency;a.level=c.info;return a}();b.LatencyLogger=n;var j=function(){function a(){}a.Instance=function(){if(!a.instance)a.instance=new a;return a.instance};a.prototype.LogData=function(b){d.SendULSTraceTag(a.category,a.level,b.SerializeRow(),17085959)};a.category=f.msoulscat_Osf_InsertionDialogSession;a.level=c.info;return a}();b.InsertionDialogSessionLogger=j;var t=function(){function a(){}a.LogNotification=function(c,d,b){var a=new OSFLog.AppNotificationUsageData;a.CorrelationId=c;a.ErrorResult=d;a.NotificationClickInfo=b;m.Instance().LogData(a)};return a}();b.AppNotificationHelper=t;var r=function(){function a(){}a.LogAppManagementMenuAction=function(c,b,i,d,f,g){var a=new OSFLog.AppManagementMenuUsageData,e=c.toLowerCase().indexOf("wa")===0?parseInt(c.substring(2),10):parseInt(c,10);if(d)b|=h.InsertionDialogClosed;if(f)b|=h.IsAnonymous;a.AssetId=e;a.OperationMetadata=b;a.ErrorResult=g;l.Instance().LogData(a)};return a}();b.AppManagementMenuHelper=r;var q=function(){function a(){}a.LogUploadFileDevCatelogAction=function(c,b,f,e,g,d){var a=new OSFLog.UploadFileDevCatelogUsageData;a.CorrelationId=c;a.OperationMetadata=b;a.ErrorResult=d;k.Instance().LogData(a)};return a}();b.UploadFileDevCatelogHelper=q;var o=function(){function a(){}a.LogUploadFileDevCatalogUsageAction=function(d,h,j,g,c,f,e,b){var a=new OSFLog.UploadFileDevCatalogUsageUsageData;a.CorrelationId=d;a.StoreType=h;a.AppId=j;a.AppVersion=g;a.AppTargetType=c;a.IsAppCommand=f;a.AppSizeWidth=e;a.AppSizeHeight=b;i.Instance().LogData(a)};return a}();b.UploadFileDevCatalogUsageHelper=o;var u=function(){var p="Stage11Time",o="Stage10Time",m="Stage9Time",l="Stage8Time",k="Stage7Time",j="Stage5Time",i="Stage4Time",h="Stage2Time",g="Stage1Time";function b(){}b.GenerateActivationMessage=function(c,d){var b="";if(c!=a)b+="ActivationRuntimeType: "+c.toString()+"|";if(d!=a)b+="CorrelationId: "+d;return b};b.ActivationStart=function(a,s,t,n,r,q){b.activatingNumber++;a.LoadTime=new OSFLog.AppLoadTimeUsageData;a.Timers={};a.LoadTime.CorrelationId=n;a.LoadTime.AppInfo=s;a.LoadTime.ActivationInfo=0;a.LoadTime.InstanceId=r;a.LoadTime.AssetId=t;a.LoadTime.Stage1Time=0;a.Timers[g]=new e;a.LoadTime.Stage2Time=0;a.Timers[h]=new e;a.LoadTime.Stage3Time=0;a.LoadTime.Stage4Time=0;a.Timers[i]=new e;a.LoadTime.Stage5Time=0;a.Timers[j]=new e;a.LoadTime.Stage6Time=b.activatingNumber;a.LoadTime.Stage7Time=0;a.Timers[k]=new e;a.LoadTime.Stage8Time=0;a.Timers[l]=new e;a.LoadTime.Stage9Time=0;a.Timers[m]=new e;a.LoadTime.Stage10Time=0;a.Timers[o]=new e;a.LoadTime.Stage11Time=0;a.Timers[p]=new e;a.LoadTime.ErrorResult=0;a.ActivationRuntimeType=q;b.StartStopwatch(a,g);d.SendULSTraceTag(f.msoulscat_Osf_Runtime,c.info,b.GenerateActivationMessage(q,n),19515419)};b.ActivationEnd=function(a){b.ActivateEndInternal(a)};b.PageStart=function(a){b.StartStopwatch(a,h)};b.PageLoaded=function(a){b.StopStopwatch(a,h)};b.ServerCallStart=function(a){b.StartStopwatch(a,i)};b.ServerCallEnd=function(a){b.StopStopwatch(a,i)};b.AuthenticationStart=function(a){b.StartStopwatch(a,j)};b.AuthenticationEnd=function(a){b.StopStopwatch(a,j)};b.EntitlementCheckStart=function(a){b.StartStopwatch(a,k)};b.EntitlementCheckEnd=function(a){b.StopStopwatch(a,k)};b.KilledAppsCheckStart=function(a){b.StartStopwatch(a,l)};b.KilledAppsCheckEnd=function(a){b.StopStopwatch(a,l)};b.AppStateCheckStart=function(a){b.StartStopwatch(a,m)};b.AppStateCheckEnd=function(a){b.StopStopwatch(a,m)};b.ManifestRequestStart=function(a){b.StartStopwatch(a,o)};b.ManifestRequestEnd=function(a){b.StopStopwatch(a,o)};b.OfficeJSStartToLoad=function(a){b.StartStopwatch(a,p)};b.OfficeJSLoaded=function(a){b.StopStopwatch(a,p)};b.SetAnonymousFlag=function(c,a){b.SetActivationInfoField(c,b.ConvertFlagToBit(a),2,0)};b.SetRetryCount=function(c,a){b.SetActivationInfoField(c,a,3,2)};b.SetManifestTrustCachedFlag=function(c,a){b.SetActivationInfoField(c,b.ConvertFlagToBit(a),2,5)};b.SetManifestDataCachedFlag=function(c,a){b.SetActivationInfoField(c,b.ConvertFlagToBit(a),2,7)};b.SetOmexHasEntitlementFlag=function(c,a){b.SetActivationInfoField(c,b.ConvertFlagToBit(a),2,9)};b.SetManifestDataInvalidFlag=function(c,a){b.SetActivationInfoField(c,b.ConvertFlagToBit(a),2,11)};b.SetAppStateDataCachedFlag=function(c,a){b.SetActivationInfoField(c,b.ConvertFlagToBit(a),2,13)};b.SetAppStateDataInvalidFlag=function(c,a){b.SetActivationInfoField(c,b.ConvertFlagToBit(a),2,15)};b.SetActivationRuntimeType=function(c,a){b.SetActivationInfoField(c,a,2,17)};b.SetErrorResult=function(a,c){if(a.LoadTime){a.LoadTime.ErrorResult=c;b.ActivateEndInternal(a)}};b.SetBit=function(a,e,d,c){b.SetActivationInfoField(a,e,c||2,d)};b.StartStopwatch=function(a,c){if(a.LoadTime&&a.Timers&&a.Timers[c]){a.Timers[c].Start();b.UpdateActivatingNumber(a)}};b.StopStopwatch=function(a,c){if(a.LoadTime&&a.Timers&&a.Timers[c]){a.Timers[c].Stop();b.UpdateActivatingNumber(a)}};b.ConvertFlagToBit=function(a){if(a)return 2;else return 1};b.SetActivationInfoField=function(a,e,c,d){if(a.LoadTime){b.UpdateActivatingNumber(a);a.LoadTime.ActivationInfo=b.SetBitField(a.LoadTime.ActivationInfo,e,c,d)}};b.SetBitField=function(d,e,c,a){var f=Math.pow(2,c)-1<<a,b=d&~f;return b|e<<a};b.UpdateActivatingNumber=function(a){if(a.LoadTime)a.LoadTime.Stage6Time=a.LoadTime.Stage6Time>b.activatingNumber?a.LoadTime.Stage6Time:b.activatingNumber};b.ActivateEndInternal=function(e){if(e.LoadTime){b.StopStopwatch(e,g);if(e.Timers)for(var h in e.Timers)if(e.Timers[h].ElapsedTime!=a)e.LoadTime[h]=e.Timers[h].ElapsedTime;d.SendULSTraceTag(f.msoulscat_Osf_Runtime,c.info,b.GenerateActivationMessage(e.ActivationRuntimeType,e.LoadTime.CorrelationId),19515420);n.Instance().LogData(e.LoadTime);e.LoadTime=a;b.activatingNumber--}};b.activatingNumber=0;return b}();b.AppLoadTimeHelper=u;var s=function(){var e=" AppCorrelationId:";function b(){}b.LogProxyFailure=function(f,h,g){var e;if(f==a)f="";e=OSF.OUtil.formatString("appCorrelationId:{0}, methodName:{1}",f,h);Object.keys(g).forEach(function(c){var b=g[c];if(b!=a)b=b.toString();e+=", "+c+":"+b});d.SendULSTraceTag(b.category,c.warning,e,6062432)};b.LogExceptionTag=function(i,f,h,j){var g=i;if(f){if(f.name)g+=" Exception name:"+f.name+".";if(f.paramName)g+=" Param name:"+f.paramName+".";if(f.message)g+=" Message:"+f.message+".";if(f.stack)g+=" [Stack:"+f.stack+"]"}if(h!=a)g+=e+h+".";d.SendULSTraceTag(b.category,c.warning,g,j)};b.LogCommonMessageTag=function(g,f,h){if(f!=a)g+=e+f+".";d.SendULSTraceTag(b.category,c.info,g,h)};b.category=f.msoulscat_Osf_Runtime;return b}();b.RuntimeTelemetryHelper=s;var p=function(){function a(){}a.LogInsertionDialogSession=function(c,f,d,k,i,e){var a=new OSFLog.InsertionDialogSessionUsageData,h=c.toLowerCase().indexOf("wa")===0?parseInt(c.substring(2),10):parseInt(c,10),b=g.Undefined;if(k)b|=g.Inserted;else b|=g.Canceled;if(d>0)b|=g.TrustPageVisited;a.AssetId=h;a.TotalSessionTime=f;a.TrustPageSessionTime=d;a.DialogState=b;a.LastActiveTab=i;a.LastActiveTabCount=e;j.Instance().LogData(a)};return a}();b.InsertionDialogSessionHelper=p})(Telemetry||(Telemetry={}));var OfficeExt;(function(c){var a=true,b=null,f=function(){function c(){this.m_osfControlId=b;this.m_isControlReady=false;this.m_queue=[]}Object.defineProperty(c.prototype,"osfControlId",{"get":function(){return this.m_osfControlId},"set":function(a){this.m_osfControlId=a},enumerable:a,configurable:a});Object.defineProperty(c.prototype,"isControlReady",{"get":function(){return this.m_isControlReady},"set":function(a){this.m_isControlReady=a},enumerable:a,configurable:a});Object.defineProperty(c.prototype,"isEmpty",{"get":function(){return this.m_queue.length===0},enumerable:a,configurable:a});c.prototype.queueAction=function(b,a){var c={eventData:b,actionSender:a};this.m_queue.push(c)};c.prototype.sendActions=function(){var a=this;return new Promise(function(b){window.setTimeout(function(){while(a.m_queue.length>0){var c=a.m_queue[0];a.m_queue.splice(0,1);a.sendAction(c)}b()},0)})};c.prototype.sendAction=function(c){var b=c.eventData,a=c.actionSender;b&&a&&this.m_isControlReady&&a(this.m_osfControlId,b)};return c}(),d;(function(a){a[a["Unknown"]=0]="Unknown";a[a["Host"]=1]="Host";a[a["Addin"]=2]="Addin"})(d||(d={}));var g=function(){function a(){this.ownerType=d.Unknown}return a}(),h=function(){function a(){this.shortcutDisplayInfoArray=[]}return a}(),e=function(){var g="undefined";function e(){}e.init=function(){e.s_usedShortcutAddins={};return c.ActionMetadataManager.init(a)};e.tryDispatchShortcutKeyDeprecated=function(f,g,d){if(!d)throw OSF.OUtil.formatString(Strings.OfficeOM.L_InvalidParameters,d);var b=c.ActionMetadataManager.getActionFromShortcutKey(f,g);if(b&&b.addinId&&b.actionId){d(b.addinId,b.actionId);setTimeout(function(){e.sendShortcutUsageTelemetry(b.addinId)},0);return a}return false};e.tryDispatchShortcutKey=function(j,h,i,k){if(!i)throw OSF.OUtil.formatString(Strings.OfficeOM.L_InvalidParameters,i);var f=c.ActionMetadataManager.getShortcutInfoArrayFromShortcutKey(j,h);if(f&&f.length==1&&f[0].addinId&&f[0].actionId){i(f[0].addinId,f[0].actionId);setTimeout(function(){e.sendShortcutUsageTelemetry(f[0].addinId)},0);return a}else if(f&&f.length>1){if(typeof Common!==g&&Common.App&&Common.App.AppsForOffice&&Common.App.AppsForOffice.AddinShortcutsPreferenceSettingHelper)Common.App.AppsForOffice.AddinShortcutsPreferenceSettingHelper.instance().getAddinShortcutsPreferenceSetting().then(function(p){if(p){var m=JSON.parse(p);if(m[h.toString()]){var g=m[h.toString()][j.toString()];if(g){if(g["ownerType"]==d.Addin)i(g["addinId"],g["action"]);else k();return}}}for(var n=[],b=0;b<f.length;b++){var o=f[b].addinId.split(e.s_separator),r=o[e.s_addinIdMarketPlaceIdComponentIndex],q=o[e.s_addinIdMarketPlaceVersionComponentIndex],l=OSF.OsfManifestManager.getCachedManifest(r,q);l&&n.push({addinId:f[b].addinId,addinName:l._displayNames[l._UILocale.toLowerCase()],action:f[b].actionId,actionDescription:f[b].actionId,ownerType:d.Addin})}var a={modifiers:j,keyCode:h,shortcutText:c.ShortcutsMappingTableManager.getShortcutText(j,h,e.getPlatformName()),shortcutDisplayInfoArray:n};e.conflictHandler(a).then(function(b){if(b>=0)a.shortcutDisplayInfoArray[b]&&e.enableShortcutKey(a.shortcutDisplayInfoArray[b].ownerType,a.shortcutDisplayInfoArray[b].addinId,a.shortcutDisplayInfoArray[b].action,j,h).then(function(){if(a.shortcutDisplayInfoArray[b].ownerType==d.Addin)i(a.shortcutDisplayInfoArray[b].addinId,a.shortcutDisplayInfoArray[b].action);else k()})})});else Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("AddinShortcutsPreferenceSettingHelper isn't ready",b,0);return a}else return false};e.conflictHandler=function(a){for(var b in a.shortcutDisplayInfoArray)var d=a.shortcutDisplayInfoArray[b].action,c=a.shortcutDisplayInfoArray[b].addinName;return new Promise(function(a){window.setTimeout(function(){var b=0;a(b)},0)})};e.enableShortcutKey=function(b,c,e,a,d){return Common.App.AppsForOffice.AddinShortcutsPreferenceSettingHelper.instance().saveAddinShortcutsPreferenceSettingToRoaming(b,c,e,a,d)};e.sendQueuedActions=function(c){var b=e.getOrCreateAddinActionQueue(c);if(b){b.isControlReady=a;b.sendActions()}};e.queueOrSendActionIfControlReady=function(d,c,b){var a=e.getOrCreateAddinActionQueue(d);if(a.isControlReady)if(a.isEmpty)b(d,c);else{a.queueAction(c,b);a.sendActions()}else a.queueAction(c,b)};e.getOrCreateAddinActionQueue=function(b){var a=e.s_actionQueues[b];if(!a){a=new f;a.osfControlId=b;e.s_actionQueues[b]=a}return a};e.sendShortcutUsageTelemetry=function(d){if(!e.s_usedShortcutAddins[d]){e.s_usedShortcutAddins[d]=a;if(typeof Otel!==g){var f={otelEvent:{eventName:"Office.Extensibility.Shortcuts.RuntimeInfo",dataFields:[{name:"shortcutBeingUsed",dataType:1,value:d}],telemetryProperties:c.TelemetryProperties}};Otel.Telemetry.sendOtelEvent(f)}else Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("The Otel isn't available, couldn't call sendOtelEvent for logging the shortcuts telemetry",b,0)}};e.getPlatformName=function(){var a=navigator.userAgent;if(a.indexOf("Windows")>=0||a.indexOf("SunOS")>=0||a.indexOf("Linux")>=0)return c.ShortcutsMappingTableManager.s_shortcutPlatformWin32;else if(a.indexOf("Macintosh")>=0||a.indexOf("Mac OS X")>=0)return c.ShortcutsMappingTableManager.s_shortcutPlatformMac;else{Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("Unknown platform or operating system",b,0);return b}};e.s_usedShortcutAddins={};e.s_actionQueues={};e.s_addinIdMarketPlaceIdComponentIndex=1;e.s_addinIdMarketPlaceVersionComponentIndex=2;e.s_separator="|";return e}();c.ShortcutKeyDispatchManager=e})(OfficeExt||(OfficeExt={}));var _omexXmlNamespaces='xmlns="urn:schemas-microsoft-com:office:office" xmlns:o="urn:schemas-microsoft-com:office:office"';OSF.AppVersion={access:"ZAC150",excel:"ZXL150",excelwebapp:"WAE160",outlook:"ZOL150",outlookwebapp:"MOW150",powerpoint:"ZPP151",powerpointwebapp:"WAP160",project:"ZPJ150",word:"ZWD150",wordwebapp:"WAW160",onenotewebapp:"WAO160",visio:"ZVO161",visiowebapp:"WAV161"};OSF.AppSubType={Taskpane:1,Content:2,Contextual:3,Dictionary:4};OSF.ClientAppInfoReturnType={urlOnly:0,etokenOnly:1,both:2};function _getAppSubType(b){var a;if(b===0)a=OSF.AppSubType.Content;else if(b===1)a=OSF.AppSubType.Taskpane;else throw OsfMsAjaxFactory.msAjaxError.argument("officeExtentionTarget");return a}function _getAppVersion(b){var a=OSF.AppVersion[b.toLowerCase()];if(typeof a=="undefined")throw OsfMsAjaxFactory.msAjaxError.argument("applicationName");return a}function _invokeCallbackTag(g,h,l,k,a,m){var b=k;if(g){try{var d={status:h,result:l,failureInfo:null},e=function(a,c,b){if(a.failureInfo===null)a.failureInfo={};a.failureInfo[c]=b};if(a){var f=-1;if(a.get_statusCode)f=a.get_statusCode();if(!b)if(a.get_timedOut&&a.get_timedOut())b="Request timed out.";else if(a.get_aborted&&a.get_aborted())b="Request aborted.";if(f>=400||h===statusCode.Failed||b){e(d,"statusCode",f);e(d,"tagId",m);var c=a.get_webRequest();if(c){c.getResolvedUrl&&e(d,"url",c.getResolvedUrl());if(a.getResponseHeader&&c.get_userContext&&c.get_userContext()&&!c.get_userContext().correlationId){var j=a.getResponseHeader("X-CorrelationId");e(d,"correlationId",j)}}}}if(b){e(d,"message",b);OsfMsAjaxFactory.msAjaxDebug.trace(b)}}catch(i){OsfMsAjaxFactory.msAjaxDebug.trace("Encountered exception with logging: "+i)}g(d)}}var _serviceEndPoint=null,_defaultRefreshRate=3,_msPerDay=8.64e7,_defaultTimeout=6e4,_officeVersionHeader="X-Office-Version",_hourToDayConversionFactor=24,_buildParameter="&build=",_expectedVersionParameter="&expver=",_queryStringParameters={clientName:"client",clientVersion:"cv"},statusCode={Succeeded:1,Failed:0},_spUpn=null;function _sendWebRequest(c,h,d,g,b,e){b=b||{};var a=new Sys.Net.WebRequest;for(var f in d)a.get_headers()[f]=d[f];if(b){if(b.officeVersion)a.get_headers()[_officeVersionHeader]=b.officeVersion;if(b.correlationId&&c.indexOf("?")>-1)c+="&corr="+b.correlationId}e&&a.set_body(e);a.set_url(c);a.set_httpVerb(h);a.set_timeout(_defaultTimeout);a.set_userContext(b);a.add_completed(g);a.invoke()}function _onCompleted(a,g){var b=null,c=a.get_webRequest().get_userContext(),d=a.get_webRequest().get_url();if(a.get_timedOut()){OsfMsAjaxFactory.msAjaxDebug.trace("Request timed out: "+d);_invokeCallbackTag(c.callback,statusCode.Failed,b,b,a,8757955)}else if(a.get_aborted()){OsfMsAjaxFactory.msAjaxDebug.trace("Request aborted: "+d);_invokeCallbackTag(c.callback,statusCode.Failed,b,b,a,8757956)}else if(a.get_responseAvailable())if(a.get_statusCode()==200)try{c._onCompleteHandler(a,g)}catch(f){OsfMsAjaxFactory.msAjaxDebug.trace("Request failed with exception "+f+": "+d);_invokeCallbackTag(c.callback,statusCode.Failed,f,b,a,8757957)}else{var e=a.get_statusText();OsfMsAjaxFactory.msAjaxDebug.trace("Request failed with status code "+e+": "+d);_invokeCallbackTag(c.callback,statusCode.Failed,e,b,a,8757958)}else{OsfMsAjaxFactory.msAjaxDebug.trace("Request failed: "+d);_invokeCallbackTag(c.callback,statusCode.Failed,e,b,a,8757959)}}function _isProxyReady(b,a){a&&a({status:statusCode.Succeeded,result:true})}function _createQueryStringFragment(b){var c="";for(var d in b){var a=b[d];if(a===null||a===undefined||a==="")continue;c+="&"+encodeURIComponent(d)+"="+encodeURIComponent(a)}return c}OSF.HostSpecificFileVersionDefault="16.00";OSF.HostSpecificFileVersionMap={access:{web:"16.00"},agavito:{winrt:"16.00"},excel:{ios:"16.00",mac:"16.00",web:"16.00",win32:"16.01",winrt:"16.00"},onenote:{android:"16.00",web:"16.00",win32:"16.00",winrt:"16.00"},outlook:{ios:"16.00",mac:"16.00",web:"16.01",win32:"16.02"},powerpoint:{ios:"16.00",mac:"16.00",web:"16.00",win32:"16.01",winrt:"16.00"},project:{win32:"16.00"},sway:{web:"16.00"},word:{ios:"16.00",mac:"16.00",web:"16.00",win32:"16.01",winrt:"16.00"},visio:{web:"16.00",win32:"16.00"}};OSF.HostType={Excel:"Excel",Outlook:"Outlook",Access:"Access",PowerPoint:"PowerPoint",Word:"Word",Sway:"Sway",OneNote:"OneNote",Visio:"Visio"};OSF.ManifestHostType={Workbook:"Workbook",Document:"Document",Presentation:"Presentation",Notebook:"Notebook",Mailbox:"Mailbox",Drawing:"Drawing"};OSF.HostPlatform={Web:"Web"};OSF.getAppVerCode=function(c){var b="Invalid appName.",a;switch(c){case OSF.AppName.ExcelWebApp:a="excel.exe";break;case OSF.AppName.AccessWebApp:a="ZAC";break;case OSF.AppName.PowerpointWebApp:a="WAP";break;case OSF.AppName.WordWebApp:a="WAW";break;case OSF.AppName.OneNoteWebApp:a="WAO";break;case OSF.AppName.VisioWebApp:a="WAV";break;default:OsfMsAjaxFactory.msAjaxDebug.trace(b);throw b}return a};OSF.getModernAppVerCode=function(c){var b="Invalid appName.",a;switch(c){case OSF.AppName.ExcelWebApp:a="WAC_Excel";break;case OSF.AppName.PowerpointWebApp:a="WAC_PowerPoint";break;case OSF.AppName.WordWebApp:a="WAC_Word";break;case OSF.AppName.OneNoteWebApp:a="WAC_OneNote";break;case OSF.AppName.OutlookWebApp:a="WAC_Outlook";break;case OSF.AppName.VisioWebApp:a="WAC_Visio";break;default:OsfMsAjaxFactory.msAjaxDebug.trace(b);throw b}return a};OSF.getManifestHostType=function(b){var a;switch(b){case OSF.HostType.Excel:a=OSF.ManifestHostType.Workbook;break;case OSF.HostType.Word:a=OSF.ManifestHostType.Document;break;case OSF.HostType.PowerPoint:a=OSF.ManifestHostType.Presentation;break;case OSF.HostType.OneNote:a=OSF.ManifestHostType.Notebook;break;case OSF.HostType.Outlook:a=OSF.ManifestHostType.Mailbox;break;case OSF.HostType.Visio:a=OSF.ManifestHostType.Drawing;break;default:OsfMsAjaxFactory.msAjaxDebug.trace("Invalid host type.");throw"Invalid hostType."}return a};OSF.Capability={Mailbox:"Mailbox",Document:"Document",Workbook:"Workbook",Project:"Project",Presentation:"Presentation",Database:"Database",Sway:"Sway",Notebook:"Notebook",Drawing:"Drawing"};OSF.HostCapability={Excel:OSF.Capability.Workbook,Outlook:OSF.Capability.Mailbox,Access:OSF.Capability.Database,PowerPoint:OSF.Capability.Presentation,Word:OSF.Capability.Document,Sway:OSF.Capability.Sway,OneNote:OSF.Capability.Notebook,Visio:OSF.Capability.Drawing};OSF.OsfControlTarget={Undefined:-1,InContent:0,TaskPane:1,Contextual:2};OSF.OsfControlPermission={Restricted:1,ReadDocument:2,WriteDocument:4,ReadItem:32,ReadWriteMailbox:64,ReadAllDocument:131,ReadWriteDocument:135};OSF.OsfControlStatus={NotActivated:1,Activated:2,AppStoreNotReachable:3,InvalidOsfControl:4,UnsupportedStore:5,UnknownStore:6,ActivationFailed:7,NotSandBoxSupported:8};OSF.OsfControlPageStatus={NotStarted:1,Loading:2,Ready:3,FailedHandleRequest:4,FailedOriginCheck:5,FailedPermissionCheck:6};OSF.StoreType={OMEX:"omex",SPCatalog:"spcatalog",SPApp:"spapp",Exchange:"exchange",FileSystem:"filesystem",Registry:"registry",InMemory:"inmemory",OneDrive:"onedrive",PrivateCatalog:"excatalog",HardCodedPreinstall:"hardcodedpreinstall",FirstParty:"firstparty",UploadFileDevCatalog:"uploadfiledevcatalog",Sdx:"sdxcatalog"};OSF.StoreTypeEnum={MarketPlace:0,Catalog:1,SPApp:2,Exchange:3,FileSystem:4,Registry:5,OneDrive:9,PrivateCatalog:10,HardCodedPreinstall:11,FirstParty:12,Sdx:14,UploadFileDevCatalog:15};OSF.ManifestIdIssuer={Microsoft:"Microsoft",Custom:"Custom"};OSF.OmexClientAppStatus={OK:1,UnknownAssetId:2,KilledAsset:3,NoEntitlement:4,DownloadsExceeded:5,Expired:6,Invalid:7,Revoked:8,ServerError:9,BadRequest:10,LimitedTrial:11,TrialNotSupported:12,EntitlementDeactivated:13,VersionMismatch:14,VersionNotSupported:15,UserIsMinor:16};OSF.OmexState={Killed:0,OK:1,Withdrawn:2,Flagged:3,DeveloperWithdrawn:4};OSF.OmexTrialType={None:0,Office:1,External:2};OSF.OmexEntitlementType={Free:"free",Trial:"trial",Paid:"paid"};OSF.OmexAuthNStatus={NotAttempted:-1,CheckFailed:0,Authenticated:1,Anonymous:2,Unknown:3};OSF.OmexRemoveAppStatus={Failed:0,Success:1};OSF.OfficeAppType={ContentApp:OSF.OsfControlTarget.InContent,TaskPaneApp:OSF.OsfControlTarget.TaskPane,MailApp:OSF.OsfControlTarget.Contextual};OSF.FormFactor={Default:"DefaultSettings",Desktop:"DesktopSettings",Tablet:"TabletSettings",Phone:"PhoneSettings"};OSF.OsfOfficeExtensionManagerPerfMarker={GetEntitlementStart:"Agave.OfficeExtensionManager.GetEntitlementStart",GetEntitlementEnd:"Agave.OfficeExtensionManager.GetEntitlementEnd"};OSF.OsfControlActivationPerfMarker={ActivationStart:"Agave.AgaveActivationStart",ActivationEnd:"Agave.AgaveActivationEnd",DeactivationStart:"Agave.AgaveDeactivationStart",DeactivationEnd:"Agave.AgaveDeactivationEnd",SelectionTimeout:"Agave.AgaveSelectionTimeout"};OSF.NotificationUxPerfMarker={RenderLoadingAnimationStart:"Agave.NotificationUx.RenderLoadingAnimationStart",RenderLoadingAnimationEnd:"Agave.NotificationUx.RenderLoadingAnimationEnd",RemoveLoadingAnimationStart:"Agave.NotificationUx.RemoveLoadingAnimationStart",RemoveLoadingAnimationEnd:"Agave.NotificationUx.RemoveLoadingAnimationEnd",RenderStage1Start:"Agave.NotificationUx.RenderStage1Start",RenderStage1End:"Agave.NotificationUx.RenderStage1End",RemoveStage1Start:"Agave.NotificationUx.RemoveStage1Start",RemoveStage1End:"Agave.NotificationUx.RemoveStage1End",RenderStage2Start:"Agave.NotificationUx.RenderStage2Start",RenderStage2End:"Agave.NotificationUx.RenderStage2End",RemoveStage2Start:"Agave.NotificationUx.RemoveStage2Start",RemoveStage2End:"Agave.NotificationUx.RemoveStage2End"};OSF.ProxyCallStatusCode={Succeeded:1,Failed:0,ProxyNotReady:-1};OSF.UpnCheckCode={NotSet:0,Match:1,NotMatch:2};OSF.HostFrameTrustState={NotInitialized:0,NotImplemented:1,NotReady:2,Exempted:3,NotTrusted:4,Trusted:5};OSF.ClientAppInfoReturnType={urlOnly:0,etokenOnly:1,both:2};OSF.SQMDataPoints={DATAID_APPSFOROFFICEUSAGE:10595,DATAID_APPSFOROFFICENOTIFICATIONS:10942};OSF.BWsaStreamTypes={Static:1};OSF.BWsaConfig={defaultMaxStreamRows:1e3};OSF.ErrorStatusCodes={E_OEM_EXTENSION_NOT_ENTITLED:2147758662,E_MANIFEST_SERVER_UNAVAILABLE:2147758672,E_USER_NOT_SIGNED_IN:2147758677,E_MANIFEST_DOES_NOT_EXIST:2147758673,E_OEM_EXTENSION_KILLED:2147758660,E_OEM_OMEX_EXTENSION_KILLED:2147758686,E_MANIFEST_UPDATE_AVAILABLE:2147758681,S_OEM_EXTENSION_TRIAL_MODE:275013,E_OEM_EXTENSION_WITHDRAWN_FROM_SALE:2147758690,E_TOKEN_EXPIRED:2147758675,E_TRUSTCENTER_CATALOG_UNTRUSTED_ADMIN_CONTROLLED:2147757992,E_MANIFEST_REFERENCE_INVALID:2147758678,S_USER_CLICKED_BUY:274205,E_MANIFEST_INVALID_VALUE_FORMAT:2147758654,E_TRUSTCENTER_MOE_UNACTIVATED:2147757996,S_OEM_EXTENSION_FLAGGED:275040,S_OEM_EXTENSION_DEVELOPER_WITHDRAWN_FROM_SALE:275041,E_BROWSER_VERSION:2147758194,E_TRUSTCENTER_APP_BLOCKED_FOR_MINOR:-2147209295,E_PRIVACY_SERVICE_DISABLED_ADMIN:2147758792,WAC_AgaveUnsupportedStoreType:1041,WAC_AgaveActivationError:1042,WAC_ActivateAttempLoading:1043,WAC_HTML5IframeSandboxNotSupport:1044,WAC_AgaveRequirementsErrorOmex:1045,WAC_AgaveRequirementsError:1046,WAC_AgaveOriginCheckError:1047,WAC_AgavePermissionCheckError:1048,WAC_AgaveHostHandleRequestError:1049,WAC_AgaveUnknownClientAppStatus:1050,WAC_AgaveAnonymousProxyCreationError:1051,WAC_AgaveOsfControlActivationError:1052,WAC_AgaveEntitlementRequestFailure:1053,WAC_AgaveManifestRequestFailure:1054,WAC_AgaveManifestAndEtokenRequestFailure:1055,WAC_FirstPartyAddInListRequestFailure:1056,WAC_SDX_DMSRequestFailed:1058,WAC_SDX_AssetIdNotInDMSResponse:1059,WAC_CustomFunctionsRegistrationError:1060,WAC_WopiHostCheckStatusNotTrusted:1061,WAC_WopiHostCheckStatusNotReady:1062,WAC_AgaveIRMBlockError:1063};OSF.InvokeResultCode={S_OK:0,E_REQUEST_TIME_OUT:-2147471590,E_USER_NOT_SIGNED_IN:-2147208619,E_CATALOG_ACCESS_DENIED:-2147471591,E_CATALOG_REQUEST_FAILED:-2147471589,E_OEM_NO_NETWORK_CONNECTION:-2147208640,E_PROVIDER_NOT_REGISTERED:-2147208617,E_OEM_CACHE_SHUTDOWN:-2147208637,E_OEM_REMOVED_FAILED:-2147209421,E_CATALOG_NO_APPS:-1,E_GENERIC_ERROR:-1e3,S_HIDE_PROVIDER:10};OSF.OmexClientNames=function(){var a={},b=OSF.AppName;a[b.ExcelWebApp]="WAC_Excel";a[b.WordWebApp]="WAC_Word";a[b.OutlookWebApp]="WAC_Outlook";a[b.AccessWebApp]="WAC_Access";a[b.PowerpointWebApp]="WAC_Powerpoint";a[b.OneNoteWebApp]="WAC_OneNote";a[b.VisioWebApp]="WAC_Visio";return a}();OSF.OmexAppVersions=function(){var a={},b=OSF.AppName;a[b.ExcelWebApp]=OSF.AppVersion.excelwebapp;a[b.WordWebApp]=OSF.AppVersion.wordwebapp;a[b.OutlookWebApp]=OSF.AppVersion.outlookwebapp;a[b.AccessWebApp]=OSF.AppVersion.access;a[b.PowerpointWebApp]=OSF.AppVersion.powerpointwebapp;a[b.OneNoteWebApp]=OSF.AppVersion.onenotewebapp;a[b.VisioWebApp]=OSF.AppVersion.visiowebapp;return a}();OSF.ActivationTypes={V1Enabled:0,V1S2SEnabled:1,V2Enabled:2,V2S2SEnabled:3};OSF.ManifestRequestTypes={Manifest:1,Etoken:2,Both:3};OSF.HostInfoFlags={None:0,SharedApp:1,CustomFunction:2,ProtectedDocDisable:4};OSF.MaxAppContextLength=10240;OSF.HostFeatureGateFlags={None:0,Enable3rdPartySetAppContextInIFrameName:2};OSF.SdxAssetIds={Ideas:"fa000000029",ExperimentationSdx:"fa000000059"};OSF.ExtendedManifestSupportTokens={Requirements:"RequirementsToken",Locale:"LocaleToken",TokenReplaceRegex:"\\$\\{token\\.(\\w+)\\}"};var OfficeExt;(function(b){var a=null,d=function(){function c(){}c.versionLessThan=function(a,b){return OSF.OsfManifestManager.versionLessThan(a,b)};c.ParseManifest=function(e,d,c){try{return new OSF.Manifest.Manifest(e,d)}catch(b){Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Invalid manifest:",b,c,20306078);return a}};c.constructAddInId=function(f,g,e,d){var c="{0}|{1}|{2}|{3}|{4}|||",a="2";return b.MsAjaxString.format(c,a,f,g,this.GetStoreTypeId(e).toString(),d)};c.GetStoreTypeId=function(a){if(a==OSF.StoreType.OMEX)return OSF.StoreTypeEnum.MarketPlace;else if(a==OSF.StoreType.SPCatalog)return OSF.StoreTypeEnum.Catalog;else if(a==OSF.StoreType.SPApp)return OSF.StoreTypeEnum.SPApp;else if(a==OSF.StoreType.Exchange)return OSF.StoreTypeEnum.Exchange;else if(a==OSF.StoreType.FileSystem)return OSF.StoreTypeEnum.FileSystem;else if(a==OSF.StoreType.Registry)return OSF.StoreTypeEnum.Registry;else if(a==OSF.StoreType.OneDrive)return OSF.StoreTypeEnum.OneDrive;else if(a==OSF.StoreType.PrivateCatalog)return OSF.StoreTypeEnum.PrivateCatalog;else if(a==OSF.StoreType.HardCodedPreinstall)return OSF.StoreTypeEnum.HardCodedPreinstall;else if(a==OSF.StoreType.FirstParty)return OSF.StoreTypeEnum.FirstParty;else if(a==OSF.StoreType.UploadFileDevCatalog)return OSF.StoreTypeEnum.UploadFileDevCatalog;return -1};c.GetStoreTypeName=function(c){var b=parseInt(c);if(b==OSF.StoreTypeEnum.MarketPlace)return OSF.StoreType.OMEX;else if(b==OSF.StoreTypeEnum.Catalog)return OSF.StoreType.SPCatalog;else if(b==OSF.StoreTypeEnum.SPApp)return OSF.StoreType.SPApp;else if(b==OSF.StoreTypeEnum.Exchange)return OSF.StoreType.Exchange;else if(b==OSF.StoreTypeEnum.FileSystem)return OSF.StoreType.FileSystem;else if(b==OSF.StoreTypeEnum.Registry)return OSF.StoreType.Registry;else if(b==OSF.StoreTypeEnum.OneDrive)return OSF.StoreType.OneDrive;else if(b==OSF.StoreTypeEnum.PrivateCatalog)return OSF.StoreType.PrivateCatalog;else if(b==OSF.StoreTypeEnum.HardCodedPreinstall)return OSF.StoreType.HardCodedPreinstall;else if(b==OSF.StoreTypeEnum.FirstParty)return OSF.StoreType.FirstParty;else if(b==OSF.StoreTypeEnum.UploadFileDevCatalog)return OSF.StoreType.UploadFileDevCatalog;return a};return c}();b.ManifestUtil=d;var e=function(){function c(){}c.failed=function(c,f,d){if(c.status!=b.DataServiceResultCode.Succeeded){var e={status:c.status,httpStatus:c.httpStatus};if(d!=a)e.value=d;f(e);return true}return false};c.retry=function(h,a){if(a===void 0)a={};var b=a.retries,i=b===void 0?3:b,c=a.factor,j=c===void 0?2:c,d=a.minTimeout,g=d===void 0?300:d,e=a.maxTimeout,f=e===void 0?Infinity:e;return new Promise(function(b,c){var a=function(d){h().then(b,function(b){if(d>=i){c(b);return}setTimeout(function(){return a(d+1)},Math.min(g*Math.pow(j,d),f))})};a(0)})};c.limitRate=function(e,d){var a=[],c=-Infinity,b=function(){var f=a.shift();a.length>0&&setTimeout(b,d);c=performance.now();e.apply(void 0,f)};return function(){for(var f=[],e=0;e<arguments.length;e++)f[e-0]=arguments[e];a.length===0&&setTimeout(b,Math.max(0,d-(performance.now()-c)));a.push(f)}};c.withCache=function(b,k,o){var a="__OSF_AsyncCache_",l=k.forceUpdateCache,j=l===void 0?false:l,m=k.maxAgeInSecs,n=m===void 0?60*60*24*3:m;if(!j&&c.Cache.hasOwnProperty(b))return Promise.resolve({cacheType:"memory",value:c.Cache[b]});var g=a+b,e="__OSF_AsyncCacheExpiry",h=Date.now();try{if(h>=c.NextCheckExpiry){var d=JSON.parse(localStorage.getItem(e))||{},i=false;c.NextCheckExpiry=Infinity;for(var f in d)if(h>d[f]){localStorage.removeItem(a+f);delete d[f];i=true}else c.NextCheckExpiry=Math.min(c.NextCheckExpiry,d[f]);i&&localStorage.setItem(e,JSON.stringify(d))}if(!j&&localStorage.hasOwnProperty(g))return Promise.resolve({cacheType:"localStorage",value:localStorage.getItem(g)})}catch(p){}return o().then(function(d){c.Cache[b]=d;try{var a=JSON.parse(localStorage.getItem(e))||{};a[b]=h+n*1e3;c.NextCheckExpiry=Math.min(c.NextCheckExpiry,a[b]);localStorage.setItem(e,JSON.stringify(a));localStorage.setItem(g,d)}catch(f){}return {cacheType:"none",value:d}})};c.fetch=function(c,b){if(b===void 0)b={};return new Promise(function(j,l){var d=new XMLHttpRequest,g=b.method,k=g===void 0?"GET":g,h=b.headers,e=h===void 0?{}:h,i=b.body,m=i===void 0?a:i;d.onreadystatechange=function(){d.readyState==4&&j({ok:d.status>=200&&d.status<=299,status:d.status,statusText:d.statusText,text:function(){return Promise.resolve(d.responseText)},json:function(){return Promise.resolve(JSON.parse(d.responseText))}})};d.onerror=l;d.open(k,c,true);for(var f in e)d.setRequestHeader(f,e[f]);d.send(m)})};c.Cache={};c.NextCheckExpiry=0;return c}();b.AsyncUtil=e;var c=function(){function b(){}b.register=function(a,b){this._registry[a]=b};b.resolve=function(e,b){var d=this,c=d._resolved[e];if(c!=a)return c;b=b||d._hostInfo;if(b!=a){var f=d._registry[e];if(f==a)return a;d._resolved[e]=c=f(b)}return c};b.setHostContext=function(a){this._hostInfo=a};b.getHostContext=function(){return this._hostInfo};b._registry={};b._resolved={};return b}();b.CatalogFactory=c})(OfficeExt||(OfficeExt={}));var OfficeExt;(function(a){var b=function(){function b(a){this._initParams=a}b.prototype.getEntitlementAsync=function(c,d,b){b({status:a.DataServiceResultCode.Failed,httpStatus:403})};b.prototype.getAndCacheManifest=function(e,c,d,b){b({status:a.DataServiceResultCode.Failed,httpStatus:404})};b.prototype.activateAsync=function(e,c){var b=this;if(b._initParams&&b._initParams.loaderParams)if(b._initParams.controlStatus===OSF.OsfControlStatus.ActivationFailed)c.fail(b._initParams.loaderParams,b._initParams.controlStatus);else c.notifyUser(b._initParams.loaderParams);else c.fail(a.LoaderUtil.error({description:Strings.OsfRuntime.L_AgaveActivationError_ERR,errorCode:OSF.ErrorStatusCodes.WAC_AgaveActivationError}),OSF.OsfControlStatus.ActivationFailed)};b.prototype.removeAsync=function(d,c,b){b({status:a.DataServiceResultCode.Failed,httpStatus:403})};b.prototype.getAppDetails=function(e,d,c,b){b({status:a.DataServiceResultCode.Failed,httpStatus:403})};return b}();a.ForbiddenCatalog=b})(OfficeExt||(OfficeExt={}));var OfficeExt;(function(b){var a=function(){var c=true,a=null;function b(){}b.defaultTitle=function(a){switch(a){case OSF.InfoType.Information:return Strings.OsfRuntime.L_AgaveInformationTitle_TXT;case OSF.InfoType.Error:return Strings.OsfRuntime.L_AgaveErrorTile_TXT;case OSF.InfoType.Warning:return Strings.OsfRuntime.L_AgaveWarningTitle_TXT}return Strings.OsfRuntime.L_AgaveInformationTitle_TXT};b.fillMissing=function(d){var e=false;d.infoType=b.isNullOrUndefined(d.infoType)?OSF.InfoType.Information:d.infoType;d.title=d.title||b.defaultTitle(d.infoType);d.buttonTxt=d.buttonTxt||Strings.OsfRuntime.L_OkButton_TXT;d.buttonCallback=d.buttonCallback||a;d.url=d.url||a;d.urlButtonTxt=d.urlButtonTxt||a;d.dismissCallback=d.dismissCallback||a;d.reDisplay=!d.dismissCallback?c:e;d.displayDeactive=d.displayDeactive!=a?d.displayDeactive:c;d.detailView=d.detailView||e;d.logAsError=d.logAsError||e;d.highPriority=d.highPriority||e;d.retryAll=d.retryAll||e;d.errorCode=d.errorCode?d.errorCode:0;return d};b.error=function(d){d.infoType=b.isNullOrUndefined(d.infoType)?OSF.InfoType.Error:d.infoType;d.logAsError=d.logAsError!=a?d.logAsError:c;return b.fillMissing(d)};b.warning=function(d){d.infoType=b.isNullOrUndefined(d.infoType)?OSF.InfoType.Warning:d.infoType;d.logAsError=d.logAsError!=a?d.logAsError:c;return b.fillMissing(d)};b.showNotification=function(a,c){a.notifyUser(b.fillMissing(c))};b.showError=function(a,c){a.notifyUser(b.error(c))};b.showWarning=function(a,c){a.notifyUser(b.warning(c))};b.failWithWarning=function(c,d,a){a=b.isNullOrUndefined(a)?OSF.OsfControlStatus.ActivationFailed:a;c.fail(b.warning(d),a)};b.failWithError=function(c,d,a){a=b.isNullOrUndefined(a)?OSF.OsfControlStatus.ActivationFailed:a;c.fail(b.error(d),a)};b.isNullOrUndefined=function(b){return b===a||typeof b==="undefined"};return b}();b.LoaderUtil=a})(OfficeExt||(OfficeExt={}));var OfficeExt;(function(a){var b=function(){function b(b,a){this.osfControl=b;this.trusted=a}b.prototype.getRequirementsChecker=function(){return this.osfControl._contextActivationMgr.getRequirementsChecker()};b.prototype.load=function(g,h){var d=true,c=null,f=this,i=f,j=performance.now();if(f.osfControl.getReason()==Microsoft.Office.WebExtension.InitializationReason.Inserted){f.osfControl._retryActivate=c;f.osfControl._contextActivationMgr.retryAll(g.entitlement.assetId)}f.osfControl._status!==OSF.OsfControlStatus.NotActivated&&f.osfControl.deActivate();var e=g.manifest,b=f.osfControl;b._etoken=g.eToken;b._manifest=e;if(b._sourceLocationOverrideUrl)b._iframeUrl=b._sourceLocationOverrideUrl;else if(b._sourceLocationOverrideResourceId)b._iframeUrl=e.getSourceLocationOverrideByResourceId(b._sourceLocationOverrideResourceId);else b._iframeUrl=e.getDefaultSourceLocation(b._contextActivationMgr.getFormFactor());b._iframeUrl&&b.updateUrlsForSdx(g.manifestUrl);b._permission=e.getPermission();b._appDomains=e.getAppDomains();b.processManifestForCustomFunctions(e);e.getExtendedOverrides()&&b.processManifestForExtendedOverrides(e);if(h!=c)b._iframeUrl=h.decorateUrl(b._iframeUrl);if(b.hostInfoFlags()&OSF.HostInfoFlags.ProtectedDocDisable)if(!b.isFirstParty()){a.LoaderUtil.failWithError(f,{description:Strings.OsfRuntime.L_AgaveProtectedDocError_ERR,detailView:d,errorCode:OSF.ErrorStatusCodes.WAC_AgaveIRMBlockError});return}if(!b._contextActivationMgr._doesUrlHaveSupportedProtocol(b._iframeUrl)){a.LoaderUtil.failWithError(f,{description:Strings.OsfRuntime.L_AgaveManifestError_ERR,detailView:d,errorCode:OSF.ErrorStatusCodes.E_MANIFEST_INVALID_VALUE_FORMAT});return}h!=c&&h.preLoad(b,b._contextActivationMgr);var k=e.getDefaultDisplayName();b._isAddinCommands(function(a){if(a){b._isvirtualOsfControl=d;b.invokeVirtualOsfControlActivationCallback(e)}else{i.osfControl._sdxTelemetryContext["iframeCreateStart"]=performance.now();b._createIframeAndActivateOsfControl(k);i.osfControl._sdxTelemetryContext["iframeCreateEnd"]=performance.now()}});g.entitlement!=c&&g.entitlement.storeType===OSF.StoreType.Sdx&&a.SDXCatalog.recordActivity("IframeCreate",j,d,[{name:"OsfControlId",string:b._id},{name:"AssetId",string:g.entitlement.assetId}]);h!=c&&h.postLoad(b,b._contextActivationMgr)};b.prototype.skipTrust=function(){var a=this;return a.osfControl._contextActivationMgr._autoTrusted||a.osfControl.getTrustNoPrompt()||a.osfControl._isOsfControlInEmbeddingMode(a.osfControl)};b.prototype.hasConsent=function(){return this.trusted||this.isInsertion()};b.prototype.isInsertion=function(){return this.osfControl.getReason()==Microsoft.Office.WebExtension.InitializationReason.Inserted};b.prototype.setRetryCall=function(a){this.osfControl._retryActivate=a};b.prototype.askForTrust=function(a,b){var c=this;this.osfControl._showTrustError(a.clientName,a.displayName,a.providerName,a.iconUrl,a.entitlement.storeType,function(){c.restartActivation();b()},a.url,a.isSSOAddin)};b.prototype.askForUpgrade=function(a,b){var c=this;a.buttonCallback=function(){c.restartActivation();b()};this.notifyUser(a)};b.prototype.fail=function(c,b){var a=this.osfControl;a._status=b;this.notifyUser(c);a._contextActivationMgr.raiseOsfControlStatusChange(a)};b.prototype.notifyUser=function(b){var a=this.osfControl;b.id=a._id;a._contextActivationMgr.displayNotification(b)};b.prototype.restartActivation=function(){this.osfControl._restartActivate()};b.prototype.isForCustomFunctionSandbox=function(){return this.osfControl.isCustomFunctionSandbox()};b.prototype.setIsUpgrading=function(a){this.osfControl.setIsUpgrading(a)};b.prototype.getIsUpgrading=function(){return this.osfControl.getIsUpgrading()};b.prototype.setUpgradingFailed=function(a){this.osfControl.setUpgradingFailed(a)};return b}();a.OsfControlLoader=b})(OfficeExt||(OfficeExt={}));var OfficeExt;(function(a){var b=function(){var b=false;function a(a){this._requirementsChecker=a}a.prototype.getRequirementsChecker=function(){return this._requirementsChecker};a.prototype.load=function(){};a.prototype.skipTrust=function(){return b};a.prototype.hasConsent=function(){return b};a.prototype.setRetryCall=function(){};a.prototype.askForTrust=function(){};a.prototype.askForUpgrade=function(){};a.prototype.fail=function(){};a.prototype.notifyUser=function(){};a.prototype.restartActivation=function(){};a.prototype.isForCustomFunctionSandbox=function(){return b};a.prototype.setIsUpgrading=function(){};a.prototype.getIsUpgrading=function(){return b};a.prototype.setUpgradingFailed=function(){};return a}();a.PreCacher=b})(OfficeExt||(OfficeExt={}));var OfficeExt;(function(a){var b=function(){var b=null;function c(){var a=this;a.isReady=false;a.clientEndPoint=b;a.pendingCallbacks=[];a.iframe=b;a._pendingRequests={};a.conversationId=OSF.OUtil.generateConversationId()}c.prototype.invokeProxyCommandAsync=function(h,d,c){var i=this,e=d||d.correlationId||"",f=function(g){var f=g.value;if(f!=b)i.invokeProxyMethodAsync(h,c,d);else{Telemetry.RuntimeTelemetryHelper.LogExceptionTag("clientendpoint is invalid",b,e,18940552);c({status:a.DataServiceResultCode.ProxyNotReady})}},g=function(){Telemetry.RuntimeTelemetryHelper.LogExceptionTag("proxysetup failure",b,e,18940553);c({status:a.DataServiceResultCode.ProxyNotReady})};this.prepareProxy(f,g)};c.prototype.prepareProxy=function(){};c.prototype.doesUrlHaveSupportedProtocol=function(c){var a=false;if(c){var d=decodeURIComponent(c),e=d.match(/^https?:\/\/.+$/ig);a=e!=b}return a};c.prototype.invokeProxyMethodAsync=function(g,o,c){var n=c||c.correlationId||"",m=this.clientEndPoint._targetUrl,j=[m,g],e;for(var k in c){e=typeof c[k];(e==="string"||e==="number"||e==="boolean")&&j.push(c[k])}var f=j.join("."),d=this._pendingRequests,i={onCompleted:o,methodName:g,correlationId:n},h=d[f];if(!h){d[f]=[i];var l=function(o,c){var l=b,i=0,j=a.DataServiceResultCode.Failed;if(o===0&&c.status){l=c.result;j=a.DataServiceResultCode.Succeeded}var h=d[f];delete d[f];for(var n=h.length,m=0;m<n;m++){var e=h.shift();try{if(c&&c.failureInfo){i=c.failureInfo.statusCode||b;c.failureInfo["result"]=c.result;Telemetry.RuntimeTelemetryHelper.LogProxyFailure(e.correlationId,e.methodName,c.failureInfo)}e.onCompleted({status:j,httpStatus:i,value:l})}catch(g){var k="invokeProxyMethodAsync failed";a.WACUtils.logExceptionToBrowserConsole(k,g);Telemetry.RuntimeTelemetryHelper.LogExceptionTag(k,g,e.correlationId,19015124)}}};if(!c)c={};c.officeVersion=OSF.Constants.ThreePartsFileVersion;this.clientEndPoint.invoke(g,l,c)}else h.push(i)};return c}();a.ProxyBase=b})(OfficeExt||(OfficeExt={}));var OfficeExt;(function(a){(function(a){var h="ManifestRequest",g="KilledAppsCheck",f="AppStateCheck",e="EntitlementCheck",d="Authentication",c="ServerCall",b="Activation";a[a[b]=0]=b;a[a[c]=1]=c;a[a[d]=2]=d;a[a[e]=3]=e;a[a[f]=4]=f;a[a[g]=5]=g;a[a[h]=6]=h})(a.Activity||(a.Activity={}));var f=a.Activity;(function(a){var l="DmsRequestCachedFlag",k="ManifestRequestType",j="ActivationRuntimeType",i="AppStateDataInvalidFlag",h="AppStateDataCachedFlag",g="ManifestDataInvalidFlag",f="OmexHasEntitlementFlag",e="ManifestDataCachedFlag",d="ManifestTrustCachedFlag",c="RetryCount",b="AnonymousFlag";a[a[b]=0]=b;a[a[c]=1]=c;a[a[d]=2]=d;a[a[e]=3]=e;a[a[f]=4]=f;a[a[g]=5]=g;a[a[h]=6]=h;a[a[i]=7]=i;a[a[j]=8]=j;a[a[k]=9]=k;a[a[l]=10]=l})(a.FlagName||(a.FlagName={}));var g=a.FlagName,d=function(){function b(b,c,e,f,d){var a=this;a.correlationId=b;a.perfContext=c;a.appInfo=e;a.assetId=f;a.instanceId=d}b.prototype.startActivity=function(e){var c=this;switch(e){case f.Activation:var d=OSF.ActivationTypes.V2Enabled;if((c.appInfo&15)===0&&a.S2SOmexCatalogService._requestHandler)d=OSF.ActivationTypes.V2S2SEnabled;Telemetry.AppLoadTimeHelper.ActivationStart(c.perfContext,c.appInfo,c.assetId,c.correlationId,c.instanceId,d);c.setBits(g.ActivationRuntimeType,d);return}Telemetry.AppLoadTimeHelper.StartStopwatch(c.perfContext,b.StopWatchName[e])};b.prototype.stopActivity=function(a){Telemetry.AppLoadTimeHelper.StopStopwatch(this.perfContext,b.StopWatchName[a])};b.prototype.setFlag=function(a,c){var b=c?2:1;this.setBits(a,b)};b.prototype.setBits=function(a,c){Telemetry.AppLoadTimeHelper.SetBit(this.perfContext,c,b.FlagOffsetMap[a],2)};b.FlagOffsetMap=[0,2,5,7,9,11,13,15,17,19,21];b.StopWatchName=["Stage1Time","Stage4Time","Stage5Time","Stage7Time","Stage9Time","Stage8Time","Stage10Time"];return b}();a.ActivationTelemetryContext=d;var b=function(){function a(a){this.correlationId=a}a.prototype.startActivity=function(){};a.prototype.stopActivity=function(){};a.prototype.setFlag=function(){};a.prototype.setBits=function(){};return a}();a.AddinCommandsTelemetryContext=b;var c=function(){function a(a){this.correlationId=a}a.prototype.startActivity=function(){};a.prototype.stopActivity=function(){};a.prototype.setFlag=function(){};a.prototype.setBits=function(){};return a}();a.InsertDialogTelemetryContext=c;var e=function(){function a(){}a.prototype.startActivity=function(){};a.prototype.stopActivity=function(){};a.prototype.setFlag=function(){};a.prototype.setBits=function(){};return a}();a.SimpleTelemetryContext=e})(OfficeExt||(OfficeExt={}));var OfficeExt;(function(b){var a=null,e=function(){var d=".";function c(d,c){if(c===void 0)c=a;this._initParam=d;this._cacheManager=c||new b.AppsDataCacheManager(OSF.OUtil.getLocalStorage(),new b.SafeSerializer)}c.prototype.getEntitlementAsync=function(i,k,j){var c=this,g=c,d=[],h=[],f=i?c.getUploadFileDevCatalogAddinCommandsMyAddinsCacheKey():c.getUploadFileDevCatalogAddinsCacheKey(),e=c._cacheManager.GetCacheItem(f);if(e!=a){e.forEach(function(e){var f=g._cacheManager.GetCacheItem(g.getUploadFileDevCatalogManifestCacheKey(e));if(f!=a){var c=b.ManifestUtil.ParseManifest(f,g._initParam.appUILocale);if(c==a)return;var i={assetId:e,appVersion:c.getMarketplaceVersion(),storeId:"developer",storeType:OSF.StoreType.UploadFileDevCatalog,targetType:c.getTarget()};h.push(i);d.push(e)}});if(d.length!=e.length)if(d.length>0)c._cacheManager.SetCacheItem(f,d);else c._cacheManager.RemoveCacheItem(f)}j({status:b.DataServiceResultCode.Succeeded,value:h})};c.prototype.getAndCacheManifest=function(d,i,j,h){var e=this,g=OSF.OsfManifestManager.getCachedManifest(d.assetId,d.appVersion);if(g!=a){h({status:b.DataServiceResultCode.Succeeded,value:g});return}var f=function(g,c,h){var b=e._cacheManager.GetCacheItem(e.getUploadFileDevCatalogManifestCacheKey(d.assetId));if(b==a&&g>=1)setTimeout(function(){return f(g-1,c*2,h)},c);else h(b)};f(c.GetManifestRetryLimit,c.GetManifestRetryWaitMs,function(f){var c;if(f!=a){c=b.ManifestUtil.ParseManifest(f,e._initParam.appUILocale);c!=a&&OSF.OsfManifestManager.cacheManifest(d.assetId,d.appVersion,c)}h({status:c!=a?b.DataServiceResultCode.Succeeded:b.DataServiceResultCode.Failed,value:c})})};c.prototype.activateAsync=function(d,c,e){var f=this;this.getAndCacheManifest(d,d.storeId,e,function(g){if(g.status==b.DataServiceResultCode.Succeeded){var h=b.HostFeatureEnabledInfo.getHostFeatureEnabledInfo();if(h&&h.enableSingleSignOnForAddin&&!c.isForCustomFunctionSandbox())var i=g.value;c.load({entitlement:d,eToken:"",manifest:g.value},a);return}b.LoaderUtil.failWithError(c,{description:Strings.OsfRuntime.L_AgaveManifestRetrieve_ERR,buttonTxt:Strings.OsfRuntime.L_RetryButton_TXT,buttonCallback:function(){c.restartActivation();f.activateAsync(d,c,e)},errorCode:OSF.ErrorStatusCodes.E_MANIFEST_SERVER_UNAVAILABLE})})};c.prototype.removeAsync=function(d,c,a){a({status:b.DataServiceResultCode.Failed})};c.prototype.getAppDetails=function(e,d,c,a){a({status:b.DataServiceResultCode.Failed})};c.prototype.validateAndCacheNewManifest=function(b,a,c,d){if(this.validateAddinIdAndVersion(b,a)){this.cacheManifest(b,a,c,d);return true}return false};c.prototype.localCacheAddinCommands=function(a){this.cacheMyAddins(this.getUploadFileDevCatalogAddinCommandsMyAddinsCacheKey(),a)};c.prototype.validateAddinIdAndVersion=function(b,a){return c.idRegExp.test(b)&&c.versionRegExp.test(a)};c.prototype.cacheManifest=function(b,d,c,e){var a=this;OSF.OsfManifestManager.cacheManifest(b,d,e);a.cacheMyAddins(a.getUploadFileDevCatalogAddinsCacheKey(),b);a._cacheManager.SetCacheItem(a.getUploadFileDevCatalogManifestCacheKey(b),c)};c.prototype.cacheMyAddins=function(c,d){var b=this._cacheManager.GetCacheItem(c);if(b==a)b=[];if(b.lastIndexOf(d)<0){b.push(d);this._cacheManager.SetCacheItem(c,b)}};c.prototype.getUploadFileDevCatalogAddinsCacheKey=function(){return c.UploadFileCatalogCacheKey.myAddins+d+this._initParam.appName+d+this._initParam.userNameHashCode};c.prototype.getUploadFileDevCatalogAddinCommandsMyAddinsCacheKey=function(){return c.UploadFileCatalogCacheKey.addinCommandsMyAddins+d+this._initParam.appName+d+this._initParam.userNameHashCode};c.prototype.getUploadFileDevCatalogManifestCacheKey=function(a){return c.UploadFileCatalogCacheKey.manifest+d+this._initParam.appName+d+a};c.UploadFileCatalogCacheKeyPrefix="__OSF_UPLOADFILE.";c.UploadFileCatalogCacheKey={myAddins:c.UploadFileCatalogCacheKeyPrefix+"MyAddins",addinCommandsMyAddins:c.UploadFileCatalogCacheKeyPrefix+"AddinCommandsMyAddins",manifest:c.UploadFileCatalogCacheKeyPrefix+"Manifest"};c.idRegExp=new RegExp("[\\w-]+");c.versionRegExp=new RegExp("(\\d{1,2}.)*\\d{1,2}");c.GetManifestRetryLimit=4;c.GetManifestRetryWaitMs=500;return c}();b.CatalogFactory.register(OSF.StoreType.UploadFileDevCatalog,function(c){if(c.enableUploadFileDevCatalog){var d=new e({appName:c.appName,appUILocale:c.appUILocale,userNameHashCode:c.userNameHashCode});return d}return new b.ForbiddenCatalog(a)});var d=function(){var a="Should never here";function c(b,a){this._catalog=b;this._storeType=a}c.prototype.validateAndCacheNewManifest=function(){throw a};c.prototype.getEntitlementsAsync=function(e,c,d,a){this._catalog.getEntitlementAsync(c,new b.AddinCommandsTelemetryContext(OSF.OUtil.Guid.generateNewGuid()),function(b){a(b.value)},false,d)};c.prototype.getManifestAsync=function(){throw a};c.prototype.localCacheAddinCommands=function(e,b,d,c){if(this._storeType==OSF.StoreType.UploadFileDevCatalog){var a=this._catalog;a.localCacheAddinCommands(b,d,c)}};return c}(),c=function(){function c(){}c.createAddinDataProvider=function(c){var e=b.CatalogFactory.resolve(c);if(e==a)return a;return new d(e,c)};return c}();b.AddinDataProviderFactory=c})(OfficeExt||(OfficeExt={}));var OfficeExt;(function(a){(function(a){var f="Unauthenticated",e="UnknownUserType",d="PrxoyUrlEmpty",c="ProxyNotReady",b="Succeeded";a[a[b]=1]=b;a[a["Failed"]=0]="Failed";a[a[c]=-1]=c;a[a[d]=-2]=d;a[a[e]=2]=e;a[a[f]=3]=f})(a.DataServiceResultCode||(a.DataServiceResultCode={}));var b=a.DataServiceResultCode})(OfficeExt||(OfficeExt={}));var OfficeExt;(function(a){var b=true,c=function(){var e=false,c=null;function d(d,b){if(b===void 0)b=c;this._initParam=d;this._cacheManager=b||new a.AppsDataCacheManager(OSF.OUtil.getLocalStorage(),new a.SafeSerializer)}d.LogFirstPartyCatalogMonitoringError=function(a,b){Telemetry.RuntimeTelemetryHelper.LogExceptionTag("First Party Catalog Error AssetId: "+b+" Message: "+a,c,c,39068000)};d.prototype.getEntitlementAsync=function(){throw new Error("in firstParty get Entitlementasync")};d.prototype.getAndCacheManifest=function(){throw new Error("in firstParty getAndCacheManifest")};d.prototype.removeAsync=function(){throw new Error("in firstParty removeAsync")};d.prototype.getAppDetails=function(){throw new Error("in firstParty getappDetails")};d.prototype.TryFallBackFirstPartyAddInList=function(h,g,f){var b=this._cacheManager.GetCacheItem(a.CacheConsts.firstPartyAddinListCacheKey,e);if(b){d.LogFirstPartyCatalogMonitoringError("Falling back to stale 1st party add-ins list.",g);f({status:a.DataServiceResultCode.Succeeded,value:b})}else f({status:a.DataServiceResultCode.Failed,value:c})};d.prototype.GetFirstyPartyAddInsInfo=function(k,f,i,d){var g=this,h=this._cacheManager.GetCacheItem(a.CacheConsts.firstPartyAddinListCacheKey,b,c,c,e);if(h){var j={addInList:h,refreshRate:c};d({status:a.DataServiceResultCode.Succeeded,value:j});return}k.getFirstPartyAddInList(function(e){if(e.status!=a.DataServiceResultCode.Succeeded){g.TryFallBackFirstPartyAddInList(f,i,d);return}var b=c;try{b=a.OmexXmlProcessor.ProcessFirstPartyAddInList(e.value)}catch(h){Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Problem parsing first party list.",h,f.correlationId,34366472);g.TryFallBackFirstPartyAddInList(f,i,d);return}g._cacheManager.SetCacheItem(a.CacheConsts.firstPartyAddinListCacheKey,b.addInList,b.refreshRate/a.CacheConsts.hourToDayConversionFactor);d({status:a.DataServiceResultCode.Succeeded,value:b});return})};d.prototype.TryFallBackFirstPartyManifest=function(f,g,e){var b=this.ReadFirstPartyManifestFromLocalStorage(g,f);if(b){d.LogFirstPartyCatalogMonitoringError("Falling back to stale manifest.",f);e({status:a.DataServiceResultCode.Succeeded,value:b})}else e({status:a.DataServiceResultCode.Failed,value:c})};d.prototype.ReadFirstPartyManifestFromLocalStorage=function(f,g){var d=OSF.OUtil.formatString(a.CacheConsts.firstPartyManifestCacheKey,g),b=this._cacheManager.GetCacheItem(d,e);if(b)return a.ManifestUtil.ParseManifest(b,this._initParam.appUILocale,f.correlationId);return c};d.prototype.GetCachedManifest=function(c,b){var a=OSF.OsfManifestManager.getCachedManifest(b,"");if(!a){a=this.ReadFirstPartyManifestFromLocalStorage(c,b);a&&OSF.OsfManifestManager.cacheManifest(b,"",a)}return a};d.prototype.GetFirstPartyManifest=function(i,c,b,d){var e=this,f=this.GetCachedManifest(c,b.assetId);if(f&&!OSF.OsfManifestManager.versionLessThan(f.getMarketplaceVersion(),b.version)){d({status:a.DataServiceResultCode.Succeeded,value:f});return}var g="{0}/{1}",h=OSF.OUtil.formatString(g,this._initParam.firstPartyManifestCDNUrl,b.path);i.getFirstPartyManifest(h,function(g){if(g.status!=a.DataServiceResultCode.Succeeded){e.TryFallBackFirstPartyManifest(b.assetId,c,d);return}var f=a.ManifestUtil.ParseManifest(g.value,e._initParam.appUILocale,c.correlationId);if(!f){e.TryFallBackFirstPartyManifest(b.assetId,c,d);return}OSF.OsfManifestManager.cacheManifest(b.assetId,"",f);var h=OSF.OUtil.formatString(a.CacheConsts.firstPartyManifestCacheKey,b.assetId);e._cacheManager.SetCacheItem(h,g.value);d({status:a.DataServiceResultCode.Succeeded,value:f});return})};d.prototype.getDataService=function(g,e){var d=this,i=d;if(d._dataService!=c){e({status:a.DataServiceResultCode.Succeeded,value:d._dataService});return}var b={status:a.DataServiceResultCode.Failed,value:c},h=function(d,c){if(d.status==a.DataServiceResultCode.Succeeded){i._dataService=c;b.value=c;b.status=a.DataServiceResultCode.Succeeded;e(b)}else{b.httpStatus=d.httpStatus;e(b)}},f=a.ProxyBasedCatalogService.getFirstPartyInstance(d._initParam);f.prepareProxy(g.correlationId,function(a){h(a,f)})};d.prototype.createActivityScope=function(c,d){var e=this;this.getDataService(c,function(g){if(a.AsyncUtil.failed(g,d))return;var f=g.value,h={cacheManager:e._cacheManager,cachePrefix:a.CacheConsts.anonymousCacheKeyPrefix,cid:f.getCID(),anonymous:b,telemetryContext:c},i=f.createScope(h);d({status:a.DataServiceResultCode.Succeeded,value:i})})};d.prototype.activateAsync=function(h,g,f){var k=this,j=k;f.startActivity(a.Activity.Activation);f.startActivity(a.Activity.ServerCall);var l=a.HostFeatureEnabledInfo.getHostFeatureEnabledInfo(),i=l&&l.enableFirstPartySDXErrorMessages,n=k._cacheManager.GetCacheItem(a.CacheConsts.firstPartyAddinListCacheKey,b,c,c,e);if(n){var m=k.GetCachedManifest(f,h.assetId);if(m){f.stopActivity(a.Activity.ServerCall);g.load({entitlement:h,manifest:m,eToken:""},c);return}}k.createActivityScope(f,function(e){if(e.status!=a.DataServiceResultCode.Succeeded){d.LogFirstPartyCatalogMonitoringError("Failed to create 1st party activity scope.",h.assetId);a.LoaderUtil.failWithError(g,{title:i?Strings.OsfRuntime.L_AgaveErrorTile_TXT_FirstParty:Strings.OsfRuntime.L_AgaveErrorTile_TXT,description:i?Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR_FirstParty:Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR,buttonTxt:Strings.OsfRuntime.L_RetryButton_TXT,buttonCallback:function(){g.restartActivation();j.activateAsync(h,g,f)},errorCode:OSF.ErrorStatusCodes.WAC_AgaveAnonymousProxyCreationError});return}var b=e.value;j.GetFirstyPartyAddInsInfo(b,f,h.assetId,function(k){if(k.status!=a.DataServiceResultCode.Succeeded){d.LogFirstPartyCatalogMonitoringError("Failed get list of 1st party addIns.",h.assetId);a.LoaderUtil.failWithError(g,{title:i?Strings.OsfRuntime.L_AgaveErrorTile_TXT_FirstParty:Strings.OsfRuntime.L_AgaveErrorTile_TXT,description:i?Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR_FirstParty:Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR,buttonTxt:Strings.OsfRuntime.L_RetryButton_TXT,buttonCallback:function(){g.restartActivation();j.activateAsync(h,g,f)},errorCode:OSF.ErrorStatusCodes.WAC_FirstPartyAddInListRequestFailure});return}var l=k.value,e=l.addInList[h.assetId];if(!e){d.LogFirstPartyCatalogMonitoringError("Could not find 1st party addin assetId in list.",h.assetId);a.LoaderUtil.failWithError(g,{title:i?Strings.OsfRuntime.L_AgaveErrorTile_TXT_FirstParty:Strings.OsfRuntime.L_AgaveErrorTile_TXT,description:i?Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR_FirstParty:Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR,buttonTxt:Strings.OsfRuntime.L_RetryButton_TXT,buttonCallback:function(){g.restartActivation();j.activateAsync(h,g,f)},errorCode:OSF.ErrorStatusCodes.WAC_FirstPartyAddInListRequestFailure});return}f.startActivity(a.Activity.ManifestRequest);j.GetFirstPartyManifest(b,f,e,function(b){if(b.status!=a.DataServiceResultCode.Succeeded){d.LogFirstPartyCatalogMonitoringError("Could not get 1st party manifest.",h.assetId);a.LoaderUtil.failWithError(g,{title:i?Strings.OsfRuntime.L_AgaveErrorTile_TXT_FirstParty:Strings.OsfRuntime.L_AgaveErrorTile_TXT,description:i?Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR_FirstParty:Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR,buttonTxt:Strings.OsfRuntime.L_RetryButton_TXT,buttonCallback:function(){g.restartActivation();j.activateAsync(h,g,f)},errorCode:OSF.ErrorStatusCodes.WAC_AgaveManifestRequestFailure});return}f.stopActivity(a.Activity.ManifestRequest);f.stopActivity(a.Activity.ServerCall);var e=b.value;g.load({entitlement:h,manifest:e,eToken:""},c)})})})};return d}();a.FirstPartyCatalog=c;a.CatalogFactory.register(OSF.StoreType.FirstParty,function(d){if(d.osfOmexBaseUrl&&d.firstPartyManifestCDNUrl){var e,f=d.osfOmexBaseUrl.indexOf(OSF.Constants.ProtocolSeparator);if(f>=0)e=d.osfOmexBaseUrl.substr(f);else e=OSF.Constants.ProtocolSeparator+d.osfOmexBaseUrl;var g=OSF.Constants.Https+e,h=new c({appName:d.appName,appUILocale:d.appUILocale,AppVersion:d.appVersion,clientMode:d.clientMode,docUrl:d.docUrl,omexBaseUrl:g,omexForceAnonymous:b,firstPartyManifestCDNUrl:d.firstPartyManifestCDNUrl});return h}return new a.ForbiddenCatalog({loaderParams:a.LoaderUtil.error({description:Strings.OsfRuntime.L_AgaveOmexNotConfigured_ERR,errorCode:OSF.ErrorStatusCodes.E_TRUSTCENTER_CATALOG_UNTRUSTED_ADMIN_CONTROLLED}),controlStatus:OSF.OsfControlStatus.ActivationFailed})})})(OfficeExt||(OfficeExt={}));var OfficeExt;(function(a){var b=function(){var b="OMEX_clearCacheAsync",f="OMEX_removeCacheAsync",e="OMEX_getAppStateAsync",d="OMEX_getKilledAppsAsync",c="OMEX_getManifestAndETokenAsync";function a(){}a.CheckProxyIsReady="OMEX_isProxyReady";a.Gated_GetManifestAndEToken=c;a.Gated_GetKilledApps=d;a.Gated_GetEntitlementSummary="OMEX_getEntitlementSummaryAsync";a.Gated_GetAppState=e;a.Gated_RemoveApp="OMEX_removeAppAsync";a.Gated_RemoveCache=f;a.Gated_ClearCache=b;a.UnGated_GetAppDetails="OMEX_getAppDetailsAsync";a.UnGated_GetRecommendations="OMEX_getRecommendationsAsync";a.UnGated_ClearCache=b;a.Anonymous_GetManifestAndEToken=c;a.Anonymous_GetKilledApps=d;a.Anonymous_GetAppState=e;a.Anonymous_RemoveCache=f;a.Anonymous_ClearCache=b;a.Anonymous_GetAuthNStatus="OMEX_getAuthNStatus";a.Anonymous_GetFirstPartyAddInList="OMEX_getFirstPartyAddInListAsync";a.Anonymous_GetFirstPartyManifest="OMEX_getFirstPartyManifestAsync";return a}();a.OmexProxyMethods=b;var c=function(e){var c=null;__extends(d,e);function d(a){e.call(this);this.osfOmexBaseUrl=a}d.prototype.prepareProxy=function(b,e,f){var a=this;if(f){a.isReady=false;d.resetProxy(a)}if(a.isReady)b({status:c,value:{clientEndpoint:a.clientEndPoint}});else if(!a.clientEndPoint)a.createProxy(b,e);else a.pendingCallbacks.push([b,e])};d.resetProxy=function(a){Microsoft.Office.Common.XdmCommunicationManager.getClientEndPoint(a.conversationId)&&Microsoft.Office.Common.XdmCommunicationManager.deleteClientEndPoint(a.conversationId);if(a.iframe){OSF.OUtil.removeEventListener(a.iframe,"load",a.iframeOnload);a.iframe.parentNode.removeChild(a.iframe);a.iframe=c}a.clientEndPoint=c};d.prototype.createProxy=function(m,i){var e=this;try{!e.doesUrlHaveSupportedProtocol(e.proxyUrl)&&i({status:c,value:{errorMessage:"Protocal of proxyUrl is not supported."}});var f=document.createElement("iframe");f.setAttribute("id",e.proxyName);f.setAttribute("name",e.proxyName);var h=e.proxyUrl+"?"+e.conversationId,n=window.location.origin;h=OSF.OUtil.addXdmInfoAsHash(h,e.conversationId+"|"+e.proxyName+"|"+n);h=OSF.OUtil.addSerializerVersionAsHash(h,OSF.SerializerVersion.Browser);h=OSF.OUtil.addFlightsAsHash(h,JSON.stringify(OSF.Flights));f.setAttribute("src",h);f.setAttribute("scrolling","auto");f.setAttribute("border","0");f.setAttribute("width","0");f.setAttribute("height","0");f.setAttribute("style","position: absolute; left: -100px; top:0px;");var j=500;if(e.proxyName===OSF.Constants.OmexAnonymousServiceName&&OSF.OUtil.checkFlight(OSF.FlightNames.FirstPartyAnonymousProxyReadyCheckTimeout))j=5e3;document.body.appendChild(f);var g=e,k=function(){var e=function(f,i){var b=g.pendingCallbacks.length;if(b==0)return;var a=c;if(f===0&&i.status){g.isReady=true;a={status:c,value:{clientEndpoint:g.clientEndPoint}}}else{d.resetProxy(g);a={status:c,value:{errorMessage:"OmexProxyBase::onIframeLoad::isProxyReadyCallback failed, error code "+f}}}for(var h=0;h<b;h++){var e=g.pendingCallbacks.shift();if(g.isReady)e[0](a);else e[1](a)}};g.clientEndPoint=Microsoft.Office.Common.XdmCommunicationManager.connect(g.conversationId,f.contentWindow,g.proxyUrl);if(g.clientEndPoint)g.clientEndPoint.invoke(b.CheckProxyIsReady,e,{__timeout__:j});else{var a="Unexpected error, iframe loaded again after failing OMEX_isProxyReady";Telemetry.RuntimeTelemetryHelper.LogExceptionTag(a,c,c,18121820);i({status:c,value:{errorMessage:a}})}OSF.OUtil.set_entropy((new Date).getTime())};OSF.OUtil.addEventListener(f,"load",k);e.iframeOnload=k;e.pendingCallbacks.push([m,i]);e.iframe=f}catch(l){var o="Error creating client endpoint with proxyUrl = ["+e.proxyUrl+"], msg:"+a.WACUtils.serializeObjectToString(l);i({status:c,value:{errorMessage:o}})}};return d}(a.ProxyBase);a.OmexProxyBase=c})(OfficeExt||(OfficeExt={}));var OfficeExt;(function(a){var b=function(c){__extends(b,c);function b(b){var a=this;c.call(a,b);a.proxyName=OSF.Constants.OmexAnonymousServiceName;a.proxyUrl=a.osfOmexBaseUrl+OSF.Constants.OmexAnonymousServiceExtension}b.prototype.getManifestAsync=function(c,b){this.invokeProxyCommandAsync(a.OmexProxyMethods.Anonymous_GetManifestAndEToken,c,function(c){if(c.value!=null&&c.status==a.DataServiceResultCode.Succeeded)c.value=a.OmexXmlProcessor.ConvertClientAppInstallInfo(c.value);b(c)})};b.prototype.getFirstPartyAddInListAsync=function(c,b){this.invokeProxyCommandAsync(a.OmexProxyMethods.Anonymous_GetFirstPartyAddInList,c,function(a){b(a)})};b.prototype.getFirstPartyManifestAsync=function(c,b){this.invokeProxyCommandAsync(a.OmexProxyMethods.Anonymous_GetFirstPartyManifest,c,function(a){b(a)})};b.prototype.getAppStateAsync=function(c,b){this.invokeProxyCommandAsync(a.OmexProxyMethods.Anonymous_GetAppState,c,function(c){if(c.value!=null&&c.status==a.DataServiceResultCode.Succeeded)c.value=a.OmexXmlProcessor.ConvertAppState(c.value);b(c)})};b.prototype.getKilledAppAsync=function(c,b){this.invokeProxyCommandAsync(a.OmexProxyMethods.Anonymous_GetKilledApps,c,function(c){if(c.value!=null&&c.status==a.DataServiceResultCode.Succeeded)c.value=a.OmexXmlProcessor.ConvertKilledAppsInfo(c.value);b(c)})};b.prototype.getAuthNStatusAsync=function(c,b){this.invokeProxyCommandAsync(a.OmexProxyMethods.Anonymous_GetAuthNStatus,c,b)};return b}(a.OmexProxyBase);a.AnonymousOmexProxy=b})(OfficeExt||(OfficeExt={}));var OfficeExt;(function(a){var b=function(d){var b=null;__extends(c,d);function c(b){var a=this;d.call(a,b);a.proxyName=OSF.Constants.OmexGatedServiceName;a.proxyUrl=a.osfOmexBaseUrl+OSF.Constants.OmexGatedServiceExtension}c.prototype.getOmexEntitlementsAsync=function(d,c){this.invokeProxyCommandAsync(a.OmexProxyMethods.Gated_GetEntitlementSummary,d,function(d){if(d.value!=b&&d.status==a.DataServiceResultCode.Succeeded)d.value=a.OmexXmlProcessor.ConvertEntitlementInfo(d.value);c(d)})};c.prototype.getManifestAndETokenAsync=function(d,c){this.invokeProxyCommandAsync(a.OmexProxyMethods.Gated_GetManifestAndEToken,d,function(d){if(d.value!=b&&d.status==a.DataServiceResultCode.Succeeded)d.value=a.OmexXmlProcessor.ConvertClientAppInstallInfo(d.value);c(d)})};c.prototype.getAppStateAsync=function(d,c){this.invokeProxyCommandAsync(a.OmexProxyMethods.Gated_GetAppState,d,function(d){if(d.value!=b&&d.status==a.DataServiceResultCode.Succeeded)d.value=a.OmexXmlProcessor.ConvertAppState(d.value);c(d)})};c.prototype.getKilledAppAsync=function(d,c){this.invokeProxyCommandAsync(a.OmexProxyMethods.Gated_GetKilledApps,d,function(d){if(d.value!=b&&d.status==a.DataServiceResultCode.Succeeded)d.value=a.OmexXmlProcessor.ConvertKilledAppsInfo(d.value);c(d)})};c.prototype.removeApps=function(d,c){this.invokeProxyCommandAsync(a.OmexProxyMethods.Gated_RemoveApp,d,function(d){if(d.value!=b&&d.status==a.DataServiceResultCode.Succeeded)d.value=a.OmexXmlProcessor.ConvertRemoveAppResponse(d.value);c(d)})};return c}(a.OmexProxyBase);a.GatedOmexProxy=b})(OfficeExt||(OfficeExt={}));var OfficeExt;(function(c){var f=false,b="",e=true,a=null,d;(function(a){var d="AnonymousUser",c="AuthedUser",b="NotDetected";a[a[b]=0]=b;a[a[c]=1]=c;a[a[d]=2]=d})(d||(d={}));var j=function(){function h(b){var a=this;a.currentUserType=d.NotDetected;a.omexAuthNStatus=OSF.OmexAuthNStatus.NotAttempted;a.omexAuthConnectTries=1;a.initParams=b;a.gatedProxy=new c.GatedOmexProxy(b.omexBaseUrl);a.ungatedProxy=new c.UnGatedOmexProxy(b.omexBaseUrl);a.anonymousProxy=new c.AnonymousOmexProxy(b.omexBaseUrl)}h.getInstance=function(b){if(h._instance==a)h._instance=new h(b);return h._instance};h.getFirstPartyInstance=function(c){if(h._firstPartyInstance==a){var b=new h(c);b._isFirstParty=e;b.omexAuthNStatus=OSF.OmexAuthNStatus.Anonymous;this._firstPartyInstance=b}return h._firstPartyInstance};h.prototype.prepareProxy=function(g,i){var j=this;g=g||b;var h=function(b){var h=b&&b.status!=a?b.status:c.DataServiceResultCode.ProxyNotReady,g;if(b&&b.value)if(j._isFirstParty)g=e;else if(b.value.currentUserType)if(b.value.currentUserType==d.AuthedUser)g=f;else if(b.value.currentUserType==d.AnonymousUser)g=e;i({status:b.status,value:{anonymous:g}})};this.ensureOmexProxySetUp(g,h)};h.prototype.createScope=function(a){return new g(a,this)};h.prototype.getCID=function(){switch(this.currentUserType){case d.AuthedUser:return this._cid;case d.AnonymousUser:return b}throw"not initialized"};h.prototype.ensureOmexProxySetUp=function(g,l){var h=this;if(h.currentUserType!=d.NotDetected&&(h.anonymousProxy.isReady||h.gatedProxy.isReady)){l({status:c.DataServiceResultCode.Succeeded,value:h});return}var e=h,j=function(){e.currentUserType=d.AuthedUser;l({status:c.DataServiceResultCode.Succeeded,value:e})},k=function(){if(e.omexAuthConnectTries<OSF.Constants.AuthenticatedConnectMaxTries){e.omexAuthConnectTries++;if(e.omexAuthNStatus!==OSF.OmexAuthNStatus.CheckFailed)e.anonymousProxy.prepareProxy(m,f);else e.gatedProxy.prepareProxy(j,k)}else{Telemetry.RuntimeTelemetryHelper.LogExceptionTag("exceed maximum tries and fail",a,g,18657693);e.anonymousProxy.prepareProxy(i,f)}},m=function(b){if(b&&b.value){var c=function(c){var d=c.status;if(d===OSF.ProxyCallStatusCode.Succeeded){var b=c.value;if(b==OSF.OmexAuthNStatus.Authenticated){e.omexAuthNStatus=OSF.OmexAuthNStatus.Authenticated;e.gatedProxy.prepareProxy(j,k)}else if(b==OSF.OmexAuthNStatus.Anonymous||b==OSF.OmexAuthNStatus.Unknown){e.omexAuthNStatus=OSF.OmexAuthNStatus.Anonymous;e.anonymousProxy.prepareProxy(i,f)}}else{Telemetry.RuntimeTelemetryHelper.LogExceptionTag("auth check failure.",a,g,18657694);e.omexAuthNStatus=OSF.OmexAuthNStatus.CheckFailed;if(e.initParams.omexForceAnonymous)e.anonymousProxy.prepareProxy(i,f);else e.gatedProxy.prepareProxy(j,k)}};e.anonymousProxy.getAuthNStatusAsync({correlationId:g},c)}else Telemetry.RuntimeTelemetryHelper.LogExceptionTag("GetAuthNStatus callback param invalid",a,g,18657695)},i=function(a){if(e.omexAuthNStatus==OSF.OmexAuthNStatus.NotAttempted)m(a);else{e.currentUserType=d.AnonymousUser;l({status:c.DataServiceResultCode.Succeeded,value:e})}},f=function(d){var e=b;if(typeof d!=="undefined")if(d.value&&d.value.errorMessage)e=d.value.errorMessage;Telemetry.RuntimeTelemetryHelper.LogExceptionTag("create anonymous proxy failure: "+e,a,g,18657696);l({status:c.DataServiceResultCode.ProxyNotReady})};if(e.initParams.omexForceAnonymous)e.anonymousProxy.prepareProxy(i,f);else e.gatedProxy.prepareProxy(j,k)};return h}();c.ProxyBasedCatalogService=j;var h=function(){function a(){}a.dummyApplicationName="unused";return a}(),g=function(){var l="contentMarket",j="assetID",m="applicationName",k="errors";function g(d,c){var a=this;a._build=OSF.Constants.FileVersion;a._catalogService=c;a._appVersion=OSF.OmexAppVersions[a._catalogService.initParams.appName];a._clientName=OSF.OmexClientNames[a._catalogService.initParams.appName];a._clientVersion=i.getClientVersionFromWACAppVersion(a._catalogService.initParams.AppVersion);a._correlationId=d.telemetryContext.correlationId||b}g.prototype.getFirstPartyAddInList=function(b){var a=this.buildOmexRequestParameters();a[k]={};this._catalogService.anonymousProxy.getFirstPartyAddInListAsync(a,b)};g.prototype.getFirstPartyManifest=function(c,b){var a=this.buildOmexRequestParameters();a[k]={};a["manifestUrl"]=c;this._catalogService.anonymousProxy.getFirstPartyManifestAsync(a,b)};g.prototype.tryFail=function(a,d,b){if(a!=c.DataServiceResultCode.Succeeded){b({status:a});return e}else return f};g.prototype.isUserTypeValid=function(b){if(b===d.NotDetected){Telemetry.RuntimeTelemetryHelper.LogExceptionTag("userType is invalid.",a,this._correlationId,18657698);return f}return e};g.prototype.getEntitlementAsync=function(k,b,j){var a=this,i=a,e=a.buildOmexRequestParameters();e[m]=h.dummyApplicationName;e["appVersion"]=a._appVersion;e["clearEntitlement"]=j||f;var g=a._catalogService.currentUserType;if(a.isUserTypeValid(g))if(g===d.AuthedUser)a._catalogService.gatedProxy.getOmexEntitlementsAsync(e,function(a){if(i.tryFail(a.status,a.httpStatus,b))return;i._catalogService._cid=a.value.cid;b(a)});else g===d.AnonymousUser&&b({status:c.DataServiceResultCode.Succeeded,value:{refreshRate2:0,entitlements:[]}});else b({status:c.DataServiceResultCode.UnknownUserType,value:{refreshRate2:0,entitlements:[]}})};g.prototype.getLastStoreUpdate=function(){};g.prototype.isStoreDisabled=function(a){a({status:c.DataServiceResultCode.Succeeded,value:f})};g.prototype.getManifest=function(e,d,f){var a=function(a){var d=a&&a.value&&a.value.manifest?a.value.manifest:b,e=a&&a.value&&a.value.status2?a.value.status2:OSF.OmexClientAppStatus.ServerError,g=a?a.status:c.DataServiceResultCode.Failed;f({status:g,value:{status2:e,manifest:d}})};this.getETokenAndManifestInternal(e,d,OSF.ClientAppInfoReturnType.urlOnly,a)};g.prototype.getEToken=function(b,a,c){this.getETokenAndManifestInternal(b,a,OSF.ClientAppInfoReturnType.etokenOnly,c)};g.prototype.getETokenAndManifest=function(b,a,c){this.getETokenAndManifestInternal(b,a,OSF.ClientAppInfoReturnType.both,c)};g.prototype.getAppState=function(h,f){var a=this,i=a,e=a.buildOmexRequestParameters();e[j]=h.assetId;e[l]=h.storeId;e[k]={};var g=a._catalogService.currentUserType;if(a.isUserTypeValid(g))if(g===d.AuthedUser)a._catalogService.gatedProxy.getAppStateAsync(e,function(a){if(i.tryFail(a.status,a.httpStatus,f)){i.logServiceCallResponseError("appstate",a.httpStatus);return}f(a)});else g===d.AnonymousUser&&a._catalogService.anonymousProxy.getAppStateAsync(e,f);else f({status:c.DataServiceResultCode.UnknownUserType,value:{refreshRate2:0,assetId:b,productId:b,version:b,state2:-1}})};g.prototype.getKilledApps=function(e){var b=this,h=b,g=b.buildOmexRequestParameters(),f=b._catalogService.currentUserType;if(b.isUserTypeValid(f))if(f===d.AuthedUser)b._catalogService.gatedProxy.getKilledAppAsync(g,function(a){if(h.tryFail(a.status,a.httpStatus,e)){h.logServiceCallResponseError("killedapps",a.httpStatus);return}e(a)});else f===d.AnonymousUser&&b._catalogService.anonymousProxy.getKilledAppAsync(g,e);else e({status:c.DataServiceResultCode.UnknownUserType,value:{refreshRate2:0,killedApps:a}})};g.prototype.getAppDetails=function(f,e,c){var d=this,a=this.buildOmexRequestParameters();a["assetid"]=b;a[j]=f.join(",");a[l]=e;this._catalogService.ungatedProxy.getAppDetailsAsync(a,function(a){if(d.tryFail(a.status,a.httpStatus,c)){d.logServiceCallResponseError("appdetails",a.httpStatus);return}c(a)})};g.prototype.removeApps=function(i,e){var a=this,h=a,g=a.buildOmexRequestParameters();g["assetid"]=b;g[j]=i.join(",");var f=a._catalogService.currentUserType;if(a.isUserTypeValid(f))if(f===d.AuthedUser)a._catalogService.gatedProxy.removeApps(g,function(a){if(h.tryFail(a.status,a.httpStatus,e)){h.logServiceCallResponseError("removeapps",a.httpStatus);return}e(a)});else f===d.AnonymousUser&&e({status:c.DataServiceResultCode.Succeeded,value:{removedApps:[]}});else e({status:c.DataServiceResultCode.UnknownUserType,value:{removedApps:[]}})};g.prototype.getETokenAndManifestInternal=function(i,p,n,f){var g=this,k=g,e=g.buildOmexRequestParameters();e[m]=h.dummyApplicationName;e[j]=i.assetId;e["clientAppInfoReturnType"]=n;var o=g._catalogService.currentUserType;if(g.isUserTypeValid(o))if(o===d.AuthedUser&&n!=OSF.ClientAppInfoReturnType.urlOnly){e["assetContentMarket"]=p;e["userContentMarket"]=i.storeId;e["expectedVersion"]=i.appVersion;g._catalogService.gatedProxy.getManifestAndETokenAsync(e,function(a){if(k.tryFail(a.status,a.httpStatus,f)){k.logServiceCallResponseError("manifestandetoken",a.httpStatus);return}f(a)})}else{e[l]=i.storeId;if(e.clientAppInfoReturnType==OSF.ClientAppInfoReturnType.etokenOnly)f({status:c.DataServiceResultCode.Succeeded,value:{status2:OSF.OmexClientAppStatus.OK,etoken:b,manifest:a}});else g._catalogService.anonymousProxy.getManifestAsync(e,function(a){if(k.tryFail(a.status,a.httpStatus,f)){k.logServiceCallResponseError("manifest",a.httpStatus);return}f(a)})}else f({status:c.DataServiceResultCode.UnknownUserType,value:{etoken:b,manifest:a}})};g.prototype.buildOmexRequestParameters=function(){var a=this,b={clientName:a._clientName,clientVersion:a._clientVersion,correlationId:a._correlationId,build:a._build};return b};g.prototype.logServiceCallResponseError=function(d,b){var c="proxybased request "+d+" failed";if(b)c+=":"+b;Telemetry.RuntimeTelemetryHelper.LogExceptionTag(c,a,this._correlationId,18657697)};return g}();c.ProxyBasedCatalogServiceScope=g;var i=function(){function a(){}a.getClientVersionFromWACAppVersion=function(c){if(!c)return undefined;var b=c.split("."),d=parseInt(b[0],10),e=parseInt(b[1],10)||0;if(d<=15&&e<=0)return undefined;var a=OSF.Constants.FileVersion.split(".");return d+"."+e+"."+a[2]+"."+a[3]};a.getOmexEndPointPageUrl=function(b,c,a){return OSF.OUtil.formatString("{0}/{1}/downloads/{2}.aspx",b,a,c)};return a}();c.OmexUtils=i})(OfficeExt||(OfficeExt={}));var OfficeExt;(function(a){var b=function(c){__extends(b,c);function b(b){var a=this;c.call(a,b);a.proxyName=OSF.Constants.OmexUnGatedServiceName;a.proxyUrl=a.osfOmexBaseUrl+OSF.Constants.OmexUnGatedServiceExtension}b.prototype.getAppDetailsAsync=function(c,b){this.invokeProxyCommandAsync(a.OmexProxyMethods.UnGated_GetAppDetails,c,function(c){if(c.value!=null&&c.status==a.DataServiceResultCode.Succeeded)c.value=a.OmexXmlProcessor.ConvertAppDetails(c.value);b(c)})};return b}(a.OmexProxyBase);a.UnGatedOmexProxy=b})(OfficeExt||(OfficeExt={}));var OfficeExt;(function(b){var d=false,c=null,a=true,f=function(){var f="cacheExpired";function e(b,c){var a=this;a._initParam=c;a._cacheManager=b.cacheManager;a._cachePrefix=b.cachePrefix;a._cid=b.cid;a._anonymous=b.anonymous;a._telemetryContext=b.telemetryContext}e.prototype.GetCacheKeyPrefix=function(){return this._cachePrefix};e.prototype.getOmexEndPointPageUrl=function(c,a){return b.OmexUtils.getOmexEndPointPageUrl(this._initParam.omexBaseUrl,c,a)};e.prototype.getKilledApps=function(j,f,i){var e=this,h=e;e._telemetryContext.startActivity(b.Activity.KilledAppsCheck);var g=OSF.OUtil.formatString(b.CacheConsts.killedAppsCacheKey,e.GetCacheKeyPrefix());if(i)e._cacheManager.RemoveCacheItem(g);else{var d=e._cacheManager.GetCacheItem(g,a);if(d&&d.refreshRate2!=c){e._telemetryContext.stopActivity(b.Activity.KilledAppsCheck);f({status:b.DataServiceResultCode.Succeeded,value:d});return}}j.getKilledApps(function(a){if(a.status!=b.DataServiceResultCode.Succeeded){f(a);return}h._telemetryContext.stopActivity(b.Activity.KilledAppsCheck);d=a.value;h._cacheManager.SetCacheItem(g,d,d.refreshRate/b.CacheConsts.hourToDayConversionFactor);f(a)})};e.prototype.getAppState=function(n,h,i,m){var e=this,k=e;e._telemetryContext.startActivity(b.Activity.AppStateCheck);var j=OSF.OUtil.formatString(b.CacheConsts.appStateCacheKey,e.GetCacheKeyPrefix(),h.storeId,h.assetId),g;if(m)e._cacheManager.RemoveCacheItem(j);else{var l={};g=e._cacheManager.GetCacheItem(j,a,l);e._telemetryContext.setFlag(b.FlagName.AppStateDataInvalidFlag,l[f]||d);if(g&&g.state2!=c){e._telemetryContext.stopActivity(b.Activity.AppStateCheck);e._telemetryContext.setFlag(b.FlagName.AppStateDataCachedFlag,a);i({status:b.DataServiceResultCode.Succeeded,value:g});return}}n.getAppState(h,function(a){if(a.status!=b.DataServiceResultCode.Succeeded){i(a);return}k._telemetryContext.stopActivity(b.Activity.AppStateCheck);k._telemetryContext.setFlag(b.FlagName.AppStateDataCachedFlag,d);g=a.value;k._cacheManager.SetCacheItem(j,g,g.refreshRate2/b.CacheConsts.hourToDayConversionFactor);i(a)})};e.prototype.getManifest=function(o,i,m,j,n){var e=this,h=e;e._telemetryContext.startActivity(b.Activity.ManifestRequest);var g,k=OSF.OUtil.formatString(b.CacheConsts.anonymousAppInstallInfoCacheKey,i.assetId,i.storeId);if(n)e._cacheManager.RemoveCacheItem(k);else{var l={};g=e._cacheManager.GetCacheItem(k,a,l);e._telemetryContext.setFlag(b.FlagName.ManifestDataInvalidFlag,l[f]||d);if(g&&g.status2!=c){e._telemetryContext.stopActivity(b.Activity.ManifestRequest);e._telemetryContext.stopActivity(b.Activity.ServerCall);e._telemetryContext.setFlag(b.FlagName.ManifestDataCachedFlag,a);j({status:b.DataServiceResultCode.Succeeded,value:{status2:g.status2,manifest:g.manifest}});return}}o.getManifest(i,m,function(a){if(a.status!=b.DataServiceResultCode.Succeeded||a.value.status2!=OSF.OmexClientAppStatus.OK){j(a);return}h._telemetryContext.stopActivity(b.Activity.ManifestRequest);h._telemetryContext.stopActivity(b.Activity.ServerCall);h._telemetryContext.setFlag(b.FlagName.ManifestDataCachedFlag,d);h._telemetryContext.setBits(b.FlagName.ManifestRequestType,OSF.ManifestRequestTypes.Manifest);g={etoken:"",status2:a.value.status2,manifest:a.value.manifest};h._cacheManager.SetCacheItem(k,g,b.CacheConsts.manifestRefreshRate);j(a)})};e.prototype.removeApps=function(f,e,c){var g=this;f.removeApps(e,function(e){if(e.status!=b.DataServiceResultCode.Succeeded){c(e);return}for(var h=".*",k=d,j=[],i=e.value.removedApps,f=0;f<i.length;++f)if(i[f].result2==OSF.OmexRemoveAppStatus.Success){j.push(new RegExp(OSF.OUtil.formatString(b.WACUtils.CacheConstants.AuthenticatedAppInstallInfoCacheKey,h,i[f].assetId,h,h),"i"));k=a}k&&g._cacheManager.RemoveMatches(j);c(e)})};e.prototype.getCachedETokenAndManifest=function(h){var g={},e=this._cacheManager.GetCacheItem(h,a,g);this._telemetryContext.setFlag(b.FlagName.ManifestDataInvalidFlag,g[f]||d);if(e){if(e.status2&&e.tokenExpirationDate2&&e.tokenExpirationDate2>(new Date).getTime())return e;e.etoken=c;e.tokenExpirationDate2=c;e.entitlementType=c}return e};e.prototype.getETokenAndManifest=function(n,g,k,h,p){var f=this,j=f;if(f._anonymous){f.getManifest(n,g,k,function(a){if(b.AsyncUtil.failed(a,h))return;h({status:a.status,value:{etoken:"",status2:a.value.status2,manifest:a.value.manifest}})},p);return}f._telemetryContext.startActivity(b.Activity.ManifestRequest);var l=function(c,a){j._telemetryContext.stopActivity(b.Activity.ManifestRequest);j._telemetryContext.stopActivity(b.Activity.ServerCall);j._telemetryContext.setFlag(b.FlagName.ManifestDataCachedFlag,c);a&&j._telemetryContext.setBits(b.FlagName.ManifestRequestType,a)},m=OSF.OUtil.formatString(b.WACUtils.CacheConstants.AuthenticatedAppInstallInfoCacheKey,f._cid,g.assetId,g.storeId,k),e;if(p)f._cacheManager.RemoveCacheItem(m);else{var r={};e=f.getCachedETokenAndManifest(m);if(e&&e.etoken&&e.manifest){l(a);h({status:b.DataServiceResultCode.Succeeded,value:e});return}var i=e?e.manifest:c;if(i==c||i==""){var q=OSF.OUtil.formatString(b.CacheConsts.anonymousAppInstallInfoCacheKey,g.assetId,g.storeId),o=f._cacheManager.GetCacheItem(q,a);if(o)i=o.manifest}if(i){if(!e||!e.etoken)n.getEToken(g,k,function(a){if(a.status===b.DataServiceResultCode.Succeeded&&a.value){l(d,OSF.ManifestRequestTypes.Etoken);e=a.value;if(e.status2===OSF.OmexClientAppStatus.OK){j._cacheManager.SetCacheItem(m,e,b.CacheConsts.manifestRefreshRate);e.manifest=i}}h(a)});else{l(a);e.manifest=i;h({status:b.DataServiceResultCode.Succeeded,value:e})}return}}n.getETokenAndManifest(g,k,function(a){if(a.status!=b.DataServiceResultCode.Succeeded){h(a);return}l(d,OSF.ManifestRequestTypes.Both);a.value.status2===OSF.OmexClientAppStatus.OK&&j._cacheManager.SetCacheItem(m,a.value,b.CacheConsts.manifestRefreshRate);h(a)})};e.prototype.getEntitlements=function(i,j,d,k){var e=this,h=e;e._telemetryContext.startActivity(b.Activity.EntitlementCheck);var a,f,g=function(){if(f==c||a==c)return;a=a.filter(function(a){return f.every(function(b){return b.assetId!=a.assetId})});d({status:b.DataServiceResultCode.Succeeded,value:{entitlements:a,killed:f}})};if(e._anonymous){a=[];e._telemetryContext.stopActivity(b.Activity.EntitlementCheck);g()}else i.getEntitlementAsync(j,function(e){h._telemetryContext.stopActivity(b.Activity.EntitlementCheck);if(d==c)return;if(b.AsyncUtil.failed(e,d)){d=c;return}if(!h._cid)h._cid=e.value.cid;a=e.value.entitlements;g()},k);e.getKilledApps(i,function(a){if(d==c)return;f=a.status==b.DataServiceResultCode.Succeeded?a.value.killedApps:[];g()})};e.prototype.activate=function(n,h,e){var f=this,g={assetId:h.assetId,appVersion:h.appVersion,storeId:h.storeId,storeType:h.storeType,targetType:h.targetType},o=d,k,l,i=this.getOmexEndPointPageUrl(g.assetId,g.storeId),m=b.HostFeatureEnabledInfo.getHostFeatureEnabledInfo(),r=function(o,s){switch(o.status2){case OSF.OmexClientAppStatus.OK:if(o.tokenExpirationDate2&&o.tokenExpirationDate2<=(new Date).getTime()){b.LoaderUtil.failWithWarning(e,b.LoaderUtil.warning({description:Strings.OsfRuntime.L_AgaveLicenseExpired_ERR,buttonTxt:Strings.OsfRuntime.L_RetryButton_TXT,buttonCallback:function(){return j()},errorCode:OSF.ErrorStatusCodes.E_TOKEN_EXPIRED}));return}var l=b.ManifestUtil.ParseManifest(o.manifest,f._initParam.appUILocale,f._telemetryContext.correlationId);if(l==c){b.LoaderUtil.failWithError(e,{infoType:OSF.InfoType.Error,buttonTxt:Strings.OsfRuntime.L_RetryButton_TXT,buttonCallback:function(){e.restartActivation();f.restartActivationTelemetry();j()},description:Strings.OsfRuntime.L_AgaveManifestRetrieve_ERR,errorCode:OSF.ErrorStatusCodes.E_MANIFEST_INVALID_VALUE_FORMAT});return}var v=l.getMarketplaceVersion();OSF.OsfManifestManager.cacheManifest(g.assetId,h.appVersion,l);if(l.requirementsSupported===d||l.requirementsSupported===undefined&&!e.getRequirementsChecker().isManifestSupported(l)){l.requirementsSupported=d;var u,B,C=c;u=Strings.OsfRuntime.L_AgaveManifestRequirementsErrorOmex_ERR||Strings.OsfRuntime.L_AgaveManifestError_ERR;b.LoaderUtil.failWithError(e,{description:u,url:i,detailView:a,errorCode:OSF.ErrorStatusCodes.WAC_AgaveRequirementsErrorOmex});return}l.requirementsSupported=a;f._telemetryContext.setFlag(b.FlagName.ManifestTrustCachedFlag,!s);var r=OSF.OUtil.formatString(OSF.Constants.ActivatedCacheKey,h.assetId.toLowerCase(),h.storeType,h.storeId);if(s&&!e.skipTrust(h)){var A=function(){f.restartActivationTelemetry();f._cacheManager.SetCacheItem(r,a);if(f._anonymous){e.load({entitlement:g,manifest:l,eToken:o.etoken},c);return}f.getETokenAndManifest(n,g,g.storeId,function(d){if(d.status!=b.DataServiceResultCode.Succeeded||d.value.status2!=OSF.OmexClientAppStatus.OK){b.LoaderUtil.failWithError(e,{infoType:OSF.InfoType.Error,buttonTxt:Strings.OsfRuntime.L_RetryButton_TXT,buttonCallback:function(){e.restartActivation();f.restartActivationTelemetry();j()},description:OSF.OUtil.formatString(Strings.OsfRuntime.L_AgaveServerConnectionToCatalogFailed_ERR,Strings.OsfRuntime.L_AgaveOmexCatalogName),errorCode:OSF.ErrorStatusCodes.WAC_AgaveManifestAndEtokenRequestFailure});return}if(d.value.version!=c&&b.ManifestUtil.versionLessThan(g.appVersion,d.value.version))g.appVersion=d.value.version;q(a)})},z=OSF.OmexClientNames[f._initParam.appName],y=f._anonymous&&f._cacheManager.GetCacheItem(r,d);if(!y&&!e.hasConsent(h)&&!e.isForCustomFunctionSandbox()){e.askForTrust({anonymous:d,clientName:z,entitlement:g,displayName:l.getDefaultDisplayName(),providerName:l.getProviderName(),iconUrl:l.getDefaultIconUrl(),url:i,isSSOAddin:l.isSSOAddin()},A);return}}e.hasConsent(h)&&f._cacheManager.SetCacheItem(r,a);var p=k.version;if(b.ManifestUtil.versionLessThan(p,h.appVersion))p=h.appVersion;if(b.ManifestUtil.versionLessThan(v,p)){g.appVersion=p;b.LoaderUtil.showWarning(e,{description:Strings.OsfRuntime.L_AgaveNewerVersion_ERR,buttonTxt:Strings.OsfRuntime.L_UpdateButton_TXT,buttonCallback:function(){e.restartActivation();f.restartActivationTelemetry();e.setIsUpgrading(a);e.setUpgradingFailed(d);j(a);t()},url:i,highPriority:a,displayDeactive:d,errorCode:OSF.ErrorStatusCodes.E_MANIFEST_UPDATE_AVAILABLE})}else if(k.state2===OSF.OmexState.DeveloperWithdrawn)b.LoaderUtil.showWarning(e,{description:Strings.OsfRuntime.L_AgaveRetiring_ERR,buttonTxt:Strings.OsfRuntime.L_OkButton_TXT,url:i,displayDeactive:d,errorCode:OSF.ErrorStatusCodes.S_OEM_EXTENSION_DEVELOPER_WITHDRAWN_FROM_SALE});else if(k.state2===OSF.OmexState.Flagged)b.LoaderUtil.showWarning(e,{description:Strings.OsfRuntime.L_AgaveSoftKilled_ERR,buttonTxt:Strings.OsfRuntime.L_OkButton_TXT,url:i,displayDeactive:d,errorCode:OSF.ErrorStatusCodes.S_OEM_EXTENSION_FLAGGED});else if(!f._anonymous&&o.entitlementType&&o.entitlementType.toLowerCase()===OSF.OmexEntitlementType.Trial){b.LoaderUtil.showNotification(e,{description:Strings.OsfRuntime.L_AgaveTrial_ERR,buttonTxt:Strings.OsfRuntime.L_BuyButton_TXT,buttonCallback:function(){return window.open(i)},reDisplay:a,highPriority:a,displayDeactive:d,errorCode:OSF.ErrorStatusCodes.S_OEM_EXTENSION_TRIAL_MODE});b.LoaderUtil.showNotification(e,{description:Strings.OsfRuntime.L_AgaveTrialRefresh_ERR,buttonTxt:Strings.OsfRuntime.L_RefreshButton_TXT,buttonCallback:function(){e.restartActivation();f.restartActivationTelemetry();j(a)},detailView:a,reDisplay:a,highPriority:a,displayDeactive:d,errorCode:OSF.ErrorStatusCodes.S_USER_CLICKED_BUY})}e.load({entitlement:g,manifest:l,eToken:o.etoken},c);break;case OSF.OmexClientAppStatus.KilledAsset:b.LoaderUtil.failWithError(e,{description:Strings.OsfRuntime.L_AgaveDisabledByOmex_ERR,url:i,errorCode:OSF.ErrorStatusCodes.E_OEM_OMEX_EXTENSION_KILLED});break;case OSF.OmexClientAppStatus.NoEntitlement:case OSF.OmexClientAppStatus.TrialNotSupported:case OSF.OmexClientAppStatus.LimitedTrial:case OSF.OmexClientAppStatus.EntitlementDeactivated:if(f._anonymous){var x=function(){var b=window.location.href,a=f._initParam.omexBaseUrl+OSF.Constants.SignInRedirectUrl+encodeURIComponent(b);window.open(a)};b.LoaderUtil.failWithError(e,{title:Strings.OsfRuntime.L_AgaveSigninRequiredTitle_TXT,description:Strings.OsfRuntime.L_AgaveNotViewableAnonymous_ERR,buttonTxt:Strings.OsfRuntime.L_SignInButton_TXT,buttonCallback:x,errorCode:OSF.ErrorStatusCodes.E_USER_NOT_SIGNED_IN})}else{var w=function(){window.open(i);b.LoaderUtil.showWarning(e,{description:Strings.OsfRuntime.L_AgaveLicenseNotAquiredRefresh_ERR,buttonTxt:Strings.OsfRuntime.L_RefreshButton_TXT,buttonCallback:function(){e.restartActivation();f.restartActivationTelemetry();j(a)},detailView:a,retryAll:a,errorCode:OSF.ErrorStatusCodes.E_OEM_EXTENSION_NOT_ENTITLED})};e.setRetryCall(function(){f.restartActivationTelemetry();j(a)});b.LoaderUtil.failWithWarning(e,{description:Strings.OsfRuntime.L_AgaveLicenseNotAquired_ERR,buttonTxt:Strings.OsfRuntime.L_BuyButton_TXT,buttonCallback:w,errorCode:OSF.ErrorStatusCodes.E_OEM_EXTENSION_NOT_ENTITLED})}break;case OSF.OmexClientAppStatus.UnknownAssetId:b.LoaderUtil.failWithError(e,{description:Strings.OsfRuntime.L_AgaveNotExist_ERR,errorCode:OSF.ErrorStatusCodes.E_MANIFEST_DOES_NOT_EXIST});break;case OSF.OmexClientAppStatus.Expired:case OSF.OmexClientAppStatus.Invalid:b.LoaderUtil.failWithWarning(e,{description:Strings.OsfRuntime.L_AgaveLicenseExpired_ERR,buttonTxt:Strings.OsfRuntime.L_RetryButton_TXT,buttonCallback:function(){e.restartActivation();f.restartActivationTelemetry();j()},errorCode:OSF.ErrorStatusCodes.E_TOKEN_EXPIRED});break;case OSF.OmexClientAppStatus.Revoked:b.LoaderUtil.failWithError(e,{description:Strings.OsfRuntime.L_AgaveRetired_ERR,url:i,errorCode:OSF.ErrorStatusCodes.E_OEM_EXTENSION_WITHDRAWN_FROM_SALE});break;case OSF.OmexClientAppStatus.VersionMismatch:g.appVersion=o.version;e.askForUpgrade(b.LoaderUtil.warning({description:Strings.OsfRuntime.L_AgaveNewerVersion_ERR,buttonTxt:Strings.OsfRuntime.L_UpdateButton_TXT,url:i,highPriority:a,logAsError:a,errorCode:OSF.ErrorStatusCodes.E_MANIFEST_UPDATE_AVAILABLE}),function(){f.restartActivationTelemetry();e.setIsUpgrading(a);e.setUpgradingFailed(d);j(a)});break;case OSF.OmexClientAppStatus.VersionNotSupported:b.LoaderUtil.failWithWarning(e,{description:Strings.OsfRuntime.L_AgaveUnsupportedStoreType_ERR,errorCode:OSF.ErrorStatusCodes.WAC_AgaveUnsupportedStoreType},OSF.OsfControlStatus.UnsupportedStore);break;case OSF.OmexClientAppStatus.UserIsMinor:m&&m.enableDisplayBlockedMinorError&&b.LoaderUtil.failWithError(e,{description:Strings.OsfRuntime.L_AgaveDisabledForMinor_ERR,errorCode:OSF.ErrorStatusCodes.E_TRUSTCENTER_APP_BLOCKED_FOR_MINOR});break;default:Telemetry.RuntimeTelemetryHelper.LogExceptionTag("unknown clientAppStatus in manifestAndEtoken: "+o.status2,c,f._telemetryContext.correlationId,20030238);b.LoaderUtil.failWithError(e,{description:OSF.OUtil.formatString(Strings.OsfRuntime.L_AgaveServerConnectionToCatalogFailed_ERR,Strings.OsfRuntime.L_AgaveOmexCatalogName),buttonTxt:Strings.OsfRuntime.L_RetryButton_TXT,buttonCallback:function(){e.restartActivation();f.restartActivationTelemetry();j(a)},errorCode:OSF.ErrorStatusCodes.WAC_AgaveUnknownClientAppStatus})}},j=function(h){var i=l?l.contentMarket:g.storeId,p=function(c,g){if(c.status!=b.DataServiceResultCode.Succeeded){if(m&&m.enableDisplayBlockedMinorError)if(c.httpStatus===451){b.LoaderUtil.failWithError(e,{description:Strings.OsfRuntime.L_AgaveDisabledForMinor_ERR,errorCode:OSF.ErrorStatusCodes.E_TRUSTCENTER_APP_BLOCKED_FOR_MINOR});return a}b.LoaderUtil.failWithError(e,{description:OSF.OUtil.formatString(Strings.OsfRuntime.L_AgaveServerConnectionToCatalogFailed_ERR,Strings.OsfRuntime.L_AgaveOmexCatalogName),buttonTxt:Strings.OsfRuntime.L_RetryButton_TXT,buttonCallback:function(){e.restartActivation();f.restartActivationTelemetry();j(h)},errorCode:g});return a}return d};if(e.skipTrust(g)){f.getManifest(n,g,i,function(b){if(p(b,OSF.ErrorStatusCodes.WAC_AgaveManifestRequestFailure)){if(e.getIsUpgrading()){e.setUpgradingFailed(a);e.setIsUpgrading(d)}return}if(h){k=c;s(a);return}e.getIsUpgrading()&&e.setIsUpgrading(d);r({etoken:"",status2:b.value.status2,manifest:b.value.manifest})},h);return}f.getETokenAndManifest(n,g,i,function(b){if(p(b,OSF.ErrorStatusCodes.WAC_AgaveManifestAndEtokenRequestFailure)){if(e.getIsUpgrading()){e.setUpgradingFailed(a);e.setIsUpgrading(d)}return}if(h){k=c;o=d;q(a);s(a);return}e.getIsUpgrading()&&e.setIsUpgrading(d);r(b.value)},h)},t=function(){var a=OSF.OUtil.formatString(b.CacheConsts.anonymousAppInstallInfoCacheKey,g.assetId,g.storeId);f._cacheManager.RemoveCacheItem(a)},p=function(){if(k==c||!o)return;if(l!=c){g.appVersion=l.version;j();return}var d,m,q;if(k.state2===OSF.OmexState.Flagged)d=a;else if(k.state2===OSF.OmexState.DeveloperWithdrawn)m=a;else if(k.state2===OSF.OmexState.Withdrawn)q=a;if(d||m||q){b.LoaderUtil.failWithError(e,{description:Strings.OsfRuntime.L_AgaveRetired_ERR,url:i,errorCode:OSF.ErrorStatusCodes.E_OEM_EXTENSION_WITHDRAWN_FROM_SALE});if(d)return}if(e.hasConsent(h)){j();return}var s=l?l.contentMarket:g.storeId;f.getManifest(n,g,s,function(c){if(c.status!=b.DataServiceResultCode.Succeeded){b.LoaderUtil.failWithError(e,{description:OSF.OUtil.formatString(Strings.OsfRuntime.L_AgaveServerConnectionToCatalogFailed_ERR,Strings.OsfRuntime.L_AgaveOmexCatalogName),buttonTxt:Strings.OsfRuntime.L_RetryButton_TXT,buttonCallback:function(){e.restartActivation();f.restartActivationTelemetry();p()},errorCode:OSF.ErrorStatusCodes.WAC_AgaveManifestRequestFailure});return}r({etoken:"",status2:c.value.status2,manifest:c.value.manifest},a)})},q=function(h){l=c;o=d;f.getEntitlements(n,d,function(h){if(h.status!=b.DataServiceResultCode.Succeeded){if(m&&m.enableDisplayBlockedMinorError)if(h.httpStatus===451){b.LoaderUtil.failWithError(e,{description:Strings.OsfRuntime.L_AgaveDisabledForMinor_ERR,errorCode:OSF.ErrorStatusCodes.E_TRUSTCENTER_APP_BLOCKED_FOR_MINOR});return}b.LoaderUtil.failWithError(e,{description:OSF.OUtil.formatString(Strings.OsfRuntime.L_AgaveServerConnectionToCatalogFailed_ERR,Strings.OsfRuntime.L_AgaveOmexCatalogName),buttonTxt:Strings.OsfRuntime.L_RetryButton_TXT,buttonCallback:function(){e.restartActivation();q()},errorCode:OSF.ErrorStatusCodes.WAC_AgaveEntitlementRequestFailure});return}if(h.value.killed.some(function(a){return a.assetId==g.assetId})){b.LoaderUtil.failWithError(e,{description:Strings.OsfRuntime.L_AgaveDisabledByOmex_ERR,url:i,errorCode:OSF.ErrorStatusCodes.E_OEM_OMEX_EXTENSION_KILLED});return}h.value.entitlements.some(function(b){if(b.assetId.toLowerCase()==g.assetId.toLowerCase()){l=b;i=f.getOmexEndPointPageUrl(b.assetId,b.contentMarket);return a}return d});f._telemetryContext.setFlag(b.FlagName.OmexHasEntitlementFlag,l!=c);o=a;p()},h)},s=function(a){k=c;f.getAppState(n,g,function(a){if(a.status!=b.DataServiceResultCode.Succeeded){k={state2:OSF.OmexState.OK,productId:c,assetId:g.assetId,version:g.appVersion,refreshRate2:0};p();return}var d=a.value.state2;if(d===OSF.OmexState.Killed){b.LoaderUtil.failWithError(e,{description:Strings.OsfRuntime.L_AgaveDisabledByOmex_ERR,url:i,errorCode:OSF.ErrorStatusCodes.E_OEM_OMEX_EXTENSION_KILLED});return}k=a.value;p()},a)};s();q()};e.prototype.restartActivationTelemetry=function(){var a=this;a._telemetryContext.startActivity(b.Activity.Activation);a._telemetryContext.startActivity(b.Activity.ServerCall);a._telemetryContext.setFlag(b.FlagName.AnonymousFlag,a._anonymous)};return e}(),e=function(){function e(e,d){if(d===void 0)d=c;this._anonymous=a;this._initParam=e;this._cacheManager=d||new b.AppsDataCacheManager(OSF.OUtil.getLocalStorage(),new b.SafeSerializer)}e.prototype.GetCacheKeyPrefix=function(){if(this._anonymous)return b.CacheConsts.anonymousCacheKeyPrefix;return b.WACUtils.CacheConstants.GatedCacheKeyPrefix};e.prototype.getOmexEndPointPageUrl=function(b,a){return OSF.OUtil.formatString("{0}/{1}/downloads/{2}.aspx",this._initParam.omexBaseUrl,a,b)};e.prototype.getDataService=function(a,g){var d=this,e=d;if(d._dataService!=c){g({status:b.DataServiceResultCode.Succeeded,value:d._dataService});return}if(d._dataServiceReady!=c){a.startActivity(b.Activity.Authentication);var j=d._dataServiceReady;d._dataServiceReady=function(c){a.stopActivity(b.Activity.Authentication);j(c);g(c)};return}else d._dataServiceReady=g;var f={status:b.DataServiceResultCode.Failed,value:c},h=function(a,d){var g=e._dataServiceReady;e._dataServiceReady=c;if(a.status==b.DataServiceResultCode.Succeeded){e._anonymous=a.value.anonymous;e._dataService=d;f.value=d;f.status=b.DataServiceResultCode.Succeeded;g(f)}else{f.httpStatus=a.httpStatus;g(f)}};a.startActivity(b.Activity.Authentication);var i=new b.S2SOmexCatalogService(d._initParam);i.initialize(a.correlationId,function(d){if(d.status==b.DataServiceResultCode.Succeeded){var f=b.HostFeatureEnabledInfo.getHostFeatureEnabledInfo();if(!(f&&f.enableAnonymousUseLegacyCatalogService)||!d.value.anonymous){a.stopActivity(b.Activity.Authentication);h(d,i);return}}a.setBits(b.FlagName.ActivationRuntimeType,OSF.ActivationTypes.V2Enabled);var c=b.ProxyBasedCatalogService.getInstance(e._initParam);c.prepareProxy(a.correlationId,function(d){a.stopActivity(b.Activity.Authentication);a.setBits(b.FlagName.RetryCount,c.omexAuthConnectTries);h(d,c)})})};e.prototype.createActivityScope=function(d,e){var a=this;this.getDataService(d,function(i){if(b.AsyncUtil.failed(i,e)){Telemetry.RuntimeTelemetryHelper.LogExceptionTag("failed to get data service.",c,d.correlationId,18657692);return}d.setFlag(b.FlagName.AnonymousFlag,a._anonymous);var h=i.value,g={cacheManager:a._cacheManager,cachePrefix:a.GetCacheKeyPrefix(),cid:h.getCID(),anonymous:a._anonymous,telemetryContext:d},j=h.createScope(g),k=new f(g,a._initParam);e({status:b.DataServiceResultCode.Succeeded,value:{serviceScope:j,activityScope:k}})})};e.prototype.getEntitlementAsync=function(c,d,a,f,e){var g=this;this.createActivityScope(d,function(d){if(b.AsyncUtil.failed(d,a,[]))return;if(g._anonymous){a({status:b.DataServiceResultCode.Failed,httpStatus:403});return}var h=d.value.serviceScope;h.getEntitlementAsync(c,function(e){if(b.AsyncUtil.failed(e,a,[]))return;for(var f=e.value.entitlements,g=0;g<f.length;g++){var d=f[g],c=d;c.appVersion=d.version;c.storeId=d.contentMarket;c.storeType=OSF.StoreType.OMEX;c.targetType=OSF.OUtil.getTargetType(d.appSubType)}a({status:e.status,value:f})},f,e)})};e.prototype.getAndCacheManifest=function(e,i,g,a,f){var j=this;f=f||d;var h=OSF.OsfManifestManager.getCachedManifest(e.assetId,e.appVersion);if(!f&&h!=c){a({status:b.DataServiceResultCode.Succeeded,value:h});return}this.createActivityScope(g,function(d){if(b.AsyncUtil.failed(d,a))return;var h=d.value.serviceScope,k=d.value.activityScope;k.getManifest(h,e,i,function(f){if(b.AsyncUtil.failed(f,a))return;if(f.value.status2!=OSF.OmexClientAppStatus.OK){a({status:b.DataServiceResultCode.Failed});return}var d=b.ManifestUtil.ParseManifest(f.value.manifest,j._initParam.appUILocale,g.correlationId);if(d==c){a({status:b.DataServiceResultCode.Failed,value:d});return}OSF.OsfManifestManager.cacheManifest(e.assetId,e.appVersion,d);a({status:b.DataServiceResultCode.Succeeded,value:d})},f)})};e.prototype.activateAsync=function(e,d,c){var f=this;c.startActivity(b.Activity.Activation);c.startActivity(b.Activity.ServerCall);this.createActivityScope(c,function(g){f.isStoreDisabled(c,function(h){if(h.value===a)b.LoaderUtil.failWithError(d,{description:Strings.OsfRuntime.L_OmexStoreDisabledByAdmin,errorCode:OSF.ErrorStatusCodes.E_TRUSTCENTER_CATALOG_UNTRUSTED_ADMIN_CONTROLLED});else if(g.status!=b.DataServiceResultCode.Succeeded){b.LoaderUtil.failWithError(d,{description:OSF.OUtil.formatString(Strings.OsfRuntime.L_AgaveServerConnectionToCatalogFailed_ERR,Strings.OsfRuntime.L_AgaveOmexCatalogName),buttonTxt:Strings.OsfRuntime.L_RetryButton_TXT,buttonCallback:function(){d.restartActivation();f.activateAsync(e,d,c)},errorCode:OSF.ErrorStatusCodes.WAC_AgaveAnonymousProxyCreationError});return}});var h=g.value.serviceScope,i=g.value.activityScope;i.activate(h,e,d)})};e.prototype.removeAsync=function(d,c,a){this.createActivityScope(c,function(c){if(b.AsyncUtil.failed(c,a))return;var e=c.value.serviceScope,f=c.value.activityScope;f.removeApps(e,d,a)})};e.prototype.getAppDetails=function(i,m,l,e,n){var f=this,p=f,d=[];if(n)f._cacheManager.RemoveAll(b.CacheConsts.ungatedCacheKeyPrefix);else{for(var k=i,h=[],g=0;g<k.length;++g){var o=OSF.OUtil.formatString(b.CacheConsts.appDetailKey,k[g]),j=f._cacheManager.GetCacheItem(o,a);if(j&&j.state2!=c)d.push(j);else h.push(k[g])}if(h.length===0){e({status:b.DataServiceResultCode.Succeeded,value:d});return}i=h}f.createActivityScope(l,function(a){if(b.AsyncUtil.failed(a,e,d))return;var c=a.value.serviceScope;c.getAppDetails(i,m,function(a){if(b.AsyncUtil.failed(a,e,d))return;for(var g=a.value,f=0;f<g.length;++f){var c=g[f],h=OSF.OUtil.formatString(b.CacheConsts.appDetailKey,c.assetId);p._cacheManager.SetCacheItem(h,c);d.push(c)}a.value=d;e(a)})})};e.prototype.isStoreDisabled=function(c,a){this.createActivityScope(c,function(c){if(b.AsyncUtil.failed(c,a,d))return;var e=c.value.serviceScope;e.isStoreDisabled(a)})};return e}();b.OmexCatalog=e;b.CatalogFactory.register(OSF.StoreType.OMEX,function(c){if(c.allowExternalMarketplace&&c.osfOmexBaseUrl){var d,f=c.osfOmexBaseUrl.indexOf(OSF.Constants.ProtocolSeparator);if(f>=0)d=c.osfOmexBaseUrl.substr(f);else d=OSF.Constants.ProtocolSeparator+c.osfOmexBaseUrl;var g=OSF.Constants.Https+d;if(OSF.OUtil.getQueryStringParamValue(window.location.search,OSF.Constants.OmexForceAnonymousParamName).toLowerCase()==OSF.Constants.OmexForceAnonymousParamValue.toLowerCase())c.omexForceAnonymous=a;var h=new e({appName:c.appName,appUILocale:c.appUILocale,AppVersion:c.appVersion,clientMode:c.clientMode,docUrl:c.docUrl,omexBaseUrl:g,omexForceAnonymous:c.omexForceAnonymous});return h}return new b.ForbiddenCatalog({loaderParams:b.LoaderUtil.error({description:Strings.OsfRuntime.L_AgaveOmexNotConfigured_ERR,errorCode:OSF.ErrorStatusCodes.E_TRUSTCENTER_CATALOG_UNTRUSTED_ADMIN_CONTROLLED}),controlStatus:OSF.OsfControlStatus.ActivationFailed})})})(OfficeExt||(OfficeExt={}));var OfficeExt;(function(b){var a=function(){function a(){}a.anonymousCacheKeyPrefix="__OSF_ANONYMOUS_OMEX.";a.ungatedCacheKeyPrefix="__OSF_OMEX.";a.manifestRefreshRate=5*365;a.hourToDayConversionFactor=24;a.anonymousAppInstallInfoCacheKey=a.anonymousCacheKeyPrefix+"appInstallInfo.{0}.{1}";a.firstPartyAddinListCacheKey=a.anonymousCacheKeyPrefix+"firstPartyAddInList";a.firstPartyManifestCacheKey=a.anonymousCacheKeyPrefix+"firstPartyManifest.{0}";a.killedAppsCacheKey="{0}killedApps";a.appStateCacheKey="{0}appState.{1}.{2}";a.appDetailKey="__OSF_OMEX.appDetails.{0}";return a}();b.CacheConsts=a})(OfficeExt||(OfficeExt={}));var OfficeExt;(function(a){var b=null,c=true,d=function(){function d(d,c,b){var a=this;a._handler=d;a._initParam=c;a._cacheManager=b.cacheManager;a._cachePrefix=b.cachePrefix;a._cid=b.cid;a._correlationId=b.telemetryContext.correlationId}d.prototype.tryFail=function(b,d){if(b==200)return false;d({httpStatus:b,status:a.DataServiceResultCode.Failed});return c};d.prototype.getLastStoreUpdate=function(c){var b=this,d=b,e=b._initParam.appUILocale;b._handler.getLastStoreUpdate(e,b._correlationId,function(b,e){if(d.tryFail(b,c)){d.logServiceCallResponseError("laststoreupdate",b);return}c({status:a.DataServiceResultCode.Succeeded,value:a.OmexXmlProcessor.ProcessLastStoreUpdate(e)})})};d.prototype.getEntitlementAsync=function(j,f,l,k){var d=this,e=d,h=OSF.OmexAppVersions[d._initParam.appName],g=OSF.OUtil.formatString(d._cachePrefix+a.WACUtils.CacheConstants.EntitlementsKey,h,d._cid);if(l)d._cacheManager.RemoveCacheItem(g);else{var i=d._cacheManager.GetCacheItem(g,c,b,k);if(i!=b){f({status:a.DataServiceResultCode.Succeeded,value:i});return}}d._handler.getEntitlement(j,h,d._correlationId,function(c,d){if(e.tryFail(c,f)){e.logServiceCallResponseError("entitlement",c);return}var b=a.OmexXmlProcessor.ProcessEntitlement(d);b.cid=e._cid;e._cacheManager.SetCacheItem(g,b,b.refreshRate2/a.CacheConsts.hourToDayConversionFactor);f({status:a.DataServiceResultCode.Succeeded,value:b})})};d.prototype.getEToken=function(b,e,c){var d=this,h=e,i=b.storeId,f=b.assetId,g=b.appVersion;this._handler.getEToken(i,h,f,g,this._correlationId,function(b,e){if(d.tryFail(b,c)){d.logServiceCallResponseError("etoken",b);return}c({status:a.DataServiceResultCode.Succeeded,value:a.OmexXmlProcessor.ProcessClientAppInstallInfo(e,OSF.ClientAppInfoReturnType.etokenOnly)})})};d.prototype.getETokenAndManifest=function(d,c,b){var e=this;this.getEToken(d,c,function(f){if(f.status!=a.DataServiceResultCode.Succeeded){b(f);return}e.getManifest(d,c,function(c){if(c.status!=a.DataServiceResultCode.Succeeded){f.status=c.status;f.httpStatus=c.httpStatus;b(f);return}f.value.manifest=c.value.manifest;b(f)})})};d.prototype.getManifest=function(c,b,d){var e=b;this._handler.getManifest(e,c.assetId,this._correlationId,function(c,b){d({status:a.DataServiceResultCode.Succeeded,value:a.OmexXmlProcessor.ConvertAnonymousManifest(c,b)})})};d.prototype.getAppState=function(b,c){var d=this,e=b.storeId+":"+b.assetId;this._handler.getAppState(e,this._correlationId,function(b,e){if(d.tryFail(b,c)){d.logServiceCallResponseError("appstate",b);return}c({status:a.DataServiceResultCode.Succeeded,value:a.OmexXmlProcessor.ProcessAppState(e)})})};d.prototype.getKilledApps=function(b){var c=this;this._handler.getKilledApps(this._correlationId,function(d,e){if(c.tryFail(d,b)){c.logServiceCallResponseError("killedapps",d);return}b({status:a.DataServiceResultCode.Succeeded,value:a.OmexXmlProcessor.ProcessKilledApps(e)})})};d.prototype.getAppDetails=function(e,d,b){var c=this;this._handler.getAppDetails(d,e.join(","),this._correlationId,function(d,e){if(c.tryFail(d,b)){c.logServiceCallResponseError("appdetails",d);return}b({status:a.DataServiceResultCode.Succeeded,value:a.OmexXmlProcessor.ProcessAppDetails(e)})})};d.prototype.removeApps=function(d,c){var b=this;this._handler.removeApps(d.join(","),this._correlationId,function(e,f){if(b.tryFail(e,c)){b.logServiceCallResponseError("removeapps",e);return}var d=a.OmexXmlProcessor.ProcessRemoveAppResponse(f);d.removedApps.some(function(a){return a.result2==OSF.OmexRemoveAppStatus.Success})&&b.clearEntitlementCache();c({status:a.DataServiceResultCode.Succeeded,value:d})})};d.prototype.clearEntitlementCache=function(){var b=".*",c=new RegExp(OSF.OUtil.formatString(a.WACUtils.CacheConstants.EntitlementsKey,b,b),"i");this._cacheManager.RemoveMatches([c])};d.prototype.isStoreDisabled=function(b){var c=this;this._handler.isStoreDisabled(this._correlationId,function(d){if(d!=200&&d!=403&&d!=401){c.logServiceCallResponseError("isStoreDisabled",d);b({status:a.DataServiceResultCode.Failed,value:false});return}b({status:a.DataServiceResultCode.Succeeded,value:d==401})})};d.prototype.logServiceCallResponseError=function(d,a){var c="s2s request "+d+" failed";if(a)c+=":"+a;Telemetry.RuntimeTelemetryHelper.LogExceptionTag(c,b,this._correlationId,18657699)};return d}();a.OmexCatalogServiceS2SScope=d;var e=function(){function e(a){this._cid="";this._initParam=a}e.initRequestHandler=function(a){if(e._requestHandler==b)e._requestHandler=a};e.prototype.getCID=function(){return this._cid};e.prototype.initialize=function(f,d){var g=this;if(e._requestHandler==b){d({status:a.DataServiceResultCode.Failed,httpStatus:404});return}if(this._initParam.omexForceAnonymous){d({status:a.DataServiceResultCode.Succeeded,value:{anonymous:c}});return}e._requestHandler.getUserId(f,function(e,h){if(e==200){g._cid=h.trim();d({status:a.DataServiceResultCode.Succeeded,value:{anonymous:false}})}else if(e==403)d({status:a.DataServiceResultCode.Succeeded,value:{anonymous:c}});else{Telemetry.RuntimeTelemetryHelper.LogExceptionTag("s2s getuserId request failed "+e,b,f,18657728);d({status:a.DataServiceResultCode.Failed,httpStatus:e})}})};e.prototype.createScope=function(a){return new d(e._requestHandler,this._initParam,a)};return e}();a.S2SOmexCatalogService=e})(OfficeExt||(OfficeExt={}));var OfficeExt;(function(b){var a=function(){var o="description",n="provider",m="o:assets",l="contentMarket",k="appSubType",j="expirationDate",i="state",d="version",h="productId",c="assetId",g="o:asset",f="o:results",e="refreshRate",a=null;function b(){}b.ProcessLastStoreUpdate=function(d){var g={},c=new OSF.XmlProcessor(d,_omexXmlNamespaces),f=c.getDocumentElement(),b=f.selectSingleNode("o:update");if(b.firstChild!=a){var e=Date.parse(b.firstChild.nodeValue);return e}return a};b.ProcessAppState=function(l){var k={},a=new OSF.XmlProcessor(l,_omexXmlNamespaces),p=a.getDocumentElement();a.readAttributes(p,{rr:e},k);var m=a.selectSingleNode(f),o=a.selectSingleNode("o:lang",m),n=a.selectSingleNode(g,o);a.readAttributes(n,{assetid:c,prodid:h,ver:d,state:i,tdurl:"takeDownUrl",upv:"unsafePreviousVersion",expiry:j},k);return b.ConvertAppState(k)};b.ProcessFirstPartyAddInList=function(m){var g={addInList:{},refreshRate:a},b=new OSF.XmlProcessor(m,_omexXmlNamespaces),n=b.getDocumentElement(),l=b.selectSingleNode("o:Apps",n),j=l.getAttribute("d1p1:rr");g.refreshRate=j?parseInt(j):0;for(var k=b.selectNodes("o:App",l),i=0;i<k.length;i++){var h=k[i],f={assetId:a,path:a,version:a};b.readAttributes(h,{assetid:c},f);var e=b.selectSingleNode("o:Path",h);f.path=e.text!=a?e.text:e.textContent!=a?e.textContent:e.nodeTypedValue;var d=b.selectSingleNode("o:Version",h);f.version=d.text!=a?d.text:d.textContent!=a?d.textContent:d.nodeTypedValue;g.addInList[f.assetId]=f}return g};b.ConvertAppState=function(a){a.refreshRate2=a.refreshRate?parseInt(a.refreshRate):0;a.state2=a.state?parseInt(a.state):0;a.expirationDate2=b.GetTickByDate(a.expirationDate);return a};b.ProcessEntitlement=function(q){var f={},a=new OSF.XmlProcessor(q,_omexXmlNamespaces),m=a.selectSingleNode("o:entitlementlist"),r=a.selectSingleNode("o:hdr",m);a.readAttributes(r,{pm:"billingMarket",pagesize:"pageSize",rr:e},f);for(var n=a.selectNodes("o:entitlement",a.selectSingleNode("o:entitlements",m)),o,g,p=[],i=0;i<n.length;++i){g={};o=n[i];a.readAttributes(o,{assetid:c,pid:h,ver:d,appst:k,cm:l,trlt:"licenseType",acqdate:"acquireDate",expiry2:j,attreq:"attentionRequired"},g);p.push(g)}f.entitlements=p;return b.ConvertEntitlementInfo(f)};b.ConvertEntitlementInfo=function(c){for(var e=c.entitlements,d=0;d<e.length;++d){var a=e[d];a.appSubType2=a.appSubType?parseInt(a.appSubType):0;a.acquireDate2=b.GetTickByDate(a.acquireDate);a.expirationDate2=b.GetTickByDate(a.expirationDate);a.attentionRequired2=a.attentionRequired==="true"?true:false}c.refreshRate2=c.refreshRate?parseInt(c.refreshRate):0;return c};b.ProcessKilledApps=function(l){var d={},a=new OSF.XmlProcessor(l,_omexXmlNamespaces),p=a.getDocumentElement();a.readAttributes(p,{rr:e},d);for(var k=[],n=a.selectSingleNode(m),j=a.selectNodes(g,n),i=0;i<j.length;++i){var o=j[i],f={};a.readAttributes(o,{assetid:c,pid:h},f);k.push({assetId:f.assetId,productId:f.productId})}d.killedApps=k;return b.ConvertKilledAppsInfo(d)};b.ConvertKilledAppsInfo=function(a){a.refreshRate2=a.refreshRate?parseInt(a.refreshRate):0;return a};b.ProcessClientAppInstallInfo=function(k,j){var f=new OSF.XmlProcessor(k,_omexXmlNamespaces),n=f.selectSingleNode(m),h=f.selectSingleNode(g,n),e={etoken:a,manifest:a};if(j===OSF.ClientAppInfoReturnType.urlOnly)f.readAttributes(h,{url:"url"},e);else if(j===OSF.ClientAppInfoReturnType.etokenOnly)f.readAttributes(h,{etok:"etoken"},e);else f.readAttributes(h,{url:"url",etok:"etoken"},e);f.readAttributes(h,{status:"status",cm:l,assetid:c,ver:d},e);if(j!=OSF.ClientAppInfoReturnType.urlOnly&&e.etoken){var i=new OSF.XmlProcessor(e.etoken,""),o=i.selectSingleNode("t",i.selectSingleNode("r"));i.readAttributes(o,{te:"tokenExpirationDate",et:"entitlementType",cid:"cid"},e)}return b.ConvertClientAppInstallInfo(e)};b.ConvertClientAppInstallInfo=function(a){a.status2=a.status?parseInt(a.status):0;a.tokenExpirationDate2=b.GetTickByDate(a.tokenExpirationDate);return a};b.ProcessManifest=function(a){return {manifest:a}};b.ProcessRemoveAppResponse=function(i){var d={};d.removedApps=[];for(var a=new OSF.XmlProcessor(i,_omexXmlNamespaces),k=a.getDocumentElement(),j=a.selectSingleNode("o:apps",a.selectSingleNode("o:removedApps")),g=a.selectNodes("o:app",j),h,e,f=0;f<g.length;++f){h=g[f];e={};a.readAttributes(h,{assetid:c,result:"result"},e);d.removedApps.push(e)}return b.ConvertRemoveAppResponse(d)};b.ConvertRemoveAppResponse=function(c){for(var d=c.removedApps,b=0;b<d.length;++b){var a=d[b];a.result2=a.result?parseInt(a.result):0}return c};b.ProcessAppDetails=function(m){for(var a=new OSF.XmlProcessor(m,_omexXmlNamespaces),p=a.selectSingleNode(f),h=a.selectNodes("o:wainfo",p),l,e,j=[],g=0;g<h.length;++g){l=h[g];e={};a.readAttributes(l,{assetid:c,appid:"webApplicationId",defhei:"defaultHeight",defwid:"defaultWidth",title:"name",prov:n,desc:o,icon:"iconUrl",ver:d,state:i,appst:k,appvers:"appVersions",req:"requirements",hosts:"hosts",highresicon:"highResolutionIconUrl"},e);j.push(e)}return b.ConvertAppDetails(j)};b.ConvertAppDetails=function(b){for(var c=0;c<b.length;++c){var a=b[c];a.defaultHeight2=a.defaultHeight?parseInt(a.defaultHeight):0;a.defaultWidth2=a.defaultWidth?parseInt(a.defaultWidth):0;a.state2=a.state?parseInt(a.state):0;a.appSubType2=a.appSubType?parseInt(a.appSubType):0}return b};b.ProcessRecommendations=function(l){for(var a=new OSF.XmlProcessor(l,_omexXmlNamespaces),m=a.selectSingleNode(f),k=a.selectNodes("o:wa",m),e,j,h=[],b,g=0;g<k.length;++g){e=k[g];b={};a.readAttributes(e,{assetid:c,title:"name",desc:o,icon:"iconUrl",ver:d,state:i,rat:"rating",dls:"downloads",prov:n},b);j=a.selectSingleNode("o:price",e);a.readAttributes(j,{fop:"originalPrice",opt:"originalPriceTier",fpp:"promotionalPrice",ppt:"promotionalPriceTier",cmod:"priceModel"},b);h.push(b)}return h};b.ConvertAnonymousManifest=function(c,d){var a,b="";switch(c){case 200:a=OSF.OmexClientAppStatus.OK;b=d;break;case 204:case 1223:a=OSF.OmexClientAppStatus.NoEntitlement;break;case 400:a=OSF.OmexClientAppStatus.BadRequest;break;case 410:a=OSF.OmexClientAppStatus.KilledAsset;break;case 404:a=OSF.OmexClientAppStatus.UnknownAssetId;break;case 412:a=OSF.OmexClientAppStatus.VersionNotSupported;break;case 451:a=OSF.OmexClientAppStatus.UserIsMinor;break;default:a=OSF.OmexClientAppStatus.ServerError}return {status2:a,manifest:b}};b.GetTickByDate=function(b){if(b)return (new Date(b)).getTime();return a};return b}();b.OmexXmlProcessor=a})(OfficeExt||(OfficeExt={}));var OfficeExt;(function(a){var b=function(){var c=null;function b(e,d,f,b){if(b===void 0)b=c;this._cacheManager=b||new a.AppsDataCacheManager(OSF.OUtil.getLocalStorage(),new a.SafeSerializer);this._privateCatalogService=new a.PrivateCatalogService(OSF.OmexClientNames[e],OSF.OUtil.normalizeAppVersion(d));this._uiLocale=f}b.prototype.getEntitlementAsync=function(e,c,d,f){c.startActivity(a.Activity.EntitlementCheck);if(f){this._cacheManager.RemoveAll(b._addInsCacheKey);this._cacheManager.RemoveCacheItem(b._lastCatalogUpdateKey)}this.GetAddInList(e,c,function(f){for(var g=[],e=0;e<f.length;e++){var h=f[e];h.addInState===b._addInOkState&&g.push(h)}c.stopActivity(a.Activity.EntitlementCheck);d({status:a.DataServiceResultCode.Succeeded,value:g})},function(a){d({status:a})})};b.prototype.getAppDetails=function(h,o,j,i,m){var e=this,l=e;m&&e._cacheManager.RemoveAll(b._addInDetailsCacheKeyPrefix);for(var d=[],g=[],f=0;f<h.length;f++){var n=b.GetAppDetailsCacheKey(h[f].ProductId),k=e._cacheManager.GetCacheItem(n);if(k)d.push(k);else g.push(h[f])}if(g.length===0){i({status:a.DataServiceResultCode.Succeeded,value:d});return}e._privateCatalogService.GetManifests(g,c,c,j,function(f){for(var e=0;e<f.length;e++){var g=l.ParseAndCacheManifest(f[e],j);if(!g)continue;var c=b.CreateAddInDetails(g);d.push(c);var h=b.GetAppDetailsCacheKey(c.assetId);l._cacheManager.SetCacheItem(h,c,b._addInDetailsRefreshRateDays)}i({status:a.DataServiceResultCode.Succeeded,value:d})},function(a){i({status:a})})};b.prototype.getAndCacheManifest=function(c,f,g,d){var e={ProductId:c.assetId,Version:c.appVersion,AddInState:b._addInOkState,StoreInfo:{AssetId:c.storeId,ContentMarket:f}};this.GetManifest(e,g,function(b){d({status:a.DataServiceResultCode.Succeeded,value:b})},function(a){d({status:a})})};b.prototype.activateAsync=function(h,e,f){var d=true,i=this;f.startActivity(a.Activity.Activation);var g=this;this.GetAddInList(false,f,function(m){for(var j,l=/[{}]/g,k=0;k<m.length;k++){var n=m[k];if(h.assetId.replace(l,"").toLowerCase()===n.assetId.replace(l,"").toLowerCase()){j=n;break}}if(!j){a.LoaderUtil.showWarning(e,{description:Strings.OsfRuntime.L_AgaveNotExist_ERR,buttonTxt:Strings.OsfRuntime.L_RefreshButton_TXT,buttonCallback:function(){e.restartActivation();g._cacheManager.RemoveAll(b._addInsCacheKey);g._cacheManager.RemoveCacheItem(b._lastCatalogUpdateKey);g.activateAsync(h,e,f)},detailView:d,retryAll:d,errorCode:OSF.ErrorStatusCodes.E_OEM_EXTENSION_NOT_ENTITLED});return}if(j.addInState!==b._addInOkState){a.LoaderUtil.failWithError(e,{description:Strings.OsfRuntime.L_AgaveDisabledByAdmin_ERR,url:"",errorCode:OSF.ErrorStatusCodes.E_OEM_OMEX_EXTENSION_KILLED});return}h.appVersion=j.appVersion;var o={ProductId:j.assetId,Version:j.appVersion,AddInState:b._addInOkState,StoreInfo:{AssetId:j.storeId,ContentMarket:""}};i.GetManifest(o,f,function(a){e.load({entitlement:h,manifest:a,eToken:""},c)},function(){a.LoaderUtil.failWithError(e,{description:Strings.OsfRuntime.L_AddinCommands_AddinNotSupported_Message,url:"",errorCode:OSF.ErrorStatusCodes.E_MANIFEST_DOES_NOT_EXIST,buttonTxt:Strings.OsfRuntime.L_RefreshButton_TXT,buttonCallback:function(){e.restartActivation();g.activateAsync(h,e,f)}})})},function(){a.LoaderUtil.showWarning(e,{description:OSF.OUtil.formatString(Strings.OsfRuntime.L_AgaveServerConnectionToCatalogFailed_ERR,Strings.OsfRuntime.L_AgaveAdminManagedCatalogName),buttonTxt:Strings.OsfRuntime.L_RefreshButton_TXT,buttonCallback:function(){e.restartActivation();g._cacheManager.RemoveAll(b._addInsCacheKey);g._cacheManager.RemoveCacheItem(b._lastCatalogUpdateKey);g.activateAsync(h,e,f)},detailView:d,retryAll:d,errorCode:OSF.ErrorStatusCodes.WAC_AgaveActivationError});f.stopActivity(a.Activity.Activation)})};b.prototype.removeAsync=function(d,c,b){b({status:a.DataServiceResultCode.Failed})};b.GetAppDetailsCacheKey=function(a){return b._addInDetailsCacheKeyPrefix+OSF.OUtil.formatString(b._addInDetailsCacheKeySufix,a)};b.GetManifestCacheKey=function(c,a){return b._manifestCacheKeyPrefix+OSF.OUtil.formatString(b._manifestCacheKeySufix,c,a)};b.CreateAddInDetails=function(a){return {assetId:a.getMarketplaceID(),webApplicationId:a.getWebApplicationId(),defaultHeight2:a.getDefaultHeight()||0,defaultHeight:String(a.getDefaultHeight()||0),defaultWidth2:a.getDefaultWidth()||0,defaultWidth:String(a.getDefaultWidth()||0),name:a.getDefaultDisplayName(),provider:a.getProviderName(),description:a.getDefaultDescription(),iconUrl:a.getDefaultIconUrl(),version:a.getMarketplaceVersion(),state2:1,state:"1",appSubType2:a.getOmexTargetCode(),appSubType:String(a.getOmexTargetCode()),appVersions:undefined,requirements:a.getRequirementsXml(),hosts:a.getHostsXml(),highResolutionIconUrl:a.getDefaultHighResolutionIconUrl()}};b.prototype.GetAddInList=function(f,g,e,h){var d=this,a;if(!f){a=this._cacheManager.GetCacheItem(b._addInsCacheKey);if(a){e(a);return}}this._privateCatalogService.GetAddInList(c,c,g,function(a){for(var c=0;c<a.length;c++){var h=a[c],g=b.GetAppDetailsCacheKey(h.assetId),f=d._cacheManager.GetCacheItem(g);f&&f.version!==h.appVersion&&d._cacheManager.RemoveCacheItem(g)}d._cacheManager.SetCacheItem(b._addInsCacheKey,a,b._addInListRefreshRateDays);e(a)},h)};b.prototype.GetManifest=function(e,f,h,i){var g=this,l=g;f.startActivity(a.Activity.ManifestRequest);var d=OSF.OsfManifestManager.getCachedManifest(e.ProductId,e.Version);if(d){f.stopActivity(a.Activity.ManifestRequest);h(d);return}var k=b.GetManifestCacheKey(e.ProductId,e.Version),j=g._cacheManager.GetCacheItem(k);if(j){d=new OSF.Manifest.Manifest(j,g._uiLocale);if(!d){i(a.DataServiceResultCode.Failed);return}f.stopActivity(a.Activity.ManifestRequest);h(d);return}g._privateCatalogService.GetManifests([e],c,c,f,function(b){d=l.ParseAndCacheManifest(b[0],f);if(!d){i(a.DataServiceResultCode.Failed);return}OSF.OsfManifestManager.cacheManifest(e.ProductId,e.Version,d);f.stopActivity(a.Activity.ManifestRequest);h(d)},function(a){i(a)})};b.prototype.ParseAndCacheManifest=function(d,f){try{var a=new OSF.Manifest.Manifest(d,this._uiLocale),g=b.GetManifestCacheKey(a.getMarketplaceID(),a.getMarketplaceVersion());this._cacheManager.SetCacheItem(g,d,b._addInManifestRefreshRateDays);return a}catch(e){Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Invalid manifest retrieved from Private Catalog.",e,f.correlationId,19965729)}return c};b._addInsCacheKey="__OSF_PRIVATECATALOG_ADDINS";b._addInDetailsCacheKeyPrefix="__OSF_PRIVATECATALOG_ADDINDETAILS";b._addInDetailsCacheKeySufix="_{0}";b._manifestCacheKeyPrefix="__OSF_PRIVATECATALOG_MANIFEST";b._manifestCacheKeySufix="_{0}_{1}";b._lastCatalogUpdateKey="_OSF_PRIVATECATALOG_LASTUPDATE";b._addInListRefreshRateDays=1/24;b._addInDetailsRefreshRateDays=365;b._addInManifestRefreshRateDays=365;b._addInOkState="Ok";return b}();a.PrivateCatalog=b;a.CatalogFactory.register(OSF.StoreType.PrivateCatalog,function(c){if(c.enablePrivateCatalog)return new b(c.appName,c.appVersion,c.appUILocale);return new a.ForbiddenCatalog({loaderParams:a.LoaderUtil.error({description:OSF.OUtil.formatString(Strings.OsfRuntime.L_AgaveCatalogNotEnabled_ERR,Strings.OsfRuntime.L_AgaveAdminManagedCatalogName),errorCode:OSF.ErrorStatusCodes.E_EXCHANGE_PRIVATE_CATALOG_DISABLED}),controlStatus:OSF.OsfControlStatus.ActivationFailed})})})(OfficeExt||(OfficeExt={}));var OfficeExt;(function(a){var b=function(){var g="Failed to parse response into PrivateCatalogServiceResponse object.",e=200,f=true,b=null,c=false;function d(b,a){this._clientCode=b;this._clientVersion=a}d.initRequestHandler=function(i,h,g,e){if(e===void 0)e=c;if(d._requestHandler==b)d._requestHandler=i;if(d.authenticationProxy==b)d.authenticationProxy=h;d._isThirdPartyHostEnabled=g;d._resultCodeIsEnabled=e&&e===f;d._tokenCacheManager=new a.TokenCacheManager(OSF.OUtil.getLocalStorage(),new a.SafeSerializer);d._cacheManager=new a.AppsDataCacheManager(OSF.OUtil.getLocalStorage(),new a.SafeSerializer)};d.ParseAddInList=function(j,e){var f=[],c;try{c=JSON.parse(j)}catch(h){Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Could not parse GetAddIns reponse.",h,e.correlationId,19965730);return b}if(!c||!c.AddIns){Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("GetPrivateCatalogAddIns response could not be parsed.",e.correlationId,20194262);return f}for(var g=0,i=c.AddIns;g<i.length;g++){var a=i[g];if(!a.AddInState||!a.ProductId||!a.Version){Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag(OSF.OUtil.formatString('Add-In metadata was missing some data. ID: "{0}", Version: "{1}", State: "{2}".',a.ProductId||"",a.Version||"",a.AddInState||""),e.correlationId,20194263);continue}f.push({assetId:a.ProductId,storeId:!a.StoreInfo?"none":a.StoreInfo.AssetId,appVersion:a.Version,storeType:OSF.StoreType.PrivateCatalog,targetType:OSF.OsfControlTarget.Undefined,addInState:a.AddInState,contentMarket:!a.StoreInfo?"":a.StoreInfo.ContentMarket});d.StoreAuthenticationData(c)}return f};d.ParseAndCacheManifestList=function(j,f){var c=[],a;try{a=JSON.parse(j)}catch(g){Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Could not parse GetManifests reponse.",g,f.correlationId,19965731);return b}if(!a||!a.Manifests){Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("GetAddInManifests response could not be parsed.",f.correlationId,20194264);return c}for(var e=0,h=a.Manifests;e<h.length;e++){var i=h[e];c.push(i)}d.StoreAuthenticationData(a);return c};d.StoreAuthenticationData=function(a){d._tokenCacheManager.AddRefreshToken(a.RefreshToken,a.UserId,a.TenantId);d._userId=a.UserId;d._tenantId=a.TenantId};d.prototype.GetLastPrivateCatalogUpdate=function(l,m,h,i,g){var k=this,j=0;d._requestHandler.getLastPrivateCatalogUpdate(this._clientCode,this._clientVersion,l,m,h.correlationId,function(u,s){var q="GetLastPrivateCatalogUpdate response could not be parsed.",p="Could not parse GetLastPrivateCatalogUpdate reponse.";j++;if(d._resultCodeIsEnabled){if(u===e){var r=d.ParsePrivateCatalogServiceResponse(s,h);if(!r){g(a.DataServiceResultCode.Failed);return}if(r.ResponseCode===1){var o;try{o=JSON.parse(s)}catch(v){Telemetry.RuntimeTelemetryHelper.LogExceptionTag(p,v,h.correlationId,42284249);g(a.DataServiceResultCode.Failed);return}if(!o||!o.LastUpdate){Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag(q,h.correlationId,42284250);g(a.DataServiceResultCode.Failed);return}d.StoreAuthenticationData(o);i(o.LastUpdate);return}if(r.ResponseCode===2){var t=d.TryGetRefreshToken(s,h);if(t){k.GetLastPrivateCatalogUpdate(b,t,h,i,g);return}}if(r.ResponseCode===2||r.ResponseCode===3){var n=f;setTimeout(function(){d.authenticationProxy.tryAuthorize(function(a){if(n){n=c;k.GetLastPrivateCatalogUpdate(a,b,h,i,g)}},function(){if(n){n=c;var b=d._isThirdPartyHostEnabled?a.DataServiceResultCode.Unauthenticated:a.DataServiceResultCode.Failed;g(b)}})},0);setTimeout(function(){if(n){n=c;var b=d._isThirdPartyHostEnabled?a.DataServiceResultCode.Unauthenticated:a.DataServiceResultCode.Failed;g(b)}},d._authenticationTimeout);return}d.HandleLogging(r,h,g);return}}else{if(u===e){var o;try{o=JSON.parse(s)}catch(v){Telemetry.RuntimeTelemetryHelper.LogExceptionTag(p,v,h.correlationId,22823177);g(a.DataServiceResultCode.Failed);return}if(!o||!o.LastUpdate){Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag(q,h.correlationId,22823178);g(a.DataServiceResultCode.Failed);return}d.StoreAuthenticationData(o);i(o.LastUpdate);return}if(u===403){if(j==1){j++;var t=d.TryGetRefreshToken(s,h);if(t!=b){k.GetLastPrivateCatalogUpdate(l,t,h,i,g);return}}if(j>d._maxAuthenticationAttempts||l!=b){Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Private Catalog: GetLastPrivateCatalogUpdate authentication loop occured.",b,h.correlationId,22823179);g(a.DataServiceResultCode.Unauthenticated);return}j++;var n=f;setTimeout(function(){d.authenticationProxy.tryAuthorize(function(a){if(n){n=c;k.GetLastPrivateCatalogUpdate(a,m,h,i,g)}},function(){if(n){n=c;g(a.DataServiceResultCode.Unauthenticated)}})},0);setTimeout(function(){if(n){n=c;g(a.DataServiceResultCode.Unauthenticated)}},5*1e3);return}}Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Private Catalog: GetLastPrivateCatalogUpdate request failed with status code "+u,b,h.correlationId,22823180);g(a.DataServiceResultCode.Failed)})};d.prototype.GetAddInList=function(l,m,h,j,g){var k=this,i=0;d._requestHandler.getPrivateCatalogAddIns(this._clientCode,this._clientVersion,l,m,h.correlationId,function(q,r){i++;if(d._resultCodeIsEnabled){if(q===e){var o=d.ParsePrivateCatalogServiceResponse(r,h);if(!o){g(a.DataServiceResultCode.Failed);return}if(o.ResponseCode===1){var s=d.ParseAddInList(r,h);if(!s){g(a.DataServiceResultCode.Failed);return}j(s);return}if(o.ResponseCode===2){var p=d._tokenCacheManager.GetRefreshToken(o.UserId,o.TenantId);if(p){k.GetAddInList(b,p,h,j,g);return}}if(o.ResponseCode===2||o.ResponseCode===3){var n=f;setTimeout(function(){d.authenticationProxy.tryAuthorize(function(a){if(n){n=c;k.GetAddInList(a,b,h,j,g)}},function(){if(n){n=c;var b=d._isThirdPartyHostEnabled?a.DataServiceResultCode.Unauthenticated:a.DataServiceResultCode.Failed;g(b)}})},0);setTimeout(function(){if(n){n=c;var b=d._isThirdPartyHostEnabled?a.DataServiceResultCode.Unauthenticated:a.DataServiceResultCode.Failed;g(b)}},d._authenticationTimeout);return}d.HandleLogging(o,h,g);return}}else{if(q===e){var s=d.ParseAddInList(r,h);if(!s){g(a.DataServiceResultCode.Failed);return}j(s);return}if(q===403){if(i==1){i++;var p=d.TryGetRefreshToken(r,h);if(p!=b){k.GetAddInList(l,p,h,j,g);return}}if(i>d._maxAuthenticationAttempts||l!=b){Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Private Catalog: GetAddInList authentication loop occured. Either authentication attempts count is greater than 2, or authorizationCode is not null. attemptsCount: "+i,b,h.correlationId,20497158);g(a.DataServiceResultCode.Unauthenticated);return}i++;var n=f;setTimeout(function(){d.authenticationProxy.tryAuthorize(function(a){if(n){n=c;k.GetAddInList(a,m,h,j,g)}},function(){if(n){n=c;var b=d._isThirdPartyHostEnabled?a.DataServiceResultCode.Unauthenticated:a.DataServiceResultCode.Failed;g(b)}})},0);setTimeout(function(){if(n){n=c;var b=d._isThirdPartyHostEnabled?a.DataServiceResultCode.Unauthenticated:a.DataServiceResultCode.Failed;g(b)}},5*1e3);return}}Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Private Catalog: GetAddInList request failed with status code "+q,b,h.correlationId,20497159);g(a.DataServiceResultCode.Failed)})};d.prototype.GetManifests=function(k,m,n,g,i,h){var l=this,p=[],j=0,o={AddIns:k,RefreshToken:n,ResponseCode:1,UserId:"",TenantId:""};d._requestHandler.getPrivateCatalogManifests(a.WACUtils.serializeObjectToString(o),m,n,g.correlationId,function(s,q){j++;if(d._resultCodeIsEnabled){if(s===e){var o=d.ParsePrivateCatalogServiceResponse(q,g);if(!o){h(a.DataServiceResultCode.Failed);return}if(o.ResponseCode===1){var t=d.ParseAndCacheManifestList(q,g);if(!t){h(a.DataServiceResultCode.Failed);return}i(t);return}if(o.ResponseCode===2){var r=d.TryGetRefreshToken(q,g);if(r){l.GetManifests(k,b,r,g,i,h);return}}if(o.ResponseCode===2||o.ResponseCode===3){var p=f;setTimeout(function(){d.authenticationProxy.tryAuthorize(function(a){if(p){p=c;l.GetManifests(k,a,b,g,i,h)}},function(){if(p){p=c;var b=d._isThirdPartyHostEnabled?a.DataServiceResultCode.Unauthenticated:a.DataServiceResultCode.Failed;h(b)}})},0);setTimeout(function(){if(p){p=c;var b=d._isThirdPartyHostEnabled?a.DataServiceResultCode.Unauthenticated:a.DataServiceResultCode.Failed;h(b)}},d._authenticationTimeout);return}d.HandleLogging(o,g,h);return}}else{if(s===e){var t=d.ParseAndCacheManifestList(q,g);if(!t){h(a.DataServiceResultCode.Failed);return}i(t);return}if(s===403){if(j==1){j++;var r=d.TryGetRefreshToken(q,g);if(r!=b){l.GetManifests(k,m,r,g,i,h);return}}if(j>d._maxAuthenticationAttempts||m!=b){Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Private Catalog: GetManifests authentication loop occured.",b,g.correlationId,20497160);h(a.DataServiceResultCode.Unauthenticated);return}j++;d.authenticationProxy.tryAuthorize(function(a){l.GetManifests(k,a,n,g,i,h)},function(){h(a.DataServiceResultCode.Unauthenticated)});return}}Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Private Catalog: GetManifests request failed with status code "+s,b,g.correlationId,20497161);h(a.DataServiceResultCode.Failed)})};d.TryGetRefreshToken=function(e,c){var a;try{a=JSON.parse(e)}catch(f){Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag(g,c.correlationId,40748691)}if(a)return d._tokenCacheManager.GetRefreshToken(a.UserId,a.TenantId);return b};d.HandleLogging=function(c,e,f){if(!c){Telemetry.RuntimeTelemetryHelper.LogExceptionTag("PrivateCatalogService.HandleLogging: parsedResponse object is null.",b,e.correlationId,42284251);f(a.DataServiceResultCode.Failed);return}if(c.ResponseCode===4||c.ResponseCode===5){if(c.ResponseCode===5)Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("PrivateCatalogService: User not authenticated.",b,42768075);else Telemetry.RuntimeTelemetryHelper.LogExceptionTag("PrivateCatalogService: All authentication attempts failed. ResponseCode: "+c.ResponseCode,b,e.correlationId,42284252);f(d._isThirdPartyHostEnabled?a.DataServiceResultCode.Unauthenticated:a.DataServiceResultCode.Failed);return}(c.ResponseCode===0||c.ResponseCode===7)&&Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Call to AddinServiceHandler failed. ResponseCode: "+c.ResponseCode,b,e.correlationId,42284253);c.ResponseCode===6&&Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("PrivateCatalogService: User not supported.",b,42284254);f(a.DataServiceResultCode.Failed);return};d.ParsePrivateCatalogServiceResponse=function(c,b){var a;try{a=JSON.parse(c)}catch(d){Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag(g,b.correlationId,42284255)}return a};d.SignOutUser=function(){Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag(OSF.OUtil.formatString("PrivateCatalogService.SignOutUser: userId = {0}, tenantId = {1}",d._userId,d._tenantId),b,21616005);d._tokenCacheManager.RemoveRefreshToken(d._userId,d._tenantId);d.authenticationProxy.signOut(function(){d._cacheManager.RemoveAll(a.PrivateCatalog._addInsCacheKey);d._cacheManager.RemoveAll(a.PrivateCatalog._addInDetailsCacheKeyPrefix)},function(){Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("Private Catalog: Failed to sign out ",b,22316866)})};d._maxAuthenticationAttempts=3;d._authenticationTimeout=3*1e3;return d}();a.PrivateCatalogService=b})(OfficeExt||(OfficeExt={}));var OfficeExt;(function(a){var b=function(){var z="requestIdleCallback",w="SDX Catalog Error AssetId: ",c=null,q="fetch",f="",d=false,p="sdxPreloadStart",e=true,v="errorMessage",u="manifestParseEnd",o="manifestParseStart",k="manifestRetrievalEnd",t="manifestRetrievalStart",s="packageListParseEnd",r="packageListParseStart",n="packageListRetrievalEnd",y="packageListRetrievalStart",x="activateAsyncStart",m="cachedUrls",j="Version",i="FFN",h="AssetId",g="OsfControlId",l="performanceTimestampOrigin";function b(){}b.recordActivity=function(d,a,c,b){otel&&otel.sendActivityEvent&&otel.sendActivityEvent({name:"Office.Online.Sdx."+d,durationMs:performance.now()-a,succeeded:c,dataFields:b})};b.recordActivationActivity=function(f,a){var d="SdxOnWacCDNIsEnabled",c="activationStart";b.recordActivity("Activation",a[c],f,[{name:"PerformanceTimestampOrigin","double":a[l]},{name:g,string:a["osfControlId"]},{name:h,string:a["assetId"]},{name:i,string:a["ffn"]},{name:j,string:a["version"]},{name:"SourceLocationOverrideResourceId",string:a["sourceLocationOverrideResourceId"]},{name:"IframeUrl",string:a["iframeUrl"]},{name:"CachedUrls",string:a[m]},{name:"ActivationStart","double":a[c]},{name:"ActivateAsyncStart","double":a[x]},{name:"PackageListRetrievalStart","double":a[y]},{name:"PackageListRetrievalEnd","double":a[n]},{name:"PackageListParseStart","double":a[r]},{name:"PackageListParseEnd","double":a[s]},{name:"ManifestRetrievalStart","double":a[t]},{name:"ManifestRetrievalEnd","double":a[k]},{name:"ManifestParseStart","double":a[o]},{name:"ManifestParseEnd","double":a[u]},{name:"IframeCreateStart","double":a["iframeCreateStart"]},{name:"IframeCreateEnd","double":a["iframeCreateEnd"]},{name:"GetAppContextStart","double":a["getAppContextStart"]},{name:"GetAppContextEnd","double":a["getAppContextEnd"]},{name:"IframeOnLoadReceived","double":a["iframeOnLoadReceived"]},{name:"ErrorMessage",string:a[v]},{name:"OfficeJsReadyDate","double":a["officeJsReadyDate"]},{name:d,"boolean":a[d]},{name:"IsPreload","boolean":a["isPreload"]===e},{name:"SdxPreloadStart",string:a[p]}])};b.InitializeSdx=function(e){var c="Application",g=OSF.OUtil.getValue(e["flightingTreatmentVariables"],{});OSF.OUtil.getValue(g["Microsoft.Office.OEP.FA000000059.SdxOnWacCDNIsEnabled"],d)&&OSF.OUtil.pushFlight(OSF.FlightNames.SdxOnWacCDNIsEnabled);var a=OSF.OUtil.getValue(e["generalParameters"],{});b.appName=OSF.OUtil.getValue(a[c],"Unknown");b.wacCdnRssUrl=OSF.OUtil.getValue(a["wacCdnRssUrl"],f);b.InitializeSdxList(a["SdxDmsUrl"],a["SdxCdnUrl"],a["UICulture"],a[c],a["LoggableUserId"],a["SessionStartInfoJson"])};b.MarkSdxPreloadStart=function(c){var a=c.toLowerCase();b.SdxPreloadStart[a]=performance.now()};b.IsSdxPreloaded=function(c){var a=c.toLowerCase();return b.SdxPreloadStart.hasOwnProperty(a)};b.GetPackageList=function(i,e,f,j,g,b){if(b===void 0)b=d;var k=window[q]||a.AsyncUtil.fetch,h=JSON.parse(g)["AudienceGroup"].toLowerCase(),l=({automation:"Dogfood",microsoft:"Microsoft",dogfood:"Dogfood"})[h]||"Production";return a.AsyncUtil.withCache("SDXPackageList_"+f+"_"+e.toLowerCase(),{forceUpdateCache:b,maxAgeInSecs:60*60},function(){return a.AsyncUtil.retry(function(){var a=OSF.OUtil.Guid.generateNewGuid();Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("Making network call to DMS. DMSActivityId="+a,c,594629387);return k(i,{method:"POST",body:JSON.stringify({Context:{Hosts:[f],ReactNativeVersion:"0.0.0.0",Channel:"DevMain",Capabilities:OSF.AppSpecificSetup.BuildRequirementsChecker()._getSupportedSetAsDmsCapabilities(),Ring:l,Platform:"Web",Locales:[e],ClientId:j},SyncId:0}),headers:{"Content-Type":"application/json",DMSActivityId:a}}).then(function(a){if(!a.ok)throw new Error("GetPackageList error: "+a.status+" - "+a.statusText);return a.text()})})})};b.GetManifest=function(h,e,k,f){if(f===void 0)f=d;var j=window[q]||a.AsyncUtil.fetch,g=b.GetManifestCdnUrl(h,e),i=OSF.OUtil.hashCode(g);return a.AsyncUtil.withCache("SDXManifest_"+e.AssetId+"_"+e.FFN+"_"+e.Version+"_"+i,{forceUpdateCache:f},function(){return a.AsyncUtil.retry(function(){Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("Making network call to CDN. Url="+g,c,594629386);return j(g).then(function(a){if(!a.ok)throw new Error("GetManifest error: "+a.status+" - "+a.statusText);return a.text()})})})};b.GetManifestCdnUrl=function(c,a){var d=function(c,a){if(OSF.OUtil.checkFlight(OSF.FlightNames.SdxOnWacCDNIsEnabled)&&b.appName==="Word"&&a.AssetId.toLowerCase()===OSF.SdxAssetIds.ExperimentationSdx)return b.wacCdnRssUrl+"sdxexpwaccdn/manifest_web.xml";return c},e="en-us";return OSF.OUtil.formatString(d(c,a),a.AssetId,a.FFN,a.Version,e)};b.IsAbsoluteUrl=function(a){return /^(?:[a-z]+:)?\/\//i.test(a)};b.ResolveUrl=function(c,a){if(b.IsAbsoluteUrl(a))return a;var d=c.lastIndexOf("/");return c.substr(0,d)+(a.charAt(0)==="/"?f:"/")+a};b.UpdateManifestIconUrl=function(a,g,e){for(var f="en-US",i=["_iconUrls","_highResolutionIconUrls"],h=0;h<i.length;h++){var c=i[h];if(a[c])if(a[c][e])a[c][e]=b.ResolveUrl(g,a[c][e]);else if(a[c][f])a[c][e]=b.ResolveUrl(g,a[c][f]);else for(var d in a[c])if(a[c].hasOwnProperty(d)&&f.toLowerCase()==d.toLowerCase()){a[c][d]=b.ResolveUrl(g,a[c][d]);break}}};b.InitializeSdxList=function(i,d,f,h,j,g){var a=b.GetPackageList(i,f,OSF.getManifestHostType(h),j,g,e).then(function(b){var a=b.value;return JSON.parse(a).Packages});a.then(function(a){var c=function(a){return function(){return b.GetManifest(d,a,f,e)["catch"](function(){})}};a.forEach(function(a){return b.requestIdleCallback(c(a))});return a},function(a){Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Error in getting SDX package list.",a,c,594629385)});b.SdxCdnManifestUrlByAssetId=a.then(function(c){var a={};c.forEach(function(c){a[c.AssetId.toLowerCase()]=b.GetManifestCdnUrl(d,c)});return a})};b.PrefetchUrl=function(e,g){if(g===void 0)g=d;if(b.PrefetchedAssetSet.hasOwnProperty(e))return;var f={start:performance.now()};b.PrefetchedAssetSet[e]=f;if(g){var c=document.createElement("link");c.rel="prefetch";c.href=e;c.onload=function(){f.end=performance.now()};document.head.appendChild(c)}else{var h=window[q]||a.AsyncUtil.fetch;b.requestIdleCallback(function(){h(e,{mode:"no-cors"}).then(function(){f.end=performance.now()})})}};b.ResolveRelativeUrl=function(a,d){return b.SdxCdnManifestUrlByAssetId.then(function(f){var e=f[d.toLowerCase()];if(e==c)throw new Error("Unable to find manifestUrl");return b.ResolveUrl(e,a)})};b.PrefetchAsset=function(a,q,n,j){var h=a.match(b.OfficeJsEntryRegex);if(h===c){var i=d;if(a.slice(0,10)==="iframeUrl:"){a=a.slice(10);i=e}if(b.IsAbsoluteUrl(a))b.PrefetchUrl(a,i);else if(i)b.ResolveRelativeUrl(a,j).then(function(a){return b.PrefetchUrl(a,e)},function(){});else b.ResolveRelativeUrl(a,j).then(function(a){return b.PrefetchUrl(a,d)},function(){})}else{var m=h[1],p=h[2],o=h[3],g="https://appsforoffice.microsoft.com/lib/"+o+"/hosted/",k=n.toLowerCase(),l=OSF.HostSpecificFileVersionMap[k]["web"]||OSF.HostSpecificFileVersionDefault;b.PrefetchUrl(f+g+m);b.PrefetchUrl(f+g+k+"-web-"+l+(p||f)+".js");b.PrefetchUrl(g+"en-us/office_strings.js");b.PrefetchUrl(g+"telemetry/oteljs_agave.js");b.PrefetchUrl(g+"webauth/webauth.implicit.js")}};b.PrefetchSdxAssets=function(i,m,l,a){var h="Microsoft.Office.OEP.",v=i["SdxAssetsToPrefetchMapping"];if(v==c)return;if(b.IsSdxPreloaded(a))return;var o=[],n=[];try{o=JSON.parse(m[h+a.toUpperCase()+".SdxPrefetchAssetsToAdd"]||"[]");n=JSON.parse(m[h+a.toUpperCase()+".SdxPrefetchAssetsToRemove"]||"[]")}catch(q){Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Error in parsing the sdx prefetch override flighting treatment variables.",q,c,593052824)}if(l!=="Word")return;var g;try{var B=JSON.parse(v);g=B[a.toLowerCase()]}catch(q){b.LogSDXCatalogMonitoringError("Parsing SdxAssetsToPrefetchMapping failed.",a);return}if(Array.isArray(g))for(var u=0;u<g.length;u++){var j=g[u];n.indexOf(j)===-1&&b.PrefetchAsset(j,i,l,a)}else for(var r=0,y=Object.keys(g);r<y.length;r++){var p=y[r],k=d;if(p===f)k=e;else{var z=p.split("=="),x=z[0],w=z[1];if(i[x]==w)k=e;else if(m["Microsoft.Office."+x]==w)k=e}if(k)for(var s=0,A=g[p];s<A.length;s++){var j=A[s];n.indexOf(j)===-1&&b.PrefetchAsset(j,i,l,a)}}for(var t=0;t<o.length;t++){var j=o[t];b.PrefetchAsset(j,i,l,a)}};b.AddWacSettingParametersToIframeUrl=function(e,b){var a=document.createElement("a");a.href=e;var c=Object.keys(b).map(function(a){return "wacSetting"+a+"="+encodeURIComponent(b[a].toString())}).join("&"),d=a.search.length>1?a.search.substr(1)+"&":f;a.search=d+c;return a.href};b.activateAsync=function(E,F,A,I,G,q){var z="WasCachedInMemory",B="PackageListRetrieval";A.startActivity(a.Activity.Activation);q[x]=performance.now();q["assetId"]=E.assetId.toUpperCase();var D=a.CatalogFactory.getHostContext();Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("Start activating SDX with assetId: "+E.assetId+".",A.correlationId,37291606);A.startActivity(a.Activity.ServerCall);var C=c,H=performance.now();q[y]=performance.now();b.GetPackageList(D.sdxDmsUrl,D.appUILocale,OSF.getManifestHostType(D.hostType),G.clientId,G.sessionStartInfoJson).then(function(a){var b=a.cacheType,d=a.value;q[n]=performance.now();q[r]=performance.now();var c={cacheType:b,packages:JSON.parse(d).Packages};q[s]=performance.now();return c}).then(function(a){var c=a.cacheType,d=a.packages;b.recordActivity(B,H,e,[{name:g,string:A.instanceId},{name:z,bool:c=="memory"}]);return d},function(a){q[n]=performance.now();b.recordActivity(B,H,d,[{name:g,string:A.instanceId},{name:z,bool:d}]);a.sdxErrorCode=OSF.ErrorStatusCodes.WAC_SDX_DMSRequestFailed;throw a}).then(function(b){C=b.filter(function(a){return a.AssetId.toLowerCase()==E.assetId.toLowerCase()})[0];if(C==c){var a=new Error('Unable to find SDX "'+E.assetId+'" in the package list.');a.sdxErrorCode=OSF.ErrorStatusCodes.WAC_SDX_AssetIdNotInDMSResponse;throw a}return C}).then(function(f){var c="ManifestRetrieval";A.startActivity(a.Activity.ManifestRequest);var l=performance.now();q[t]=performance.now();q["ffn"]=f.FFN;q["version"]=f.Version;return b.GetManifest(D.sdxCdnUrl,f,D.appUILocale).then(function(a){var d=a.cacheType,m=a.value;q[k]=performance.now();b.recordActivity(c,l,e,[{name:g,string:A.instanceId},{name:h,string:f.AssetId},{name:i,string:f.FFN},{name:j,string:f.Version},{name:z,bool:d=="memory"}]);return m},function(a){q[k]=performance.now();b.recordActivity(c,l,d,[{name:g,string:A.instanceId},{name:h,string:f.AssetId},{name:i,string:f.FFN},{name:j,string:f.Version},{name:z,bool:d}]);a.sdxErrorCode=OSF.ErrorStatusCodes.WAC_AgaveManifestRequestFailure;throw a})}).then(function(k){q[o]=performance.now();var d=a.ManifestUtil.ParseManifest(k,D.appUILocale,A.correlationId);q[u]=performance.now();b.recordActivity("ManifestParse",q[o],d!=c,[{name:g,string:A.instanceId},{name:h,string:C.AssetId},{name:i,string:C.FFN},{name:j,string:C.Version}]);if(d==c){var e=new Error("Unable to parse manifest.");e.sdxErrorCode=OSF.ErrorStatusCodes.WAC_AgaveManifestRequestFailure;throw e}OSF.OsfManifestManager.cacheManifest(C.AssetId,f,d);return d}).then(function(e){A.stopActivity(a.Activity.ServerCall);A.stopActivity(a.Activity.ManifestRequest);var d=b.GetManifestCdnUrl(D.sdxCdnUrl,C);b.UpdateManifestIconUrl(e,d,D.appUILocale);q[m]=JSON.stringify(b.PrefetchedAssetSet);q[p]=JSON.stringify(b.SdxPreloadStart);q[l]=Date.now()-performance.now();F.load({entitlement:E,manifest:e,eToken:f,manifestUrl:d},c)},function(e){q[v]=e.toString();q[m]=JSON.stringify(b.PrefetchedAssetSet);q[p]=JSON.stringify(b.SdxPreloadStart);q[l]=Date.now()-performance.now();a.SDXCatalog.recordActivationActivity(d,q);Telemetry.RuntimeTelemetryHelper.LogExceptionTag(w+E.assetId,e,c,39068003);if(e.sdxErrorCode!=c){var g=a.HostFeatureEnabledInfo.getHostFeatureEnabledInfo(),f=g&&g.enableFirstPartySDXErrorMessages;a.LoaderUtil.failWithError(F,{title:f?Strings.OsfRuntime.L_AgaveErrorTile_TXT_FirstParty:Strings.OsfRuntime.L_AgaveErrorTile_TXT,description:f?Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR_FirstParty:Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR,buttonTxt:Strings.OsfRuntime.L_RetryButton_TXT,buttonCallback:function(){F.restartActivation();b.activateAsync(E,F,A,I,G,q)},errorCode:e.sdxErrorCode})}})};b.LogSDXCatalogMonitoringError=function(a,b){Telemetry.RuntimeTelemetryHelper.LogExceptionTag(w+b+" Message: "+a,c,c,594350788)};b.appName="Unknown";b.wacCdnRssUrl=f;b.PrefetchedAssetSet={};b.OfficeJsEntryRegex=/^(office(\.debug)?\.js)@(1|1\.0|1\.1|beta)$/i;b.SdxPreloadStart={};b.requestIdleCallback=window[z]?window[z].bind(window):a.AsyncUtil.limitRate(function(a){return a()},50);return b}();a.SDXCatalog=b})(OfficeExt||(OfficeExt={}));var OfficeExt;(function(b){var d=false,a=null,c=true,e=function(){function e(a,b){this._initParam=b;this._cacheManager=a.cacheManager;this._telemetryContext=a.telemetryContext}e.prototype.getManifest=function(k,e,f,j){var g=this,h=g;g._telemetryContext.startActivity(b.Activity.ManifestRequest);var i=OSF.OsfManifestManager.getCachedManifest(e.OfficeExtensionID,e.OfficeExtensionVersion);if(i){g._telemetryContext.stopActivity(b.Activity.ManifestRequest);g._telemetryContext.stopActivity(b.Activity.ServerCall);f({status:b.DataServiceResultCode.Succeeded,value:{manifest:i,cached:c}});return}else if(e.EncodedAbsUrl)k.getManifest(e.EncodedAbsUrl,e.OfficeExtensionID,e.OfficeExtensionVersion,function(c){h._telemetryContext.stopActivity(b.Activity.ManifestRequest);h._telemetryContext.stopActivity(b.Activity.ServerCall);if(c.status!=b.DataServiceResultCode.Succeeded){f({status:c.status,value:{manifest:a,cached:d}});return}var e=b.ManifestUtil.ParseManifest(c.value.manifest,h._initParam.appUILocale,h._telemetryContext.correlationId);if(e==a)c.status=b.DataServiceResultCode.Failed;f({status:c.status,value:{manifest:e,cached:d}})},j);else f({status:b.DataServiceResultCode.Failed,value:{manifest:a,cached:d}})};e.prototype.activate=function(l,f,e){var g=this,i={assetId:f.assetId,appVersion:f.appVersion,storeId:f.storeId,storeType:f.storeType,targetType:f.targetType},h,m=function(l,r){var h=l.manifest,n=h.getMarketplaceVersion();OSF.OsfManifestManager.cacheManifest(f.assetId,f.appVersion,h);if(l.cached)if(b.ManifestUtil.versionLessThan(n,f.appVersion)){j(c);return}if(h.requirementsSupported===d||h.requirementsSupported===undefined&&!e.getRequirementsChecker().isManifestSupported(h)){h.requirementsSupported=d;var m,s,t=a;m=Strings.OsfRuntime.L_AgaveManifestRequirementsError_ERR||Strings.OsfRuntime.L_AgaveManifestError_ERR;b.LoaderUtil.failWithError(e,{description:m,detailView:c,errorCode:OSF.ErrorStatusCodes.WAC_AgaveRequirementsError});return}h.requirementsSupported=c;if(r&&!e.skipTrust(f)){var k=OSF.OUtil.formatString(OSF.Constants.ActivatedCacheKey,f.assetId.toLowerCase(),f.storeType,f.storeId),q=function(){g._cacheManager.SetCacheItem(k,c);e.load({entitlement:i,manifest:h,eToken:a},a)},p=OSF.OmexClientNames[g._initParam.applicationName],o=g._cacheManager.GetCacheItem(k,d);if(!o&&!e.hasConsent(f)&&!e.isForCustomFunctionSandbox()){e.askForTrust({anonymous:a,clientName:p,entitlement:i,displayName:h.getDefaultDisplayName(),providerName:h.getProviderName(),iconUrl:h.getDefaultIconUrl(),isSSOAddin:h.isSSOAddin()},q);return}}e.hasConsent(f)&&g._cacheManager.SetCacheItem(k,c);e.load({entitlement:i,manifest:h,eToken:a},a)},k=function(a){g.getManifest(l,h,function(d){if(d.status===b.DataServiceResultCode.Succeeded&&d.value.manifest)m(d.value,c);else{b.LoaderUtil.failWithError(e,{description:Strings.OsfRuntime.L_AgaveManifestRetrieve_ERR,buttonTxt:Strings.OsfRuntime.L_RetryButton_TXT,buttonCallback:function(){e.restartActivation();k(a)},errorCode:OSF.ErrorStatusCodes.E_MANIFEST_SERVER_UNAVAILABLE});return}},a)},n=function(a){if(!h){b.LoaderUtil.failWithError(e,{description:Strings.OsfRuntime.L_AgaveNotExist_ERR,buttonTxt:Strings.OsfRuntime.L_RetryButton_TXT,buttonCallback:function(){e.restartActivation();g._telemetryContext.startActivity(b.Activity.Activation);g._telemetryContext.startActivity(b.Activity.ServerCall);j(c)},errorCode:OSF.ErrorStatusCodes.E_MANIFEST_DOES_NOT_EXIST});return}if(h.OfficeExtensionKillbit){b.LoaderUtil.failWithError(e,{description:Strings.OsfRuntime.L_AgaveDisabledByAdmin_ERR,errorCode:OSF.ErrorStatusCodes.E_OEM_EXTENSION_KILLED});return}k(a)},j=function(c){h=a;g._telemetryContext.startActivity(b.Activity.EntitlementCheck);l.getEntitlementAsync(d,f.targetType,function(m){if(m.status!=b.DataServiceResultCode.Succeeded){b.LoaderUtil.failWithError(e,{description:OSF.OUtil.formatString(Strings.OsfRuntime.L_AgaveServerConnectionToCatalogFailed_ERR,Strings.OsfRuntime.L_AgaveMyOrganizationCatalogName),buttonTxt:Strings.OsfRuntime.L_RetryButton_TXT,buttonCallback:function(){e.restartActivation();g._telemetryContext.startActivity(b.Activity.Activation);g._telemetryContext.startActivity(b.Activity.ServerCall);j()},errorCode:OSF.ErrorStatusCodes.E_MANIFEST_SERVER_UNAVAILABLE});return}g._telemetryContext.stopActivity(b.Activity.EntitlementCheck);for(var f=a,l=m.value.entitlements,d,k=0;k<l.length;k++){d=l[k];if(d.OfficeExtensionID&&i.assetId&&d.OfficeExtensionID.toLowerCase()==i.assetId.toLowerCase())if(!f||b.ManifestUtil.versionLessThan(f.OfficeExtensionVersion,d.OfficeExtensionVersion))f=d}h=f;n(c)},c)};j()};return e}(),f=function(){function f(e,d){var c=this;if(d===void 0)d=a;c._appDataService={};c._catalogUrlDataService={};c._initParam=e;c._cacheManager=d||new b.AppsDataCacheManager(OSF.OUtil.getLocalStorage(),new b.SafeSerializer)}f.prototype.getDataService=function(b,a,c){this.getDataServiceInternal(this._appDataService,b,a,c)};f.prototype.getCatalogUrlDataService=function(b,a,c){this.getDataServiceInternal(this._catalogUrlDataService,b,a,c)};f.prototype.getDataServiceInternal=function(d,c,f,g){if(d[c]==a)d[c]={spCatalogService:a,spCatalogServiceReady:a};if(d[c].spCatalogService!=a){g({status:b.DataServiceResultCode.Succeeded,value:d[c].spCatalogService});return}if(d[c].spCatalogServiceReady!=a){var j=d[c].spCatalogServiceReady;d[c].spCatalogServiceReady=function(a){j(a);g(a)};return}else d[c].spCatalogServiceReady=g;var e={status:b.DataServiceResultCode.Failed,value:a},i=function(g,f){var h=d[c].spCatalogServiceReady;d[c].spCatalogServiceReady=a;if(g.status==b.DataServiceResultCode.Succeeded){d[c].spCatalogService=f;e.value=f;e.status=b.DataServiceResultCode.Succeeded;h(e)}else{e.httpStatus=g.httpStatus;h(e)}};f.startActivity(b.Activity.Authentication);var h=b.SPCatalogProxyBasedCatalogService.getInstance(this._initParam);h.prepareProxy(c,f.correlationId,function(a){f.stopActivity(b.Activity.Authentication);i(a,h)})};f.prototype.createActivityScope=function(d,a,c){var f=this;this.getDataService(d,a,function(h){if(b.AsyncUtil.failed(h,c))return;var k=h.value,g={cacheManager:f._cacheManager,storeId:d,telemetryContext:a},i=k.createScope(g),j=new e(g,f._initParam);c({status:b.DataServiceResultCode.Succeeded,value:{serviceScope:i,activityScope:j}})})};f.prototype.getEntitlementAsync=function(h,g,c,i,j,d){var e=this;d=d||this.myOrgCatalogUrl||a;var f=function(d){if(d.status!==b.DataServiceResultCode.Succeeded){c({status:d.status,value:a});return}e.myOrgCatalogUrl=d.value;e.createActivityScope(d.value,g,function(d){if(b.AsyncUtil.failed(d,c,[]))return;var f=d.value.serviceScope;f.getEntitlementAsync(h,a,function(d){if(b.AsyncUtil.failed(d,c,[]))return;for(var f=d.value.entitlements,g=0;g<f.length;g++){var a=f[g];a.assetId=a.OfficeExtensionID;a.appVersion=a.OfficeExtensionVersion;a.storeId=e.myOrgCatalogUrl;a.storeType=OSF.StoreType.SPCatalog;a.targetType=OSF.OfficeAppType[a.OEType]}c({status:d.status,value:f})},i)})};if(!d)this.getSPCatalogUrl(g,f);else f({status:b.DataServiceResultCode.Succeeded,value:d})};f.prototype.getAndCacheManifest=function(f,j,g,e){var h=this,i=function(i){OSF.OUtil.writeProfilerMark(OSF.OsfOfficeExtensionManagerPerfMarker.GetEntitlementEnd);if(i.status===b.DataServiceResultCode.Succeeded&&i.value){for(var k=i.value,l=k.length,c=a,j=0;j<l;j++){var d=k[j];if(d.OfficeExtensionID&&f.assetId&&d.OfficeExtensionID.toLowerCase()===f.assetId.toLowerCase())if(!c||OSF.OsfManifestManager.versionLessThan(c.OfficeExtensionVersion,d.OfficeExtensionVersion))c=d}if(c!=a)h.createActivityScope(h.myOrgCatalogUrl,g,function(a){if(b.AsyncUtil.failed(a,e))return;var d=a.value.activityScope;d.getManifest(a.value.serviceScope,c,function(a){e({status:a.status,value:a.value.manifest})})});else e({status:b.DataServiceResultCode.Failed,value:a})}else e({status:b.DataServiceResultCode.Failed,value:a})};this.getEntitlementAsync(c,g,i,d,0,f.storeId)};f.prototype.isUpnMatchAsync=function(e,a,d){var c=this;this.getCatalogUrlDataService(this._initParam.spBaseUrl,a,function(){var f=b.SPCatalogProxyBasedCatalogService.getInstance(c._initParam);f.isUpnMatchAsync(e,c._initParam.spBaseUrl,a.correlationId,d)})};f.prototype.activateAsync=function(d,c,a){var e=this;a.startActivity(b.Activity.Activation);a.startActivity(b.Activity.ServerCall);this.createActivityScope(d.storeId,a,function(f){if(f.status!=b.DataServiceResultCode.Succeeded){b.LoaderUtil.failWithError(c,{description:OSF.OUtil.formatString(Strings.OsfRuntime.L_AgaveServerConnectionToCatalogFailed_ERR,Strings.OsfRuntime.L_AgaveMyOrganizationCatalogName),buttonTxt:Strings.OsfRuntime.L_RetryButton_TXT,buttonCallback:function(){c.restartActivation();e.activateAsync(d,c,a)},errorCode:OSF.ErrorStatusCodes.WAC_AgaveAnonymousProxyCreationError});return}var g=f.value.serviceScope,h=f.value.activityScope;h.activate(g,d,c)})};f.prototype.removeAsync=function(d,c,a){a({status:b.DataServiceResultCode.Failed})};f.prototype.getAppDetails=function(e,d,c,a){a({status:b.DataServiceResultCode.Failed})};f.prototype.getSPCatalogUrl=function(a,d){var c=this;this.getCatalogUrlDataService(this._initParam.spBaseUrl,a,function(){var e=b.SPCatalogProxyBasedCatalogService.getInstance(c._initParam);e.getSPCatalogUrl(c._initParam.spBaseUrl,a.correlationId,d)})};return f}();b.CatalogFactory.register(OSF.StoreType.SPCatalog,function(a){var b=new f({applicationName:OSF.HostCapability[a.hostType],AppVersion:a.appVersion,clientMode:a.clientMode,appUILocale:a.appUILocale,spBaseUrl:a.spBaseUrl,docUrl:a.docUrl});return b})})(OfficeExt||(OfficeExt={}));var OfficeExt;(function(b){var a=function(){function a(){}a.CheckProxyIsReady="OEM_isProxyReady";a.GetEntitlementSummary="OEM_getEntitlementSummaryAsync";a.GetManifest="OEM_getManifestAsync";a.GetSPCatalogUrl="OEM_getSPCatalogUrlAsync";a.IsUpnMatch="OEM_isUpnMatchAsync";return a}();b.SPCatalogProxyMethods=a;var c=function(){function a(){this.iframeProxies={};this.iframeProxyCount=0}a.iframeNamePrefix="__officeExtensionProxy";return a}();b.IframeProxyGroup=c;var d=function(f){var d=null;__extends(e,f);function e(b,a){f.call(this);this.proxyUrl=b;this.iframeProxyGroup=a}e.prototype.getEntitlementsAsync=function(c,b){this.invokeProxyCommandAsync(a.GetEntitlementSummary,c,b)};e.prototype.getManifestAsync=function(c,b){this.invokeProxyCommandAsync(a.GetManifest,c,b)};e.prototype.getSPCatalogUrlAsync=function(c,b){this.invokeProxyCommandAsync(a.GetSPCatalogUrl,c,b)};e.prototype.isUpnMatchAsync=function(c,b){this.invokeProxyCommandAsync(a.IsUpnMatch,c,b)};e.prototype.prepareProxy=function(b,c){var a=this;if(a.isReady)b({status:d,value:{clientEndpoint:a.clientEndPoint}});else if(!a.clientEndPoint)a.createProxy(b,c);else a.pendingCallbacks.push([b,c])};e.resetProxy=function(a){delete a.iframeProxyGroup.iframeProxies[a.proxyUrl];a.iframeProxyGroup.iframeProxyCount=a.iframeProxyGroup.iframeProxyCount-1;Microsoft.Office.Common.XdmCommunicationManager.getClientEndPoint(a.conversationId)&&Microsoft.Office.Common.XdmCommunicationManager.deleteClientEndPoint(a.conversationId);if(a.iframe){OSF.OUtil.removeEventListener(a.iframe,"load",a.iframeOnload);a.iframe.parentNode.removeChild(a.iframe);a.iframe=d}a.clientEndPoint=d};e.prototype.createProxy=function(p,k){var f=this;try{if(!f.doesUrlHaveSupportedProtocol(f.proxyUrl)){k({status:d,value:{errorMessage:"Protocal of proxyUrl is not supported."}});return}f.iframeProxyGroup.iframeProxies[f.proxyUrl]=f;f.iframeProxyGroup.iframeProxyCount=f.iframeProxyGroup.iframeProxyCount+1;var j=f.proxyUrl,n=j.length;if(j.charAt(n-1)==="/")j=j.substr(0,n-1);var g=document.createElement("iframe"),l=c.iframeNamePrefix+f.iframeProxyGroup.iframeProxyCount;g.setAttribute("id",l);g.setAttribute("name",l);var i=j+"/_layouts/15/OfficeExtensionManager.aspx?"+f.conversationId,q=window.location.origin;i=OSF.OUtil.addXdmInfoAsHash(i,f.conversationId+"|"+l+"|"+q);i=OSF.OUtil.addSerializerVersionAsHash(i,OSF.SerializerVersion.Browser);i=OSF.OUtil.addFlightsAsHash(i,JSON.stringify(OSF.Flights));g.setAttribute("scrolling","auto");g.setAttribute("border","0");g.setAttribute("width","0");g.setAttribute("height","0");g.setAttribute("style","position: absolute; left: -100px; top:0px;");var h=f;document.body.appendChild(g);var m=function(){var c=function(c,i){var a=d;if(c===0&&i.status){h.isReady=true;a={status:d,value:{clientEndpoint:h.clientEndPoint}}}else{e.resetProxy(h);a={status:d,value:{errorMessage:"isProxyReadyCallback failed, error code "+c}}}for(var g=h.pendingCallbacks.length,f=0;f<g;f++){var b=h.pendingCallbacks.shift();if(h.isReady)b[0](a);else b[1](a)}};h.clientEndPoint=Microsoft.Office.Common.XdmCommunicationManager.connect(h.conversationId,g.contentWindow,h.proxyUrl);if(h.clientEndPoint)h.clientEndPoint.invoke(a.CheckProxyIsReady,c,{__timeout__:2e3});else{var b="Unexpected error, iframe loaded again after failing OEM_isProxyReady";Telemetry.RuntimeTelemetryHelper.LogExceptionTag(b,d,d,18657365);k({status:d,value:{errorMessage:b}})}};OSF.OUtil.addEventListener(g,"load",m);g.setAttribute("src",i);f.iframeOnload=m;f.pendingCallbacks.push([p,k]);f.iframe=g}catch(o){var r="Error creating client endpoint with proxyUrl = ["+f.proxyUrl+"], msg:"+b.WACUtils.serializeObjectToString(o);k({status:d,value:{errorMessage:r}})}};return e}(b.ProxyBase);b.SPCatalogProxy=d})(OfficeExt||(OfficeExt={}));var OfficeExt;(function(b){var c="webUrl",a=null,e=function(){function e(a){this.proxyRetries={};this.initParams=a;this.iframeProxyGroup=new b.IframeProxyGroup}e.getInstance=function(b){if(e._instance==a)e._instance=new e(b);return e._instance};e.prototype.prepareProxy=function(d,c,f){c=c||"";var e=function(c){var d=c&&c.status!=a?c.status:b.DataServiceResultCode.ProxyNotReady;f({status:c.status})};this.proxyRetries[d]=1;this.ensureSPCatalogProxySetUp(d,c,e)};e.prototype.createScope=function(a){return new d(a,this)};e.prototype.getSPCatalogUrl=function(d,e,f){var h=this,g=function(){var i;if(!d){Telemetry.RuntimeTelemetryHelper.LogExceptionTag("getspcatalogurl proxy URL empty",a,e,595190872);f({status:b.DataServiceResultCode.PrxoyUrlEmpty})}else if(i=h.iframeProxyGroup.iframeProxies[d]){var g={};g[c]=d;i.getSPCatalogUrlAsync(g,function(d){var c="getspcatalogurl failed";if(d.status!==b.DataServiceResultCode.Succeeded){Telemetry.RuntimeTelemetryHelper.LogExceptionTag(c,a,e,19015125);OsfMsAjaxFactory.msAjaxDebug.trace(c)}f(d)})}else{Telemetry.RuntimeTelemetryHelper.LogExceptionTag(OSF.OUtil.formatString("getspcatalogurl proxy not found, webUrl: {0}",d),a,e,19969545);f({status:b.DataServiceResultCode.ProxyNotReady})}};this.prepareProxy(d,e,g)};e.prototype.isUpnMatchAsync=function(h,d,e,f){var i=this,g=function(){var j;if(!d){Telemetry.RuntimeTelemetryHelper.LogExceptionTag("isUpnMatchAsync proxy URL empty",a,e,588814301);f({status:b.DataServiceResultCode.PrxoyUrlEmpty})}else if(j=i.iframeProxyGroup.iframeProxies[d]){var g={};g["upn"]=h;g[c]=d;j.isUpnMatchAsync(g,function(d){var c="isUpnMatchAsync failed";if(d.status!==b.DataServiceResultCode.Succeeded){Telemetry.RuntimeTelemetryHelper.LogExceptionTag(c,a,e,588814302);OsfMsAjaxFactory.msAjaxDebug.trace(c)}f(d)})}else{Telemetry.RuntimeTelemetryHelper.LogExceptionTag(OSF.OUtil.formatString("isUpnMatchAsync proxy not found, webUrl: {0}",d),a,e,588814303);f({status:b.DataServiceResultCode.ProxyNotReady})}};this.prepareProxy(d,e,g)};e.prototype.ensureSPCatalogProxySetUp=function(c,h,e){if(!c){Telemetry.RuntimeTelemetryHelper.LogExceptionTag("proxyUrl is null",a,h,19969546);e({status:b.DataServiceResultCode.Failed});return}var d=this.iframeProxyGroup.iframeProxies[c];if(!d)d=new b.SPCatalogProxy(c,this.iframeProxyGroup);if(d.isReady){e({status:b.DataServiceResultCode.Succeeded});return}var i=this,f=function(){e({status:b.DataServiceResultCode.Succeeded})},g=function(){if(i.proxyRetries[c]<OSF.Constants.AuthenticatedConnectMaxTries){i.proxyRetries[c]++;d.prepareProxy(f,g)}else{Telemetry.RuntimeTelemetryHelper.LogExceptionTag("sp exceed maximum tries and fail",a,h,18940555);e({status:b.DataServiceResultCode.ProxyNotReady})}};d.prepareProxy(f,g)};return e}();b.SPCatalogProxyBasedCatalogService=e;var d=function(){var e="clearCache";function d(a,b){this._catalogService=b;this.proxyUrl=a.storeId;this._correlationId=a.telemetryContext.correlationId||""}d.prototype.tryFail=function(a,d,c){if(a!=b.DataServiceResultCode.Succeeded){c({status:a});return true}else return false};d.prototype.getEntitlementAsync=function(j,g,d,h){var b=this,f=b,i=b._catalogService.iframeProxyGroup.iframeProxies[b.proxyUrl],a={};a[c]=b.proxyUrl;a["applicationName"]=b._catalogService.initParams.applicationName;a["officeExtentionTarget"]=g;a[e]=h||false;a["supportedManifestVersions"]={"1.0":true,"1.1":true};i.getEntitlementsAsync(a,function(a){if(f.tryFail(a.status,a.httpStatus,d)){f.logServiceCallResponseError("entitlement",a.httpStatus);return}d(a)})};d.prototype.getLastStoreUpdate=function(){};d.prototype.getManifest=function(d,i,g,b,f){var c=this,h=this._catalogService.iframeProxyGroup.iframeProxies[this.proxyUrl],a={};a["manifestUrl"]=d;a["id"]=i;a["version"]=g;a[e]=f;h.getManifestAsync(a,function(a){if(c.tryFail(a.status,a.httpStatus,b)){c.logServiceCallResponseError("manifest",a.httpStatus);return}b(a)})};d.prototype.isUpnMatchAsync=function(f,d){var a=this,e=a,g=a._catalogService.iframeProxyGroup.iframeProxies[a.proxyUrl],b={};b["upn"]=f;b[c]=a.proxyUrl;g.isUpnMatchAsync(b,function(a){if(e.tryFail(a.status,a.httpStatus,d)){e.logServiceCallResponseError("isUpnMatch",a.httpStatus);return}d(a)})};d.prototype.logServiceCallResponseError=function(d,b){var c="spproxy request "+d+" failed";if(b)c+=":"+b;Telemetry.RuntimeTelemetryHelper.LogExceptionTag(c,a,this._correlationId,18940556)};return d}();b.SPCatalogProxyBasedCatalogServiceScope=d})(OfficeExt||(OfficeExt={}));OSF.InfoType={Error:0,Warning:1,Information:2,SecurityInfo:3};OSF.NotificationType={TrustYellowBar:0,TrustPromptTaskpane:3,TrustPromptContent:4};OSF.OmexMessageType={TabExit:1,ButtonClick:2,PageLoad:3};OSF._ErrorUXHelper=function(Bb){var M="progress_",mb="input,a,button",lb="moe-infobar-button2_",f=true,kb="moe-infobar-button_",A="moe-infobar-button",e=false,d="button",jb="moe-infobar-dismiss_",ib="moe-infobar-dismiss",hb="moe-infobar-message",gb="moe-infobar-message_",fb="moe-infobar-title",z="span",eb="moe-infobar-message-div",db="moe-infobar-secinfo",cb="moe-infobar-info",bb="moe-infobar-warning",ab="moe-infobar-error",Z="moe-infobar-button-cell",Y="moe-infobar-top-right-cell",X="moe-infobar-message-cell",W="moe-infobar-top-left-cell",k="presentation",i="role",V="moe-infobar-infotable",E="table",U="moe-infobar-body",s="alt",c=null,m="100%",y="center",x="no-repeat",w="alpha(opacity=100)",l="1",L="white",v="url(",r="onclick",q="tabindex",K="image",u="type",J="input",h="id",t="moe-background",a="class",g="div",Q="moe-trust-prompt-table_",I="notificationbackground_",H="moe-infobar-body_",D="agavedefaulticon96x96.png",o="moe_status_icons.png",nb="progress.gif",n="img",b=Bb,T=b.getOsfOmexBaseUrl(),pb="omexNotificationIframeClassName";OSF.OUtil.loadCSS(b.getLocalizedCSSFilePath("moeerrorux.css"));var Hb=document.createElement(n);Hb.src=b.getLocalizedImageFilePath(nb);var Fb=document.createElement(n);Fb.src=b.getLocalizedImageFilePath(o);var Eb=document.createElement(n);Eb.src=b.getLocalizedImageFilePath(D);var j={},R=0,N=function(a){var d=a.childNodes.length,c=0,b;while(c<d){b=a.childNodes.item(c);if(b.tagName.toLowerCase()==="iframe")c++;else{a.removeChild(b);d--}}},S=function(b){var a=document.getElementById(b);a&&a.parentNode.removeChild(a)},Ib=function(a){OSF.OUtil.writeProfilerMark(OSF.NotificationUxPerfMarker.RemoveStage1Start);S("icon_"+a);OSF.OUtil.writeProfilerMark(OSF.NotificationUxPerfMarker.RemoveStage1End)},G=function(a,d){OSF.OUtil.writeProfilerMark(OSF.NotificationUxPerfMarker.RemoveStage2Start);var b;if(d)b=H+a;else b=I+a;var c=C(a);if(c&&j[a][0].highPriority)R--;S(b);c&&j[a].shift();OSF.OUtil.writeProfilerMark(OSF.NotificationUxPerfMarker.RemoveStage2End)},qb=function(a){OSF.OUtil.writeProfilerMark(OSF.NotificationUxPerfMarker.RemoveStage2Start);var c=Q+a.id,b=C(a.id);if(b&&j[a.id][0].highPriority)R--;S(c);b&&j[a.id].shift();OSF.OUtil.writeProfilerMark(OSF.NotificationUxPerfMarker.RemoveStage2End)},wb=function(d){OSF.OUtil.writeProfilerMark(OSF.NotificationUxPerfMarker.RenderStage1Start);N(d.div);var e=document.createElement(g);e.setAttribute(a,t);e.setAttribute(h,"icon_"+d.id);var f=document.createElement(J);f.setAttribute(h,"iconImg_"+d.id);f.setAttribute(u,K);f.setAttribute(q,"0");f.src=b.getLocalizedImageFilePath(o);var n=function(a){a.sqmDWords[1]|=2;p(a.id);var b=OfficeExt.HostFeatureEnabledInfo.getHostFeatureEnabledInfo();if(b&&b.enableSingleSignOnForAddin)rb(a);else vb(a)};f.setAttribute(r,"getIntoStage2(params)");OSF.OUtil.attachClickHandler(f,function(){n(d)});e.appendChild(f);if(d.displayDeactive){e.style.backgroundImage=v+b.getLocalizedImageFilePath(D)+")";e.style.backgroundColor=L;e.style.opacity=l;e.style.filter=w;e.style.backgroundRepeat=x;e.style.backgroundPosition=y;e.style.height=m}var i,k,j;if(d.infoType===OSF.InfoType.Error){i="moe-status-error-icon";k="iconImg_error_"+d.id;j=Strings.OsfRuntime.L_InfobarIconErrorAccessibleName_TXT}else if(d.infoType===OSF.InfoType.Warning){i="moe-status-warning-icon";k="iconImg_warning_"+d.id;j=Strings.OsfRuntime.L_InfobarIconWarningAccessibleName_TXT}else if(d.infoType===OSF.InfoType.Information){i="moe-status-info-icon";k="iconImg_info_"+d.id;j=Strings.OsfRuntime.L_InfobarIconInfoAccessibleName_TXT}else{i="moe-status-secinfo-icon";k="iconImg_secinfo_"+d.id;j=Strings.OsfRuntime.L_InfobarIconSecInfoAccessibleName_TXT}var z=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");if(z.exec(navigator.userAgent)!=c&&parseFloat(RegExp.$1)==9)i+="_ie";f.setAttribute(a,i);f.setAttribute(h,k);f.setAttribute(s,j);if(d.div.childNodes.length!=0)d.div.insertBefore(e,d.div.childNodes[0]);else d.div.appendChild(e);O(d.id,OSF.AgaveHostAction.TabIn);OSF.OUtil.writeProfilerMark(OSF.NotificationUxPerfMarker.RenderStage1End)},vb=function(j){OSF.OUtil.writeProfilerMark(OSF.NotificationUxPerfMarker.RenderStage2Start);N(j.div);var Bb=j.description;if(j.title.length>100)j.title=j.title.substring(0,99);if(j.description.length>255)j.description=j.description.substring(0,254);var xb=H+j.id,S=document.getElementById(xb);if(S==undefined){S=document.createElement(g);S.setAttribute(a,U);S.setAttribute(h,xb)}var sb=document.createElement(g);sb.innerHTML=Bb;S.setAttribute("title",sb.textContent);sb=c;var nb=document.createElement(E);nb.setAttribute(a,V);nb.setAttribute(i,k);for(var yb,ub=0;ub<3;ub++){yb=nb.insertRow(ub);yb.setAttribute(i,k)}var C=nb.rows;C[0].insertCell(0);C[0].insertCell(1);C[0].insertCell(2);C[0].cells[1].setAttribute("rowSpan","2");C[1].insertCell(0);C[1].insertCell(1);C[2].insertCell(0);C[2].insertCell(1);C[2].insertCell(2);C[0].cells[0].setAttribute(a,W);C[0].cells[1].setAttribute(a,X);C[0].cells[2].setAttribute(a,Y);C[2].cells[1].setAttribute(a,Z);var qb=document.createElement(n);qb.src=b.getLocalizedImageFilePath(o);var mb,ob;if(j.infoType===OSF.InfoType.Error){mb=ab;ob=Strings.OsfRuntime.L_InfobarIconErrorAccessibleName_TXT}else if(j.infoType===OSF.InfoType.Warning){mb=bb;ob=Strings.OsfRuntime.L_InfobarIconWarningAccessibleName_TXT}else if(j.infoType===OSF.InfoType.Information){mb=cb;ob=Strings.OsfRuntime.L_InfobarIconInfoAccessibleName_TXT}else{mb=db;ob=Strings.OsfRuntime.L_InfobarIconSecInfoAccessibleName_TXT}qb.setAttribute(a,mb);qb.setAttribute(s,ob);C[0].cells[0].appendChild(qb);var pb=document.createElement("a");pb.setAttribute(a,eb);pb.setAttribute(q,l);var tb=document.createElement(z);tb.setAttribute(a,fb);tb.innerHTML=j.title;var vb=gb+j.id,T=document.getElementById(vb);if(T==undefined){T=document.createElement(z);T.setAttribute(a,hb);T.setAttribute(h,vb)}T.innerHTML=j.description;pb.appendChild(tb);pb.appendChild(T);C[0].cells[1].appendChild(pb);var rb=function(a){var c=b.getOsfControl(a.id);Telemetry.AppNotificationHelper.LogNotification(c._appCorrelationId,a.sqmDWords[0],a.sqmDWords[1])},wb=function(){j.sqmDWords[1]|=8;rb(j);!j.reDisplay&&G(j.id,j.displayDeactive);p(j.id);if(j.reDisplay)P(j);else B(j.id);j.dismissCallback&&j.dismissCallback()},M=document.createElement(J);M.setAttribute(u,K);M.setAttribute("src",b.getLocalizedImageFilePath(o));M.setAttribute(a,ib);M.setAttribute(h,jb+j.id);M.setAttribute(q,"0");M.setAttribute(s,Strings.OsfRuntime.L_InfobarIconCloseButtonAccessibleName_TXT);M.setAttribute(i,d);M.setAttribute(r,"handleDismiss();");OSF.OUtil.attachClickHandler(M,wb);C[0].cells[2].appendChild(M);j.detailView=e;var Q=document.createElement(d);Q.setAttribute(a,A);Q.innerHTML=j.buttonTxt;Q.setAttribute(h,kb+j.id);Q.setAttribute(q,l);Q.setAttribute(u,d);if(j.buttonCallback){var Ab=function(){j.sqmDWords[1]|=4;rb(j);G(j.id,e);p(j.id);B(j.id);if(j.retryAll===f){var a=b.getOsfControl(j.id);a._retryActivate=c;b.retryAll(a._marketplaceID)}j.buttonCallback()};Q.setAttribute(r,"handleButtonClick()");OSF.OUtil.attachClickHandler(Q,Ab)}else{Q.setAttribute(r,"handleDismiss()");OSF.OUtil.attachClickHandler(Q,wb)}C[2].cells[1].appendChild(Q);if(j.url){var zb=function(){j.sqmDWords[1]|=4;rb(j);j.sqmDWords[1]=1;window.open(j.url)},R=document.createElement(d);R.setAttribute(a,A);R.innerHTML=j.urlButtonTxt?j.urlButtonTxt:Strings.OsfRuntime.L_MoreInfoButton_TXT;R.setAttribute(h,lb+j.id);R.setAttribute(r,"moreInfoButtonClick()");OSF.OUtil.attachClickHandler(R,zb);R.setAttribute(q,l);R.setAttribute(u,d);C[2].cells[1].appendChild(R)}S.appendChild(nb);var F=document.createElement(g);F.setAttribute(a,t);F.setAttribute(h,I+j.id);if(j.displayDeactive){F.style.backgroundImage=v+b.getLocalizedImageFilePath(D)+")";F.style.backgroundColor=L;F.style.opacity=l;F.style.filter=w;F.style.backgroundRepeat=x;F.style.backgroundPosition=y;F.style.height=m}F.appendChild(S);if(j.div.childNodes.length!=0)j.div.insertBefore(F,j.div.childNodes[0]);else j.div.appendChild(F);O(j.id,OSF.AgaveHostAction.TabIn);OSF.OUtil.writeProfilerMark(OSF.NotificationUxPerfMarker.RenderStage2End)},rb=function(a){OSF.OUtil.writeProfilerMark(OSF.NotificationUxPerfMarker.RenderStage2Start);try{N(a.div);var i=a.description;if(a.title.length>100)a.title=a.title.substring(0,99);if(a.description.length>255)a.description=a.description.substring(0,254);var f=H+a.id,e=document.getElementById(f);if(e==undefined){e=document.createElement(g);e.className=U;e.id=f}e.title=i;if(a.iframeNotificationUrl)e.appendChild(xb(a,e));else e.appendChild(yb(a));var d=document.createElement(g);d.className=t;d.id=I+a.id;if(a.displayDeactive){d.style.backgroundImage=v+b.getLocalizedImageFilePath(D)+")";d.style.backgroundColor=L;d.style.opacity=l;d.style.filter=w;d.style.backgroundRepeat=x;d.style.backgroundPosition=y;d.style.height=m}d.appendChild(e);if(a.div.childNodes.length!=0)a.div.insertBefore(d,a.div.childNodes[0]);else a.div.appendChild(d);O(a.id,OSF.AgaveHostAction.TabIn)}catch(h){Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Failed to show infobar, error message: ",h,c,23455900)}OSF.OUtil.writeProfilerMark(OSF.NotificationUxPerfMarker.RenderStage2End)},zb=function(a){var j="moe-trust-prompt-description-id";function r(f){function b(c,b){var a=c.insertRow(-1);a.className="moe-trust-prompt-row "+b;a.setAttribute(i,k);var d=a.insertCell(-1);d.className="moe-trust-prompt-cell"}var j=f.id,e=Q+f.id,a=document.getElementById(e);if(a===c){a=document.createElement(E);a.id=e;a.className="moe-trust-prompt-table";a.setAttribute(i,k)}var h=a.createTHead();b(h,"moe-trust-prompt-header");var d=a.createTBody();b(d,"moe-trust-prompt-preview");b(d,"moe-trust-prompt-description");var g=a.createTFoot();b(g,"moe-trust-prompt-footer");return a}function u(c){var d=document.createElement(g);d.className="moe-trust-prompt-collapse cui-ctl-iconContainer cui-img-cont-float cui-img-16by16";var a=document.createElement(n);switch(c.clientName){case "WAC_Powerpoint":a.src=b.getLocalizedImageFilePath("per.png");a.className="per_UpChevron_16x16x32";break;case "WAC_Word":a.src=b.getLocalizedImageFilePath("we.png");a.className="we_UpChevron_16x16x32";break;case "WAC_Excel":a.src=b.getLocalizedImageFilePath("EwaEdit.png");a.className="ewaboot_UpChevron16"}a.alt=Strings.OsfRuntime.L_InfobarIconCloseButtonAccessibleName_TXT;var e=function(){var a="collapsed";if(c.collapsed===f)c.div.classList.remove(a);else c.div.classList.add(a);c.collapsed=!c.collapsed};d.appendChild(a);OSF.OUtil.attachClickHandler(d,e);return d}function y(b){var a=document.createElement("p");a.innerHTML=b.notificationType===OSF.NotificationType.TrustPromptContent?b.name:b.title;a.className="moe-trust-prompt-header-title";return a}function A(b){var a=document.createElement(n);a.src=b.icon;a.className="moe-trust-prompt-preview-img";a.setAttribute(s,b.iconTitle);return a}function x(b){var a=document.createElement("p");a.innerHTML=b.name;a.className="moe-trust-prompt-preview-title";return a}function C(b){var a=document.createElement("p");a.innerHTML=b.provider;a.className="moe-trust-prompt-preview-sub";return a}function t(b){var a=document.createElement("p");a.innerHTML=b.description;a.className="moe-trust-prompt-description-text";a.id=j;return a}function w(){var e=document.createElement(d);e.textContent=a.buttonTxt;e.className="moe-trust-prompt-button moe-trust-prompt-button-primary moe-trust-prompt-buttons-action";e.id="moe-trust-prompt-buttons-action_"+a.id;e.tabIndex=0;e.type=d;e.setAttribute("aria-describedby",j);var g;if(a.buttonCallback)g=function(){a.sqmDWords[1]|=4;F(a);qb(a);p(a.id);B(a.id);if(a.retryAll===f){var d=b.getOsfControl(a.id);d._retryActivate=c;b.retryAll(d._marketplaceID)}a.buttonCallback()};else g=function(){a.sqmDWords[1]|=8;F(a);!a.reDisplay&&qb(a);p(a.id);if(a.reDisplay)P(a);else B(a.id);a.dismissCallback&&a.dismissCallback()};OSF.OUtil.attachClickHandler(e,g);return e}function z(b){var a=document.createElement(d);a.textContent=b.urlButtonTxt||Strings.OsfRuntime.L_MoreInfoButton_TXT;a.className="moe-trust-prompt-button moe-trust-prompt-buttons-url";a.id="moe-trust-prompt-buttons-url_"+b.id;a.tabIndex=0;a.type=d;var c=function(){b.sqmDWords[1]|=4;F(b);window.open(b.url)};OSF.OUtil.attachClickHandler(a,c);return a}OSF.OUtil.writeProfilerMark(OSF.NotificationUxPerfMarker.RenderStage2Start);try{N(a.div);var R=0,l=1,G=2,o=3,h=0,m=r(a),e=m.rows,K=y(a);e[R].cells[h].appendChild(K);var L=A(a),J=x(a),M=C(a);e[l].cells[h].appendChild(L);e[l].cells[h].appendChild(J);e[l].cells[h].appendChild(M);var D=t(a);e[G].cells[h].appendChild(D);var v=w(a);e[o].cells[h].appendChild(v);if(a.url!==c){var I=z(a);e[o].cells[h].appendChild(I)}var H=u(a);if(a.div.childNodes.length!=0)a.div.insertBefore(m,a.div.childNodes[0]);else a.div.appendChild(m);a.div.appendChild(H);a.div.style.overflowY="auto";a.div.classList.add("moe-trust-prompt");a.div.classList.add(a.clientName);a.div.classList.add(a.notificationType===OSF.NotificationType.TrustPromptContent?"content-add-in":"taskpane-add-in");O(a.id,OSF.AgaveHostAction.TabIn)}catch(q){Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Failed to show trust prompt, error message: ",q,c,38592974)}OSF.OUtil.writeProfilerMark(OSF.NotificationUxPerfMarker.RenderStage2End)},yb=function(a){var q=ob(a),j=q.rows;j[0].cells[0].appendChild(sb(a));var k=document.createElement("a");k.className=eb;k.tabIndex=1;var l=document.createElement(z);l.className=fb;l.textContent=a.title;var m=gb+a.id,i=document.getElementById(m);if(i==undefined){i=document.createElement(z);i.className=hb;i.id=m}i.textContent=a.description;k.appendChild(l);k.appendChild(i);j[0].cells[1].appendChild(k);var o=function(){ub(a)},n=tb(a);OSF.OUtil.attachClickHandler(n,o);j[0].cells[2].appendChild(n);a.detailView=e;var g=document.createElement(d);g.className=A;g.textContent=a.buttonTxt;g.id=kb+a.id;g.tabIndex=1;g.type=d;if(a.buttonCallback){var s=function(){a.sqmDWords[1]|=4;F(a);G(a.id,e);p(a.id);B(a.id);if(a.retryAll===f){var d=b.getOsfControl(a.id);d._retryActivate=c;b.retryAll(d._marketplaceID)}a.buttonCallback()};OSF.OUtil.attachClickHandler(g,s)}else OSF.OUtil.attachClickHandler(g,o);j[2].cells[1].appendChild(g);if(a.url){var r=function(){a.sqmDWords[1]|=4;F(a);a.sqmDWords[1]=1;window.open(a.url)},h=document.createElement(d);h.className=A;h.textContent=a.urlButtonTxt?a.urlButtonTxt:Strings.OsfRuntime.L_MoreInfoButton_TXT;h.id=lb+a.id;OSF.OUtil.attachClickHandler(h,r);h.tabIndex=1;h.type=d;j[2].cells[1].appendChild(h)}return q},xb=function(a,j){var g="message",n=ob(a),l=n.rows,d=document.createElement("iframe"),q=window.getComputedStyle(a.div,c);d.width=m;d.frameBorder="0";d.className=pb;d.src=a.iframeNotificationUrl;l[0].cells[1].appendChild(d);var k="moe-hovered";j.addEventListener("mouseenter",function(){OSF.OUtil.addClass(j,k);d.contentWindow.postMessage(OSF.AgaveHostAction.MouseEnter,T)});j.addEventListener("mouseleave",function(){OSF.OUtil.removeClass(j,k);d.contentWindow.postMessage(OSF.AgaveHostAction.MouseLeave,T)});a.detailView=e;var h=c,o=function(){ub(a);window.removeEventListener(g,h)},i=tb(a);OSF.OUtil.attachClickHandler(i,o);l[0].cells[2].appendChild(i);i.addEventListener("keydown",function(a){if(a.keyCode==9)if(a.shiftKey){a.preventDefault();a.stopPropagation();d.contentWindow.postMessage(OSF.AgaveHostAction.TabInShift,T)}});if(a.buttonCallback){h=function(n){try{if(n.source==d.contentWindow){var l=JSON.parse(n.data),k=parseInt(l[OSF.OmexMessageKeys.MessageType]),j=parseInt(l[OSF.OmexMessageKeys.MessageValue]);if(k==OSF.OmexMessageType.ConsentResult){G(a.id,e);p(a.id);B(a.id);if(a.retryAll===f&&(a.notificationType==OSF.NotificationType.TrustYellowBar||a.notificationType==OSF.NotificationType.ConsentYellowBar&&j==OSF.ConsentResultCode.Success)){var m=b.getOsfControl(a.id);m._retryActivate=c;b.retryAll(m._marketplaceID)}window.removeEventListener(g,h);a.buttonCallback(j)}else if(k==OSF.OmexMessageType.TabExit)if(j==OSF.AgaveHostAction.TabExitShift&&b._notifyHost)b._notifyHost(a.id,OSF.AgaveHostAction.TabExitShift);else if(j==OSF.AgaveHostAction.TabExit){window.focus();i.focus()}}}catch(o){Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Exception in receivedMessageHandler: ",o,c,23455901)}};window.addEventListener(g,h)}return n},ob=function(e){var d=document.createElement(E);d.className=V;d.setAttribute(i,k);for(var g=e.iframeNotificationUrl?1:3,f=0;f<g;f++){var h=d.insertRow(f);h.setAttribute(i,k)}var b=d.rows;b[0].insertCell(0);b[0].insertCell(1);b[0].insertCell(2);b[0].cells[1].setAttribute("rowSpan","2");b[0].cells[0].setAttribute(a,W);b[0].cells[1].setAttribute(a,X);b[0].cells[2].setAttribute(a,Y);if(e.iframeNotificationUrl==c){b[1].insertCell(0);b[1].insertCell(1);b[2].insertCell(0);b[2].insertCell(1);b[2].insertCell(2);b[2].cells[1].setAttribute(a,Z)}b[0].cells[0].appendChild(sb(e));return d},sb=function(e){var d=document.createElement(n);d.src=b.getLocalizedImageFilePath(o);var a,c;if(e.infoType===OSF.InfoType.Error){a=ab;c=Strings.OsfRuntime.L_InfobarIconErrorAccessibleName_TXT}else if(e.infoType===OSF.InfoType.Warning){a=bb;c=Strings.OsfRuntime.L_InfobarIconWarningAccessibleName_TXT}else if(e.infoType===OSF.InfoType.Information){a=cb;c=Strings.OsfRuntime.L_InfobarIconInfoAccessibleName_TXT}else{a=db;c=Strings.OsfRuntime.L_InfobarIconSecInfoAccessibleName_TXT}d.className=a;d.alt=c;return d},F=function(a){var c=b.getOsfControl(a.id);Telemetry.AppNotificationHelper.LogNotification(c._appCorrelationId,a.sqmDWords[0],a.sqmDWords[1])},ub=function(a){a.sqmDWords[1]|=8;F(a);!a.reDisplay&&G(a.id,a.displayDeactive);p(a.id);if(a.reDisplay)P(a);else B(a.id);a.dismissCallback&&a.dismissCallback()},tb=function(c){var a=document.createElement(J);a.type=K;a.src=b.getLocalizedImageFilePath(o);a.className=ib;a.id=jb+c.id;a.tabIndex=0;a.alt=Strings.OsfRuntime.L_InfobarIconCloseButtonAccessibleName_TXT;a.setAttribute(i,d);return a},p=function(c){var a=b.getOsfControl(c);if(a)a._controlFocus=f},Cb=function(e){var a=b.getOsfControl(e);if(!a)return;if(C(e))return;if(a.getStatus()===OSF.OsfControlStatus.Activated&&a.getPageStatus()===OSF.OsfControlPageStatus.Ready)a.notifyAgave(OSF.AgaveHostAction.TabIn);else{var d="_trySetFocusInAppContent$newCallback";if(a._notifyHostIFrameOnLoaded&&a._notifyHostIFrameOnLoaded.newCallbackIdentity&&a._notifyHostIFrameOnLoaded.newCallbackIdentity===d)return;var c=function(b){return function(){if(b)try{b()}catch(c){}a.getStatus()===OSF.OsfControlStatus.Activated&&a.getPageStatus()===OSF.OsfControlPageStatus.Ready&&a.notifyAgave(OSF.AgaveHostAction.TabIn);a._notifyHostIFrameOnLoaded=b}}(a._notifyHostIFrameOnLoaded);c["newCallbackIdentity"]=d;a._notifyHostIFrameOnLoaded=c}},O=function(d,i){var e=b.getOsfControl(d);if(e)if(e._controlFocus)if(C(d)){var a=j[d][0];if(a&&a.div)if(a.iframeNotificationUrl!=c){var g=a.div.getElementsByClassName(pb)[0];if(g){g.contentWindow.postMessage(OSF.AgaveHostAction.TabIn,T);b._notifyHost&&b._notifyHost(d,OSF.AgaveHostAction.SelectWithError)}}else{var f=a.div.querySelectorAll(mb);if(f&&f.length>0){var h=f[0];if(h instanceof HTMLElement){window.focus();h.focus();b._notifyHost&&b._notifyHost(d,OSF.AgaveHostAction.SelectWithError)}}}}else e.notifyAgave(i)},Ab=function(c,h){var d=b.getOsfControl(c);if(d)if(d._controlFocus)if(C(c)){var f=j[c][0];if(f&&f.div){var a=f.div.querySelectorAll(mb);if(a&&a.length>0){var g=a.length>1?a[1]:a[0];if(g instanceof HTMLElement){window.focus();g.focus();b._notifyHost&&b._notifyHost(c,OSF.AgaveHostAction.SelectWithError)}}}}else{d._controlFocus=e;b._notifyHost(c,h)}},P=function(a){if(a.notificationType===OSF.NotificationType.TrustPromptContent||a.notificationType===OSF.NotificationType.TrustPromptTaskpane){zb(a);return}if(a.detailView==undefined||a.detailView===e){a.sqmDWords[1]=0;wb(a)}else{a.sqmDWords[1]=1;var b=OfficeExt.HostFeatureEnabledInfo.getHostFeatureEnabledInfo(),c=b&&b.enableSingleSignOnForAddin;if(c)rb(a);else vb(a)}},Gb=function(a){if(j[a]){if(j[a].length>0){var b=j[a][0].div;N(b)}delete j[a]}},Db=function(c){var a=document.createElement(g),b=document.createTextNode(c);a.appendChild(b);return a.innerHTML},B=function(a){if(C(a)){var b=j[a][0];P(b)}else Cb(a)},C=function(a){return j[a]&&j[a].length>0};return {showProgress:function(i,e){try{OSF.OUtil.writeProfilerMark(OSF.NotificationUxPerfMarker.RenderLoadingAnimationStart);var f=document.getElementById(M+e);if(!f){j[e]=[];var c=document.createElement(g);c.setAttribute(a,t);c.setAttribute(h,M+e);c.style.backgroundColor="rgba(255, 255, 255, 0.5)";c.style.opacity=l;c.style.filter=w;c.style.height=m;var d=document.createElement(g);d.style.width=m;d.style.height=m;d.style.backgroundImage=v+b.getLocalizedImageFilePath(nb)+")";d.style.backgroundRepeat=x;d.style.backgroundPosition=y;c.appendChild(d);i.appendChild(c)}OSF.OUtil.writeProfilerMark(OSF.NotificationUxPerfMarker.RenderLoadingAnimationEnd)}catch(k){}},showNotification:function(a){a.sqmDWords=[a.errorCode,0];delete a.errorCode;if(a.highPriority==undefined)a.highPriority=a.infoType===OSF.InfoType.Error?f:e;if(a.reDisplay==undefined)a.reDisplay=a.infoType===OSF.InfoType.Error?f:e;var b=j[a.id];if(b===undefined){b=[];j[a.id]=b}if(a.highPriority===e)b.push(a);else{b.splice(R,0,a);R++}(j[a.id].length===1||a.highPriority)&&P(b[0])},showICon:function(a){wb(a)},removeDOMElement:function(a){S(a)},removeProgressDiv:function(a,c){OSF.OUtil.writeProfilerMark(OSF.NotificationUxPerfMarker.RemoveLoadingAnimationStart);var b=a.ownerDocument.getElementById(M+c);b&&N(a);OSF.OUtil.writeProfilerMark(OSF.NotificationUxPerfMarker.RemoveLoadingAnimationEnd)},removeIConDiv:function(a){Ib(a)},removeInfoBarDiv:function(b,a){G(b,a)},dismissMessages:function(a){Gb(a)},getHTMLEncodedString:function(a){return Db(a)},purgeOsfControlNotification:function(c){var a=j[c],d=b.getOsfControl(c);a&&a.length>0&&d&&Telemetry.AppNotificationHelper.LogNotification(c,a[0].sqmDWords[0],a[0].sqmDWords[1])},focusOnNotificationUx:function(a,b){p(a);O(a,b)},focusOnNotificationUxShiftIn:function(a,b){p(a);Ab(a,b)},appHasNotifications:function(a){return C(a)}}};var OfficeExt;(function(a){var c="web",b="default",d;(function(a){a[a[b]=0]=b;a[a[c]=1]=c;a[a["win32"]=2]="win32";a[a["mac"]=3]="mac"})(d||(d={}));var e=function(){var j=false,m="resources.default",l="resources",e="Extended Manifest",h="string",k="^\\$\\{resource\\.([A-Za-z0-9_-]+)\\}$",f=null,i=true;function g(){}g.ensureFinalExtendedOverridesUrls=function(b,d){var c=b.getExtendedOverrides();if(c.hasFinalUrls)return;c.url=a.ExtendedManifestUtility.ensureFinalExtendedOverridesUrl(b.getExtendedOverrides().url,b,d);if(b.getExtendedOverrides().resourcesUrl)c.resourcesUrl=a.ExtendedManifestUtility.ensureFinalExtendedOverridesUrl(b.getExtendedOverrides().resourcesUrl,b,d);c.hasFinalUrls=i};g.ensureFinalExtendedOverridesUrl=function(d,c,a){var b=g.computeUrlTokens(c,a);return g.substituteUrlTokens(d,b)};g.computeUrlTokens=function(e,d){for(var b=e.getExtendedOverridesTokens(),c={},a=0;a<b.length;++a)if(b[a].type==OSF.ExtendedManifestSupportTokens.Requirements)c[b[a].name]=g.computeRequirementsToken(b[a],d);else if(b[a].type==OSF.ExtendedManifestSupportTokens.Locale)c[b[a].name]=g.computeLocaleToken(b[a],d);else c[b[a].name]=b[a].defaultValue;return c};g.computeRequirementsToken=function(e,c){for(var d=e.defaultValue,b=e.overrides,a=0;a<b.length;++a)if(c._requirementsChecker._checkSets(b[a].data.sets)&&c._requirementsChecker._checkMethods(b[a].data.methods))d=b[a].value;return d};g.computeLocaleToken=function(f,g){for(var b=f.defaultValue.toLowerCase(),e=g.getAppUILocale().toLowerCase(),h=e.replace(/-.+/,"-*"),d=f.overrides,c=0;c<d.length;++c){var a=d[c];if(e==a.data){b=a.value;break}else if(h==a.data)b=a.value}return b};g.substituteUrlTokens=function(b,a){return b.replace(new RegExp(OSF.ExtendedManifestSupportTokens.TokenReplaceRegex,"g"),function(d,e,c,b){return g.substituteMatchWithTokenValue(d,e,c,b,a)})};g.downloadContent=function(a){return new Promise(function(c,b){OSF.OUtil.xhrGet(a,function(a){if(!a)b(-1);else c(a)},function(a){b(a)})})};g.substituteMatchWithResourceValue=function(e,b,c,d){if(c&&typeof c[b]==="object")return c[b].value;else if(d&&typeof d[b]==="object")return d[b].value;else{Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Missing Extended Manifest Resource Token value",f,f,0);throw new a.OsfRuntimeError(a.OsfRuntimeErrorCode.tokenError,"Missing Extended Manifest Resource token value")}};g.replaceResourceTokens=function(d,a,c){var b=new RegExp(k);return d.replace(b,function(b,d){return g.substituteMatchWithResourceValue(b,d,a,c)})};g.constructExtendedManifest=function(i,j){var h=undefined;if(i.resources)h=i.resources[b];var d=i.shortcuts,e=i.actions;if(d)for(var a=0;a<d.length;a++){if(d[a].key[c])d[a].key[c]=g.replaceResourceTokens(d[a].key[c],j,h);if(d[a].key[b])d[a].key[b]=g.replaceResourceTokens(d[a].key[b],j,h);!d[a].key[b]&&!d[a].key[c]&&Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Error: No valid platform for shortcut",f,f,f)}if(e)for(var a=0;a<e.length;a++)e[a].name=g.replaceResourceTokens(e[a].name,j,h);var k={shortcuts:d,actions:e};return k};g.substituteMatchWithTokenValue=function(i,d,g,e,c){var b="Missing ExtendedOverrides Token value";if(typeof c[d]===h)return c[d];else{Telemetry.RuntimeTelemetryHelper.LogExceptionTag(b,f,f,0);throw new a.OsfRuntimeError(a.OsfRuntimeErrorCode.tokenError,b)}};g.validateExtendedOverrides=function(h){var c=[],i=[],d=h.resources,r=h.shortcuts,s=h.actions,n=new RegExp(k),o=new RegExp(".*\\$\\{resource\\.([A-Za-z0-9_-]+)\\}.*"),g=a.ExtendedManifestUtility.validateShortcuts(r,n,o),p=a.ExtendedManifestUtility.validateActions(s,n,o);c=g.errors.concat(p.errors);i=g.tokens.concat(g.tokens);if(g.needsResources&&p.needsResources)if(!d)c.push(a.ExtendedManifestValidationErrorMessages.missingRequiredProperty(e,l));else{Object.keys(d).length>1&&c.push(a.ExtendedManifestValidationErrorMessages.invalidProperty(e,l,"1 locale",Object.keys(d).length+" locales"));if(!d[b])c.push(a.ExtendedManifestValidationErrorMessages.missingRequiredProperty(e,m));else{var q=a.ExtendedManifestUtility.validateExtendedOverridesResources(d[b],i,j);c=c.concat(q)}}c.length>0&&Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Invalid extended manifest",f,f,0);return {errors:c,tokens:i,needsResources:j}};g.validateShortcuts=function(f,n,o){var c="shortcuts[",k=[],l=j,m=[];if(f)for(var b=0;b<f.length;++b){!f[b].action&&k.push(a.ExtendedManifestValidationErrorMessages.missingRequiredProperty(e,c+b+"].action"));if(!f[b].key)k.push(a.ExtendedManifestValidationErrorMessages.missingRequiredProperty(e,c+b+"].key"));else for(var g in f[b].key)if(!(g in d))k.push(a.ExtendedManifestValidationErrorMessages.invalidValue(e,c+b+"].key",g));else if(!n.test(f[b].key[g]))if(o.test(f[b].key[g]))k.push(a.ExtendedManifestValidationErrorMessages.invalidValue(e,c+b+"].key."+g,f[b].key[g]));else typeof f[b].key[g]!==h&&k.push(a.ExtendedManifestValidationErrorMessages.invalidType(e,c+b+"].key.",h,typeof f[b].key[g]));else{m.push(f[b].key[g]);l=i}}return {errors:k,tokens:m,needsResources:l}};g.validateActions=function(c,l,m){var d="actions[",f=[],k=[],g=j;if(c)for(var b=0;b<c.length;++b){!c[b].id&&f.push(a.ExtendedManifestValidationErrorMessages.missingRequiredProperty(e,d+b+"].id"));if(!c[b].type)c[b].type="ExecuteFunction";if(!c[b].name)c[b].name=c[b].id;else if(!l.test(c[b].name))if(m.test(c[b].name))f.push(a.ExtendedManifestValidationErrorMessages.invalidValue(e,d+b+"].name",c[b].name));else typeof c[b].name!==h&&f.push(a.ExtendedManifestValidationErrorMessages.invalidType(e,d+b+"].name",h,typeof c[b].name));else{k.push(c[b].name);g=i}}return {errors:f,tokens:k,needsResources:g}};g.validateExtendedOverridesResources=function(d,n,j){var c="Extended Manifest Resources",b=[];if(!d)return b;for(var p=Object.keys(d),q=new RegExp(k),i=0;i<n.length;i++){var h=n[i],g=q.exec(h)[1],o=d[g];if(o){if(!o["value"])if(j)b.push(a.ExtendedManifestValidationErrorMessages.missingRequiredProperty(c,"resources["+p.indexOf(g)+"].value"));else b.push(a.ExtendedManifestValidationErrorMessages.missingRequiredProperty(e,"resources.default["+p.indexOf(g)+"].value"))}else if(j)b.push(a.ExtendedManifestValidationErrorMessages.missingRequiredValue(c,l,h));else b.push(a.ExtendedManifestValidationErrorMessages.missingRequiredValue(e,m,h))}b.length>0&&Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Invalid extended manifest resources",f,f,0);return b};g.validateAndSubstituteExtendedManifestTokens=function(d,b){var c=a.ExtendedManifestUtility.validateExtendedOverrides(d),e=a.ExtendedManifestUtility.validateExtendedOverridesResources(b,c.tokens,i),f=c.errors.concat(e);if(f.length==0)return a.ExtendedManifestUtility.constructExtendedManifest(d,b);else throw new a.OsfRuntimeError(a.OsfRuntimeErrorCode.invalidExtendedOverride,"Invalid Extended Override")};return g}();a.ExtendedManifestUtility=e})(OfficeExt||(OfficeExt={}));var OfficeExt;(function(b){var a=function(){var b=", expected = ",a=", value = ";function c(){}c.missingRequiredProperty=function(b,a){return "["+b+"][Parsing][Missing Required Property] property = "+a};c.invalidValue=function(d,b,c){return "["+d+"][Parsing][Invalid Value] property = "+b+a+c};c.invalidType=function(f,d,c,e){return "["+f+"][Parsing][Invalid Type] property = "+d+b+c+a+e};c.invalidProperty=function(f,d,c,e){return "["+f+"][Parsing][Invalid Property] property = "+d+b+c+a+e};c.missingRequiredValue=function(d,c,a){return "["+d+"][Parsing][Missing Required Value] property = "+c+b+a};return c}();b.ExtendedManifestValidationErrorMessages=a})(OfficeExt||(OfficeExt={}));var OfficeExt;(function(b){var a=function(){function a(){}a.setHostFeatureEnabledInfo=function(a){this._hostFeatureEnabledInfo=a};a.getHostFeatureEnabledInfo=function(){return this._hostFeatureEnabledInfo};return a}();b.HostFeatureEnabledInfo=a})(OfficeExt||(OfficeExt={}));var OfficeExt;(function(d){var a="_",c=function(){function a(){}a.prototype.get=function(a,b){return this.openTransaction(a).then(function(c){return new Promise(function(f,g){var e=c.objectStore(a),d=e.get(b);d.onsuccess=function(b){var a=b.target.result;f(a)};d.onerror=function(a){g(a)}})})};a.prototype.set=function(a,c,b){return this.openTransaction(a).then(function(d){return new Promise(function(g,h){var f=d.objectStore(a),e=f.put(b,c);e.onsuccess=function(){g()};e.onerror=function(a){h(a)}})})};a.prototype.openDB=function(a){var b=window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB||window.indexedDB;return new Promise(function(d,e){var c=b.open(a);c.onupgradeneeded=function(){var b=c.result;!b.objectStoreNames.contains(a)&&b.createObjectStore(a)};c.onsuccess=function(){var a=c.result;d(a)};c.onerror=function(a){console.log(a.error);e(a)}})};a.prototype.openTransaction=function(a){return this.openDB(a).then(function(c){var b=c.transaction(a,"readwrite");return b})};return a}(),b=function(){function b(){}b.prototype.get=function(b,d){var c=localStorage.getItem(b.concat(a,d));return Promise.resolve(c)};b.prototype.set=function(b,d,c){localStorage.setItem(b.concat(a,d),c);return Promise.resolve()};return b}(),e=function(){var a=null,e="The browser does not support Web Storage";function d(){this.indexedDB=window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB||window.indexedDB}d.get=function(c,d){var b=this.getOrCreateOsfCache();if(b)return b.get(c,d);else{Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag(e,a,0);return Promise.resolve(a)}};d.set=function(c,f,d){var b=this.getOrCreateOsfCache();if(b)return b.set(c,f,d);else{Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag(e,a,0);return Promise.resolve(a)}};d.getOrCreateOsfCache=function(){var e="undefined";if(d.instance==a)if(typeof indexedDB!=e)d.instance=new c;else if(typeof localStorage!=e)d.instance=new b;return d.instance};d.c_osfCacheTableName="OSF.Cache";d.c_extendedManifestTableName="OSF.ExtendedManifest";d.c_extendedManifestResourcesTableName="OSF.ExtendedManifestResources";return d}();d.OsfCache=e})(OfficeExt||(OfficeExt={}));OSF.OUtil.setNamespace("AppSpecificSetup",OSF);OSF.ContextActivationManager=function(e){var g="0",m="osfControl for the given ID doesn't exist.",i="object",k="string",x="DevConsoleEnabled",o="IsReactMLR",c=null,d=true,b=false,a=this,z=a;OSF.OUtil.validateParamObject(e,{appName:{type:Number,mayBeNull:b},appVersion:{type:String,mayBeNull:b},clientMode:{type:Number,mayBeNull:b},appUILocale:{type:String,mayBeNull:b},dataLocale:{type:String,mayBeNull:b},osfOmexBaseUrl:{type:String,mayBeNull:d},devCatalogUrl:{type:String,mayBeNull:d},oneDriveCatalogBaseApiUrl:{type:String,mayBeNull:d},sdxCdnUrl:{type:String,mayBeNull:d},sdxDmsUrl:{type:String,mayBeNull:d},spBaseUrl:{type:String,mayBeNull:d},docUrl:{type:String,mayBeNull:d},hostControl:{type:Object,mayBeNull:d},pageBaseUrl:{type:String,mayBeNull:d},lcid:{type:String,mayBeNull:d},formFactor:{type:String,mayBeNull:d},controlStatusChanged:{type:Object,mayBeNull:d},notifyHost:{type:Object,mayBeNull:d},allowExternalMarketplace:{type:Boolean,mayBeNull:d},localizedScriptsUrl:{type:String,mayBeNull:d},localizedImagesUrl:{type:String,mayBeNull:d},localizedStylesUrl:{type:String,mayBeNull:d},localizedResourcesUrl:{type:String,mayBeNull:d},trustAgaves:{type:Boolean,mayBeNull:d},enableAddinCommands:{type:Boolean,mayBeNull:d},enableBlackForestRedirect:{type:Boolean,mayBeNull:d},enableMyOrg:{type:Boolean,mayBeNull:d},enableMyApps:{type:Boolean,mayBeNull:d},enableDevCatalog:{type:Boolean,mayBeNull:d},enableOneDriveCatalog:{type:Boolean,mayBeNull:d},enablePrivateCatalog:{type:Boolean,mayBeNull:d},enableTaskpaneUpgradeToAppCommand:{type:Boolean,mayBeNull:d},enableUploadFileDevCatalog:{type:Boolean,mayBeNull:d},enableV1RedirectApis:{type:Boolean,mayBeNull:d},omexForceAnonymous:{type:Boolean,mayBeNull:d},userNameHashCode:{type:Number,mayBeNull:d},hostFullVersion:{type:String,mayBeNull:d},envCode:{type:String,mayBeNull:d},showSignOutFromPrivateCatalogMessage:{type:Boolean,mayBeNull:d},enableSingleSignOnForAddin:{type:Boolean,mayBeNull:d},firstPartySingleSignOnWhitelist:{type:String,mayBeNull:d},enableServiceDeliveredExperience:{type:Boolean,mayBeNull:d},hideAppsExtensionUrl:{type:String,mayBeNull:d},enableInsertDialogAccessibilityFix:{type:Boolean,mayBeNull:d},disableLogging:{type:Boolean,mayBeNull:d},enableDisplayBlockedMinorError:{type:Boolean,mayBeNull:d},enableFirstPartySSO:{type:Boolean,mayBeNull:d},disableAppsForOfficeThirdParty:{type:Boolean,mayBeNull:d},wacSessionId:{type:String,mayBeNull:d},enableFirstPartySDXErrorMessages:{type:Boolean,mayBeNull:d},isHostDocumentDomain:{type:Boolean,mayBeNull:d},enableRichApiCellEditDelay:{type:Boolean,mayBeNull:d},wopiHostOriginFromPostMessage:{type:String,mayBeNull:d},wopiHostOriginFromWacPropBag:{type:String,mayBeNull:d},"wacIsEmbedded ":{type:Boolean,mayBeNull:d},"accessibilityAllowFocusAddinTaskpane ":{type:Boolean,mayBeNull:d},disableMicrophonePermission:{type:Boolean,mayBeNull:d},agaveAddinUploadEnabled:{type:Boolean,mayBeNull:d},addinEnforceHttpsIsEnabled:{type:Boolean,mayBeNull:d},featureGateFlag:{type:Number,mayBeNull:d},isReactRibbonEnabled:{type:Boolean,mayBeNull:d},enableAddinInsertDialogReflow:{type:Boolean,mayBeNull:d},enableDisplayUILocaleQueryString:{type:Boolean,mayBeNull:d},advancedUrlParsing:{type:Boolean,mayBeNull:d}},c);a._osfOmexBaseUrl=e.osfOmexBaseUrl;a._devCatalogUrl=e.devCatalogUrl;a._sdxCdnUrl=e.sdxCdnUrl;a._sdxDmsUrl=e.sdxDmsUrl;a._firstPartyManifestCDNUrl=e.firstPartyManifestCDNUrl;a._oneDriveCatalogBaseApiUrl=e.oneDriveCatalogBaseApiUrl;a._spBaseUrl=e.spBaseUrl;a._myOrgCatalogUrl=c;a._enableAddinCommands=e.enableAddinCommands||b;a._enableBlackForestRedirect=e.enableBlackForestRedirect||b;a._enableInsertDialogAccessibilityFix=e.enableInsertDialogAccessibilityFix||b;a._enableFirstPartySDXErrorMessages=e.enableFirstPartySDXErrorMessages||b;a._enableMyOrg=e.enableMyOrg||b;a._enableMyApps=e.enableMyApps||b;a._enableDevCatalog=e.enableDevCatalog||b;a._enableOneDriveCatalog=e.enableOneDriveCatalog||b;a._enablePrivateCatalog=e.enablePrivateCatalog||b;a._showSignOutFromPrivateCatalogMessage=e.showSignOutFromPrivateCatalogMessage||b;a._enableTaskpaneUpgradeToAppCommand=e.enableTaskpaneUpgradeToAppCommand||b;a._enableUploadFileDevCatalog=e.enableUploadFileDevCatalog||b;a._enableV1RedirectApis=e.enableV1RedirectApis||b;a._appName=e.appName;a._appVersion=e.appVersion;a._clientMode=e.clientMode;a._appUILocale=e.appUILocale;a._dataLocale=e.dataLocale;a._docUrl=e.docUrl;a._hostControl=e.hostControl;a._formFactor=e.formFactor||OSF.FormFactor.Default;a._pageBaseUrl=e.pageBaseUrl;a._lcid=e.lcid;a._controlStatusChanged=e.controlStatusChanged;a._notifyHost=e.notifyHost||function(){};a._allowExternalMarketplace=e.allowExternalMarketplace;a._localizedScriptsUrl=e.localizedScriptsUrl;a._localizedImagesUrl=e.localizedImagesUrl;a._localizedStylesUrl=e.localizedStylesUrl;a._localizedResourcesUrl=e.localizedResourcesUrl;a._autoTrusted=e.trustAgaves;a._omexForceAnonymous=e.omexForceAnonymous||b;a._userNameHashCode=e.userNameHashCode||0;a._hostFullVersion=e.hostFullVersion;a._wacHostEnvironment=e.envCode;a._enableSingleSignOnForAddin=e.enableSingleSignOnForAddin||b;a._enableFirstPartySSO=e.enableFirstPartySSO||b;a._enableServiceDeliveredExperience=e.enableServiceDeliveredExperience||d;a._hideAppsExtensionUrl=a._osfOmexBaseUrl+e.hideAppsExtensionUrl;a._disableLogging=e.disableLogging||b;a._enableDisplayBlockedMinorError=e.enableDisplayBlockedMinorError||b;a._disableAppsForOfficeThirdParty=e.disableAppsForOfficeThirdParty||b;a._isHostDocumentDomain=e.isHostDocumentDomain||b;a._enableRichApiCellEditDelay=e.enableRichApiCellEditDelay||b;a._loggableUserId=e.loggableUserId;a._sessionStartInfoJson=e.sessionStartInfoJson;a._firstPartySingleSignOnWhitelist=e.firstPartySingleSignOnWhitelist;a._wopiHostOriginFromPostMessage=e.wopiHostOriginFromPostMessage;a._wopiHostOriginFromWacPropBag=e.wopiHostOriginFromWacPropBag;a._wacIsEmbedded=e.wacIsEmbedded;a._enableWopiHostCheck=e.isHostFrameTrustCheckEnabledForAddIns||b;a._enableUpnCheck=e.isUpnCheckEnabled||b;a._wacUpn=e.wacUpn;a._accessibilityAllowFocusAddinTaskpane=e.accessibilityAllowFocusAddinTaskpane;a._disableMicrophonePermission=e.disableMicrophonePermission||b;a._oAuthManager=c;a._agaveAddinUploadEnabled=e.agaveAddinUploadEnabled||b;a._isHostFrameTrusted=e.isHostFrameTrusted||OSF.HostFrameTrustState.NotInitialized;a._hostFeatureGateFlag=e.hostFeatureGateFlag||OSF.HostFeatureGateFlags.None;a._isReactRibbonEnabled=e.isReactRibbonEnabled||b;a._enableAddinInsertDialogReflow=e.enableAddinInsertDialogReflow||b;a._enableDisplayUILocaleQueryString=e.enableDisplayUILocaleQueryString||b;a._enable3rdPartySetAppContextInIframeName=a._hostFeatureGateFlag&OSF.HostFeatureGateFlags.Enable3rdPartySetAppContextInIFrameName;a._appSettings=e.appSettings||{};a._flightingTreatmentVariables=e.flightingTreatmentVariables||{};a._enableWopiHostCheck=a._enableWopiHostCheck||j(a._appSettings,"WopiHostCheckForAddinsIsEnabled");a._hostAllowedSdxEmbedding=e.hostAllowedSdxEmbedding||d;if(!a._enableWopiHostCheck)a._hostAllowedSdxEmbedding=d;a._upnCheckResult=OSF.UpnCheckCode.NotSet;OfficeExt.HostFeatureEnabledInfo.setHostFeatureEnabledInfo(e);if(a._pageBaseUrl&&a._pageBaseUrl.charAt(a._pageBaseUrl.length-1)!=="/")a._pageBaseUrl=a._pageBaseUrl+"/";if(a._localizedResourcesUrl&&a._localizedResourcesUrl.charAt(a._localizedResourcesUrl.length-1)!=="/")a._localizedResourcesUrl=a._localizedResourcesUrl+"/";a._clientId=OSF.OUtil.getUniqueId();a._cachedOsfControls={};a._notReadyOsfControls={};a._notReadyOsfControlsIndex=0;a._iframeAttributeBag={};a._serviceEndPoint=c;a._serviceEndPointInternal=c;a._internalConversationId=c;a._iframeProxies={};a._iframeProxyCount=0;a._iframeNamePrefix="__officeExtensionProxy";a._webUrl=c;a._wsa=c;a._insertDialogDiv=c;a._hasPreloadedOfficeJs=b;a._contextMgrCorrelationId=e.wacSessionId||OSF.OUtil.Guid.generateNewGuid();Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("_contextMgrCorrelationId :"+a._contextMgrCorrelationId,c,20194265);Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("ContextActivationManager Constructor isHostFrameTrusted param:"+e.isHostFrameTrusted,a._contextMgrCorrelationId,591697925);a._hostType=c;a._hostPlatform=c;a._hostSpecificFileVersion=c;a._requirementsChecker=new OSF.RequirementsChecker;a._onClickInstallOsfControl=c;if(a._osfOmexBaseUrl){var l,t=a._osfOmexBaseUrl.indexOf(OSF.Constants.ProtocolSeparator);if(t>=0)l=a._osfOmexBaseUrl.substr(t);else l=OSF.Constants.ProtocolSeparator+a._osfOmexBaseUrl;var v=OSF.Constants.Https+l,u=OSF.Constants.Https+l;if(OSF.OUtil.getQueryStringParamValue(window.location.search,OSF.Constants.OmexForceAnonymousParamName).toLowerCase()==OSF.Constants.OmexForceAnonymousParamValue.toLowerCase()){a._omexAuthNStatus=OSF.OmexAuthNStatus.Anonymous;a._omexForceAnonymous=d}else a._omexAuthNStatus=OSF.OmexAuthNStatus.NotAttempted;a._omexGatedWSProxy={proxyUrl:v+OSF.Constants.OmexGatedServiceExtension,proxyName:OSF.Constants.OmexGatedServiceName,isReady:b,clientEndPoint:c,pendingCallbacks:[]};a._omexWSProxy={proxyUrl:u+OSF.Constants.OmexUnGatedServiceExtension,proxyName:OSF.Constants.OmexUnGatedServiceName,isReady:b,clientEndPoint:c,pendingCallbacks:[]};a._omexAnonymousWSProxy={proxyUrl:v+OSF.Constants.OmexAnonymousServiceExtension,proxyName:OSF.Constants.OmexAnonymousServiceName,isReady:b,clientEndPoint:c,pendingCallbacks:[]};a._omexBillingMarket=c;a._omexEndPointBaseUrl=u}(e.addinEnforceHttpsIsEnabled||b)&&OSF.OUtil.pushFlight(OSF.FlightNames.AddinEnforceHttps);a._enableUpnCheck=a._enableUpnCheck||j(a._appSettings,"AddinCheckUpnIsEnabled");a._enableDisplayUILocaleQueryString=a._enableDisplayUILocaleQueryString||j(a._appSettings,"DisplayUILocaleQueryStringIsEnabled");a._agaveAddinUploadEnabled=a._agaveAddinUploadEnabled||j(a._appSettings,"AgaveAddinUploadEnabled");h(a._appSettings,"AddinCheckReceiverOriginIsEnabled",OSF.FlightNames.CheckReceiverOrigin);h(a._appSettings,"AddinRibbonNativeGroupControlIsEnabled",OSF.FlightNames.RibbonNativeGroupControl);h(a._appSettings,"AddinRibbonTabPositionIsEnabled",OSF.FlightNames.RibbonTabPosition);h(a._appSettings,"AddinRibbonTabAutoFocusIsEnabled",OSF.FlightNames.RibbonTabAutoFocus);h(a._appSettings,"AddinRibbonIdAllowUnknown",OSF.FlightNames.AddinRibbonIdAllowUnknown);h(a._appSettings,"AddinRibbonControlsOverriddenByApi",OSF.FlightNames.AddinRibbonControlsOverriddenByApi);h(a._appSettings,"AdvancedUrlParsingIsEnabled",OSF.FlightNames.AdvancedUrlParsing);h(a._appSettings,"IgnoreWindowNameIsEnabled",OSF.FlightNames.IgnoreWindowName);h(a._appSettings,"DialogPromptCleanDisplayIsEnabled",OSF.FlightNames.DialogPromptCleanDisplay);h(a._appSettings,"PostMessageParentOnlyOnceIsEnabled",OSF.FlightNames.PostMessageParentOnlyOnce);h(a._appSettings,"AddinActionDefinitionHybridModeIsEnabled",OSF.FlightNames.AddinActionDefinitionHybridMode);h(a._appSettings,"AddInsInSupportedIrmDocsIsEnabled",OSF.FlightNames.AddInsInSupportedIrmDocsIsEnabled);h(a._appSettings,"RemoveOptionNotEnforceAppDomainsIsEnabled",OSF.FlightNames.RemoveOptionNotEnforceAppDomains);h(a._appSettings,"ManifestParserDevConsoleEnabled",OSF.FlightNames.ManifestParserDevConsoleLog);h(a._appSettings,"NotifyHostOnlyWithOriginIsEnabled",OSF.FlightNames.NotifyHostOnlyWithOrigin);h(a._appSettings,"LegacyRibbonAddinCommandsEnableDisableControls",OSF.FlightNames.LegacyRibbonAddinCommandsEnableDisableControls);for(var n=OSF.TestFlightStart;n<=OSF.TestFlightEnd;n++){var O="OSFTestFlight"+n;h(a._appSettings,O,n)}OSF.OUtil.getValue(a._flightingTreatmentVariables["Microsoft.Office.OEP.FirstPartyAnonymousProxyReadyCheckTimeoutEnabled"],b)&&OSF.OUtil.pushFlight(OSF.FlightNames.FirstPartyAnonymousProxyReadyCheckTimeout);OSF.Settings["IsReactRibbonEnabled"]=a._isReactRibbonEnabled;OSF.Settings[o]=j(a._appSettings,o);if(OSF.OUtil.checkFlight(OSF.FlightNames.ManifestParserDevConsoleLog))OSF.Settings[x]=j(a._appSettings,x);if(OSF.OUtil.checkFlight(OSF.FlightNames.RibbonNativeGroupControl)&&OSF.Settings[o])OSF.RibbonGroupIdMap=Object.assign(OSF.RibbonGroupIdMapCommonMLR,OSF.RibbonGroupIdMap);function h(b,c,a){j(b,c)&&OSF.OUtil.pushFlight(a)}function j(a,c){var d=a&&c&&a[c]!==undefined&&a[c]&&(typeof a[c]===k&&a[c].toUpperCase()==="TRUE"||typeof a[c]==="boolean"&&a[c]);return d!==undefined?d:b}a._isFromWacAutomation=function(){if(this._isFromWacAutomation!==undefined&&this._isFromWacAutomation!==c)return this._isFromWacAutomation;else try{var a=window,e=undefined;while(a!==e){if(!a.location||!a.location.search)return b;var f=a.location.search.toLowerCase(),g=f.indexOf("automation=1");if(g>=0)return d;else{e=a;a=a.parent}}}catch(h){return b}return b}();OSF.OsfManifestManager._setUILocale(a._appUILocale);var f=a,H=function(b,d){var g=typeof b===k?b:typeof b===i&&b.length>0?b[0]:c;(!g||!d)&&Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Parameter validation error in getAppContextAsync.",c,c,19203545);var a=f.getOsfControl(g);if(!a){OsfMsAjaxFactory.msAjaxDebug.trace(m);Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Cannot get osfControl with given ID.",c,c,19203546);throw OsfMsAjaxFactory.msAjaxError.argument("contextId")}else{a._sdxTelemetryContext["getAppContextStart"]=performance.now();a._iframeOnGetAppContextDelegate&&a._iframeOnGetAppContextDelegate();Telemetry.AppLoadTimeHelper.OfficeJSLoaded(a._telemetryContext);var e;e=a.getAppContext();d(e);a._pageStatus=OSF.OsfControlPageStatus.Ready;a._pageIsReadyTimerExpired&&Telemetry.RuntimeTelemetryHelper.LogExceptionTag("App attempted to retrieve context after app activation error has occured.",c,a.getCorrelationId(),19203547);a._contextActivationMgr._ErrorUXHelper&&a._contextActivationMgr._ErrorUXHelper.removeProgressDiv(a._div,a._id);a.ensureAgaveEndPoint();a._focusOnIframeWhenLoaded&&a._frame.contentWindow.focus();Telemetry.AppLoadTimeHelper.ActivationEnd(a._telemetryContext);a._sdxTelemetryContext["getAppContextEnd"]=performance.now();if(a._timer){window.clearTimeout(a._timer);a._timer=c}a._iframeIsLoaded&&a._notifyHostIFrameOnLoaded()}};f.getContextForEmbeddingPage=function(){var b=0;if(f._hostSpecificFileVersion&&f._hostSpecificFileVersion.indexOf(".")!=-1){var a=f._hostSpecificFileVersion.split("."),c=a[1];if(!isNaN(c))b=parseInt(a[1])}var d=f._requirementsChecker._getSupportedSet();return {appName:f._appName,appVersion:f._appVersion,appUILocal:f._appUILocale,dataLocale:f._dataLocale,docUrl:f._docUrl||window.location.href,clientMode:f._clientMode,minorVersion:b,requirements:d}};if(a._enableServiceDeliveredExperience)var K=function(b){var a=b&&b.contextId?f.getOsfControl(b.contextId):c;switch(b.id){case OSF.MessageIDs.FetchBundleUrl:if(!a._agaveEndPoint){var d=a._conversationId+OSF.SharedConstants.NotificationConversationIdSuffix;a._agaveEndPoint=Microsoft.Office.Common.XdmCommunicationManager.connect(d,a._frame.contentWindow,a._iframeUrl)}if(a._bundleUrl){var e={id:OSF.MessageIDs.LoadReactBundle,bundleUrl:a._bundleUrl};a.sendMessageToSdx(e)}break;case OSF.MessageIDs.LoadBundleSuccess:a._pageStatus=OSF.OsfControlPageStatus.Ready;a._contextActivationMgr._ErrorUXHelper&&a._contextActivationMgr._ErrorUXHelper.removeProgressDiv(a._div,a._id);break;case OSF.MessageIDs.LoadBundleError:break;default:OsfMsAjaxFactory.msAjaxDebug.trace("MessageID: "+b.id+" onMessageFromSdx got wrong message.")}};var P=function(a){if(!a||a.length!=2){var p=a&&a.length==3&&(a[1]===OSF.AgaveHostAction.UpdateTargetUrl||a[1]===OSF.AgaveHostAction.SendTelemetryEvent||a[1]===OSF.AgaveHostAction.SendMessage||a[1]===OSF.AgaveHostAction.LaunchExtensionComponent||a[1]===OSF.AgaveHostAction.StopExtensionComponent||a[1]===OSF.AgaveHostAction.RestartExtensionComponent||a[1]===OSF.AgaveHostAction.EnableTaskPaneHeaderButton||a[1]===OSF.AgaveHostAction.DisableTaskPaneHeaderButton||a[1]===OSF.AgaveHostAction.RefreshRibbonGallery||a[1]===OSF.AgaveHostAction.OfficeJsReady);!p&&OsfMsAjaxFactory.msAjaxDebug.trace("ContextActivationManager_notifyHost params is wrong.")}var e=a[0],d=a[1],b=f.getOsfControl(e);if(!b)OsfMsAjaxFactory.msAjaxDebug.trace(m);else if(d===OSF.AgaveHostAction.TabExitShift||d===OSF.AgaveHostAction.ExitNoFocusableShift)f._ErrorUXHelper.focusOnNotificationUxShiftIn(e,d);else if(d===OSF.AgaveHostAction.UpdateTargetUrl){var j=a[2];b.checkAppDomains(j)&&b.updateAgaveEndPointTargetUrl(j)}else if(d===OSF.AgaveHostAction.SendTelemetryEvent){var r=a[2];b._contextActivationMgr._notifyHost(e,d,r)}else if(d===OSF.AgaveHostAction.LaunchExtensionComponent){var s=a[2];b._contextActivationMgr._notifyHost(e,d,s)}else if(d===OSF.AgaveHostAction.RestartExtensionComponent){var h=a[2];if(h.InstanceToken){var i=b._contextActivationMgr._cachedOsfControls[h.InstanceToken];if(i)i.refresh();else if(h.LaunchProperties&&h.LaunchProperties.OptionalProperties){var v=h.Id.Id,n=h.LaunchProperties.OptionalProperties["SourceLocationOverrideResourceId"];b._contextActivationMgr.refreshOsfControl(v,n)}}}else if(d===OSF.AgaveHostAction.StopExtensionComponent){var u=a[2];b._contextActivationMgr._notifyHost(e,d,u)}else if(d==OSF.AgaveHostAction.SendMessage){for(var l in b._contextActivationMgr._cachedOsfControls)if(l!=b.getID()){var g=b._contextActivationMgr._cachedOsfControls[l];if(g.getStoreLocator()==b.getStoreLocator()&&g.getStoreType()==b.getStoreType()){var k=a[2];if(g.getOwnerAddinAssetId()!=c&&g.getOwnerAddinAssetId()==b.getOwnerAddinAssetId())g.notifyAgave(OSF.AgaveHostAction.SendMessage,k);else g.getMarketplaceID()==b.getMarketplaceID()&&g.notifyAgave(OSF.AgaveHostAction.SendMessage,k)}}}else if(d==OSF.AgaveHostAction.EnableTaskPaneHeaderButton){var o=a[2];b._contextActivationMgr._notifyHost(e,d,o)}else if(d==OSF.AgaveHostAction.RefreshRibbonGallery){var t=a[2];b._contextActivationMgr._notifyHost(e,d,t)}else if(d==OSF.AgaveHostAction.OfficeJsReady){var q=a[2];b._sdxTelemetryContext["officeJsReadyDate"]=q;b._iframeOnGetAppContextDelegate&&b._iframeOnGetAppContextDelegate()}else if(b._contextActivationMgr._notifyHost)b._contextActivationMgr._notifyHost(e,d);else OsfMsAjaxFactory.msAjaxDebug.trace("No notifyHost provided by the host.")},w=function(a){if(a.strUrl){var b=OSF.OUtil.parseUrl(a.strUrl);if(b&&(b.protocol=="http:"||b.protocol=="https:")){if(OSF.OUtil.checkFlight(OSF.FlightNames.IgnoreWindowName))window.open(a.strUrl,"",a.strWindowFeatures);else window.open(a.strUrl,a.strWindowName,a.strWindowFeatures);return}}Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("Silent fail for window.open.",this._contextMgrCorrelationId,592570305)},p=function(a,d){if(!a.hasOwnProperty("fromInsertDialog")||a.fromInsertDialog)f._insertDialogDiv!=c&&f._insertDialogDiv.childNodes.length==2&&f._insertDialogDiv.removeChild(f._insertDialogDiv.lastChild);var p=OSF.OUtil.Guid.generateNewGuid(),h=new OfficeExt.InsertDialogTelemetryContext(p),g;if(a.storeType==OSF.StoreTypeEnum.MarketPlace)g={storeType:OSF.StoreType.OMEX,storeLocator:f._osfOmexBaseUrl};else if(a.storeType==OSF.StoreTypeEnum.Catalog)g={storeType:OSF.StoreType.SPCatalog,storeLocator:f._myOrgCatalogUrl};else if(a.storeType==OSF.StoreTypeEnum.OneDrive)g={storeType:OSF.StoreType.OneDrive,storeLocator:f._oneDriveCatalogBaseApiUrl};var e=b||a.refresh,i={assetId:"",contentMarket:"",anonymous:b,clientEndPoint:c,clearCache:e,clearKilledApps:b,referenceInUse:g,hostType:f._hostType};if(a&&a.storeType==OSF.StoreTypeEnum.MarketPlace){i.clientVersion=f._getClientVersionForOmex();if(i.clientVersion){i.clientName=f._getClientNameForOmex();i.appVersion=f._getAppVersionForOmex()}var j=OfficeExt.CatalogFactory.resolve(OSF.StoreType.OMEX),o=function(k){if(k.status==OfficeExt.DataServiceResultCode.Succeeded&&k.value){for(var i=k.value,g=i.length,a,b={},n=[],l=0;l<g;l++){a=i[l];if(b[a.contentMarket])b[a.contentMarket].push(a.assetId);else b[a.contentMarket]=[a.assetId]}e&&C(i);g===0&&d({errorCode:OSF.InvokeResultCode.S_OK});var m=0,p=function(e,i){if(e.status==OfficeExt.DataServiceResultCode.Succeeded&&e.value&&e.value.length&&e.value.length>0)for(var c=e.value,h=f.getRequirementsChecker(),b=0;b<c.length;b++){if(h.isEntitlementFromOmexSupported(c[b])){var a=[];a.push(c[b].name);a.push(c[b].assetId);a.push(c[b].description);a.push(OSF.OUtil.getTargetType(c[b].appSubType));a.push(OSF.OUtil.normalizeAppVersion(c[b].version));a.push(c[b].assetId);a.push(OSF.StoreType.OMEX);a.push(parseInt(c[b].defaultWidth));a.push(parseInt(c[b].defaultHeight));a.push(c[b].iconUrl);a.push(c[b].provider);a.push(i);a.push(OSF.StoreType.OMEX);a.push(c[b].webApplicationId);n.push(a)}m++}if(m===g){var j={value:n,errorCode:OSF.InvokeResultCode.S_OK};d(j)}},q=function(b,a){j.getAppDetails(b,a,h,function(b){Function.createDelegate(f,p)(b,a)},e)};for(var o in b)q(b[o],o)}else{var r={value:c,errorCode:OSF.InvokeResultCode.E_USER_NOT_SIGNED_IN};d(r)}};j.getEntitlementAsync(b,h,Function.createDelegate(f,o),e)}else if(a&&a.storeType==OSF.StoreTypeEnum.Catalog){var k=OfficeExt.CatalogFactory.resolve(OSF.StoreType.SPCatalog);k.myOrgCatalogUrl=f._myOrgCatalogUrl;var n=function(h){OSF.OUtil.writeProfilerMark(OSF.OsfOfficeExtensionManagerPerfMarker.GetEntitlementEnd);var e;if(h.status==OfficeExt.DataServiceResultCode.Succeeded&&h.value){for(var k=h.value,n=k.length,b,l=[],j=0,m=f.getRequirementsChecker(),i=0;i<n;i++){b=k[i];if(m.isEntitlementFromCorpCatalogSupported(b)){var a=[];a.push(b.Title);a.push(b.OfficeExtensionID);a.push(b.OfficeExtensionDescription);a.push(OSF.OfficeAppType[b.OEType]);a.push(OSF.OUtil.normalizeAppVersion(b.OfficeExtensionVersion));a.push(b.OfficeExtensionID);a.push(OSF.StoreType.SPCatalog);a.push(parseInt(b.OfficeExtensionDefaultWidth.toString()));a.push(parseInt(b.OfficeExtensionDefaultHeight.toString()));a.push(b.OfficeExtensionIcon);a.push(b.OEProviderName);a.push(g.storeLocator);a.push(OSF.StoreType.SPCatalog);l.push(a);j++}}if(j>0)e={value:l,errorCode:OSF.InvokeResultCode.S_OK};else e={value:c,errorCode:OSF.InvokeResultCode.E_CATALOG_NO_APPS}}else if(!g.storeLocator)e={value:c,errorCode:OSF.InvokeResultCode.E_CATALOG_NO_APPS};else e={value:c,errorCode:OSF.InvokeResultCode.E_GENERIC_ERROR};d(e)};k.getEntitlementAsync(b,h,Function.createDelegate(f,n),e)}else if(a&&a.storeType==OSF.StoreTypeEnum.OneDrive){var m=function(a){var b;if(a.statusCode===OSF.ProxyCallStatusCode.Succeeded&&a.value){var c=a.value.entitlements;b={value:c,errorCode:OSF.InvokeResultCode.S_OK};d(b)}};OSF.OsfManifestManager.getOneDriveEntitlementsAsync(i,m)}else if(a&&a.storeType==OSF.StoreTypeEnum.PrivateCatalog){var l=function(a){if(a.status==OfficeExt.DataServiceResultCode.Unauthenticated){d({value:c,errorCode:OSF.InvokeResultCode.E_USER_NOT_SIGNED_IN});return}if(a.status!==OfficeExt.DataServiceResultCode.Succeeded||!a.value){d({value:c,errorCode:OSF.InvokeResultCode.E_CATALOG_REQUEST_FAILED});return}var g=a.value,l=g.length;if(l===0){d({errorCode:OSF.InvokeResultCode.E_CATALOG_NO_APPS});return}var b=[];b=g.map(function(a){return {ProductId:a.assetId,AddInState:a.addInState,Version:a.appVersion}});var i=[],k=function(g){if(g.status!==OfficeExt.DataServiceResultCode.Succeeded||!g.value||!g.value.length||g.value.length===0){d({value:c,errorCode:OSF.InvokeResultCode.E_CATALOG_REQUEST_FAILED});return}for(var e=g.value,h=f.getRequirementsChecker(),b=0;b<e.length;b++){if(!h.isEntitlementFromOmexSupported(e[b]))continue;var a=[];a.push(e[b].name);a.push(e[b].assetId);a.push(e[b].description);a.push(OSF.OUtil.getTargetType(e[b].appSubType));a.push(OSF.OUtil.normalizeAppVersion(e[b].version));a.push(e[b].assetId);a.push(OSF.StoreType.PrivateCatalog);a.push(parseInt(e[b].defaultWidth));a.push(parseInt(e[b].defaultHeight));a.push(e[b].iconUrl);a.push(e[b].provider);a.push(OSF.StoreType.PrivateCatalog);a.push(OSF.StoreType.PrivateCatalog);i.push(a)}d({value:i,errorCode:OSF.InvokeResultCode.S_OK})};j.getAppDetails(b,"",h,Function.createDelegate(f,k),e)},j=OfficeExt.CatalogFactory.resolve(OSF.StoreType.PrivateCatalog);j.getEntitlementAsync(b,h,Function.createDelegate(f,l),e)}else OsfMsAjaxFactory.msAjaxDebug.trace("Unknown store type.")},N=function(a){if(a&&a.storeType!=OSF.StoreTypeEnum.PrivateCatalog){var d=window.location.href,b=f._osfOmexBaseUrl+OSF.Constants.SignInRedirectUrl+encodeURIComponent(d);window.location.assign(b)}else OfficeExt.PrivateCatalogService.authenticationProxy.getSignInUrl(function(a){window.top.location.replace(a)},function(){f._notifyHost(g,OSF.AgaveHostAction.NotifyHostError,c)})},M=function(a){a&&a.storeType==OSF.StoreTypeEnum.PrivateCatalog&&OfficeExt.PrivateCatalogService.SignOutUser();r(a,c)},J=function(a){if(a.pageUrl){var b={strUrl:a.pageUrl,strWindowName:c,strWindowFeatures:c};w(b)}},D=function(a){OsfMsAjaxFactory.msAjaxDebug.trace("onClickInsertOsfControl!");f._notifyHost(g,OSF.AgaveHostAction.InsertAgave,a)};a._onClickInstallOsfControl=function(i){if(!f._enableUploadFileDevCatalog)return;OsfMsAjaxFactory.msAjaxDebug.trace("onClickInstallOsfControl!");try{OSF.OUtil.validateParamObject(i,{manifest:{type:String,mayBeNull:b}},c);var e=new OSF.Manifest.Manifest(i.manifest,f.getAppUILocale()),h=e.getMarketplaceID(),k=e.getMarketplaceVersion(),m=OfficeExt.CatalogFactory.resolve(OSF.StoreType.UploadFileDevCatalog);if(m.validateAndCacheNewManifest(h,k,i.manifest,e)){var a={id:h,targetType:e.getTarget(),appVersion:k,currentStoreType:OSF.StoreType.UploadFileDevCatalog,storeId:"developer",assetId:h,assetStoreId:OSF.StoreType.UploadFileDevCatalog,width:parseInt(e.getDefaultWidth()||g),height:parseInt(e.getDefaultHeight()||g),isAddinCommands:e._isAddinCommandsManifest(OSF.getManifestHostType(f._hostType))};OSF.OUtil.validateParamObject(a,{id:{type:String,mayBeNull:b},targetType:{type:Number,mayBeNull:b},appVersion:{type:String,mayBeNull:b},width:{type:Number,mayBeNull:d},height:{type:Number,mayBeNull:d}},c);Telemetry.UploadFileDevCatalogUsageHelper.LogUploadFileDevCatalogUsageAction(this._appCorrelationId,a.currentStoreType,a.assetId,a.appVersion,a.targetType,a.isAddinCommands,a.width,a.height);f._notifyHost(g,OSF.AgaveHostAction.InsertAgave,a)}else f._notifyHost(g,OSF.AgaveHostAction.NotifyHostError,c)}catch(j){var l="Invalid manifest from addincommands dev catalog.";OfficeExt.WACUtils.logExceptionToBrowserConsole(l,j);Telemetry.RuntimeTelemetryHelper.LogExceptionTag(l,j,this._appCorrelationId,19203548);f._notifyHost(g,OSF.AgaveHostAction.NotifyHostError,c);return}};var r=function(a){OsfMsAjaxFactory.msAjaxDebug.trace("onClickRefreshfAddinCommands!");f._notifyHost(g,OSF.AgaveHostAction.RefreshAddinCommands,a)},G=function(){OsfMsAjaxFactory.msAjaxDebug.trace("onClickCancelDialog!");f._notifyHost(g,OSF.AgaveHostAction.CancelDialog);if(f._internalConversationId){f._serviceEndPointInternal.unregisterConversation(f._internalConversationId);f._internalConversationId=c}},y=function(a){var d=OSF.OUtil.Guid.generateNewGuid(),b=new OfficeExt.InsertDialogTelemetryContext(d),g=OfficeExt.CatalogFactory.resolve(OSF.StoreType.OMEX),h=new OfficeExt.PreCacher(f.getRequirementsChecker()),e={assetId:a.assetId,storeType:OSF.StoreType.OMEX,storeId:a.storeId,appVersion:"",targetType:c};g.activateAsync(e,h,b)},s=function(e,g){if(f._enableSingleSignOnForAddin&&e.webApplicationId)A(e,g);else{var c={assetId:e.id,clientVersion:f._getClientVersionForOmex(),clientName:f._getClientNameForOmex(),clientEndPoint:f._omexGatedWSProxy.clientEndPoint},h=f._insertDialogDiv,a={errorCode:OSF.InvokeResultCode.E_OEM_REMOVED_FAILED,forceRefreshEntitlements:b},j=OSF.OUtil.Guid.generateNewGuid(),i=new OfficeExt.InsertDialogTelemetryContext(j),k=OfficeExt.CatalogFactory.resolve(OSF.StoreType.OMEX);k.removeAsync([c.assetId],i,function(i){var m=0;if(i.status==OfficeExt.DataServiceResultCode.Succeeded&&i.value&&i.value.removedApps&&i.value.removedApps.length>0){for(var l=i.value.removedApps,k=OSF.InvokeResultCode.E_OEM_REMOVED_FAILED,j=0;j<l.length;j++)if(l[j].assetId==c.assetId){if(l[j].result==OSF.OmexRemoveAppStatus.Success)k=OSF.InvokeResultCode.S_OK;break}if(k==OSF.InvokeResultCode.S_OK){m=f.untrustOsfControls(e);q(c.assetId)}a.errorCode=k}var n=!document.documentElement.contains(h);Telemetry.AppManagementMenuHelper.LogAppManagementMenuAction(c.assetId,OSF.AppManagementAction.Remove,m,n,b,a.errorCode);a.forceRefreshEntitlements=d;g(a)})}},F=function(a){var b=f.getOsfControl(a.id);if(!b)OsfMsAjaxFactory.msAjaxDebug.trace("osfControl for the given ID doesn't exist:"+a.id);else b._isAddinCommands(function(b){b&&f._notifyHost(g,OSF.AgaveHostAction.RemoveAppCommandsAddin,{assetId:a.id})})},q=function(a){var b={solutionId:a};f._appName==OSF.AppName.ExcelWebApp&&f._notifyHost(g,OSF.AgaveHostAction.UninstallCustomFunctions,b)},A=function(c,j){var h=f._hideAppsExtensionUrl+"&"+OSF.OmexPageParameterKeys.AppName+"="+OSF.getModernAppVerCode(f._appName)+"&"+OSF.OmexPageParameterKeys.AssetId+"="+c.id+"&"+OSF.OmexPageParameterKeys.AppCorrelationId+"="+f._contextMgrCorrelationId,a=document.createElement("iframe");a.setAttribute("id","serviceExtensionIframe");a.setAttribute("src",h);a.setAttribute("scrolling","auto");a.setAttribute("border",g);a.setAttribute("width",g);a.setAttribute("height",g);a.setAttribute("style","position: absolute; left: -100px; top:0px;");document.body.appendChild(a);var i=f._insertDialogDiv,e=function(o){if(o.source==a.contentWindow){var g={errorCode:OSF.InvokeResultCode.E_OEM_REMOVED_FAILED,forceRefreshEntitlements:b};document.body.removeChild(a);window.removeEventListener("message",e);var l=0,n=JSON.parse(o.data),r=parseInt(n[OSF.OmexRemoveAddinMessageKeys.RemoveAddinResultCode]),h=OSF.InvokeResultCode.E_OEM_REMOVED_FAILED;if(r===OSF.OmexRemoveAddinResultCode.Success){for(var m=n[OSF.OmexRemoveAddinMessageKeys.RemoveAddinResultValue],k=0;k<m.length;k++)if(m[k]==c.id){h=OSF.InvokeResultCode.S_OK;break}if(h==OSF.InvokeResultCode.S_OK){l=f.untrustOsfControls(c);E(c.id);q(c.id)}g.errorCode=h}var p=!document.documentElement.contains(i);Telemetry.AppManagementMenuHelper.LogAppManagementMenuAction(c.id,OSF.AppManagementAction.Remove,l,p,b,g.errorCode);g.forceRefreshEntitlements=d;j(g)}};window.addEventListener("message",e)},E=function(c){var a=".*",b=[];b.push(new RegExp(OSF.OUtil.formatString(OfficeExt.WACUtils.CacheConstants.EntitlementsKey,a,a),"i"));b.push(new RegExp(OSF.OUtil.formatString(OfficeExt.WACUtils.CacheConstants.AuthenticatedAppInstallInfoCacheKey,a,c,a,a),"i"));OfficeExt.WACUtils.removeMatchesFromLocalStorage(b)},C=function(h){for(var c=[],o=h.length,a,e=0;e<o;e++){a=h[e];var m=OSF.OUtil.formatString(OfficeExt.WACUtils.CacheConstants.AppStateCacheKey,OfficeExt.WACUtils.CacheConstants.GatedCacheKeyPrefix,a.contentMarket,a.assetId),j=OSF.OUtil.formatString(OfficeExt.WACUtils.CacheConstants.AppInstallInfoKey,OfficeExt.WACUtils.CacheConstants.AnonymousCacheKeyPrefix,a.assetId,a.contentMarket),n=OSF.OUtil.formatString(OfficeExt.WACUtils.CacheConstants.AppDetailKey,OfficeExt.WACUtils.CacheConstants.UngatedCacheKeyPrefix,a.assetId),l=OSF.OUtil.formatString(OfficeExt.WACUtils.CacheConstants.ActivatedCacheKey,a.assetId.toLowerCase(),OSF.StoreType.OMEX,a.contentMarket),k=OSF.OUtil.formatString("{0}.{1}.{2}",a.assetId,a.storeId,a.contentMarket);c[m]=d;c[j]=d;c[n]=d;c[l]=d;c[k]=d}for(var g=OSF.OUtil.getLocalStorage(),i=g.getKeysWithPrefix("__OSF_"),e=0,p=i.length;e<p;e++){var b=i[e];if(b.indexOf(OfficeExt.WACUtils.CacheConstants.GatedCacheKeyPrefix+OfficeExt.WACUtils.CacheConstants.AppState)==0||b.indexOf(OfficeExt.WACUtils.CacheConstants.AnonymousCacheKeyPrefix+OfficeExt.WACUtils.CacheConstants.AppInstallInfo)==0||b.indexOf(OfficeExt.WACUtils.CacheConstants.UngatedCacheKeyPrefix+OfficeExt.WACUtils.CacheConstants.AppDetails)==0||b.indexOf(OfficeExt.WACUtils.CacheConstants.ActivatedCacheKeyPrefix)==0)c[b]!=d&&g.removeItem(b);else if(b.indexOf(OfficeExt.WACUtils.CacheConstants.GatedCacheKeyPrefix+OfficeExt.WACUtils.CacheConstants.AppinstallAuthenticated)==0){var f=b.replace(OfficeExt.WACUtils.CacheConstants.GatedCacheKeyPrefix+OfficeExt.WACUtils.CacheConstants.AppinstallAuthenticated,"");f=f.substring(f.indexOf(".")+1);c[f]!=d&&g.removeItem(b)}}},B=function(a){switch(a.datapointName){case OSF.DataPointNames.AppManagementMenu:OSF.OUtil.validateParamObject(a,{assetId:{type:String,mayBeNull:b},operationMetadata:{type:Number,mayBeNull:b},hrStatus:{type:Number,mayBeNull:b}},c);Telemetry.AppManagementMenuHelper.LogAppManagementMenuAction(a.assetId,a.operationMetadata,0,b,b,a.hrStatus);break;case OSF.DataPointNames.InsertionDialogSession:OSF.OUtil.validateParamObject(a,{assetId:{type:String,mayBeNull:b},totalSessionTime:{type:Number,mayBeNull:b},trustPageSessionTime:{type:Number,mayBeNull:b},appInserted:{type:Boolean,mayBeNull:b},lastActiveTab:{type:Number,mayBeNull:b},lastActiveTabCount:{type:Number,mayBeNull:b}},c);Telemetry.InsertionDialogSessionHelper.LogInsertionDialogSession(a.assetId,a.totalSessionTime,a.trustPageSessionTime,a.appInserted,a.lastActiveTab,a.lastActiveTabCount);break;case OSF.DataPointNames.UploadFileDevCatelog:OSF.OUtil.validateParamObject(a,{operationMetadata:{type:Number,mayBeNull:b},hrStatus:{type:Number,mayBeNull:b}},c);Telemetry.UploadFileDevCatelogHelper.LogUploadFileDevCatelogAction(this._appCorrelationId,a.operationMetadata,0,b,b,a.hrStatus);break;case OSF.DataPointNames.UploadFileDevCatalogUsage:OSF.OUtil.validateParamObject(a,{currentStoreType:{type:String,mayBeNull:b},id:{type:String,mayBeNull:d},appVersion:{type:String,mayBeNull:d},appTargetType:{type:Number,mayBeNull:b},isAppCommand:{type:String,mayBeNull:b},appSizeWidth:{type:Number,mayBeNull:d},appSizeHeight:{type:Number,mayBeNull:d}},c);Telemetry.UploadFileDevCatalogUsageHelper.LogUploadFileDevCatalogUsageAction(this._appCorrelationId,a.currentStoreType,a.Id,a.appVersion,a.appTargetType,a.isAppCommand,a.appSizeWidth,a.appSizeHeight)}};a._serviceEndPoint=Microsoft.Office.Common.XdmCommunicationManager.createServiceEndPoint(a._clientId);a._serviceEndPoint._onHandleRequestError=function(h,g){var e="DdaMethod",b,a;if(h&&(b=h._data)){if(typeof b===i&&typeof b[e]===i)a=b[e]["ControlId"];else a=typeof b===i?b[0]:b;a=typeof a===k?a:c;var d;if(a&&(d=f.getOsfControl(a))){if(g==="Failed origin check")d._pageStatus=OSF.OsfControlPageStatus.FailedOriginCheck;else if(g==="Access Denied")d._pageStatus=OSF.OsfControlPageStatus.FailedPermissionCheck;else d._pageStatus=OSF.OsfControlPageStatus.FailedHandleRequest;Telemetry.RuntimeTelemetryHelper.LogExceptionTag(g,c,d.getCorrelationId(),19203549)}}};a._serviceEndPoint.registerMethod("ContextActivationManager_getAppContextAsync",H,Microsoft.Office.Common.InvokeType.async,b);a._serviceEndPoint.registerMethod("ContextActivationManager_notifyHost",P,Microsoft.Office.Common.InvokeType.async,b);a._serviceEndPoint.registerMethod("ContextActivationManager_openWindowInHost",w,Microsoft.Office.Common.InvokeType.async,b);a._enableServiceDeliveredExperience&&a._serviceEndPoint.registerMethod("Office_sendMessageToHost",K,Microsoft.Office.Common.InvokeType.async,b);a._serviceEndPointInternal=Microsoft.Office.Common.XdmCommunicationManager.createServiceEndPoint(a._clientId+OSF.Constants.EndPointInternalSuffix);a._serviceEndPointInternal.registerMethod("ContextActivationManager_getEntitlementsForInsertDialog",p,Microsoft.Office.Common.InvokeType.async,b);a._serviceEndPointInternal.registerMethod("ContextActivationManager_invokeSignIn",N,Microsoft.Office.Common.InvokeType.async,b);a._serviceEndPointInternal.registerMethod("ContextActivationManager_invokeSignOut",M,Microsoft.Office.Common.InvokeType.async,b);a._serviceEndPointInternal.registerMethod("ContextActivationManager_invokeWindowOpen",J,Microsoft.Office.Common.InvokeType.async,b);a._serviceEndPointInternal.registerMethod("ContextActivationManager_onClickInsertOsfControl",D,Microsoft.Office.Common.InvokeType.async,b);a._serviceEndPointInternal.registerMethod("ContextActivationManager_onClickInstallOsfControl",a._onClickInstallOsfControl,Microsoft.Office.Common.InvokeType.async,b);a._serviceEndPointInternal.registerMethod("ContextActivationManager_onClickRefreshAddinCommands",r,Microsoft.Office.Common.InvokeType.async,b);a._serviceEndPointInternal.registerMethod("ContextActivationManager_onClickCancelDialog",G,Microsoft.Office.Common.InvokeType.async,b);a._serviceEndPointInternal.registerMethod("ContextActivationManager_removeAppForInsertDialog",s,Microsoft.Office.Common.InvokeType.async,b);a._serviceEndPointInternal.registerMethod("ContextActivationManager_logTelemetryDataForInsertDialog",B,Microsoft.Office.Common.InvokeType.async,b);a._serviceEndPointInternal.registerMethod("ContextActivationManager_getOmexData",y,Microsoft.Office.Common.InvokeType.async,b);a._serviceEndPointInternal.registerMethod("ContextActivationManager_removeAppCommandsAddin",F,Microsoft.Office.Common.InvokeType.async,b);OSF.AppSpecificSetup._setupFacade(a._hostControl,a,a._serviceEndPoint,a._serviceEndPointInternal);e.hostType=a._hostType;e.spBaseUrl=a._spBaseUrl;OfficeExt.CatalogFactory.setHostContext(e);a._localeStringLoadingPendingCallbacks=[];if(a._localizedScriptsUrl&&a._localizedScriptsUrl!="null/"){var I=function(){this._ErrorUXHelper=new OSF._ErrorUXHelper(this)};a._loadLocaleString(Function.createDelegate(a,I))}a.queryEntitlementDetails=function(a){p(a,a.callbackFunc)};a._getOmexData=function(a){y(a)};a._removeAppForInsertDialog=function(a){s(a,a.callbackFunc)};var L=function(e,h){var a="wacUpn is null.",g=function(a){var b=d;OfficeExt.WACUtils.logExceptionToBrowserConsole("Check UPN result: "+a.value,c);if(a.status===OfficeExt.DataServiceResultCode.Succeeded)b=a.value;else Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("Upn Check failed.",c,588814298);h(b)},f=OfficeExt.CatalogFactory.resolve(OSF.StoreType.SPCatalog);if(f!=c&&e!=c)f.isUpnMatchAsync(e,new OfficeExt.SimpleTelemetryContext,g);else{if(e==c){OfficeExt.WACUtils.logExceptionToBrowserConsole(a,c);Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag(a,c,588814299)}e==c&&Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("spcatalog is null.",c,588814300);g({status:OfficeExt.DataServiceResultCode.Failed,value:b})}};a._enableUpnCheck&&a._enableMyOrg&&a._spBaseUrl!=c&&L(a._wacUpn,function(a){if(a)z._upnCheckResult=OSF.UpnCheckCode.Match;else z._upnCheckResult=OSF.UpnCheckCode.NotMatch})};OSF.ContextActivationManager.prototype={insertOsfControl:function(a){var b=true,d=false,e=this;OSF.OUtil.validateParamObject(a,{div:{type:Object,mayBeNull:d},id:{type:String,mayBeNull:d},marketplaceID:{type:String,mayBeNull:d},marketplaceVersion:{type:String,mayBeNull:d},store:{type:String,mayBeNull:d},storeType:{type:String,mayBeNull:d},alternateReference:{type:Object,mayBeNull:b},settings:{type:Object,mayBeNull:b},reason:{type:String,mayBeNull:b},osfControlType:{type:Number,mayBeNull:b},snapshotUrl:{type:String,mayBeNull:b},preactivationCallback:{type:Object,mayBeNull:b},virtualOsfControlActivationCallback:{type:Object,mayBeNull:b},isvirtualOsfControl:{type:Boolean,mayBeNull:b},isDialog:{type:Boolean,mayBeNull:b},hostCustomMessage:{type:String,mayBeNull:b},isForUILessAction:{type:Boolean,mayBeNull:b},ownerAddinAssetId:{type:String,mayBeNull:b},ownerAddinStoreType:{type:String,mayBeNull:b},sourceLocationOverrideUrl:{type:String,mayBeNull:b},focusOnIframeWhenLoaded:{type:Boolean,mayBeNull:b},featureGates:{type:Object,mayBeNull:b},activationStart:{type:Number,mayBeNull:b},hostInfoFlags:{type:Number,mayBeNull:b},sharedRuntimeId:{type:String,mayBeNull:b},initialDisplayMode:{type:Number,mayBeNull:b}},null);var g=d;if(OSF.OUtil.checkFlight(OSF.FlightNames.AddInsInSupportedIrmDocsIsEnabled))g=OSF.OsfControl.isFirstPartyStoreString(a.storeType);else g=a.storeType.toLowerCase()==OSF.StoreType.FirstParty.toLowerCase();if(e._disableAppsForOfficeThirdParty&&!g)return;var f={div:a.div,id:a.id,marketplaceID:a.marketplaceID,marketplaceVersion:a.marketplaceVersion,store:a.store,storeType:a.storeType,alternateReference:a.alternateReference,settings:a.settings,reason:a.reason,osfControlType:a.osfControlType,snapshotUrl:a.snapshotUrl,contextActivationMgr:e,preactivationCallback:a.preactivationCallback,virtualOsfControlActivationCallback:a.virtualOsfControlActivationCallback,isvirtualOsfControl:a.isvirtualOsfControl,isDialog:a.isDialog,hostCustomMessage:a.hostCustomMessage,isForUILessAction:a.isForUILessAction,ownerAddinAssetId:a.ownerAddinAssetId,sourceLocationOverrideResourceId:a.sourceLocationOverrideResourceId,sourceLocationOverrideUrl:a.sourceLocationOverrideUrl,ownerAddinStoreType:a.ownerAddinStoreType,focusOnIframeWhenLoaded:a.focusOnIframeWhenLoaded,featureGates:a.featureGates,activationStart:a.activationStart,hostInfoFlags:a.hostInfoFlags,sharedRuntimeId:a.sharedRuntimeId,initialDisplayMode:a.initialDisplayMode},h=e.getSQMAgaveUsage(f.storeType,f.osfControlType,f.reason,a.marketplaceID),c=new OSF.OsfControl(f);c._sqmDWords[0]=h[0];c._sqmDWords[1]=h[1];c._contextActivationMgr._ErrorUXHelper&&c._contextActivationMgr._ErrorUXHelper.showProgress(c._div,c._id);var i=function(){c.activate({isInsertOsfControl:b});Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("OsfControl activation lifecycle: OsfControl active got called for controlId: "+c._id,this._contextMgrCorrelationId,594356321)};e._loadLocaleString(Function.createDelegate(e,i));return c},insertDialogControl:function(a){var b=false;OSF.OUtil.validateParamObject(a,{div:{type:Object,mayBeNull:b},id:{type:String,mayBeNull:b},dialogUrl:{type:String,mayBeNull:b},marketplaceID:{type:String,mayBeNull:b},marketplaceVersion:{type:String,mayBeNull:b},appDomains:{type:Array,mayBeNull:b},store:{type:String,mayBeNull:b},storeType:{type:String,mayBeNull:b},agaveName:{type:String,mayBeNull:true}},null);var c={div:a.div,id:a.id,marketplaceID:a.marketplaceID,marketplaceVersion:a.marketplaceVersion,store:a.store,storeType:a.storeType,isDialog:true,contextActivationMgr:this},d=new OSF.OsfControl(c);d.createIframeForDialogControl(a.agaveName,a.dialogUrl,a.appDomains)},insertBlankControlWithErrorUX:function(a,h){var b=false,d=this;OSF.OUtil.validateParamObject(a,{div:{type:Object,mayBeNull:b},id:{type:String,mayBeNull:b},marketplaceID:{type:String,mayBeNull:b},marketplaceVersion:{type:String,mayBeNull:b},store:{type:String,mayBeNull:b},osfControlType:{type:Number,mayBeNull:true},storeType:{type:String,mayBeNull:b}},null);var g={div:a.div,id:a.id,marketplaceID:a.marketplaceID,marketplaceVersion:a.marketplaceVersion,store:a.store,storeType:a.storeType,osfControlType:a.osfControlType,contextActivationMgr:d,isvirtualOsfControl:b},c=new OSF.OsfControl(g);c._contextActivationMgr.registerOsfControl(c);var f=function(c,h){var a,d="",e="",g="",f=b;if(c.status===OfficeExt.DataServiceResultCode.Succeeded&&c.value){a=c.value;d=a.getDefaultDisplayName();e=a.getProviderName();g=a.getDefaultIconUrl();f=a.isSSOAddin()}h(d,e,g,f)},k=OfficeExt.OmexUtils.getOmexEndPointPageUrl(d.getOsfOmexBaseUrl(),a.marketplaceID,a.store),e=OfficeExt.CatalogFactory.resolve(a.storeType.toLowerCase());if(e!=null){var i={assetId:a.marketplaceID,appVersion:a.marketplaceVersion,storeType:a.storeType,storeId:a.store,targetType:null},j=OSF.OmexClientNames[d._appName];e.getAndCacheManifest(i,d._storeLocator,new OfficeExt.AddinCommandsTelemetryContext(c.getCorrelationId()),function(b){f(b,function(d,b,f,e){c._showTrustError(j,d,b,f,a.storeType,h,k,e)})})}},purgeDialogControl:function(c){var b=Function._validateParams(arguments,[{name:"id",type:String,mayBeNull:false}]);if(b)throw b;var a=this._cachedOsfControls[c];if(typeof a!="undefined"){a._conversationId&&this._getServiceEndPoint().unregisterConversation(a._conversationId);this.unregisterOsfControl(a)}},dispose:function(){var a=this;if(a._serviceEndPoint){a._serviceEndPoint.dispose();Microsoft.Office.Common.XdmCommunicationManager.deleteServiceEndPoint(a._clientId);a._serviceEndPoint=null}if(a._serviceEndPointInternal){a._serviceEndPointInternal.dispose();Microsoft.Office.Common.XdmCommunicationManager.deleteServiceEndPoint(a._clientId+OSF.Constants.EndPointInternalSuffix);a._serviceEndPointInternal=null}},setLocalizedUrl:function(d,e,f){var a=this,b=Function._validateParams(arguments,[{name:"scriptUrl",type:String,mayBeNull:false},{name:"imageUrl",type:String,mayBeNull:false},{name:"styleUrl",type:String,mayBeNull:false}]);if(b)throw b;a._localizedScriptsUrl=d;a._localizedImagesUrl=e;a._localizedStylesUrl=f;if(a._localizedScriptsUrl&&a._localizedScriptsUrl!="null/"){var c=function(){if(!this._ErrorUXHelper)this._ErrorUXHelper=new OSF._ErrorUXHelper(this)};a._loadLocaleString(Function.createDelegate(a,c))}},getOsfControlStatus:function(b){var a=this._cachedOsfControls[b];if(a)return a.getStatus();return OSF.OsfControlStatus.InvalidOsfControl},hostCheckReadyHandler:function(e,b){var a=this;if(a._isHostFrameTrusted==null||a._notReadyOsfControlsIndex==null)return;if(b!=null)a._isHostFrameTrusted=b;Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("Host frame check set :"+JSON.stringify(b),a._contextMgrCorrelationId,595354008);for(var c=0;c<a._notReadyOsfControlsIndex;c++){var d=a._notReadyOsfControls[c];d&&d.refresh()}},activateOsfControl:function(c){var b=Function._validateParams(arguments,[{name:"id",type:String,mayBeNull:false}]);if(b)throw b;var a=this._cachedOsfControls[c];typeof a!="undefined"&&a.activate()},deActivateOsfControl:function(c){var b=Function._validateParams(arguments,[{name:"id",type:String,mayBeNull:false}]);if(b)throw b;var a=this._cachedOsfControls[c];typeof a!="undefined"&&a.deActivate()},purgeOsfControl:function(b,d){var c=Function._validateParams(arguments,[{name:"id",type:String,mayBeNull:false},{name:"purgeManifest",type:Boolean,mayBeNull:false}]);if(c)throw c;var a=this._cachedOsfControls[b];if(typeof a!="undefined"){Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("OsfControl activation lifecycle: purgeOsfControl for controlId: "+b,this._contextMgrCorrelationId,594356320);a.purge(d)}},purgeOsfControlNotifications:function(){for(var a in this._cachedOsfControls)this._ErrorUXHelper.purgeOsfControlNotification(a)},untrustOsfControls:function(a){var c=this,d=0,e=function(a){return function(){a.activate({hasConsent:true})}},g=OSF.OUtil.formatString(OSF.Constants.ActivatedCacheKey,a.id.toLowerCase(),a.currentStoreType,a.storeId);c._deleteCachedFlag(g);for(var i in c._cachedOsfControls){var b=c._cachedOsfControls[i];if(b._marketplaceID.toLowerCase()==a.id.toLowerCase()){c._ErrorUXHelper.purgeOsfControlNotification(b._id);b.deActivate();var h=OfficeExt.OmexUtils.getOmexEndPointPageUrl(c.getOsfOmexBaseUrl(),b._marketplaceID,a.storeId),f=OSF.OmexClientNames[c._appName];b._showTrustError(f,a.displayName,a.providerName,a.iconUrl,a.currentStoreType,e(b),h);d++}}return d},retryAll:function(d){var b=this;for(var c in b._cachedOsfControls){var a=b._cachedOsfControls[c];if(a._marketplaceID.toLowerCase()==d.toLowerCase())if(a._retryActivate){b._ErrorUXHelper.purgeOsfControlNotification(a._id);b._ErrorUXHelper.removeInfoBarDiv(c,false);a._retryActivate();a._retryActivate=null}}},validateAndCacheNewDevAddinManifest:function(b){var a=this;a._getDevAddinManifestContent(b,a._validateAndCacheNewDevAddinManifest.bind(a),a._notifyHost.bind(a))},_getDevAddinManifestContent:function(b,f,d){var a;try{a=new XMLHttpRequest;a.onreadystatechange=function(){if(a.readyState==4&&a.status==200)return f(a.responseText);if(a.readyState==4&&a.status==0)return d("0",OSF.AgaveHostAction.InsertDevManifestError,{manifestUrl:b})};a.open("GET",b,true);a.send()}catch(c){var e="Cannot access developer manifest url.";OfficeExt.WACUtils.logExceptionToBrowserConsole(e,c);Telemetry.RuntimeTelemetryHelper.LogExceptionTag(e,c,this._appCorrelationId,587338073);return d("0",OSF.AgaveHostAction.InsertDevManifestError,{manifestUrl:b})}},_validateAndCacheNewDevAddinManifest:function(f){var h="developer",b=this;try{var a=new OSF.Manifest.Manifest(f,b.getAppUILocale()),c=a.getMarketplaceID(),d=a.getMarketplaceVersion(),i=OfficeExt.CatalogFactory.resolve(OSF.StoreType.UploadFileDevCatalog);if(i.validateAndCacheNewManifest(c,d,f,a)){var g={id:c,targetType:a.getTarget(),appVersion:d,currentStoreType:OSF.StoreType.UploadFileDevCatalog,storeId:h,assetId:c,assetStoreId:OSF.StoreType.UploadFileDevCatalog,width:parseInt(a.getDefaultWidth()||"0"),height:parseInt(a.getDefaultHeight()||"0"),isAddinCommands:a._isAddinCommandsManifest(OSF.getManifestHostType(b._hostType))};OSF.OUtil.validateParamObject(g,{id:{type:String,mayBeNull:false},targetType:{type:Number,mayBeNull:false},appVersion:{type:String,mayBeNull:false},width:{type:Number,mayBeNull:true},height:{type:Number,mayBeNull:true}},null);i.localCacheAddinCommands(c,d,h);var k=OSF.OUtil.getLocalStorage();k.setItem(c,"true");return b._notifyHost("0",OSF.AgaveHostAction.InsertDevManifest,g)}else return b._notifyHost("0",OSF.AgaveHostAction.NotifyHostError,null)}catch(e){var j="Invalid developer addin manifest.";OfficeExt.WACUtils.logExceptionToBrowserConsole(j,e);Telemetry.RuntimeTelemetryHelper.LogExceptionTag(j,e,b._appCorrelationId,587338074);return b._notifyHost("0",OSF.AgaveHostAction.NotifyHostError,null)}},getOsfControl:function(b){var a=Function._validateParams(arguments,[{name:"id",type:String,mayBeNull:false}]);if(a)throw a;return this._cachedOsfControls[b]},getOsfControls:function(){var a=[];for(var b in this._cachedOsfControls)a.push(this._cachedOsfControls[b]);return a},getOsfOmexBaseUrl:function(){return this._osfOmexBaseUrl},getAppName:function(){return this._appName},getClientMode:function(){return this._clientMode},getClientId:function(){return this._clientId},getFormFactor:function(){return this._formFactor},getDocUrl:function(){return this._docUrl},getAppUILocale:function(){return this._appUILocale},getDataLocale:function(){return this._dataLocale},getPageBaseUrl:function(){return this._pageBaseUrl},getLcid:function(){return this._lcid},isExternalMarketplaceAllowed:function(){return this._allowExternalMarketplace},isStoreDisabled:function(a){var b=function(){var b=OfficeExt.CatalogFactory.resolve(OSF.StoreType.OMEX),d=OSF.OUtil.Guid.generateNewGuid(),c=new OfficeExt.InsertDialogTelemetryContext(d);if(b instanceof OfficeExt.OmexCatalog)b.isStoreDisabled(c,a);else{var e={value:false,status:200};a(e)}};this._loadLocaleString(Function.createDelegate(this,b))},getLocalizedScriptsUrl:function(){return this._localizedScriptsUrl?this._localizedScriptsUrl:""},getLocalizedImagesUrl:function(){return this._localizedImagesUrl?this._localizedImagesUrl:""},getLocalizedStylesUrl:function(){return this._localizedStylesUrl?this._localizedStylesUrl:""},raiseOsfControlStatusChange:function(a){this._controlStatusChanged&&this._controlStatusChanged(a)},registerOsfControl:function(a){var b=Function._validateParams(arguments,[{name:"osfControl",type:Object,mayBeNull:false}]);if(b)throw b;this._cachedOsfControls[a.getID()]=a},registerNotReadyOsfControl:function(b){var a=Function._validateParams(arguments,[{name:"osfControl",type:Object,mayBeNull:false}]);if(a)throw a;this._notReadyOsfControls[this._notReadyOsfControlsIndex]=b;this._notReadyOsfControlsIndex++},unregisterOsfControl:function(b){var a=Function._validateParams(arguments,[{name:"osfControl",type:Object,mayBeNull:false}]);if(a)throw a;delete this._cachedOsfControls[b.getID()]},setIframeAttributeBag:function(a){this._iframeAttributeBag=a},displayNotification:function(a){var g=null,b=true,d=false,f=this;OSF.OUtil.validateParamObject(a,{infoType:{type:Number,mayBeNull:d},id:{type:String,mayBeNull:d},title:{type:String,mayBeNull:d},description:{type:String,mayBeNull:d},url:{type:String,mayBeNull:b},icon:{type:String,mayBeNull:b},buttonTxt:{type:String,mayBeNull:b},buttonCallback:{type:Function,mayBeNull:b},dismissCallback:{type:Function,mayBeNull:b},"displayDeactive ":{type:Boolean,mayBeNull:b},highPriority:{type:Boolean,mayBeNull:b},detailView:{type:Boolean,mayBeNull:b},reDisplay:{type:Boolean,mayBeNull:b},logAsError:{type:Boolean,mayBeNull:b},errorCode:{type:Number,mayBeNull:b},retryAll:{type:Boolean,mayBeNull:b},iframeNotificationUrl:{type:String,mayBeNull:b},notificationType:{type:Number,mayBeNull:b}},g);if(!a.errorCode)a.errorCode=0;var c=f._cachedOsfControls[a.id];if(c)if(c._isvirtualOsfControl){if(a.errorCode==OSF.ErrorStatusCodes.E_OEM_OMEX_EXTENSION_KILLED||a.errorCode==OSF.ErrorStatusCodes.E_OEM_EXTENSION_KILLED){f.purgeOsfControl(a.id,b);return}if(a.highPriority==undefined)a.highPriority=a.infoType===OSF.InfoType.Error?b:d;if(a.highPriority===d)c._notificationParams.push(a);else{for(var e=c._notificationParams,h=0;h<e.length;h++)if(!e[h].highPriority){e.splice(h,0,a);e=g;break}e!=g&&e.push(a)}!c._isvirtualOsfControlCallbackInvoked&&c.ensureToGetVirtualOsfControlManifest(function(a){c.invokeVirtualOsfControlActivationCallback(a)});!c._isManifestProcessedForCustomFunctions&&c.ensureToGetVirtualOsfControlManifest(function(a){c.processManifestForCustomFunctions(a)})}else{if(a.logAsError){Telemetry.AppLoadTimeHelper.SetErrorResult(c._telemetryContext,a.errorCode);if(f._notifyHostError){var i={errorCode:a.errorCode};f._notifyHostError(a.id,OSF.AgaveHostAction.NotifyHostError,i)}}if(a.displayDeactive||a.iframeNotificationUrl!=g)a.detailView=b;a["div"]=c._div;f._ErrorUXHelper.showNotification(a)}},dismissMessages:function(a){this._ErrorUXHelper&&this._ErrorUXHelper.dismissMessages(a)},notifyAgave:function(c,a){var d=Function._validateParams(arguments,[{name:"id",type:String,mayBeNull:false},{name:"actionId",type:Number,mayBeNull:false}]);if(d)throw d;var b=this._cachedOsfControls[c];if(typeof b!="undefined")if(a===OSF.AgaveHostAction.CtrlF6In||a===OSF.AgaveHostAction.TabIn||a===OSF.AgaveHostAction.Select)this._ErrorUXHelper.focusOnNotificationUx(c,a);else if(a===OSF.AgaveHostAction.TabInShift&&b._pageStatus!==OSF.OsfControlPageStatus.Ready)this._ErrorUXHelper.focusOnNotificationUxShiftIn(c,a);else b.notifyAgave(a)},setWSA:function(b){var a=this;a._wsa=b;if(a._wsa){a._wsa.createStreamUnobfuscated(OSF.SQMDataPoints.DATAID_APPSFOROFFICEUSAGE,OSF.BWsaStreamTypes.Static,2,OSF.BWsaConfig.defaultMaxStreamRows);a._wsa.createStreamUnobfuscated(OSF.SQMDataPoints.DATAID_APPSFOROFFICENOTIFICATIONS,OSF.BWsaStreamTypes.Static,4,OSF.BWsaConfig.defaultMaxStreamRows)}},getWSA:function(){return this._wsa},getSQMAgaveUsage:function(h,i,f,b){var a;switch(h.toLowerCase()){case OSF.StoreType.OMEX:a=0;break;case OSF.StoreType.SPCatalog:a=1;break;case OSF.StoreType.FileSystem:a=2;break;case OSF.StoreType.Registry:a=3;break;case OSF.StoreType.Exchange:a=4;break;case OSF.StoreType.SPApp:a=5;break;case OSF.StoreType.FirstParty:a=6;break;case OSF.StoreType.Sdx:a=7;break;case OSF.StoreType.InMemory:a=8;break;case OSF.StoreType.OneDrive:a=9;break;case OSF.StoreType.PrivateCatalog:a=10;break;case OSF.StoreType.HardCodedPreinstall:a=11;break;case OSF.StoreType.UploadFileDevCatalog:a=12;break;default:a=15}var d;switch(i){case OSF.OsfControlType.DocumentLevel:d=1;break;case OSF.OsfControlType.ContainerLevel:d=0;break;default:d=2}var e=7;if(f&&f.toLowerCase)switch(f.toLowerCase()){case Microsoft.Office.WebExtension.InitializationReason.Inserted.toLowerCase():e=0;break;case Microsoft.Office.WebExtension.InitializationReason.DocumentOpened.toLowerCase():e=1}var c=0;if(b.toLowerCase().indexOf("wa")===0||b.toLowerCase().indexOf("fa")===0){c=b&&b.length>2?parseInt(b.substring(2),10):0;if(isNaN(c))c=0}var g=0;g=e<<8|d<<4|a;return [g,c]},isMyOrgReady:function(b){var a=this;if(!a._enableMyOrg){b({isReady:false});return}if(a._spBaseUrl&&a._iframeProxies&&a._iframeProxies[a._spBaseUrl]&&a._iframeProxies[a._spBaseUrl].clientEndPoint){b({isReady:true,clientEndPoint:a._iframeProxies[a._spBaseUrl].clientEndPoint});return}var c=function(a){if(a)b({isReady:true,clientEndPoint:a});else b({isReady:false})};a._createSharePointIFrameProxy(a._spBaseUrl,c)},openInputUrlDialog:function(e){var c="style",f=this,d=document.createElement("p"),i="title-p";d.setAttribute("id",i);if(f._enableInsertDialogAccessibilityFix)if(document.documentElement.getAttribute("dir")=="ltr")d.setAttribute(c,"padding: 26px 0px 10px 26px;");else d.setAttribute(c,"padding: 26px 26px 10px 0px;");else d.setAttribute(c,"margin: 26px 0px 10px 26px;");d.textContent="DevCatalog server Url is configured in settings.xml - Enter manifest file name only (AppId.xml):";e.appendChild(d);var h=document.createElement("div"),a=document.createElement("input");a.setAttribute("type","url");a.setAttribute("id","url-input");a.setAttribute("aria-labelledby",i);a.setAttribute("data-lpignore","true");if(f._enableInsertDialogAccessibilityFix){if(document.documentElement.getAttribute("dir")=="ltr")a.setAttribute(c,"margin-left: 26px; height: 18px; width: calc(100% - 141px); vertical-align: middle;");else a.setAttribute(c,"margin-right: 26px; height: 18px; width: calc(100% - 141px); vertical-align: middle;");h.appendChild(a)}else{a.setAttribute("size","75");a.setAttribute(c,"margin-left: 26px; height: 18px; vertical-align: middle;");e.appendChild(a)}var g=f,j=function(c){var a=new OSF.Manifest.Manifest(c,g.getAppUILocale());!OSF.OsfManifestManager.hasManifest(a.getMarketplaceID(),a.getMarketplaceVersion())&&OSF.OsfManifestManager.cacheManifest(a.getMarketplaceID(),a.getMarketplaceVersion(),a);var b={id:a.getMarketplaceID(),targetType:a.getTarget(),appVersion:a.getMarketplaceVersion(),currentStoreType:OSF.StoreType.Registry,storeId:"developer",assetId:a.getMarketplaceID(),assetStoreId:OSF.StoreType.Registry,width:a.getDefaultWidth()||0,height:a.getDefaultHeight()||0,isAddinCommands:a._isAddinCommandsManifest(OSF.getManifestHostType(g._hostType))};Telemetry.UploadFileDevCatalogUsageHelper.LogUploadFileDevCatalogUsageAction(this._appCorrelationId,b.currentStoreType,b.id,b.appVersion,b.targetType,b.isAddinCommands,b.width,b.height);g._notifyHost("0",OSF.AgaveHostAction.InsertAgave,b)},k=function(a){alert("Error when requesting manifest file: "+a)},l=function(){OSF.OUtil.xhrGet(g._devCatalogUrl+"/"+a.value,j,k)},b=document.createElement("input");b.setAttribute("type","button");b.setAttribute("id","devcat-insert-button");b.setAttribute("value","Insert");b.setAttribute("class","WACButton WACDialogButtonNormal");OSF.OUtil.addEventListener(b,"click",l);if(f._enableInsertDialogAccessibilityFix){h.appendChild(b);e.appendChild(h)}else e.appendChild(b)},launchInsertDialog:function(e,n,g){var b=null,d="100%";e.childNodes.length!=0&&e.removeChild(e.childNodes.item(0));var l=OSF.OUtil.Guid.generateNewGuid(),k=new OfficeExt.InsertDialogTelemetryContext(l),c;if(this._enableDevCatalog){c=document.createElement("div");c.style.width=d;c.style.height="80%";e.appendChild(c);var h=document.createElement("div");h.style.width=d;h.style.height="20%";e.appendChild(h);this.openInputUrlDialog(h)}else c=e;var a=this;a._insertDialogDiv=c;var f=document.createElement("div");f.style.width=d;f.style.height=d;f.style.backgroundImage="url("+a.getLocalizedImageFilePath("progress.gif")+")";f.style.backgroundRepeat="no-repeat";f.style.backgroundPosition="center";c.appendChild(f);var o={MyApp:"0",MyOrg:"1",Store:"{98143890-AC66-440E-A448-ED8771A02D52}",OneDrive:"9"},i=function(c,d){if(!a._enableMyOrg){d({statusCode:OSF.InvokeResultCode.E_CATALOG_NO_APPS,value:b,context:c});return}try{OSF.OUtil.validateParamObject(c,{webUrl:{type:String,mayBeNull:false}},d);var f=function(a){if(a.isReady){c.clientEndPoint=a.clientEndPoint;var e=OfficeExt.CatalogFactory.resolve(OSF.StoreType.SPCatalog);e.getSPCatalogUrl(k,function(a){d({statusCode:a.status,value:a.value,context:c})})}else d({statusCode:OSF.InvokeResultCode.E_GENERIC_ERROR,value:b,context:c})};a.isMyOrgReady(f)}catch(e){Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Error when getting corporate catalog url:",e,this._appCorrelationId,34719254);d({statusCode:OSF.InvokeResultCode.E_GENERIC_ERROR,value:b,context:c});return}},j=function(f){var e=document.createElement("iframe");e.setAttribute("id","InsertDialog");e.setAttribute("src","about:blank");e.setAttribute("width",d);e.setAttribute("height",d);e.setAttribute("marginHeight","0");e.setAttribute("marginWidth","0");e.setAttribute("frameBorder","0");e.setAttribute("sandbox","allow-scripts allow-forms allow-same-origin ms-allow-popups allow-popups");typeof Strings!="undefined"&&Strings&&Strings.OsfRuntime&&e.setAttribute("title",Strings.OsfRuntime.L_InsertionDialogTile_TXT);var i=b,h=[];a.isStoreDisabled(function(z){var j='"}',k='], "url":"',d=",",x='{ "IsUploadFileDevCatalogEnabled":'+a._enableUploadFileDevCatalog+d+'"isStoreDisabled":'+z.value+d+'"showSignOutFromPrivateCatalogMessage":'+a._showSignOutFromPrivateCatalogMessage+d+'"enableInsertDialogAccessibilityFix":'+a._enableInsertDialogAccessibilityFix+d+'"enableAddinInsertDialogReflow":'+a._enableAddinInsertDialogReflow+d+'"isBlackForestRedirectEnabled":'+a._enableBlackForestRedirect+d+'"isHostDocumentDomain":'+a._isHostDocumentDomain+d+'"agaveAddinUploadEnabled":'+a._agaveAddinUploadEnabled+" }";if(a.isExternalMarketplaceAllowed()){var B=a._enableMyApps?OSF.InvokeResultCode.S_OK.toString():OSF.InvokeResultCode.S_HIDE_PROVIDER.toString(),t='{ "provValues":[0,0,0,'+B+k+a._osfOmexBaseUrl+'", "client":"'+a._getClientNameForOmex()+'", "'+OSF.OmexPageParameterKeys.AuthType+'":'+a._getAuthTypeForHideAppsExtensionUrl()+"}";h.push('"myApp":'+t);Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("isExternalMarketplaceAllowed is true, myApp tab show firstly.",a._contextMgrCorrelationId,20194266)}if(f&&f.value!=b){if(a._enableMyOrg){a._myOrgCatalogUrl=f.value;var s=f.statusCode,u='{ "provValues":[1,1,0,'+s+k+f.value+j;h.push('"myOrg":'+u)}if(a._enableOneDriveCatalog&&document.cookie.indexOf("OneDriveCatalog=true")!=-1){a._myOneDriveCatalogUrl=f.value;var r='{ "provValues":[9,9,0,0], "url":"'+f.value+j;h.push('"myOneDrive":'+r)}}if(a._enablePrivateCatalog){var q='{"provValues":[10,10,0,0], "client":"'+a._getClientNameForOmex()+j;h.push('"privateCatalog":'+q)}if(h.length>0)i="{"+h.join(", ")+"}";a._internalConversationId&&a._serviceEndPointInternal.unregisterConversation(a._internalConversationId);var A=a.getClientId()+"_"+a.getDocUrl(),y=OSF.OUtil.getFrameName(A),o=OSF.OUtil.generateConversationId();a._internalConversationId=OSF.OUtil.generateConversationId();e.setAttribute("name",y);var p=b;if(g!=b)p='{ "navigationMode":'+g.navigationMode+', "navigationModeParameter": "'+g.assetId+'", "category":"'+g.category+j;var w=window.location.origin,m="",v=[o,encodeURIComponent(w),a._appVersion,OSF.getAppVerCode(a._appName),a.getLcid(),OSF.Constants.FileVersion,encodeURIComponent(i),n,encodeURIComponent(x),encodeURIComponent(p),a._contextMgrCorrelationId];if(a._localizedResourcesUrl)m=a._localizedResourcesUrl+"WefGallery.htm?b="+OSF.Constants.FileVersion;else m=a._pageBaseUrl+a.getLcid()+"/WefGallery.htm?b="+OSF.Constants.FileVersion;var l=OSF.OUtil.addXdmInfoAsHash(m,v.join("|"));l=OSF.OUtil.addFlightsAsHash(l,JSON.stringify(OSF.Flights));a._serviceEndPointInternal.registerConversation(o,l);e.setAttribute("src",l);if(a._insertDialogDiv){c.childNodes.length!=0&&c.removeChild(c.childNodes.item(0));c.appendChild(e)}else{c.insertBefore(e,c.firstChild);a._insertDialogDiv=c}})},m={webUrl:a._spBaseUrl};i(m,j);a._preloadOfficeJs()},activateAgavesBlockedBySandboxNotSupport:function(){for(var b in this._cachedOsfControls){var a=this._cachedOsfControls[b];a._status===OSF.OsfControlStatus.NotSandBoxSupported&&a.activate()}},setRequirementsChecker:function(a){this._requirementsChecker=a},getRequirementsChecker:function(){return this._requirementsChecker},appHasNotifications:function(a){if(this._ErrorUXHelper)return this._ErrorUXHelper.appHasNotifications(a);return false},refreshOsfControl:function(d,c){var a=this;for(var b in a._cachedOsfControls)if(a._cachedOsfControls[b]&&d==a._cachedOsfControls[b]._marketplaceID&&c==a._cachedOsfControls[b]._sourceLocationOverrideResourceId){a._cachedOsfControls[b].refresh();break}},_doesUrlHaveSupportedProtocol:function(b){var a=false;if(b){var c=decodeURIComponent(b),d=c.match(/^https?:\/\/.+$/ig);a=d!=null}return a},_loadLocaleString:function(c){var a=this;if(typeof Strings=="undefined"||!Strings||!Strings.OsfRuntime){a._localeStringLoadingPendingCallbacks.push(c);var b=a._localeStringLoadingPendingCallbacks;if(b.length===1){var e=function(){for(var d=b.length,c=0;c<d;c++){var a=b.shift();typeof a=="function"&&a()}};a._loadStringScript(e)}}else{for(var f=a._localeStringLoadingPendingCallbacks.length,d=0;d<f;d++){var g=a._localeStringLoadingPendingCallbacks.shift();g()}c()}},_loadStringScript:function(e){var d=this,b=this.getLocalizedScriptsUrl();b+=OSF.Constants.StringResourceFile;var a=0,c=function(){var f=null;if(typeof Strings=="undefined"||!Strings||!Strings.OsfRuntime){if(++a<3){setTimeout(function(){OSF.OUtil.loadScript(b,c)},750*a);return}d._localeStringLoadingPendingCallbacks.length=0;var g=OSF.OUtil.formatString("The locale, {0}, provided by the host app is not supported. Url: {1}",d.getLcid(),b);Telemetry.RuntimeTelemetryHelper.LogExceptionTag(g,f,f,20306076)}else{if(a>0){var g=OSF.OUtil.formatString("osfruntime_strings loaded after {0} retries.",a);Telemetry.RuntimeTelemetryHelper.LogExceptionTag(g,f,f,20306077)}e()}};OSF.OUtil.loadScript(b,c)},_getServiceEndPoint:function(){return this._serviceEndPoint},_getOmexEndPointPageUrl:function(b,a){return OSF.OUtil.formatString("{0}/{1}/downloads/{2}.aspx",this._omexEndPointBaseUrl,a,b)},_getManifestAndTargetByConversationId:function(b){for(var e in this._cachedOsfControls){var a=this._cachedOsfControls[e];if(b===a._getConversationId()){var d=a.getStoreType()==OSF.StoreType.FirstParty?"":a.getMarketplaceVersion(),c=a.getManifest()||OSF.OsfManifestManager.getCachedManifest(a.getMarketplaceID());return {manifest:c,version:d,target:a.getOsfControlType()}}}return null},_createSharePointIFrameProxy:function(b,h){var d=null,e=this;if(!e._doesUrlHaveSupportedProtocol(b)){h(d);return}var l=b.length;if(b.charAt(l-1)==="/")b=b.substr(0,l-1);var i=e._iframeProxies[b];if(!i){var f=OSF.OUtil.generateConversationId(),a=document.createElement("iframe");e._iframeProxyCount=e._iframeProxyCount+1;var j=e._iframeNamePrefix+e._iframeProxyCount;a.setAttribute("id",j);a.setAttribute("name",j);var c=b+"/_layouts/15/OfficeExtensionManager.aspx?"+f,n=window.location.origin;c=OSF.OUtil.addXdmInfoAsHash(c,f+"|"+j+"|"+n);c=OSF.OUtil.addSerializerVersionAsHash(c,OSF.SerializerVersion.Browser);c=OSF.OUtil.addFlightsAsHash(c,JSON.stringify(OSF.XdmFlights));if(OSF.OUtil.checkFlight(OSF.FlightNames.CheckReceiverOrigin))c=OSF.OUtil.addFlightsAsHash(c,JSON.stringify(OSF.Flights));a.setAttribute("scrolling","auto");a.setAttribute("border","0");a.setAttribute("width","0");a.setAttribute("height","0");a.setAttribute("style","position: absolute; left: -100px; top:0px;");var g=e,m=function(l,m){var e,c=g._iframeProxies[b];if(c&&l===0&&m.status){c.isReady=true;e=c.clientEndPoint}else{delete g._iframeProxies[b];if(Microsoft.Office.Common.XdmCommunicationManager.getClientEndPoint(f)){Microsoft.Office.Common.XdmCommunicationManager.deleteClientEndPoint(f);OSF.OUtil.removeEventListener(a,"load",k);a.parentNode.removeChild(a)}else Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Unexpected error occured with SharePoint proxy.",d,d,19203550);e=d}if(c)for(var i=c.pendingCallbacks.length,h=0;h<i;h++){var j=c.pendingCallbacks.shift();j(e)}},k=function(){if(g._iframeProxies[b]){g._iframeProxies[b].clientEndPoint=Microsoft.Office.Common.XdmCommunicationManager.connect(f,a.contentWindow,b);g._iframeProxies[b].clientEndPoint.invoke("OEM_isProxyReady",m,{__timeout__:2e3})}};document.body.appendChild(a);OSF.OUtil.addEventListener(a,"load",k);a.setAttribute("src",c);e._iframeProxies[b]={clientEndPoint:d,isReady:false,pendingCallbacks:[h]}}else if(i.isReady)h(i.clientEndPoint);else i.pendingCallbacks.push(h)},_getClientVersionForOmex:function(){if(!this._appVersion)return undefined;var b=this._appVersion.split("."),c=parseInt(b[0],10),d=parseInt(b[1],10)||0;if(c<=15&&d<=0)return undefined;var a=OSF.Constants.FileVersion.split(".");return c+"."+d+"."+a[2]+"."+a[3]},_getClientNameForOmex:function(){return OSF.OmexClientNames[this._appName]},_getAppVersionForOmex:function(){return OSF.OmexAppVersions[this._appName]},_setCachedFlag:function(b){var a=OSF.OUtil.getLocalStorage();a&&a.setItem(b,"true")},_getCachedFlag:function(c){var a=OSF.OUtil.getLocalStorage();if(a){var b=a.getItem(c);return b?true:false}},_deleteCachedFlag:function(b){var a=OSF.OUtil.getLocalStorage();a&&a.removeItem(b)},_preloadOfficeJs:function(){var b=this;if(b._hasPreloadedOfficeJs)return;var a=document.createElement("script");a.src=OSF.OUtil.formatString("{0}?locale={1}&host={2}&version={3}",OSF.Constants.PreloadOfficeJsUrl,b._appUILocale,b._appName,b._hostSpecificFileVersion);a.type="text/javascript";a.id=OSF.Constants.PreloadOfficeJsId;a.onerror=function(){Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Failed to connect to preload service.",null,null,19203551)};document.getElementsByTagName("head")[0].appendChild(a);b._hasPreloadedOfficeJs=true},_getAuthTypeForHideAppsExtensionUrl:function(){var a=OSF.OUtil.getQueryStringParamValue(this._hideAppsExtensionUrl,OSF.OmexPageParameterKeys.AuthType);return a?a:OSF.AuthType.Anonymous},isAddinCommandsAsync:function(b,f){var c=null,a=false;OSF.OUtil.validateParamObject(b,{marketplaceId:{type:String,mayBeNull:a},marketplaceVersion:{type:String,mayBeNull:a},storeType:{type:String,mayBeNull:a},storeId:{type:String,mayBeNull:a},targetData:{type:Object,mayBeNull:a},clearCache:{type:Boolean,mayBeNull:true}},c);var d=b.storeType.toLowerCase(),n,e={contextActivationMgr:c,referenceInUse:c},l=b.clearCache||a;try{e.referenceInUse={id:b.marketplaceId,version:b.marketplaceVersion,storeType:b.storeType,storeLocator:b.storeId};e.contextActivationMgr=this;var i=function(d){if(d!=c&&d.statusCode==OfficeExt.DataServiceResultCode.Succeeded&&d.value!=c)f(true,d.value._isAddinCommandsManifest(OSF.getManifestHostType(e.contextActivationMgr._hostType)),b);else f(a,a,b)};if(OSF.StoreType.OMEX===d||OSF.StoreType.UploadFileDevCatalog===d||OSF.StoreType.SPCatalog===d||OSF.StoreType.PrivateCatalog===d){var m=OfficeExt.CatalogFactory.resolve(d),g={assetId:e.referenceInUse.id,storeType:d,storeId:e.referenceInUse.storeLocator,appVersion:e.referenceInUse.version,targetType:c},k=OSF.OUtil.Guid.generateNewGuid(),j=new OfficeExt.AddinCommandsTelemetryContext(k);m.getAndCacheManifest(g,g.storeId,j,function(a){i({statusCode:a.status,value:a.value})},l)}else f(true,a,b)}catch(h){Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Error for checking is addincommands or not",h,c,19203552);f(a,a,b)}},setOAuthManager:function(a){this._oAuthManager=a},getManifestInvaildErrorString:function(){return Strings.OsfRuntime.L_AddinCommands_AddinNotSupported_Message},getDevManifestInvalidUrlErrorString:function(a){return OSF.OUtil.formatString(Strings.OsfRuntime.L_DeveloperAddinManifestInvalidUrl_Message,a)},getUserNameHashCode:function(){return this._userNameHashCode},ownerAddinControlRecreated:function(c,b){for(var d in this._cachedOsfControls){var a=this._cachedOsfControls[d];!!a._ownerAddinAssetId&&!!a._ownerAddinStoreType&&a._ownerAddinAssetId==c&&a._ownerAddinStoreType==b&&a.setOwnerAddinControlRecreated(true)}}};var UrlFilter=function(){function a(){}a.hashString=function(c){var a=0;if(c.length===0)return a;for(var b=0;b<c.length;b++){var d=c.charCodeAt(b);a=(a<<5)-a+d;a|=0}return a};a.stringToHash=function(d){var c=a.hashString(d),b=c.toString();if(c<0)b="1"+b.substring(1);else b="0"+b;return b};a.startsWith=function(b,a){return b.indexOf(a)==0};a.isFileUrl=function(b){return a.startsWith(b.toLowerCase(),"file:")};a.removeHttpPrefix=function(c){var b="";if(a.startsWith(c.toLowerCase(),a.httpsPrefix))b=a.httpsPrefix;else if(a.startsWith(c.toLowerCase(),a.httpPrefix))b=a.httpPrefix;var d=c.slice(b.length);return d};a.getUrlDomain=function(c){var b=a.removeHttpPrefix(c);b=b.split("/")[0];b=b.split(":")[0];return b};a.isIp4Address=function(b){var a=/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/;return a.test(b)};a.filter=function(d){if(a.isFileUrl(d)){var c=a.stringToHash(d);return "file://"+c}var b=a.getUrlDomain(d);if(a.isIp4Address(b)){var c=a.stringToHash(d);if(a.startsWith(b,"10."))return "IP10Range_"+c;else if(a.startsWith(b,"192."))return "IP192Range_"+c;else if(a.startsWith(b,"127."))return "IP127Range_"+c;return "IPOther_"+c}return b.split(".").slice(-2).join(".")};a.httpPrefix="http://";a.httpsPrefix="https://";return a}();OSF.OsfControl=function(b){var e=null,d=true,c=false,a=this;OSF.OUtil.validateParamObject(b,{div:{type:Object,mayBeNull:c},contextActivationMgr:{type:Object,mayBeNull:c},id:{type:String,mayBeNull:c},marketplaceID:{type:String,mayBeNull:c},marketplaceVersion:{type:String,mayBeNull:c},store:{type:String,mayBeNull:c},storeType:{type:String,mayBeNull:c},alternateReference:{type:Object,mayBeNull:d},settings:{type:Object,mayBeNull:d},reason:{type:String,mayBeNull:d},osfControlType:{type:Number,mayBeNull:d},snapshotUrl:{type:String,mayBeNull:d},preactivationCallback:{type:Object,mayBeNull:d},virtualOsfControlActivationCallback:{type:Object,mayBeNull:d},isvirtualOsfControl:{type:Boolean,mayBeNull:d},isDialog:{type:Boolean,mayBeNull:d},hostCustomMessage:{type:String,mayBeNull:d},isForUILessAction:{type:Boolean,mayBeNull:d},ownerAddinAssetId:{type:String,mayBeNull:d},sourceLocationOverrideResourceId:{type:String,mayBeNull:d},sourceLocationOverrideUrl:{type:String,mayBeNull:d},ownerAddinStoreType:{type:String,mayBeNull:d},focusOnIframeWhenLoaded:{type:Boolean,mayBeNull:d},featureGates:{type:Object,mayBeNull:d},hostInfoFlags:{type:Number,mayBeNull:d},sharedRuntimeId:{type:String,mayBeNull:d},initialDisplayMode:{type:Number,mayBeNull:d}},e);a._div=b.div;a._sourceLocationOverrideResourceId=b.sourceLocationOverrideResourceId;a._sourceLocationOverrideUrl=b.sourceLocationOverrideUrl;a._contextActivationMgr=b.contextActivationMgr;a._id=b.id;a._storeType=b.storeType.toLowerCase();a._storeLocator=b.store;a._marketplaceID=b.marketplaceID;a._marketplaceVersion=b.marketplaceVersion;a._alternateReference=b.alternateReference;a._settings=b.settings||{};a._reason=b.reason==undefined?Microsoft.Office.WebExtension.InitializationReason.DocumentOpened:b.reason;a._osfControlType=b.osfControlType==undefined?OSF.OsfControlType.DocumentLevel:b.osfControlType;a._snapshotUrl=b.snapshotUrl;a._status=OSF.OsfControlStatus.NotActivated;a._iframeIsLoaded=c;a._iframeLoadedNotified=c;a._notificationParams=[];a._iframeUrl=e;a._permission=e;a._conversationId=e;a._manifestUrl=e;a._pageStatus=OSF.OsfControlPageStatus.NotStarted;a._pageIsReadyTimerExpired=c;a._timer=e;a._retryLoadingNum=2;a._timer1=e;a._retryCheckingNum=2;a._frame=e;a._agaveEndPoint=e;a._etoken="";a._sqmDWords=[0,0];a._preactivationCallback=b.preactivationCallback;a._telemetryContext={};a._controlFocus=c;a._agavePageUrl=e;a._agaveWindowName=e;a._manifest=e;a._virtualOsfControlActivationCallback=b.virtualOsfControlActivationCallback;a._isvirtualOsfControl=b.isvirtualOsfControl==undefined?c:b.isvirtualOsfControl;a._isvirtualOsfControlCallbackInvoked=c;a._isManifestProcessedForCustomFunctions=c;a._processManifestForExtendedOverridesPromise=e;a._isDialog=b.isDialog==undefined?c:b.isDialog;a._hostCustomMessage=b.hostCustomMessage;a._isUpgrading=c;a._isUpgradingFailed=c;a._focusOnIframeWhenLoaded=b.focusOnIframeWhenLoaded==undefined?c:b.focusOnIframeWhenLoaded;a._featureGates=b.featureGates||{};a._hostInfoFlags=typeof b.hostInfoFlags=="number"?b.hostInfoFlags:0;a._sharedRuntimeId=b.sharedRuntimeId==undefined?e:b.sharedRuntimeId;a._initialDisplayMode=b.initialDisplayMode==undefined?0:b.initialDisplayMode;a._appContextIsSetToIframeName=c;a._sdxTelemetryContext={};if(a._contextActivationMgr._enableServiceDeliveredExperience){a._bundleUrl=e;a._sdxIframeTemplateUrl="https://osf-agave/rtm/sdx/index.html"}a._isUILessAddInCommands=!!b.isForUILessAction;a._ownerAddinAssetId=!!b.ownerAddinAssetId?b.ownerAddinAssetId:e;a._ownerAddinStoreType=!!b.ownerAddinStoreType?b.ownerAddinStoreType:e;if(OSF.OUtil.isiOS()){a._div.style.webkitOverflowScrolling="touch";a._div.style.overflow="auto"}a._appCorrelationId=a._contextActivationMgr._contextMgrCorrelationId||OSF.OUtil.Guid.generateNewGuid();a._iframeOnLoadDelegate=Function.createDelegate(a,a._iframeOnLoad);a._retryActivate=e;a._onKeyDownEventDelegate=Function.createDelegate(a,a._onKeydownEvent);a._ownerAddinControlRecreated=c};OSF.OsfControl.isFirstPartyStoreString=function(b){if(b){var a=b.toLowerCase();return a===OSF.StoreType.FirstParty||a===OSF.StoreType.Sdx}else return false};OSF.OsfControl.isFirstPartyStoreEnum=function(a){if(a)return a==OSF.StoreTypeEnum.FirstParty||a==OSF.StoreTypeEnum.Sdx;else return false};OSF.OsfControl.prototype={activate:function(c){var b=null,a=this;try{var k=false,e="",f="";if(a._contextActivationMgr._wopiHostOriginFromPostMessage){var g=document.createElement("a");g.href=a._contextActivationMgr._wopiHostOriginFromPostMessage;e=g.protocol+"//"+UrlFilter.filter(g.hostname);e=g.port==""?e:e+":"+g.port}if(a._contextActivationMgr._wopiHostOriginFromWacPropBag){var h=document.createElement("a");h.href=a._contextActivationMgr._wopiHostOriginFromWacPropBag;f=h.protocol+"//"+UrlFilter.filter(h.hostname);f=h.port==""?f:f+":"+h.port}k=e==f;var l=window.top==window.parent;if(typeof JSON!=="undefined"){var i={},d={};try{i=JSON.parse(a._contextActivationMgr._sessionStartInfoJson);d.wacHost=i.Host;d.wacHostDatacenterHint=i.HostDatacenterHint;d.wacApplicationMode=i.ApplicationMode;d.wacIsAnonymousUser=i.IsAnonymousUser}catch(j){}d.isWopiTopMatch=l;d.isWopiHostPostOriginMatch=k;d.correlationId=a._contextActivationMgr._contextMgrCorrelationId;d.hostType=a._contextActivationMgr._hostType;d.hostPlatform=a._contextActivationMgr._hostPlatform;d.storeType=a._storeType;d.assetId=a._marketplaceID;d.wacIsEmbedded=a._contextActivationMgr._wacIsEmbedded;d.urlFromPostMessage=e;d.urlFromWacPropBag=f;Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("WAC host check :"+JSON.stringify(d),a._contextActivationMgr._contextMgrCorrelationId,42779916)}}catch(j){Telemetry.RuntimeTelemetryHelper.LogExceptionTag("WAC host check exception",j,a.getCorrelationId(),42779917)}if(a._status===OSF.OsfControlStatus.Activated){a.invokePreactivationCompletedCallback();return}a._contextActivationMgr.registerOsfControl(a);OSF.OUtil.addEventListener(a._div,"keydown",a._onKeyDownEventDelegate);c=c||{};c.hostType=a._contextActivationMgr._hostType;c.osfControl=c.osfControl||a;c.referenceInUse=c.referenceInUse||{id:a._marketplaceID,version:a._marketplaceVersion,storeType:a._storeType,storeLocator:a._storeLocator};c.correlationId=c.osfControl._appCorrelationId;c.isInsertOsfControl=c.isInsertOsfControl?c.isInsertOsfControl:false;if(c.isInsertOsfControl==true){if(!a._contextActivationMgr._hostAllowedSdxEmbedding||a._checkWopiHost(a._contextActivationMgr._enableWopiHostCheck)){a.invokePreactivationCompletedCallback();return}a._contextActivationMgr._enableMyOrg&&a._contextActivationMgr._spBaseUrl!=b&&a._contextActivationMgr._wacUpn==b&&Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("WAC UPN in Sharepoint is null, assetID:"+a._marketplaceID,a._contextActivationMgr._contextMgrCorrelationId,592852928);if(a._contextActivationMgr._enableUpnCheck&&a._contextActivationMgr._enableMyOrg&&a._contextActivationMgr._spBaseUrl!=b){if(a._contextActivationMgr._wacUpn==b){Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("CheckUpnInSPO failed because WAC UPN is null, assetId: "+a._marketplaceID,a._contextActivationMgr._contextMgrCorrelationId,588814296);a._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_SPO_NotSignIn_Error_ERR,b,b,b,b,b,b,OSF.ErrorStatusCodes.WAC_WopiHostCheckStatusNotTrusted)}if(a._contextActivationMgr._upnCheckResult===OSF.UpnCheckCode.NotMatch){Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("CheckUpnInSPO failed, assetId: "+a._marketplaceID,a._contextActivationMgr._contextMgrCorrelationId,588814297);a._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_UntrustedHost_Error_ERR,b,b,b,b,b,b,OSF.ErrorStatusCodes.WAC_WopiHostCheckStatusNotTrusted)}else a.activateInternal(c)}else a.activateInternal(c)}else a.activateInternal(c)},activateInternal:function(d){var f=true,b=null,a=this,h=a;try{if(!a._doesBrowserSupportRequiredFeatures()){if(a._contextActivationMgr._enableFirstPartySDXErrorMessages&&a.isFirstParty())a._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveUnsupportedBroswer_ERR_FirstParty,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(a,a._refresh),b,b,b,f,OSF.ErrorStatusCodes.E_BROWSER_VERSION);else a._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveUnsupportedBroswer_ERR,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(a,a._refresh),b,b,b,f,OSF.ErrorStatusCodes.E_BROWSER_VERSION);a.invokePreactivationCompletedCallback();return}var q=document.createElement("iframe"),y="sandbox" in q;q=b;var n=false,m=OSF.OUtil.getLocalStorage();if(m)n=m.getItem(OSF.Constants.IgnoreSandBoxSupport);if(a._contextActivationMgr._autoTrusted&&!y&&!n){a._contextActivationMgr._ErrorUXHelper.removeProgressDiv(a._div,a._id);a._status=OSF.OsfControlStatus.NotSandBoxSupported;if(a._contextActivationMgr._enableFirstPartySDXErrorMessages&&a.isFirstParty())a._contextActivationMgr.displayNotification({id:a._id,infoType:OSF.InfoType.Warning,title:Strings.OsfRuntime.L_AppsDisabled_WRN_FirstParty,description:Strings.OsfRuntime.L_NotSandBoxSupported_ERR_FirstParty,icon:b,buttonTxt:Strings.OsfRuntime.L_EnableAppsButton_TXT_FirstParty,buttonCallback:Function.createCallback(a._activateAgavesBlockedBySandboxNotSupport,a._contextActivationMgr),url:OSF.Constants.IEUpgradeUrl,urlButtonTxt:Strings.OsfRuntime.L_UpgradeBrowserButton_TXT,dismissCallback:b,reDisplay:f,displayDeactive:f,errorCode:OSF.ErrorStatusCodes.WAC_HTML5IframeSandboxNotSupport,highPriority:f});else a._contextActivationMgr.displayNotification({id:a._id,infoType:OSF.InfoType.Warning,title:Strings.OsfRuntime.L_AppsDisabled_WRN,description:Strings.OsfRuntime.L_NotSandBoxSupported_ERR,icon:b,buttonTxt:Strings.OsfRuntime.L_EnableAppsButton_TXT,buttonCallback:Function.createCallback(a._activateAgavesBlockedBySandboxNotSupport,a._contextActivationMgr),url:OSF.Constants.IEUpgradeUrl,urlButtonTxt:Strings.OsfRuntime.L_UpgradeBrowserButton_TXT,dismissCallback:b,reDisplay:f,displayDeactive:f,errorCode:OSF.ErrorStatusCodes.WAC_HTML5IframeSandboxNotSupport,highPriority:f});a.invokePreactivationCompletedCallback();return}a.startActivate();var e=a,c=d.referenceInUse,B="1B4CD97F-DBFE-4C1A-B4C4-FC163B4F9693";if(c.storeType===OSF.StoreType.OMEX||c.storeType===OSF.StoreType.UploadFileDevCatalog||c.storeType===OSF.StoreType.SPCatalog||c.storeType===OSF.StoreType.PrivateCatalog||c.storeType===OSF.StoreType.FirstParty||c.storeType===OSF.StoreType.Sdx){var p=new OfficeExt.OsfControlLoader(a,d.hasConsent),l=new OfficeExt.ActivationTelemetryContext(a.getCorrelationId(),a._telemetryContext,a._sqmDWords[0],a._sqmDWords[1],a._id);if(c.storeType===OSF.StoreType.Sdx){if(c.id.toLowerCase()===OSF.SdxAssetIds.ExperimentationSdx){var k=a._contextActivationMgr._flightingTreatmentVariables["Microsoft.Office.OEP.FA000000059.SourceLocationOverrideResourceId"];if(k!=b)a._sourceLocationOverrideResourceId=k;a._sdxTelemetryContext["sourceLocationOverrideResourceId"]=a._sourceLocationOverrideResourceId;a._sdxTelemetryContext["SdxOnWacCDNIsEnabled"]=OSF.OUtil.checkFlight(OSF.FlightNames.SdxOnWacCDNIsEnabled)}if(a._initialDisplayMode==1)a._sdxTelemetryContext["isPreload"]=f;OfficeExt.SDXCatalog.activateAsync({assetId:c.id,storeId:c.storeLocator,appVersion:c.version,storeType:c.storeType,targetType:""},p,l,a._contextActivationMgr.getRequirementsChecker(),{clientId:a._contextActivationMgr._loggableUserId,sessionStartInfoJson:a._contextActivationMgr._sessionStartInfoJson},a._sdxTelemetryContext)}else{var u=d.noTargetType||d.osfControl.getOsfControlType()===OSF.OsfControlTarget.TaskPane?b:d.osfControl.getOsfControlType(),C=OfficeExt.CatalogFactory.resolve(c.storeType);C.activateAsync({assetId:c.id,storeId:c.storeLocator,appVersion:c.version,storeType:c.storeType,targetType:c.storeType===OSF.StoreType.SPCatalog?u:""},p,l)}a.invokePreactivationCompletedCallback();return}c.id===B&&Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("ONO_Onboarding_CorrelationId :"+a.getCorrelationId(),b,23381916);Telemetry.AppLoadTimeHelper.ActivationStart(a._telemetryContext,a._sqmDWords[0],a._sqmDWords[1],a.getCorrelationId(),a._id,OSF.ActivationTypes.V2Enabled);Telemetry.AppLoadTimeHelper.ServerCallStart(a._telemetryContext);if(c.storeType===OSF.StoreType.Exchange||c.storeType===OSF.StoreType.InMemory)OSF.OsfManifestManager.getManifestAsync(d,function(a){if(a.statusCode===OSF.ProxyCallStatusCode.Succeeded&&a.value&&!h._etoken)h._etoken=a.value.getInMemoryEToken()||"";h._onGetManifestCompleted(a)});else if(c.storeType===OSF.StoreType.Registry&&a._contextActivationMgr._enableDevCatalog||c.storeType===OSF.StoreType.HardCodedPreinstall)if(d.osfControl.getReason()==Microsoft.Office.WebExtension.InitializationReason.DocumentOpened||c.storeType===OSF.StoreType.Registry&&a._contextActivationMgr._enableDevCatalog&&!OSF.OsfManifestManager.hasManifestForControl(d)){var x=function(f){var a=new OSF.Manifest.Manifest(f,e._contextActivationMgr.getAppUILocale());if(d.osfControl!=b&&d.osfControl._sharedRuntimeId!=b&&d.osfControl._sharedRuntimeId.length>0){var c=OSF.OsfManifestManager.getSharedRuntimeManifestCacheKey(d.osfControl._marketplaceID,d.osfControl._sharedRuntimeId);!OSF.OsfManifestManager.hasManifest(c,d.osfControl._marketplaceVersion)&&OSF.OsfManifestManager.cacheManifest(c,d.osfControl._marketplaceVersion,a)}!OSF.OsfManifestManager.hasManifest(a.getMarketplaceID(),a.getMarketplaceVersion())&&OSF.OsfManifestManager.cacheManifest(a.getMarketplaceID(),a.getMarketplaceVersion(),a);OSF.OsfManifestManager.getManifestAsync(d,Function.createDelegate(e,e._onGetManifestCompleted))},w=function(a){alert("Error when requesting manifest file: "+a)};OSF.OUtil.xhrGet(a._contextActivationMgr._devCatalogUrl+"/"+c.id+".xml",x,w)}else{if(d.osfControl!=b&&d.osfControl._sharedRuntimeId!=b&&d.osfControl._sharedRuntimeId.length>0){var j=OSF.OsfManifestManager.getSharedRuntimeManifestCacheKey(d.osfControl._marketplaceID,d.osfControl._sharedRuntimeId);if(!OSF.OsfManifestManager.hasManifest(j,d.osfControl._marketplaceVersion)){var A=OSF.OsfManifestManager.getCachedManifest(d.osfControl._marketplaceID,d.osfControl._marketplaceVersion);OSF.OsfManifestManager.cacheManifest(j,d.osfControl._marketplaceVersion,A)}}OSF.OsfManifestManager.getManifestAsync(d,Function.createDelegate(a,a._onGetManifestCompleted))}else if(c.storeType===OSF.StoreType.OneDrive&&a._contextActivationMgr._enableOneDriveCatalog){var r=function(b){var a=new OSF.Manifest.Manifest(b,e._contextActivationMgr.getAppUILocale());OSF.OsfManifestManager.cacheManifest(c.id,a.getMarketplaceVersion(),a);OSF.OsfManifestManager.getManifestAsync(d,Function.createDelegate(e,e._onGetManifestCompleted))},s=function(){e._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(e,e._refresh),b,b,b,b,OSF.ErrorStatusCodes.E_MANIFEST_SERVER_UNAVAILABLE)},z=window.location.protocol+"//"+window.location.host;OSF.OneDriveOAuth.setHostCallbackUri(z);var g=a._contextActivationMgr._oneDriveCatalogBaseApiUrl+"/root:/Manifests/"+c.id+":/content?access_token=",t=function(a){g=g+a;OSF.OUtil.xhrGet(g,r,s)},v=function(){e._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(e,e._refresh),b,b,b,b,OSF.ErrorStatusCodes.E_MANIFEST_SERVER_UNAVAILABLE)};OSF.OneDriveOAuth.getAccessToken(t,v)}else if(c.storeType===OSF.StoreType.SPApp){Telemetry.AppLoadTimeHelper.EntitlementCheckStart(a._telemetryContext);d.baseUrl=a._contextActivationMgr.getPageBaseUrl();d.pageUrl=a._contextActivationMgr._docUrl;d.webUrl=a._contextActivationMgr._webUrl;d.appWebUrl=a._contextActivationMgr._webUrl;OSF.OsfManifestManager.getSPAppEntitlementsAsync(d,Function.createDelegate(a,a._onGetEntitlementsCompleted))}else if(c.storeType===OSF.StoreType.FileSystem||c.storeType===OSF.StoreType.Registry||c.storeType===OSF.StoreType.HardCodedPreinstall)a._showActivationWarning(OSF.OsfControlStatus.UnsupportedStore,Strings.OsfRuntime.L_AgaveUnsupportedStoreType_ERR,b,b,b,b,OSF.ErrorStatusCodes.WAC_AgaveUnsupportedStoreType);else if(c.storeType===OSF.StoreType.OneDrive)a._showActivationWarning(OSF.OsfControlStatus.UnsupportedStore,Strings.OsfRuntime.L_AgaveUnsupportedStoreType_ERR,b,b,b,b,OSF.ErrorStatusCodes.WAC_AgaveUnsupportedStoreType);else a._showActivationError(OSF.OsfControlStatus.UnknownStore,Strings.OsfRuntime.L_AgaveUnknownStoreType_ERR,b,b,b,b,b,b,OSF.ErrorStatusCodes.E_MANIFEST_REFERENCE_INVALID)}catch(i){var o="Error getting app data.";OfficeExt.WACUtils.logExceptionToBrowserConsole(o,i);Telemetry.RuntimeTelemetryHelper.LogExceptionTag(o,i,a.getCorrelationId(),18420419);if(a._contextActivationMgr._enableFirstPartySDXErrorMessages&&a.isFirstParty())a._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR_FirstParty,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(a,a._refresh),b,b,b,b,OSF.ErrorStatusCodes.WAC_AgaveOsfControlActivationError);else a._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(a,a._refresh),b,b,b,b,OSF.ErrorStatusCodes.WAC_AgaveOsfControlActivationError)}a.invokePreactivationCompletedCallback()},createIframeForDialogControl:function(e,b,d){var a=this;while(a._div.childNodes.length>0)a._div.removeChild(a._div.childNodes.item(0));var c=a._createIframeForControl(e);a._iframeUrl=b;a._appDomains=d;a._setIframeAttribute(c,b);a._div.appendChild(c);a._contextActivationMgr.registerOsfControl(a)},deActivate:function(){var b=null,a=this;try{OSF.OUtil.writeProfilerMark(OSF.OsfControlActivationPerfMarker.DeactivationStart);a._contextActivationMgr.dismissMessages(a._id);a._retryActivate=b;if(a._status!==OSF.OsfControlStatus.NotActivated){if(a._agaveEndPoint){Microsoft.Office.Common.XdmCommunicationManager.deleteClientEndPoint(a._agaveEndPoint._conversationId);a._agaveEndPoint=b}if(a._frame){OSF.OUtil.removeEventListener(a._frame,"load",a._iframeOnLoadDelegate);a._frame=b}if(a._timer){window.clearTimeout(a._timer);a._timer=b}while(a._div.childNodes.length>0)a._div.removeChild(a._div.childNodes.item(0));a._status=OSF.OsfControlStatus.NotActivated;a._conversationId&&a._contextActivationMgr._getServiceEndPoint().unregisterConversation(a._conversationId);a._contextActivationMgr.raiseOsfControlStatusChange(a)}a._controlFocus=false;OSF.OUtil.removeEventListener(a._div,"keydown",a._onKeyDownEventDelegate);a._iframeIsLoaded=false;a._iframeLoadedNotified=false;OSF.OUtil.writeProfilerMark(OSF.OsfControlActivationPerfMarker.DeactivationEnd)}catch(c){var d="Deactivate failed.";OfficeExt.WACUtils.logExceptionToBrowserConsole(d,c);Telemetry.RuntimeTelemetryHelper.LogExceptionTag(d,c,a.getCorrelationId(),18420420)}},startActivate:function(){var a=this;a._controlFocus=true;a._pageStatus=OSF.OsfControlPageStatus.Loading;a._sdxTelemetryContext={activationStart:performance.now(),performanceTimestampOrigin:Date.now()-performance.now(),osfControlId:a._id};OSF.OUtil.writeProfilerMark(OSF.OsfControlActivationPerfMarker.ActivationStart);if(a._frame){OSF.OUtil.removeEventListener(a._frame,"load",a._iframeOnLoadDelegate);a._frame=null}while(a._div.childNodes.length>0)a._div.removeChild(a._div.childNodes.item(0));a._contextActivationMgr._ErrorUXHelper.showProgress(a._div,a._id)},refresh:function(){this._refresh()},_restartActivate:function(){this.deActivate();this.startActivate();this.invokePreactivationCompletedCallback()},purge:function(e){var a=this,d=Function._validateParams(arguments,[{name:"purgeManifest",type:Boolean,mayBeNull:false}]);if(d)throw d;try{a._contextActivationMgr._ErrorUXHelper.purgeOsfControlNotification(a._id);a.deActivate();e&&OSF.OsfManifestManager.purgeManifest(a._marketplaceID,a._marketplaceVersion);a._contextActivationMgr.unregisterOsfControl(a)}catch(b){var c="Purge failed.";OfficeExt.WACUtils.logExceptionToBrowserConsole(c,b);Telemetry.RuntimeTelemetryHelper.LogExceptionTag(c,b,a.getCorrelationId(),18420421)}},invokeVirtualOsfControlActivationCallback:function(d){var a=this;try{if(a._virtualOsfControlActivationCallback){a._virtualOsfControlActivationCallback(a,d);a._isvirtualOsfControlCallbackInvoked=true}}catch(b){var c="invokeVirtualOsfControlActivationCallback failed.";OfficeExt.WACUtils.logExceptionToBrowserConsole(c,b);Telemetry.RuntimeTelemetryHelper.LogExceptionTag(c,b,a.getCorrelationId(),36496280)}},ensureToGetVirtualOsfControlManifest:function(d){var b=null,a=this,g=a;if(a._manifest){d(a._manifest);return}var c={assetId:a._marketplaceID,appVersion:a._marketplaceVersion,storeType:a._storeType,storeId:a._storeLocator,targetType:b},e=function(a){var c=b;if(a.status===OfficeExt.DataServiceResultCode.Succeeded&&a.value)c=a.value;else g._status=OSF.OsfControlStatus.ActivationFailed;d(c)},f=OfficeExt.CatalogFactory.resolve(c.storeType);if(f!=b)f.getAndCacheManifest(c,a._storeLocator,new OfficeExt.AddinCommandsTelemetryContext(a.getCorrelationId()),e);else{alert("AddinCommands is not supported in "+c.storeType+" store.");e({status:OfficeExt.DataServiceResultCode.Failed,value:b})}},invokePreactivationCompletedCallback:function(){this._preactivationCallback&&this._preactivationCallback()},getMarketplaceID:function(){return this._marketplaceID},getMarketplaceVersion:function(){return this._marketplaceVersion},getContainingDiv:function(){return this._div},getID:function(){return this._id},getSettings:function(){return this._settings},setSettings:function(a){this._settings=a},getReason:function(){return this._reason},getManifest:function(){return this._manifest},getOsfControlType:function(){return this._osfControlType},getSharedRuntimeId:function(){return this._sharedRuntimeId},getSnapshotUrl:function(){return this._snapshotUrl},getStoreType:function(){return this._storeType},isFirstParty:function(){var a=this;if(OSF.OUtil.checkFlight(OSF.FlightNames.AddInsInSupportedIrmDocsIsEnabled))return OSF.OsfControl.isFirstPartyStoreString(a._storeType);else return a._storeType&&(a._storeType===OSF.StoreType.FirstParty||a._storeType===OSF.StoreType.Sdx)},hostInfoFlags:function(){return this._hostInfoFlags},updateAgaveEndPointTargetUrl:function(a){this.ensureAgaveEndPoint();if(this._agaveEndPoint)this._agaveEndPoint._targetUrl=a},getStoreLocator:function(){return this._storeLocator},getHostCustomMessage:function(){return this._hostCustomMessage},getProperty:function(b){var a=Function._validateParams(arguments,[{name:"name",type:String,mayBeNull:false}]);if(a)throw a;return this._settings[b]},addProperty:function(c,b){var a=Function._validateParams(arguments,[{name:"name",type:String,mayBeNull:false},{name:"value",type:String,mayBeNull:false}]);if(a)throw a;this._settings[c]=b},removeProperty:function(b){var a=Function._validateParams(arguments,[{name:"name",type:String,mayBeNull:false}]);if(a)throw a;delete this._settings[b]},getStatus:function(){return this._status},getPageStatus:function(){return this._pageStatus},checkAppDomains:function(b){var a=Microsoft.Office.Common.XdmCommunicationManager.checkUrlWithAppDomains(this._appDomains,b);if(!a)return this.isTargetSubdomainOfSourceLocation(b);else return a},isTargetSubdomainOfSourceLocation:function(a){return Microsoft.Office.Common.XdmCommunicationManager.isTargetSubdomainOfSourceLocation(this._agavePageUrl,a)},getNotificationParams:function(){return this._notificationParams},removeFirstNotification:function(){this._notificationParams.shift()},getIframeUrl:function(){return this._iframeUrl},getPermission:function(){return this._permission},getTrustNoPrompt:function(){return false},getEToken:function(){return this._etoken},getCorrelationId:function(){return this._appCorrelationId},getAgavePageUrl:function(){return this._agavePageUrl},getAgaveWindowName:function(){return this._agaveWindowName},notifyAgave:function(a,b){this._agaveEndPoint&&this._agaveEndPoint.invoke("Office_notifyAgave",null,[a,b])},sendMessageToSdx:function(b,a){this._agaveEndPoint&&this._agaveEndPoint.invoke("Office_sendMessageToSdx",a,b)},isUILessAddInCommands:function(){return this._isUILessAddInCommands},getOwnerAddinAssetId:function(){return this._ownerAddinAssetId},getOwnerAddinStoreType:function(){return this._ownerAddinStoreType},getFeatureGates:function(){return this._featureGates},getOwnerAddinControlRecreated:function(){return this._ownerAddinControlRecreated},setOwnerAddinControlRecreated:function(a){this._ownerAddinControlRecreated=a},_onKeydownEvent:function(a){var f="input, button, a",b=this;a.preventDefault=a.preventDefault||function(){a.returnValue=false};if(a.keyCode==117&&(a.ctrlKey||a.metaKey)){a.preventDefault();a.stopPropagation();var g=OSF.AgaveHostAction.CtrlF6Exit;if(a.shiftKey)g=OSF.AgaveHostAction.CtrlF6ExitShift;b._contextActivationMgr._notifyHost(b._id,g)}else if(a.keyCode==9){a.preventDefault();a.stopPropagation();var d=b._div.querySelectorAll(f);if(d.length==0)return;var i=OSF.OUtil.focusToNextTabbable(d,a.target||a.srcElement,a.shiftKey);if(!i)if(a.shiftKey)b._contextActivationMgr._notifyHost(b._id,OSF.AgaveHostAction.TabExitShift);else if(b._agaveEndPoint)b.notifyAgave(OSF.AgaveHostAction.TabIn);else b._contextActivationMgr._notifyHost(b._id,OSF.AgaveHostAction.TabExit)}else if(a.keyCode==27){a.preventDefault();b._contextActivationMgr._notifyHost(b._id,OSF.AgaveHostAction.EscExit)}else if(a.keyCode==113){a.preventDefault();b._contextActivationMgr._notifyHost(b._id,OSF.AgaveHostAction.F2Exit)}else if(a.keyCode==13||a.keyCode==32)for(var e=b._div.querySelectorAll(f),c=0;c<e.length;c++){var h=a.target||a.srcElement;if(e[c]===h){a.preventDefault();a.stopPropagation();h.click();return}}else{a.preventDefault();a.stopPropagation()}},_onGetEntitlementsCompleted:function(b){var a=null,d=this;if(b.statusCode===OSF.ProxyCallStatusCode.Succeeded&&b.value){Telemetry.AppLoadTimeHelper.EntitlementCheckEnd(d._telemetryContext);for(var h=b.context.referenceInUse,g=b.value.entitlements,i=g.length,c,e=a,f=0;f<i;f++){c=g[f];if(c.OfficeExtensionID&&h.id&&c.OfficeExtensionID.toLowerCase()===h.id.toLowerCase())if(!e||d._lessThan(e.OfficeExtensionVersion,c.OfficeExtensionVersion))e=c}c=e;if(!c)d._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveNotExist_ERR,Strings.OsfRuntime.L_RetryButton_TXT,Function.createCallback(function(a){a.osfControl._refresh(a)},{clearCache:true,referenceInUse:b.context.referenceInUse,osfControl:b.context.osfControl}),a,a,a,a,OSF.ErrorStatusCodes.E_MANIFEST_DOES_NOT_EXIST);else if(c.OfficeExtensionKillbit)d._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveDisabledByAdmin_ERR,a,a,a,a,a,a,OSF.ErrorStatusCodes.E_OEM_EXTENSION_KILLED);else{b.context.manifestUrl=c.EncodedAbsUrl;b.context.appInstanceId=c.AppInstanceID;b.context.productId=c.ProductID;if(b.context.appInstanceId)OSF.OsfManifestManager.getAppInstanceInfoByIdAsync(b.context,Function.createDelegate(d,d._onGetAppInstanceInfoByIdCompleted));else OSF.OsfManifestManager.getManifestAsync(b.context,Function.createDelegate(d,d._onGetManifestCompleted))}}else d._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(d,d._refresh),a,a,a,a,OSF.ErrorStatusCodes.E_MANIFEST_SERVER_UNAVAILABLE)},_onGetAppInstanceInfoByIdCompleted:function(e){var d=null,b=this;if(e.statusCode===OSF.ProxyCallStatusCode.Succeeded&&e.value){var c=e.value,a=e.context;if(c.AppWebFullUrl)a.appWebUrl=c.AppWebFullUrl;a.clientId=c.AppPrincipalId;a.remoteAppUrl=c.RemoteAppUrl;if(a.appWebUrl&&a.productId)OSF.OsfManifestManager.getSPTokenByProductIdAsync(a,Function.createDelegate(b,b._onGetSPTokenByProductIdCompleted));else OSF.OsfManifestManager.getManifestAsync(a,Function.createDelegate(b,b._onGetManifestCompleted))}else b._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(b,b._refresh),d,d,d,d,OSF.ErrorStatusCodes.E_MANIFEST_SERVER_UNAVAILABLE)},_onGetSPTokenByProductIdCompleted:function(a){if(a.statusCode===OSF.ProxyCallStatusCode.Succeeded&&a.value)this._etoken=a.value;OSF.OsfManifestManager.getManifestAsync(a.context,Function.createDelegate(this,this._onGetManifestCompleted))},_retryActivation:function(){var a=this;a._retryLoadingNum--;if(a._pageStatus===OSF.OsfControlPageStatus.Ready||a._retryLoadingNum<=0){a._contextActivationMgr._ErrorUXHelper.removeProgressDiv(a._div,a._id);a._retryLoadingNum=2}else a._refresh()},_iframeOnLoad:function(){var b=this,a=b;b._iframeIsLoaded=true;if(b._appContextIsSetToIframeName&&a._contextActivationMgr._ErrorUXHelper){a._contextActivationMgr._ErrorUXHelper.removeProgressDiv(a._div,a._id);a._pageStatus=OSF.OsfControlPageStatus.Ready;a._focusOnIframeWhenLoaded&&a._frame&&a._frame.contentWindow&&a._frame.contentWindow.focus();a.ensureAgaveEndPoint()}Telemetry.AppLoadTimeHelper.PageLoaded(b._telemetryContext);var c=function(a){var b=null;if(a){if(a._contextActivationMgr._ErrorUXHelper){OSF.OUtil.writeProfilerMark(OSF.OsfControlActivationPerfMarker.SelectionTimeout);a._contextActivationMgr._ErrorUXHelper.removeProgressDiv(a._div,a._id)}if(a._pageStatus!==OSF.OsfControlPageStatus.Ready){if(a._retryLoadingNum===2){var c=OSF.ErrorStatusCodes.WAC_AgaveActivationError;switch(a._pageStatus){case OSF.OsfControlPageStatus.FailedOriginCheck:c=OSF.ErrorStatusCodes.WAC_AgaveOriginCheckError;break;case OSF.OsfControlPageStatus.FailedPermissionCheck:c=OSF.ErrorStatusCodes.WAC_AgavePermissionCheckError;break;case OSF.OsfControlPageStatus.FailedHandleRequest:c=OSF.ErrorStatusCodes.WAC_AgaveHostHandleRequestError}if(a._contextActivationMgr._enableFirstPartySDXErrorMessages&&a.isFirstParty()){var d="Timeout loading contents in iframe. Error: "+c;if(a._storeType.toLowerCase()==OSF.StoreType.FirstParty.toLowerCase())OfficeExt.FirstPartyCatalog.LogFirstPartyCatalogMonitoringError(d,a._marketplaceID);else a._storeType.toLowerCase()==OSF.StoreType.Sdx.toLowerCase()&&OfficeExt.SDXCatalog.LogSDXCatalogMonitoringError(d,a._marketplaceID);a._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveActivationError_ERR_FirstParty,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(a,a._retryActivation),b,b,b,b,c)}else a._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveActivationError_ERR,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(a,a._retryActivation),b,b,b,b,c)}else if(a._retryLoadingNum===1)if(a._contextActivationMgr._enableFirstPartySDXErrorMessages&&a.isFirstParty()){var d="User retry failed to load contents in iframe.";if(a._storeType.toLowerCase()==OSF.StoreType.FirstParty.toLowerCase())OfficeExt.FirstPartyCatalog.LogFirstPartyCatalogMonitoringError(d,a._marketplaceID);else a._storeType.toLowerCase()==OSF.StoreType.Sdx.toLowerCase()&&OfficeExt.SDXCatalog.LogSDXCatalogMonitoringError(d,a._marketplaceID);a._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_ActivateAttempLoading_ERR_FirstParty,Strings.OsfRuntime.L_ActivateButton_TXT,Function.createDelegate(a,a._retryActivation),b,b,b,b,OSF.ErrorStatusCodes.WAC_ActivateAttempLoading)}else a._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_ActivateAttempLoading_ERR,Strings.OsfRuntime.L_ActivateButton_TXT,Function.createDelegate(a,a._retryActivation),b,b,b,b,OSF.ErrorStatusCodes.WAC_ActivateAttempLoading)}else a._notifyHostIFrameOnLoaded();if(a._timer){window.clearTimeout(a._timer);a._timer=b}a._pageIsReadyTimerExpired=true}};if(a._pageStatus!==OSF.OsfControlPageStatus.Ready)a._timer=window.setTimeout(function(){c(a)},5e3*a._retryLoadingNum+1);else a._notifyHostIFrameOnLoaded()},_handleNotReady:function(){var a=null,c="CheckWopiHost IsHostFrameTrusted Value:",b=this,d=true,e=function(b){if(b){if(b._contextActivationMgr._isHostFrameTrusted===OSF.HostFrameTrustState.NotInitialized||b._contextActivationMgr._isHostFrameTrusted===OSF.HostFrameTrustState.NotReady)if(b._retryCheckingNum>=0){b._retryCheckingNum--;Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag(c+b._contextActivationMgr._isHostFrameTrusted,b._contextActivationMgr._contextMgrCorrelationId,577815005);var d=OSF.ErrorStatusCodes.WAC_WopiHostCheckStatusNotReady;b._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_UnknownHost_Error_ERR,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(b,b._refresh),a,a,a,a,OSF.ErrorStatusCodes.WAC_WopiHostCheckStatusNotReady)}else{Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag(c+b._contextActivationMgr._isHostFrameTrusted,b._contextActivationMgr._contextMgrCorrelationId,577815006);var d=OSF.ErrorStatusCodes.WAC_WopiHostCheckStatusNotReady;b._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_UnknownHost_Error_ERR,a,a,a,a,a,a,OSF.ErrorStatusCodes.WAC_WopiHostCheckStatusNotReady)}else{Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag(c+b._contextActivationMgr._isHostFrameTrusted,b._contextActivationMgr._contextMgrCorrelationId,577815007);b._status==OSF.OsfControlStatus.NotActivated&&b._refresh()}if(b._timer1){window.clearTimeout(b._timer1);b._timer1=a}}};if(b._contextActivationMgr._isHostFrameTrusted===OSF.HostFrameTrustState.NotInitialized||b._contextActivationMgr._isHostFrameTrusted===OSF.HostFrameTrustState.NotReady){b._contextActivationMgr.registerNotReadyOsfControl(b);b._timer1=window.setTimeout(function(){e(b)},5e3*(b._retryCheckingNum+1))}else if(b._contextActivationMgr._isHostFrameTrusted===OSF.HostFrameTrustState.NotTrusted){Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag(c+b._contextActivationMgr._isHostFrameTrusted,b._contextActivationMgr._contextMgrCorrelationId,577815008);b._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_UntrustedHost_Error_ERR,a,a,a,a,a,a,OSF.ErrorStatusCodes.WAC_WopiHostCheckStatusNotTrusted);if(b._timer1){window.clearTimeout(b._timer1);b._timer1=a}}else{Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag(c+b._contextActivationMgr._isHostFrameTrusted,b._contextActivationMgr._contextMgrCorrelationId,577815009);d=false;if(b._timer1){window.clearTimeout(b._timer1);b._timer1=a}}return d},_checkWopiHost:function(f){var b=null,e="CheckWopiHost IsHostFrameTrusted Value:",c=this,d=false,a=c;if(f)if(a._contextActivationMgr._isHostFrameTrusted===OSF.HostFrameTrustState.NotTrusted){Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag(e+c._contextActivationMgr._isHostFrameTrusted,c._contextActivationMgr._contextMgrCorrelationId,577815010);a._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_UntrustedHost_Error_ERR,b,b,b,b,b,b,OSF.ErrorStatusCodes.WAC_WopiHostCheckStatusNotTrusted);d=true;if(a._timer1){window.clearTimeout(a._timer1);a._timer1=b}}else if(c._contextActivationMgr._isHostFrameTrusted===OSF.HostFrameTrustState.NotInitialized||c._contextActivationMgr._isHostFrameTrusted===OSF.HostFrameTrustState.NotReady)d=a._handleNotReady();else if(a._timer1){window.clearTimeout(a._timer1);a._timer1=b}Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag(e+c._contextActivationMgr._isHostFrameTrusted,c._contextActivationMgr._contextMgrCorrelationId,595354007);return d},_isOsfControlInEmbeddingMode:function(e){var a=false;try{var d=e.getContainingDiv().parentNode.parentNode,c=d.id,f=c.match(/^(m_excelEmbedRenderer_|ewaSynd).+$/ig);a=f!=null}catch(b){OfficeExt.WACUtils.logExceptionToBrowserConsole("_isOsfControlInEmbeddingMode error.",b)}return a},_createIframeAndActivateOsfControl:function(b){var a=this;Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("IFrame Created"+a._iframeUrl,a._contextActivationMgr._contextMgrCorrelationId,594356319);var c=a._createIframeForControl(b);a._activate(c,a._iframeUrl)},_createIframeForControl:function(d){var b=this,a=document.createElement("iframe");a.setAttribute("id",b._id);a.setAttribute("width","100%");a.setAttribute("height","100%");a.setAttribute("frameborder","0");a.setAttribute("allowfullscreen","true");var c;if(b._contextActivationMgr._enableFirstPartySDXErrorMessages&&b.isFirstParty())c=d;else c=Strings.OsfRuntime.L_IframeTitle_TXT+" "+d;a.setAttribute("title",c);a.style.msUserSelect="element";b._setSandboxAttribute(a);for(var e in b._contextActivationMgr._iframeAttributeBag)a.setAttribute(e,b._contextActivationMgr._iframeAttributeBag[e]);b._frame=a;return a},_setSandboxAttribute:function(b){b.setAttribute("sandbox","allow-scripts allow-forms allow-same-origin allow-popups allow-popups-to-escape-sandbox allow-modals allow-downloads");var a="geolocation;camera";if(!this._contextActivationMgr._disableMicrophonePermission)a+=";microphone";if(this._contextActivationMgr._accessibilityAllowFocusAddinTaskpane)a+=";focus-without-user-activation *";b.setAttribute("allow",a)},_onGetManifestCompleted:function(e){var b=null,f=true,a=this;if(e.statusCode===OSF.ProxyCallStatusCode.Succeeded&&e.value){Telemetry.AppLoadTimeHelper.ManifestRequestEnd(a._telemetryContext);Telemetry.AppLoadTimeHelper.ServerCallEnd(a._telemetryContext);var c=e.value,d=e.context,g=d.referenceInUse,h=g.storeType,k=c.getDefaultDisplayName();a._manifest=c;if(d.manifestCached&&!d.retried){var l=c.getMarketplaceVersion();if(a._lessThan(l,g.version))if(h===OSF.StoreType.SPApp){a._refresh({clearCache:f,referenceInUse:g,osfControl:d.osfControl,retried:f});return}}if(c.requirementsSupported===false||c.requirementsSupported===undefined&&!a._contextActivationMgr.getRequirementsChecker().isManifestSupported(c)){c.requirementsSupported=false;var j,i,m=b;j=Strings.OsfRuntime.L_AgaveManifestRequirementsError_ERR||Strings.OsfRuntime.L_AgaveManifestError_ERR;i=OSF.ErrorStatusCodes.WAC_AgaveRequirementsError;a._showActivationError(OSF.OsfControlStatus.ActivationFailed,j,b,b,m,b,b,f,i);return}c.requirementsSupported=f;a._iframeUrl=c.getDefaultSourceLocation(a._contextActivationMgr.getFormFactor());a._iframeUrl&&a.updateUrlsForSdx();a._permission=c.getPermission();a._appDomains=c.getAppDomains();if(h===OSF.StoreType.SPApp&&a._iframeUrl){if(d.clientId)a._iframeUrl=a._iframeUrl.replace(/~clientid/ig,d.clientId);if(d.appWebUrl)a._iframeUrl=a._iframeUrl.replace(/~appweburl/ig,d.appWebUrl);if(d.remoteAppUrl)a._iframeUrl=a._iframeUrl.replace(/~remoteappurl/ig,d.remoteAppUrl)}if(!a._contextActivationMgr._doesUrlHaveSupportedProtocol(a._iframeUrl)){a._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveManifestError_ERR,b,b,b,b,b,b,OSF.ErrorStatusCodes.E_MANIFEST_INVALID_VALUE_FORMAT);return}a.processManifestForCustomFunctions(c);if(!a._isvirtualOsfControl)a._createIframeAndActivateOsfControl(k);else!d.showNewerVersion&&a.invokeVirtualOsfControlActivationCallback(c)}else{Telemetry.RuntimeTelemetryHelper.LogExceptionTag("GetManifest failed:"+OfficeExt.WACUtils.serializeObjectToString(e),b,b,18420422);a._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveManifestRetrieve_ERR,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(a,a._refresh),b,b,b,b,OSF.ErrorStatusCodes.E_MANIFEST_SERVER_UNAVAILABLE)}},isCurrentLocaleDefaultLocale:function(a){return a.getDefaultLocale().toLowerCase()!=this._contextActivationMgr.getAppUILocale().toLowerCase()},processManifestForExtendedOverrides:function(b){var a=this;if(a._processManifestForExtendedOverridesPromise&&!a._isUpgrading)return a._processManifestForExtendedOverridesPromise;a._processManifestForExtendedOverridesPromise=a.processManifestForExtendedOverridesInternal(b);return a._processManifestForExtendedOverridesPromise},processManifestForExtendedOverridesInternal:function(b){var a=null,c=this,d=c;if(c._isManifestProcessedForExtendedOverrides&&!c._isUpgrading)return Promise.resolve(a);c._isManifestProcessedForExtendedOverrides=true;try{if(!b.getExtendedOverrides().url){var e="Missing extendedOverrides url info for manifest contains ExtendedOverrides node";Telemetry.RuntimeTelemetryHelper.LogExceptionTag(e,a,c.getCorrelationId(),588887693);return Promise.reject(e)}OfficeExt.ExtendedManifestUtility.ensureFinalExtendedOverridesUrls(b,c._contextActivationMgr)}catch(g){var e="Failed to construct ExtendedOverrides";Telemetry.RuntimeTelemetryHelper.LogExceptionTag(e,g,c.getCorrelationId(),592221731);return Promise.reject(e)}if(b.getExtendedOverrides().hasFinalUrls&&!OfficeExt.OsfExtendedManifestCache.wasExtendedManifestAlreadyFetched(b._id)){var f=[OfficeExt.ExtendedManifestUtility.downloadContent(b.getExtendedOverrides().url)];b.getExtendedOverrides().resourcesUrl&&b.getDefaultLocale().toLowerCase()!=c._contextActivationMgr.getAppUILocale().toLowerCase()&&f.push(OfficeExt.ExtendedManifestUtility.downloadContent(b.getExtendedOverrides().resourcesUrl));return Promise.all(f).then(function(b){if(b.length<1||b.length>2){var c="Invalid number of files fetched.";Telemetry.RuntimeTelemetryHelper.LogExceptionTag(c,a,d.getCorrelationId(),578434901);throw c}var h=JSON.parse(b[0]),f=a;if(b.length==2)f=JSON.parse(b[1]);var e=OfficeExt.ExtendedManifestUtility.validateAndSubstituteExtendedManifestTokens(h,f);if(!e){var c="Did not get a validated extended manifest.";Telemetry.RuntimeTelemetryHelper.LogExceptionTag(c,a,d.getCorrelationId(),578434902);throw c}var g=OfficeExt.ManifestUtil.constructAddInId(d._marketplaceID,d._marketplaceVersion,d._storeType,d._storeLocator);OfficeExt.ShortcutsMappingTableManager.validateExtendedManifestShortcutKeys(e,g,true);OfficeExt.OsfExtendedManifestCache.set(g,JSON.stringify(e));return a})["catch"](function(a){var b="Promise rejected.";Telemetry.RuntimeTelemetryHelper.LogExceptionTag(b,a,d.getCorrelationId(),588887695);throw a})}return Promise.resolve(a)},isCustomFunctionSandbox:function(){var a=this;if(typeof a._settings=="object"&&typeof a._settings.length=="number")for(var b=0;b<a._settings.length;b++)if(typeof a._settings[b]=="object"&&typeof a._settings[b].length=="number"&&typeof a._settings[b][0]=="string"&&typeof a._settings[b][1]=="string"&&a._settings[b][0].toLowerCase()=="customfunctionaddinid")return true;return false},processManifestForCustomFunctions:function(b){var a=this,d=a;if(a._isManifestProcessedForCustomFunctions&&!a._isUpgrading)return;a._isManifestProcessedForCustomFunctions=true;if(!b)return;if(a.getReason()!==Microsoft.Office.WebExtension.InitializationReason.Inserted&&a.getReason()!==Microsoft.Office.WebExtension.InitializationReason.DocumentOpened)return;if(!b.containsCustomFunctionsForAppHost(a._contextActivationMgr._hostType))return;var i=OSF.getManifestHostType(a._contextActivationMgr._hostType),j=a._contextActivationMgr.getFormFactor(),e=new OfficeExt.Parser.ParsingContext(i,j,null,b),n=new OfficeExt.Parser.AddinCommandsManifestParser(i,j),m={assetId:a._marketplaceID,appVersion:a._marketplaceVersion,storeType:a._storeType,storeId:a._storeLocator,targetType:null},l={setErrorMessageForAddin:function(b,a){OsfMsAjaxFactory.msAjaxDebug.trace("Error parsing app manifest: "+a)}},c=n.parseExtensions(m,b,l);if(typeof c.ExtensionPoints!=="object"||typeof c.ExtensionPoints.length!=="number")return;for(var k=b.isXLLCompatible(),g=0;g<c.ExtensionPoints.length;g++){if(c.ExtensionPoints[g].type!=="CustomFunctions")continue;var f=c.ExtensionPoints[g],h=function(){var a={osfControl:d,locale:d._getCustomFunctionsLocale(b),invariantNamespace:d._getCustomFunctionsInvariantNamespace(e,f.namespaceResId),"namespace":e.resources.ShortStrings[f.namespaceResId],metadataUrl:e.resources.Urls[f.metadataResId],title:b.getDefaultDisplayName(),isXllCompatible:k,manifest:b._xmlProcessor.getNodeXml(b._xmlProcessor.getDocumentElement())};d._contextActivationMgr._notifyHost(d._id,OSF.AgaveHostAction.InstallCustomFunctions,a)};if(a.isCustomFunctionSandbox()){a._iframeUrl=e.resources.Urls[f.pageResId];a._isUpgrading&&h()}else h();break}},setIsUpgrading:function(a){this._isUpgrading=a},getIsUpgrading:function(){return this._isUpgrading},setUpgradingFailed:function(a){this._isUpgradingFailed=a},getUpgradingFailed:function(){return this._isUpgradingFailed},updateUrlsForSdx:function(d){var a=this;if(a.isFirstParty()){var e=".js",c=a._iframeUrl.substr(a._iframeUrl.length-e.length,e.length).toLowerCase()===e,h=/^(?:[a-z]+:)?\/\//i.test(a._iframeUrl);if(c||!h){var b,g=c?"index.html":a._iframeUrl;if(d!==null){var f=d.lastIndexOf("/");if(f!==-1)b=d.substr(0,f)+"/"+g}if(c)a._bundleUrl=a._iframeUrl;a._iframeUrl=b!=null?b:a._sdxIframeTemplateUrl}}},updateUrlsForSdxBundle:function(c){var a=this;if(a._contextActivationMgr._enableServiceDeliveredExperience){var b=".js",d=a._iframeUrl.substr(a._iframeUrl.length-b.length,b.length).toLowerCase()===b;if(d){a._bundleUrl=a._iframeUrl;a._iframeUrl=c!=null?c:a._sdxIframeTemplateUrl}}},_getCustomFunctionsLocale:function(a){if(a._UILocale)return a._UILocale.toLocaleLowerCase();if(a._defaultLocale)return a._defaultLocale.toLocaleLowerCase();return ""},_getCustomFunctionsInvariantNamespace:function(b,d){var c=b.manifest._xmlProcessor.selectSingleNode("o:OfficeApp"),a=b.selectSingleNode(c,["ov:VersionOverrides","ov:Resources","bt:ShortStrings","bt:String [@id = '"+d+"']"]);if(a)return a.getAttribute("DefaultValue");return null},_lessThan:function(a,b){return OSF.OsfManifestManager.versionLessThan(a,b)},_showTrustError:function(o,d,e,j,r,g,k,f){var c=true,b=null,a=this,i=OSF.OUtil.formatString(Strings.OsfRuntime.L_AgaveName_INFO,d?d:"");i=a._contextActivationMgr._ErrorUXHelper.getHTMLEncodedString(i);var h=OSF.OUtil.formatString(Strings.OsfRuntime.L_AgaveProvider_INFO,e?e:"");h=a._contextActivationMgr._ErrorUXHelper.getHTMLEncodedString(h);f=f==undefined?a.getManifest()?a.getManifest().isSSOAddin():false:f;var q=Strings.OsfRuntime.L_AgaveNewAppTitle_TXT,l=b,m=Strings.OsfRuntime.L_AgaveTrustAddIn_INFO,p=Strings.OsfRuntime.L_TrustButton_TXT,n=a._osfControlType===OSF.OsfControlType.DocumentLevel?OSF.NotificationType.TrustPromptContent:OSF.NotificationType.TrustPromptTaskpane;a._retryActivate=g;a._contextActivationMgr.displayNotification({id:a._id,infoType:OSF.InfoType.SecurityInfo,clientName:o,name:d?d:b,provider:e,title:q,description:m,icon:j?j:b,buttonTxt:p,buttonCallback:g,url:k?k:b,dismissCallback:b,reDisplay:c,displayDeactive:c,logAsError:c,retryAll:c,errorCode:OSF.ErrorStatusCodes.E_TRUSTCENTER_MOE_UNACTIVATED,iframeNotificationUrl:l,notificationType:n})},_showActivationError:function(g,l,k,h,m,d,i,j,f){var e=false,b=true,a=null,c=this;c._status=g;if(c._contextActivationMgr._enableFirstPartySDXErrorMessages&&c.isFirstParty())var n={id:c._id,infoType:OSF.InfoType.Error,status:g,title:i||Strings.OsfRuntime.L_AgaveErrorTile_TXT_FirstParty,description:l,icon:a,buttonTxt:k||Strings.OsfRuntime.L_OkButton_TXT,buttonCallback:h||a,url:m||a,dismissCallback:d||a,reDisplay:!d?b:e,displayDeactive:b,detailView:j?b:e,logAsError:b,errorCode:f?f:0};else var n={id:c._id,infoType:OSF.InfoType.Error,status:g,title:i||Strings.OsfRuntime.L_AgaveErrorTile_TXT,description:l,icon:a,buttonTxt:k||Strings.OsfRuntime.L_OkButton_TXT,buttonCallback:h||a,url:m||a,dismissCallback:d||a,reDisplay:!d?b:e,displayDeactive:b,detailView:j?b:e,logAsError:b,errorCode:f?f:0};c._contextActivationMgr.displayNotification(n);c._contextActivationMgr.raiseOsfControlStatusChange(c)},_showActivationWarning:function(f,i,h,g,j,d,e){var c=true,a=null,b=this;b._status=f;if(b._contextActivationMgr._enableFirstPartySDXErrorMessages&&b.isFirstParty())var k={id:b._id,infoType:OSF.InfoType.Warning,status:f,title:Strings.OsfRuntime.L_AgaveWarningTitle_TXT_FirstParty,description:i,icon:a,buttonTxt:h||Strings.OsfRuntime.L_OkButton_TXT,buttonCallback:g||a,url:j||a,dismissCallback:d||a,reDisplay:!d?c:false,displayDeactive:c,logAsError:c,errorCode:e?e:0};else var k={id:b._id,infoType:OSF.InfoType.Warning,status:f,title:Strings.OsfRuntime.L_AgaveWarningTitle_TXT,description:i,icon:a,buttonTxt:h||Strings.OsfRuntime.L_OkButton_TXT,buttonCallback:g||a,url:j||a,dismissCallback:d||a,reDisplay:!d?c:false,displayDeactive:c,logAsError:c,errorCode:e?e:0};b._contextActivationMgr.displayNotification(k);b._contextActivationMgr.raiseOsfControlStatusChange(b)},_refresh:function(a){this.deActivate();this.activate(a)},_activateAgavesBlockedBySandboxNotSupport:function(b){b.activateAgavesBlockedBySandboxNotSupport();var a=OSF.OUtil.getLocalStorage();a&&a.setItem(OSF.Constants.IgnoreSandBoxSupport,"true")},_setCachedFlag:function(a){this._contextActivationMgr._setCachedFlag(a)},_getCachedFlag:function(a){return this._contextActivationMgr._getCachedFlag(a)},_deleteCachedFlag:function(a){this._contextActivationMgr._deleteCachedFlag(a)},_notifyHostIFrameOnLoaded:function(){var a=this;if(a._contextActivationMgr._changeGateOnPageReadyFix){if(a._contextActivationMgr._notifyHost&&!a._iframeLoadedNotified){a._contextActivationMgr._notifyHost(a._id,OSF.AgaveHostAction.PageIsReady);a._iframeLoadedNotified=true}}else a._contextActivationMgr._notifyHost&&a._contextActivationMgr._notifyHost(a._id,OSF.AgaveHostAction.PageIsReady)},_addETokenAsQueryParameter:function(e){var a=document.createElement("a");a.href=e;var f=this.getEToken(),b=OSF.Constants.ETokenParameterName+"="+encodeURIComponent(OSF.OUtil.encodeBase64(f)),d=a.search.length>1?a.search.substr(1)+"&":"";a.search=d+b;var c=a.href;a=null;return c},_addAsQueryParameter:function(e,g,f){var a=document.createElement("a");a.href=e;var b=encodeURIComponent(g)+"="+encodeURIComponent(f),d=a.search.length>1?a.search.substr(1)+"&":"";a.search=d+b;var c=a.href;a=null;return c},_activate:function(h,l){var e="OsfControlId",b=true,d=false,a=this,c=a;Telemetry.AppLoadTimeHelper.PageStart(a._telemetryContext);if(a._storeType===OSF.StoreType.Sdx){var k=performance.now(),g=d,f=d,i=d,j=function(){if(!i){i=b;Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("SDX Activation Duration = "+(performance.now()-c._sdxTelemetryContext["activationStart"])+".",null,42271587);OfficeExt.SDXCatalog.recordActivationActivity(b,c._sdxTelemetryContext);c._marketplaceID.toLowerCase()===OSF.SdxAssetIds.ExperimentationSdx&&setTimeout(function(){return c.deActivate()},6e4)}};a._iframeOnLoadDelegate=Function.createDelegate(a,function(){var a=this;a._sdxTelemetryContext["iframeOnLoadReceived"]=performance.now();if(!g){g=b;OfficeExt.SDXCatalog.recordActivity("PageLoad",k,b,[{name:e,string:a._id},{name:"AssetId",string:a._marketplaceID}]);f&&j()}a._iframeOnLoad.apply(a,arguments)});a._iframeOnGetAppContextDelegate=function(){if(!f){f=b;OfficeExt.SDXCatalog.recordActivity("OfficeJsReady",k,b,[{name:e,string:c._id},{name:"AssetId",string:c._marketplaceID}]);g&&j()}}}a._setIframeAttribute(h,l);a._pageIsReadyTimerExpired=d;OSF.OUtil.addEventListener(h,"load",a._iframeOnLoadDelegate);a._div.appendChild(h);a._status=OSF.OsfControlStatus.Activated;OSF.OUtil.writeProfilerMark(OSF.OsfControlActivationPerfMarker.ActivationEnd);a._contextActivationMgr.raiseOsfControlStatusChange(a);Telemetry.AppLoadTimeHelper.OfficeJSStartToLoad(a._telemetryContext)},_setIframeAttribute:function(h,d){var a=this;if(a._storeType!==OSF.StoreType.Sdx)d=a._addETokenAsQueryParameter(d);else if(a._contextActivationMgr._enableDisplayUILocaleQueryString&&a.isFirstParty())d=a._addAsQueryParameter(d,OSF.Constants.DisplayLanguageParameterName,a._contextActivationMgr._appUILocale);var o=a._contextActivationMgr.getClientId()+"_"+a._contextActivationMgr.getDocUrl()+"_"+a._id,m=OSF.OUtil.getFrameName(o);a._conversationId=OSF.OUtil.generateConversationId();var n=[a._contextActivationMgr._hostType,a._contextActivationMgr._hostPlatform,a._contextActivationMgr._hostSpecificFileVersion,a._contextActivationMgr._appUILocale,a.getCorrelationId(),a._isDialog?"isDialog":null,a._contextActivationMgr._disableLogging?"disableLogging":null,a._hostInfoFlags],p=n.join("|"),e=d,c=window.location.origin;if(typeof c==="undefined"||c&&c==="null"){var f=OSF.OUtil.parseUrl(window.location.href);c=f.protocol+"//"+f.hostname+(f.port?":"+f.port:"")}var q=a._conversationId+"|"+a._id+"|"+(c.indexOf("$")>=0?encodeURIComponent(c):c),b={};b[OSF.WindowNameItemKeys.BaseFrameName]=m;b[OSF.WindowNameItemKeys.HostInfo]=p;b[OSF.WindowNameItemKeys.XdmInfo]=q;b[OSF.WindowNameItemKeys.SerializerVersion]=OSF.SerializerVersion.Browser;b[OSF.WindowNameItemKeys.Flights]=JSON.stringify(OSF.Flights);a._marketplaceID.toLowerCase()===OSF.SdxAssetIds.ExperimentationSdx&&a.addProperty("sdxTelemetryContext",JSON.stringify(a._sdxTelemetryContext));if(a._contextActivationMgr._enable3rdPartySetAppContextInIframeName||a.isFirstParty()){var l=a.getAppContext(),g=JSON.stringify(l).length;Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("AppContext length is: "+g,a.getCorrelationId(),593896220);if(g<OSF.MaxAppContextLength){b[OSF.WindowNameItemKeys.AppContext]=l;a._appContextIsSetToIframeName=true}else Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("We got a huge appContext exceeding maximum, appContext length is: "+g,a.getCorrelationId(),593896219)}if(OSF.OUtil.checkFlight(OSF.FlightNames.CheckReceiverOrigin))b[OSF.WindowNameItemKeys.Flights]=JSON.stringify(OSF.Flights);var k=OSF.OUtil.getLocalStorage();if(k){var j="CustomFunctionsRuntimeLogging",i=k.getItem(j);if(i)b[j]=i}a._contextActivationMgr._getServiceEndPoint().registerConversation(a._conversationId,e,a._appDomains);h.setAttribute("src",e);a._sdxTelemetryContext["iframeUrl"]=e;a._agaveWindowName=OfficeExt.WACUtils.serializeObjectToString(b);h.setAttribute("name",a._agaveWindowName);OSF.OUtil.addClass(h,"AddinIframe");a._agavePageUrl=e},getAppContext:function(){var a=this,g=a.getEToken(),d=0;if(a._contextActivationMgr._hostSpecificFileVersion&&a._contextActivationMgr._hostSpecificFileVersion.indexOf(".")!=-1){var c=a._contextActivationMgr._hostSpecificFileVersion.split("."),e=c[1];if(!isNaN(e))d=parseInt(c[1])}var f=a._contextActivationMgr._requirementsChecker._getSupportedSet(),b=new OSF.OfficeAppContext(a.getMarketplaceID(),a._contextActivationMgr._appName,a._contextActivationMgr._appVersion,a._contextActivationMgr._appUILocale,a._contextActivationMgr._dataLocale,a._contextActivationMgr._docUrl||window.location.href,a._contextActivationMgr._clientMode,a.getSettings(),a.getReason(),a.getOsfControlType(),g,a._appCorrelationId,a.getID(),false,true,d,f,a.getHostCustomMessage(),a._contextActivationMgr._hostFullVersion||OSF.Constants.FileVersion,window.innerHeight,window.innerWidth,a.getManifest()?a.getManifest().getDefaultDisplayName():null,a._appDomains,undefined,a.getFeatureGates(),undefined,a._initialDisplayMode);b._wacHostEnvironment=a._contextActivationMgr._wacHostEnvironment||"0";b._isFromWacAutomation=!!a._contextActivationMgr._isFromWacAutomation;b._addInSourceLocationSubdomainAllowedIsEnabled=true;b._addInSourceUrl=a._agavePageUrl;return b},ensureAgaveEndPoint:function(){var a=this;if(!a._agaveEndPoint){var b=a._conversationId+OSF.SharedConstants.NotificationConversationIdSuffix;a._agaveEndPoint=Microsoft.Office.Common.XdmCommunicationManager.connect(b,a._frame.contentWindow,a._iframeUrl)}},_getConversationId:function(){return this._conversationId},_doesBrowserSupportRequiredFeatures:function(){var a=false;if(Object.defineProperty)try{Object.defineProperty({},"myTestProperty",{"get":function(){return this.desc},"set":function(a){this.desc=a}});a=true}catch(b){}return a},_isAddinCommands:function(b){var a=this;if(a._isvirtualOsfControl)b(true);else if(a._contextActivationMgr._enableAddinCommands&&a._contextActivationMgr._enableTaskpaneUpgradeToAppCommand&&a._virtualOsfControlActivationCallback!=null){var c={marketplaceId:a._marketplaceID,marketplaceVersion:a._marketplaceVersion,storeType:a._storeType,storeId:a._storeLocator,targetData:{}};a._contextActivationMgr.isAddinCommandsAsync(c,function(d,a){b(a)})}else b(false)}};var OfficeExt;(function(a){var b=function(){function b(){}b.getAll=function(){var c=[],d=[];return a.OsfCache.get(a.OsfCache.c_osfCacheTableName,b.c_osfExtendedManifestIdsCacheKey).then(function(b){if(b){var e=JSON.parse(b);e.forEach(function(b){d.push(a.OsfCache.get(a.OsfCache.c_extendedManifestTableName,b).then(function(a){if(a){var d={addinId:b,extendedManifest:JSON.parse(a)};c.push(d)}}))});return Promise.all(d)}else return null}).then(function(){return c})};b.get=function(b){var c=b.toLowerCase();return a.OsfCache.get(a.OsfCache.c_extendedManifestTableName,b).then(function(a){if(a){var b={addinId:c,extendedManifest:JSON.parse(a)};return b}else return null})};b.set=function(g,h){var f=this,d=g.toLowerCase(),e=JSON.stringify(JSON.parse(h)),c=[];return a.OsfCache.get(a.OsfCache.c_osfCacheTableName,b.c_osfExtendedManifestIdsCacheKey).then(function(a){if(!a){c.push(d);return f.setExtendedManifestHelper(c,d,e,false)}else{c=JSON.parse(a);if(c.indexOf(g)<0){c.push(d);return f.setExtendedManifestHelper(c,d,e,false)}else return f.setExtendedManifestHelper(c,d,e,true)}})};b.wasExtendedManifestAlreadyFetched=function(a){return b.s_fetchedExtendedManifestIdsInMemory&&b.s_fetchedExtendedManifestIdsInMemory.indexOf(a)>=0};b.onChanged=function(a){b.s_onCacheChangedCallbacks.push(a)};b.setExtendedManifestHelper=function(f,c,d,e){if(e)return a.OsfCache.get(a.OsfCache.c_extendedManifestTableName,c).then(function(e){if(d!=e)return a.OsfCache.set(a.OsfCache.c_extendedManifestTableName,c,d).then(function(){b.processCallbacks()})});else return a.OsfCache.set(a.OsfCache.c_extendedManifestTableName,c,d).then(function(){b.s_fetchedExtendedManifestIdsInMemory.push(c);return a.OsfCache.set(a.OsfCache.c_osfCacheTableName,b.c_osfExtendedManifestIdsCacheKey,JSON.stringify(f)).then(function(){b.processCallbacks()})})};b.processCallbacks=function(){b.s_onCacheChangedCallbacks.forEach(function(a){a()})};b.c_osfExtendedManifestIdsCacheKey="OsfExtendedManifestIds";b.s_fetchedExtendedManifestIdsInMemory=[];b.s_onCacheChangedCallbacks=[];return b}();a.OsfExtendedManifestCache=b;b.onChanged(function(){a.ActionMetadataManager.init(false)})})(OfficeExt||(OfficeExt={}));OSF.OUtil.setNamespace("Manifest",OSF);OSF.Manifest.HostApp=function(a){this._appName=a;this._minVersion=null};OSF.Manifest.HostApp.prototype={getAppName:function(){return this._appName},getMinVersion:function(){return this._minVersion},_setMinVersion:function(a){this._minVersion=a}};OSF.Manifest.ExtensionSettings=function(){this._sourceLocations={};this._defaultHeight=null;this._defaultWidth=null};OSF.Manifest.ExtensionSettings.prototype={getDefaultHeight:function(){return this._defaultHeight},getDefaultWidth:function(){return this._defaultWidth},getSourceLocations:function(){return this._sourceLocations},_addSourceLocation:function(a,b){this._sourceLocations[a.toLocaleLowerCase()]=b},_setDefaultWidth:function(a){this._defaultWidth=a},_setDefaultHeight:function(a){this._defaultHeight=a}};OSF.Manifest.WebAppInfoAuthorization=function(){this._resource=null;this._scopes=null};OSF.Manifest.WebAppInfoAuthorization.prototype={getResource:function(){return this._resource},getScopes:function(){return this._scopes}};OSF.Manifest.EquivalentAddins=function(){this._equivalentAddins=[]};OSF.Manifest.EquivalentAddins.prototype={isXLLCompatible:function(){for(var a=0;a<this._equivalentAddins.length;a++)if(this._equivalentAddins[a].isXLLCompatible())return true;return false},add:function(a){this._equivalentAddins.push(a)},getEquivalentAddins:function(){return this._equivalentAddins}};OSF.Manifest.EquivalentAddin=function(){this._progId=null;this._fileName=null;this._type=null};OSF.Manifest.EquivalentAddin.prototype={getProgId:function(){return this._progId},getFileName:function(){return this._fileName},getType:function(){return this._type},isXLLCompatible:function(){return this._type=="XLL"},isComAddin:function(){return this._type=="COM"}};var RuntimeLifeTime;(function(a){a[a["Short"]=0]="Short";a[a["Long"]=1]="Long"})(RuntimeLifeTime||(RuntimeLifeTime={}));OSF.Manifest.Runtimes=function(){this._runtimes=[]};OSF.Manifest.Runtimes.prototype={getSharedRuntime:function(d){var a=null,b=this;if(d==a||b._runtimes==a)return a;for(var c=0;c<b._runtimes.length;c++)if(b._runtimes[c]!=a&&b._runtimes[c].Resid===d)return b._runtimes[c];return a},add:function(a){if(a==null||this._runtimes==null)return;if(this.getSharedRuntime(a.Resid)!=null)throw OsfMsAjaxFactory.msAjaxError.argument("Manifest parser failure: cannot have same Resid for different runtime.");this._runtimes.push(a)},getRuntimes:function(){return this._runtimes}};OSF.Manifest.Runtime=function(){this.Resid=null;this.LifeTime=RuntimeLifeTime.Short};OSF.Manifest.Manifest=function(k,K){var f=null,u="ov:VersionOverrides",t="VersionOverrides",s="xsi:type",r="o:OfficeApp",h="1.1",a=this;a._UILocale=K||"en-us";if(typeof k!=="string"){k(a);return}a._displayNames={};a._descriptions={};a._iconUrls={};a._extensionSettings={};a._highResolutionIconUrls={};a._versionOverrides={};a._ribbonExtensionControls={};var m;a._xmlProcessor=new OSF.XmlProcessor(k,OSF.ManifestNamespaces[h]);if(a._xmlProcessor.selectSingleNode(r)){m=B;a._manifestSchemaVersion=OSF.ManifestSchemaVersion[h]}else{a._xmlProcessor=new OSF.XmlProcessor(k,OSF.ManifestNamespaces["1.0"]);m=A;a._manifestSchemaVersion=OSF.ManifestSchemaVersion["1.0"]}var b=a._xmlProcessor.getDocumentElement();a._target=OSF.OUtil.parseEnum(b.getAttribute(s),OSF.OfficeAppType);var c=a._xmlProcessor.selectSingleNode(r);b=a._xmlProcessor.selectSingleNode("o:Id",c);a._id=a._xmlProcessor.getNodeValue(b);var J=new RegExp("^[a-f0-9]{8}(-[a-f0-9]{4}){3}-[a-f0-9]{12}$","i");if(!J.test(a._id))throw OsfMsAjaxFactory.msAjaxError.argument("Manifest");b=a._xmlProcessor.selectSingleNode("o:Version",c);a._version=a._xmlProcessor.getNodeValue(b);b=a._xmlProcessor.selectSingleNode("o:ProviderName",c);a._providerName=a._xmlProcessor.getNodeValue(b);b=a._xmlProcessor.selectSingleNode("o:IdIssuer",c);a._idIssuer=a._parseIdIssuer(b);b=a._xmlProcessor.selectSingleNode("o:AlternateId",c);if(b)a._alternateId=a._xmlProcessor.getNodeValue(b);b=a._xmlProcessor.selectSingleNode("o:DefaultLocale",c);a._defaultLocale=a._xmlProcessor.getNodeValue(b);b=a._xmlProcessor.selectSingleNode("o:DisplayName",c);a._parseLocaleAwareSettings(b,Function.createDelegate(a,a._addDisplayName));b=a._xmlProcessor.selectSingleNode("o:Description",c);a._parseLocaleAwareSettings(b,Function.createDelegate(a,a._addDescription));b=a._xmlProcessor.selectSingleNode("o:AppDomains",c);a._appDomains=a._parseAppDomains(b);b=a._xmlProcessor.selectSingleNode("o:IconUrl",c);b&&a._parseLocaleAwareSettings(b,Function.createDelegate(a,a._addIconUrl));b=a._xmlProcessor.selectSingleNode("o:Signature",c);if(b)a._signature=a._xmlProcessor.getNodeValue(b);a._parseExtensionSettings();b=a._xmlProcessor.selectSingleNode("o:Permissions",c);a._permissions=a._parsePermission(b);a._allowSnapshot=true;b=a._xmlProcessor.selectSingleNode("o:AllowSnapshot",c);if(b)a._allowSnapshot=a._parseBooleanNode(b);if(a._manifestSchemaVersion===OSF.ManifestSchemaVersion[h]){var e="ov:";if(a._target==OSF.OfficeAppType.ContentApp)e="c:";b=a._xmlProcessor.selectSingleNode(e+t,c);if(b){var g=a._xmlProcessor.selectSingleNode(e+"WebApplicationInfo",b);if(g){var C=a._xmlProcessor.selectSingleNode(e+"Resource",g);a._webApplicationResource=a._xmlProcessor.getNodeValue(C);var G=a._xmlProcessor.selectSingleNode(e+"Id",g);a._webApplicationId=a._xmlProcessor.getNodeValue(G);var o=a._xmlProcessor.selectSingleNode(e+"MsaId",g);if(o)a._webApplicationMsaId=a._xmlProcessor.getNodeValue(o);else a._webApplicationMsaId=a._webApplicationId;var D=a._xmlProcessor.selectSingleNode(e+"Scopes",g);a._webApplicationScopes=a._parseWebApplicationScopes(D,e);a._webApplicationAuthorizations=a._parseWebAppInfoAuthorizations(g,e)}}}if(a._manifestSchemaVersion===OSF.ManifestSchemaVersion[h]&&a._target==OSF.OfficeAppType.TaskPaneApp){var e="ov:";b=a._xmlProcessor.selectSingleNode(e+t,c);if(b){var F=a._xmlProcessor.selectSingleNode(e+"EquivalentAddins",b);a._equivalentAddins=a._parseEquivalentAddins(F,e)}}if(a._manifestSchemaVersion===OSF.ManifestSchemaVersion[h]){var i=a._xmlProcessor.selectSingleNode(u,c);if(i)a._manifestSourceLocationOverrides=a._parseSourceLocationOverrides(i)}if(a._manifestSchemaVersion===OSF.ManifestSchemaVersion[h]&&a._target==OSF.OfficeAppType.TaskPaneApp){var p=a._xmlProcessor.selectSingleNode("o:ExtendedOverrides",c);p!=f&&a._parseExtendedOverrides(p);var i=a._xmlProcessor.selectSingleNode(u,c);if(i!==f){var y=a._xmlProcessor.selectSingleNode("ov:Hosts",i);if(y!==f){var j=a._xmlProcessor.selectNodes("ov:Host",y);if(j!==f)for(var L=j.length,l=0;l<L;l++){var d=j[l].getAttribute(s);if(d!=="Workbook"&&d!=="Presentation")continue;a._versionOverrides[d]={};var w=a._xmlProcessor.selectSingleNode("ov:Runtimes",j[l]);if(w)a._versionOverrides[d]._runtimes=a._parseRuntimes(w);else{var n=new OSF.Manifest.Runtime;n.Resid="OEP.SharedRuntime.Url";n.LifeTime=RuntimeLifeTime.Long;var z=new OSF.Manifest.Runtimes;z.add(n);a._versionOverrides[d]._runtimes=z}var H=new OfficeExt.Parser.AddinCommandsManifestParser(d,"DesktopFormFactor"),E=new OfficeExt.Parser.AddinCommandsManifestParser(d,"AllFormFactors"),v={setErrorMessageForAddin:function(a){OsfMsAjaxFactory.msAjaxDebug.trace("Error parsing app manifest: "+a)}},x={assetId:a._id,appVersion:a._version,storeType:f,storeId:f,targetType:f},q=H.parseExtensions(x,a,v),I=E.parseExtensions(x,a,v);a._versionOverrides[d]._addinCommandsExtensionPoints=q.ExtensionPoints;a._versionOverrides[d]._functionFileResid=q.functionFileResid;a._versionOverrides[d]._customFunctionExtensionPoint=I.ExtensionPoints[0];a._versionOverrides[d]._showTaskpaneControls=a._retrieveAppCommandShowTaskpaneControls(d);a._validateShowTaskpaneSharedRuntime(d);a._generateRibbonExtensionControlMap(d)}}}}m.apply(a);function A(){var a=this,d=a._xmlProcessor.selectSingleNode("o:Capabilities",c),b=a._xmlProcessor.selectNodes("o:Capability",d);a._capabilities=a._parseCapabilities(b)}function B(){var a=this,b=a._xmlProcessor.selectSingleNode("o:Hosts",c);a._hosts=a._parseHosts(b);if(b)a._hostsXml=b.xml||b.outerHTML;b=a._xmlProcessor.selectSingleNode("o:Requirements",c);a._requirements=a._parseRequirements(b);if(b)a._requirementsXml=b.xml||b.outerHTML;b=a._xmlProcessor.selectSingleNode("o:HighResolutionIconUrl",c);b&&a._parseLocaleAwareSettings(b,Function.createDelegate(a,a._addHighResolutionIconUrl))}};OSF.Manifest.Manifest.prototype={getSourceLocationOverrideByResourceId:function(a){if(a&&this._manifestSourceLocationOverrides)return this._manifestSourceLocationOverrides[a];return null},getManifestSchemaVersion:function(){return this._manifestSchemaVersion},getMarketplaceID:function(){return this._id},getMarketplaceVersion:function(){return this._version},getDefaultLocale:function(){return this._defaultLocale},getProviderName:function(){return this._providerName},getIdIssuer:function(){return this._idIssuer},getAlternateId:function(){return this._alternateId},getSignature:function(){return this._signature},getCapabilities:function(){return this._capabilities},getDisplayName:function(a){return this._displayNames[a.toLocaleLowerCase()]},getDefaultDisplayName:function(){return this._getDefaultValue(this._displayNames)},getDescription:function(a){return this._descriptions[a]},getDefaultDescription:function(){return this._getDefaultValue(this._descriptions)},getIconUrl:function(a){return this._iconUrls[a]},getDefaultIconUrl:function(){return this._getDefaultValue(this._iconUrls)},getSourceLocation:function(d,c){var a=this._getExtensionSetting(c),b=a.getSourceLocations();return b[d.toLocaleLowerCase()]},getDefaultSourceLocation:function(c){var a=this._getExtensionSetting(c),b=a.getSourceLocations();return this._getDefaultValue(b)},getDefaultWidth:function(b){var a=this._getExtensionSetting(b);return a.getDefaultWidth()},getDefaultHeight:function(b){var a=this._getExtensionSetting(b);return a.getDefaultHeight()},getTarget:function(){return this._target},getOmexTargetCode:function(){switch(this._target){case OSF.OfficeAppType.ContentApp:return 2;case OSF.OfficeAppType.TaskPaneApp:return 1;case OSF.OfficeAppType.MailApp:return 3;default:return 0}},getPermission:function(){return this._permissions},hasPermission:function(a){return (this._permissions&a)===a},getHosts:function(){return this._hosts},getHostsXml:function(){return this._hostsXml},getRequirements:function(){return this._requirements},getRequirementsXml:function(){return this._requirementsXml},getHighResolutionIconUrl:function(a){return this._highResolutionIconUrls[a]},getDefaultHighResolutionIconUrl:function(){return this._getDefaultValue(this._highResolutionIconUrls)},getAppDomains:function(){return this._appDomains},getInMemoryEToken:function(){return this._inMemoryEToken},isAllowSnapshot:function(){return this._allowSnapshot},addManifestUrl:function(b){var a=OfficeExt.WACUtils.getDomainForUrl(b);this._appDomains.indexOf(a)===-1&&this._appDomains.push(a)},getWebApplicationResource:function(){return this._webApplicationResource},getWebApplicationId:function(){return this._webApplicationId},getWebApplicationMsaId:function(){return this._webApplicationMsaId},getWebApplicationScopes:function(){return this._webApplicationScopes},getWebApplicationAuthorizations:function(){return this._webApplicationAuthorizations},getEquivalentAddins:function(){if(this._equivalentAddins)return this._equivalentAddins.getEquivalentAddins();return []},isXLLCompatible:function(){if(this._equivalentAddins)return this._equivalentAddins.isXLLCompatible();return false},isSSOAddin:function(){return !!this._webApplicationResource&&!!this._webApplicationId},containsAddinCommands:function(b){var a=this._getCurrentHostTypeNode(b);if(a!==null){var c=this._xmlProcessor.selectSingleNode("ov:DesktopFormFactor",a);if(c!=null)return true}return false},getRibbonExtensionControlMap:function(){return this._ribbonExtensionControls},getExtendedOverrides:function(){return this._extendedOverrides},getExtendedOverridesTokens:function(){if(this._extendedOverridesTokens)return this._extendedOverridesTokens;return []},containsCustomFunctions:function(f){var d=this._getCurrentHostTypeNode(f);if(d!==null){var c=this._xmlProcessor.selectSingleNode("ov:AllFormFactors",d);if(c!==null){var a=this._xmlProcessor.selectNodes("ov:ExtensionPoint",c);if(a!==null)for(var g=a.length,b=0;b<g;b++){var e=a[b].getAttribute("xsi:type");if(e==="CustomFunctions")return true}}}return false},containsCustomFunctionsForAppHost:function(a){var b=OSF.getManifestHostType(a);return a!=OSF.HostType.Outlook&&this.containsCustomFunctions(b)},getSharedRuntimeForCustomFunctions:function(c){var a=null;if(c==a||this._versionOverrides==a)return a;var b=this._versionOverrides[c];if(b==a||b._customFunctionExtensionPoint==a||b._runtimes==a)return a;else return b._runtimes.getSharedRuntime(b._customFunctionExtensionPoint.pageResId)},getSharedRuntimeForTaskpane:function(e,d){var a=null;if(e==a||d==a||this._versionOverrides==a)return a;var b=this._versionOverrides[e];if(b==a||b._showTaskpaneControls==a||b._runtimes==a)return a;var c=a;this._iterateAppCommandShowTaskpaneControls(b._showTaskpaneControls,function(b){if(b==a||b.action==a)return false;if(b.action.taskpaneId===d||b.id===d){c=b.action.sourceLocationResid;return true}return false});return c==a?a:b._runtimes.getSharedRuntime(c)},getTaskpaneIdByRuntimeId:function(c,e){var a=null;if(c==a||e==a||this._versionOverrides==a)return a;var b=this._versionOverrides[c];if(b==a||b._showTaskpaneControls==a||b._runtimes==a)return a;var d=a;this._iterateAppCommandShowTaskpaneControls(b._showTaskpaneControls,function(b){if(b==a||b.action==a)return false;if(b.action.sourceLocationResid===e){d=b.action.taskpaneId;return true}return false});return d},getSharedRuntimeById:function(c,d){var a=null;if(this._versionOverrides==a)return a;var b=this._versionOverrides[c];if(b==a||b._runtimes==a)return a;return b._runtimes.getSharedRuntime(d)},getSharedRuntimeForAppCmdsExecuteFunction:function(c){var a=null;if(c==a||this._versionOverrides==a)return a;var b=this._versionOverrides[c];if(b==a||b._runtimes==a)return a;else return b._runtimes.getSharedRuntime(b._functionFileResid)},getSharedRuntimeId:function(a,c,d){var b=c?this.getSharedRuntimeForAppCmdsExecuteFunction(a):this.getSharedRuntimeForTaskpane(a,d);return b!==null?b.Resid:null},sharedRuntimeHasShortLifeTime:function(c,e){var a=null;if(c===a||e===a||this._versionOverrides===a)return false;var b=this._versionOverrides[c];if(b===a||b._runtimes===a)return false;var d=b._runtimes.getSharedRuntime(e);return d===a?false:d.LifeTime===RuntimeLifeTime.Short},_iterateAppCommandShowTaskpaneControls:function(a,c){if(a==null||c==null)return;for(var b=0;b<a.length;b++)if(c(a[b]))break},_generateRibbonExtensionControlMap:function(h){var a=null,c=this;if(h==a||c._versionOverrides==a)return a;var d=c._versionOverrides[h],j=[];if(d!=a&&d._addinCommandsExtensionPoints!=a)for(var i=d._addinCommandsExtensionPoints.length,g=0;g<i;g++){var b=d._addinCommandsExtensionPoints[g];if(b.type==="PrimaryCommandSurface")if(b.tabs)for(var e=0;e<b.tabs.length;e++){var f=b.tabs[e];c._ribbonExtensionControls[f.id]=f;c._addRibbonControlsToMap(f)}}},_addRibbonControlsToMap:function(b){if(b&&b.children)for(var c=0;c<b.children.length;c++){var a=b.children[c];if(a&&!(a instanceof OfficeExt.Parser.MenuControl))this._ribbonExtensionControls[a.id]=a;this._addRibbonControlsToMap(a)}},_retrieveAppCommandShowTaskpaneControls:function(l){var a=null,c=this;if(l==a||c._versionOverrides==a)return a;var d=c._versionOverrides[l],f=[];if(d!=a&&d._addinCommandsExtensionPoints!=a)for(var m=d._addinCommandsExtensionPoints.length,j=0;j<m;j++){var b=d._addinCommandsExtensionPoints[j];if(b==a)continue;if(b.type==="PrimaryCommandSurface"){if(b.tabs==a)continue;for(var k=0;k<b.tabs.length;k++){var e=b.tabs[k];if(e==a||e.children==a)continue;for(var h=0;h<e.children.length;h++){var i=e.children[h];if(i==a||i.children==a)continue;c._getShowTaskpaneControlsFromControlsParent(i,f)}}}else if(b.type==="ContextMenu"){if(b.children==a)continue;var g=b.children[0];if(g==a||g.children==a)continue;c._getShowTaskpaneControlsFromControlsParent(g,f)}}return f},_getShowTaskpaneControlsFromControlsParent:function(c,e){var h="ShowTaskpane",a=null;if(c==a||c.children==a||e==a)return;for(var f=0;f<c.children.length;f++){var b=c.children[f];if(b!=a)if(b.controlType==="Button")b.action!=a&&b.actionType===h&&e.push(b);else{if(b.children==a)continue;for(var g=0;g<b.children.length;g++){var d=b.children[g];d!=a&&d.action!=a&&d.actionType===h&&e.push(d)}}}},_validateShowTaskpaneSharedRuntime:function(d){var a=null;if(d==a||this._versionOverrides==a)return;var c=this._versionOverrides[d];if(c==a||c._runtimes==a||c._showTaskpaneControls==a)return;var b=[];this._iterateAppCommandShowTaskpaneControls(c._showTaskpaneControls,function(g){var h="Manifest parser failure: resid and taskpaneid not correct",d=false;if(g==a||g.action==a)return d;var j=c._runtimes.getSharedRuntime(g.action.sourceLocationResid),k=a;if(j==a||j.LifeTime!=RuntimeLifeTime.Long){if(g.action.taskpaneId==a)return d}else k=j.Resid;for(var f=[g.action.taskpaneId,k],i=true,e=0;e<b.length;e++)if(b[e][0]==f[0]&&b[e][1]==f[1])if(f[0]==a)throw OsfMsAjaxFactory.msAjaxError.argument(h);else{i=d;break}else if(b[e][1]==f[1]&&b[e][1]!=a||b[e][0]==f[0]&&b[e][0]!=a){i=d;throw OsfMsAjaxFactory.msAjaxError.argument(h)}i&&b.push(f);return d})},_getDefaultValue:function(c){var b=this,a;if(b._UILocale)a=c[b._UILocale]||c[b._UILocale.toLocaleLowerCase()]||undefined;if(!a&&b._defaultLocale)a=c[b._defaultLocale]||c[b._defaultLocale.toLocaleLowerCase()]||undefined;if(!a){var d;for(var e in c){d=e;break}a=c[d]}return a},_getExtensionSetting:function(c){var a=this,b;if(typeof a._extensionSettings[c]!="undefined")b=a._extensionSettings[c];else for(var d in a._extensionSettings){b=a._extensionSettings[d];break}return b},_addDisplayName:function(a,b){this._displayNames[a.toLocaleLowerCase()]=b},_addDescription:function(a,b){this._descriptions[a]=b},_addIconUrl:function(a,b){this._iconUrls[a]=b},_parseLocaleAwareSettings:function(a,d){if(!a)throw OsfMsAjaxFactory.msAjaxError.argument("Manifest");var f=a.getAttribute("DefaultValue");d(this._defaultLocale,f);var b=this._xmlProcessor.selectNodes("o:Override",a);if(b)for(var i=b.length,c=0;c<i;c++){var e=b[c],g=e.getAttribute("Locale"),h=e.getAttribute("Value");d(g,h)}},_parseBooleanNode:function(b){if(!b)return false;else{var a=this._xmlProcessor.getNodeValue(b).toLowerCase();return a==="true"||a==="1"}},_parseIdIssuer:function(a){if(!a)return OSF.ManifestIdIssuer.Custom;else{var b=this._xmlProcessor.getNodeValue(a);return OSF.OUtil.parseEnum(b,OSF.ManifestIdIssuer)}},_parseCapabilities:function(d){for(var c=[],a,b=0;b<d.length;b++){var e=d[b];a=e.getAttribute("Name");a=OSF.OUtil.parseEnum(a,OSF.Capability);c.push(a)}return c},_parsePermission:function(a){if(!a)throw OsfMsAjaxFactory.msAjaxError.argument("Manifest");var b=this._xmlProcessor.getNodeValue(a);return OSF.OUtil.parseEnum(b,OSF.OsfControlPermission)},_parseExtensionSettings:function(){var a=this,h=a,c,d,b;for(var e in OSF.FormFactor){var g=a._xmlProcessor.selectSingleNode("o:OfficeApp");d=a._xmlProcessor.selectSingleNode("o:"+OSF.FormFactor[e],g);if(d){c=new OSF.Manifest.ExtensionSettings;b=a._xmlProcessor.selectSingleNode("o:SourceLocation",d);var f=function(b,a){c._addSourceLocation(b,a);h.addManifestUrl(a)};a._parseLocaleAwareSettings(b,f);b=a._xmlProcessor.selectSingleNode("o:RequestedWidth",d);b&&c._setDefaultWidth(a._xmlProcessor.getNodeValue(b));b=a._xmlProcessor.selectSingleNode("o:RequestedHeight",d);b&&c._setDefaultHeight(a._xmlProcessor.getNodeValue(b));a._extensionSettings[e]=c}}if(!c)throw OsfMsAjaxFactory.msAjaxError.argument("Manifest")},_parseHosts:function(d){var b=[];if(d)for(var c=this._xmlProcessor.selectNodes("o:Host",d),a=0;a<c.length;a++)b.push(c[a].getAttribute("Name"));return b},_parseWebApplicationScopes:function(b,e){var d=[];if(b)for(var c=this._xmlProcessor.selectNodes(e+"Scope",b),a=0;a<c.length;a++)d.push(this._xmlProcessor.getNodeValue(c[a]));return d},_parseWebAppInfoAuthorizations:function(n,b){var a=this,i=[],h=a._xmlProcessor.selectSingleNode(b+"Authorizations",n);if(h){var c=a._xmlProcessor.selectNodes(b+"Authorization",h);if(c)for(var e=0;e<c.length;e++){var l=c[e],f=new OSF.Manifest.WebAppInfoAuthorization,j=a._xmlProcessor.selectSingleNode(b+"Resource",l);if(j)f._resource=a._xmlProcessor.getNodeValue(j);var k=a._xmlProcessor.selectSingleNode(b+"Scopes",l);if(k){var g=a._xmlProcessor.selectNodes(b+"Scope",k);if(g){for(var m=[],d=0;d<g.length;d++){var o=g[d];m.push(a._xmlProcessor.getNodeValue(o))}f._scopes=m}}i.push(f)}}return i},_parseRequirements:function(b){var a=this,c={sets:[],methods:[]};if(b){var e=a._xmlProcessor.selectSingleNode("o:Sets",b);c.sets=a._parseSets(e);var d=a._xmlProcessor.selectSingleNode("o:Methods",b);c.methods=a._parseMethods(d)}return c},_parseSets:function(a){var e=[];if(a)for(var g=a.getAttribute("DefaultMinVersion"),c=this._xmlProcessor.selectNodes("o:Set",a),b=0;b<c.length;b++){var d=c[b],f=d.getAttribute("MinVersion");e.push({name:d.getAttribute("Name"),version:f||g})}return e},_parseMethods:function(c){var d=[];if(c)for(var b=this._xmlProcessor.selectNodes("o:Method",c),a=0;a<b.length;a++)d.push(b[a].getAttribute("Name"));return d},_parseSourceLocationOverrides:function(e){var c={};if(e){var f=this._xmlProcessor.selectSingleNode("ov:Resources",e);if(f){var g=this._xmlProcessor.selectSingleNode("bt:Urls",f);if(g){var a=this._xmlProcessor.selectNodes("bt:Url",g);if(a)for(var b=0;b<a.length;b++){var h=a[b],i=h.getAttribute("id"),d=h.getAttribute("DefaultValue");if(i&&d)c[i]=d}}}}return c},_parseAppDomains:function(d){var a=[];if(d)for(var c=this._xmlProcessor.selectNodes("o:AppDomain",d),b=0;b<c.length;b++){var e=OfficeExt.WACUtils.getDomainForUrl(this._xmlProcessor.getNodeValue(c[b]));a.indexOf(e)===-1&&a.push(e)}return a},_parseRuntimes:function(d){var a=null;if(d==a)return a;var e=new OSF.Manifest.Runtimes,b=this._xmlProcessor.selectNodes("ov:Runtime",d);if(b==a)return a;for(var c=0;c<b.length;c++){var f=this._parseRuntime(b[c]);e.add(f)}return e},_parseRuntime:function(b){if(b==null)return null;var a=new OSF.Manifest.Runtime;a.Resid=b.getAttribute("resid");if(b.getAttribute("lifetime")==="long")a.LifeTime=RuntimeLifeTime.Long;else a.LifeTime=RuntimeLifeTime.Short;return a},_parseEquivalentAddins:function(c,e){var d=new OSF.Manifest.EquivalentAddins;if(c)for(var b=this._xmlProcessor.selectNodes(e+"EquivalentAddin",c),a=0;a<b.length;a++){var f=this._parseEquivalentAddin(b[a],e);d.add(f)}return d},_parseEquivalentAddin:function(b,d){var a=this,c=new OSF.Manifest.EquivalentAddin;if(b){var f=a._xmlProcessor.selectSingleNode(d+"ProgId",b);if(f)c._progId=a._xmlProcessor.getNodeValue(f);var e=a._xmlProcessor.selectSingleNode(d+"FileName",b);if(e)c._fileName=a._xmlProcessor.getNodeValue(e);var g=a._xmlProcessor.selectSingleNode(d+"Type",b);if(g){var h=""+a._xmlProcessor.getNodeValue(g);c._type=h.toUpperCase()}else throw OsfMsAjaxFactory.msAjaxError.argument("Manifest")}return c},_parseExtendedOverrides:function(f){var l="xsi:type",b=this;b._extendedOverrides={url:f.getAttribute("Url"),resourcesUrl:f.getAttribute("ResourcesUrl"),hasFinalUrls:false};var j=b._xmlProcessor.selectSingleNode("o:Tokens",f);if(j!=null){var e=b._xmlProcessor.selectNodes("o:Token",j);if(e!=null){for(var k=[],h=0;h<e.length;h++){var d=e[h],c=b._xmlProcessor.selectNodes("o:Override",d),g=[],i=d.getAttribute(l);if(i==OSF.ExtendedManifestSupportTokens.Requirements)for(var a=0;a<c.length;a++){var o=b._xmlProcessor.selectSingleNode("o:Requirements",c[a]),m={value:c[a].getAttribute("Value"),data:b._parseRequirements(o)};g.push(m)}else if(i==OSF.ExtendedManifestSupportTokens.Locale)for(var a=0;a<c.length;a++){var m={value:c[a].getAttribute("Value"),data:c[a].getAttribute("Locale").toLowerCase()};g.push(m)}var n={name:d.getAttribute("Name"),defaultValue:d.getAttribute("DefaultValue"),type:d.getAttribute(l),overrides:g};k.push(n)}b._extendedOverridesTokens=k}}},_addHighResolutionIconUrl:function(a,b){this._highResolutionIconUrls[a]=b},_isAddinCommandsManifest:function(a){return this.containsAddinCommands(a)||this.containsCustomFunctions(a)},_getCurrentHostTypeNode:function(h){var a=null,b=this,e=b._xmlProcessor.selectSingleNode("o:OfficeApp");if(e!==a&&b.getManifestSchemaVersion()===OSF.ManifestSchemaVersion["1.1"]){var f=b._xmlProcessor.selectSingleNode("ov:VersionOverrides",e);if(f!==a){var g=b._xmlProcessor.selectSingleNode("ov:Hosts",f);if(g!==a){var c=b._xmlProcessor.selectNodes("ov:Host",g);if(c!==a)for(var j=c.length,d=0;d<j;d++){var i=c[d].getAttribute("xsi:type");if(i===h)return c[d]}}}}return a}};OSF.OsfManifestManager=function(){var h="undefined",e="marketplaceVersion",d="marketplaceID",c=true,b=null,a=false,f={},i="en-us",j={};function g(b,a){return b+"_"+a}return {getManifestAsync:function(d,h){OSF.OUtil.validateParamObject(d,{osfControl:{type:Object,mayBeNull:a},referenceInUse:{type:Object,mayBeNull:a}},h);var j=this,e=d.referenceInUse,l=e.id;if(d.osfControl!=b&&d.osfControl._sharedRuntimeId!=b&&d.osfControl._sharedRuntimeId.length>0)l=OSF.OsfManifestManager.getSharedRuntimeManifestCacheKey(e.id,d.osfControl._sharedRuntimeId);var k=g(l,e.version),i=f[k];d.manifestCached=a;if(i){d.manifestCached=c;if(j.manifestContainsDownloadResources(i))j.downloadResourcesAsync(d,h,i,k);else h({statusCode:OSF.ProxyCallStatusCode.Succeeded,value:i,context:d})}else if(d.clientEndPoint&&d.manifestUrl){Telemetry.AppLoadTimeHelper.ManifestRequestStart(d.osfControl._telemetryContext);var m=function(a){if(a.statusCode===OSF.ProxyCallStatusCode.Succeeded&&a.value){var f;try{f=a.context.osfControl;var g;if(typeof a.value==="string"){a.context.manifestCached=c;g=a.value}else{a.context.manifestCached=a.value.cached;g=a.value.manifest}Telemetry.AppLoadTimeHelper.SetManifestDataCachedFlag(f._telemetryContext,a.value.cached);a.value=new OSF.Manifest.Manifest(g,f._contextActivationMgr.getAppUILocale());OSF.OsfManifestManager.cacheManifest(e.id,e.version,a.value)}catch(l){a.value=b;var m;if(f)m=f._appCorrelationId;var n="Invalid manifest in getManifestAsync.";OfficeExt.WACUtils.logExceptionToBrowserConsole(n,l);Telemetry.RuntimeTelemetryHelper.LogExceptionTag(n,l,m,18420423)}}else Telemetry.RuntimeTelemetryHelper.LogExceptionTag("getManifestAsync failed:"+OfficeExt.WACUtils.serializeObjectToString(a),b,b,18420424);if(j.manifestContainsDownloadResources(i))j.downloadResourcesAsync(d,h,a.value,k);else h(a)},n={manifestUrl:d.manifestUrl,id:e.id,version:e.version,clearCache:d.clearCache||a};this._invokeProxyMethodAsync(d,"OEM_getManifestAsync",m,n)}else h({statusCode:OSF.ProxyCallStatusCode.Failed,value:b,context:d})},manifestContainsDownloadResources:function(a){return this.manifestContainsExtendedOverrides(a)},manifestContainsExtendedOverrides:function(a){return typeof a==="object"&&typeof a.getExtendedOverrides==="function"&&typeof a.getExtendedOverrides()==="object"},downloadResourcesAsync:function(d,b,a,c){this.manifestContainsExtendedOverrides(a)&&this.downloadExtendedOverridesAsync(d,b,a,c)},downloadExtendedOverridesAsync:function(a,c,e,g){var f=this,i=function(c,a,b){a({statusCode:OSF.ProxyCallStatusCode.Succeeded,value:b,context:c})},d=function(a,h,d,c){var e=a.osfControl._appCorrelationId;OfficeExt.WACUtils.logExceptionToBrowserConsole(c,d);Telemetry.RuntimeTelemetryHelper.LogExceptionTag(c,d,e,578168534);if(f._cachedManifests&&f._cachedManifests[g])f._cachedManifests[g]=undefined;h({statusCode:OSF.ProxyCallStatusCode.Failed,value:b,context:a})};!this.manifestContainsExtendedOverrides(e)&&d(a,c,"Unreachable","Unreachable code path executed!");try{a.osfControl.processManifestForExtendedOverrides(e).then(function(){return i(a,c,e)})["catch"](function(b){return d(a,c,b,"Invalid ExtendedOverrides content.")})}catch(h){d(a,c,h,"Unexpected exception from OsfControlV2.processManifestForExtendedOverrides()")}},getAppInstanceInfoByIdAsync:function(b,c){OSF.OUtil.validateParamObject(b,{webUrl:{type:String,mayBeNull:a},appInstanceId:{type:String,mayBeNull:a},clientEndPoint:{type:Object,mayBeNull:a}},c);var d={webUrl:b.webUrl,appInstanceId:b.appInstanceId,clearCache:b.clearCache||a};this._invokeProxyMethodAsync(b,"OEM_getSPAppInstanceInfoByIdAsync",c,d)},getSPTokenByProductIdAsync:function(c,d){OSF.OUtil.validateParamObject(c,{appWebUrl:{type:String,mayBeNull:a},productId:{type:String,mayBeNull:a}},d);var f=this,e=function(e){if(e){var g={webUrl:c.appWebUrl,productId:c.productId,clearCache:c.clearCache||a,clientEndPoint:e};f._invokeProxyMethodAsync(c,"OEM_getSPTokenByProductIdAsync",d,g)}else d({statusCode:OSF.ProxyCallStatusCode.ProxyNotReady,value:b,context:c})};c.osfControl._contextActivationMgr._createSharePointIFrameProxy(c.appWebUrl,e)},getSPAppEntitlementsAsync:function(e,g){var d="/";OSF.OUtil.validateParamObject(e,{osfControl:{type:Object,mayBeNull:a},referenceInUse:{type:Object,mayBeNull:a},baseUrl:{type:String,mayBeNull:a},pageUrl:{type:String,mayBeNull:a},webUrl:{type:String,mayBeNull:c}},g);if(!e.webUrl){var h=document.createElement("a");h.href=e.pageUrl;var o=h.pathname,m=o.split(d),r=m.length-1,f=h.href.substring(0,h.href.length-o.length);if(f&&f.charAt(f.length-1)!==d)f+=d;for(var j=[f],k=0;k<r;k++)if(m[k]){f=f+m[k]+d;j.push(f)}h=b;var p=this,l=e.osfControl._contextActivationMgr,i=j.pop(),q=function(b){if(b.statusCode===OSF.ProxyCallStatusCode.Succeeded){var a=b.value;if(a&&a.charAt(a.length-1)!==d)a+=d;l._webUrl=a;b.context.webUrl=a;b.context.appWebUrl=a;p.getCorporateCatalogEntitlementsAsync(b.context,g)}else g(b)},n=function(c){if(c){e.clientEndPoint=c;var d={pageUrl:e.pageUrl,baseUrl:i,clearCache:e.clearCache||a};p._invokeProxyMethodAsync(e,"OEM_getSPAppWebUrlFromPageUrlAsync",q,d)}else if(j.length>0){i=j.pop();l._createSharePointIFrameProxy(i,n)}else g({statusCode:OSF.ProxyCallStatusCode.Failed,value:b,context:e})};l._createSharePointIFrameProxy(i,n)}else this.getCorporateCatalogEntitlementsAsync(e,g)},getOneDriveEntitlementsAsync:function(e,o){var c="Content-Type",p=e.referenceInUse.storeLocator,m=e.referenceInUse.storeLocator+"/root:/Manifests",d=OSF.OneDriveOAuth.getAccessTokenFromCookie();if(d==""||d==undefined);var h="?access_token="+d,k=m+h,b=new XMLHttpRequest,a=new XMLHttpRequest;b.onreadystatechange=function(){if(b.readyState==4)if(b.status==200){var g=JSON.parse(b.response),f=g.id,d=e.referenceInUse.storeLocator+"/items/"+f+"/children"+h;a.open("GET",d);a.setRequestHeader(c,"json");a.send()}};var i=[],j=0,g=0,f=function(){j==g&&o({statusCode:OSF.ProxyCallStatusCode.Succeeded,value:{entitlements:i},context:e})},l=function(e,d){g++;var c=d;try{var b=new OSF.Manifest.Manifest(e.responseText),a=[];a.push(b.getDefaultDisplayName());a.push(c);a.push(b.getDefaultDescription());a.push(b.getTarget());a.push(b.getMarketplaceVersion());a.push(c);a.push(OSF.StoreType.OneDrive);a.push(b.getDefaultWidth()||0);a.push(b.getDefaultHeight()||0);a.push(b.getDefaultIconUrl());a.push(b.getProviderName());a.push(b.getDefaultLocale());a.push(OSF.StoreType.OneDrive);i.push(a)}catch(h){}f()},n=function(){g++;f()};a.onreadystatechange=function(){if(a.readyState==4&&a.status==200){for(var c=JSON.parse(a.responseText),b=0;b<c.value.length;b++)if(c.value[b].name.substr(c.value[b].name.length-4).toLowerCase()==".xml"){var e=p+"/root:/Manifests/"+c.value[b].name+":/content?access_token="+d;OSF.OUtil.xhrGetFull(e,c.value[b].name,l,n);j++}f()}};b.open("GET",k);b.setRequestHeader(c,"json");b.send()},getCorporateCatalogEntitlementsAsync:function(d,e){OSF.OUtil.validateParamObject(d,{osfControl:{type:Object,mayBeNull:a},referenceInUse:{type:Object,mayBeNull:a},webUrl:{type:String,mayBeNull:a}},e);Telemetry.AppLoadTimeHelper.AuthenticationStart(d.osfControl._telemetryContext);var h=this,g=0,f=function(i){if(i){Telemetry.AppLoadTimeHelper.AuthenticationEnd(d.osfControl._telemetryContext);d.clientEndPoint=i;var j={webUrl:d.webUrl,applicationName:OSF.HostCapability[d.hostType],officeExtentionTarget:d.noTargetType||d.osfControl.getOsfControlType()===OSF.OsfControlTarget.TaskPane?b:d.osfControl.getOsfControlType(),clearCache:d.clearCache||a,supportedManifestVersions:{"1.0":c,"1.1":c}};h._invokeProxyMethodAsync(d,"OEM_getEntitlementSummaryAsync",e,j)}else if(g<OSF.Constants.AuthenticatedConnectMaxTries){g++;setTimeout(function(){d.osfControl._contextActivationMgr._createSharePointIFrameProxy(d.webUrl,f)},500)}else e({statusCode:OSF.ProxyCallStatusCode.ProxyNotReady,value:b,context:d})};d.osfControl._contextActivationMgr._createSharePointIFrameProxy(d.webUrl,f)},_invokeProxyMethodAsync:function(c,g,p,a){var o=a.clientEndPoint?a.clientEndPoint._targetUrl:c.clientEndPoint._targetUrl,k=[o,g],e;for(var m in a){e=typeof a[m];(e==="string"||e==="number"||e==="boolean")&&k.push(a[m])}var f=k.join("."),d=j,i={onCompleted:p,context:c,methodName:g},h=d[f];if(!h){d[f]=[i];var n=function(n,c){var k=b,i=OSF.ProxyCallStatusCode.Failed;if(n===0&&c.status){k=c.result;i=OSF.ProxyCallStatusCode.Succeeded}var h=d[f];delete d[f];for(var m=h.length,l=0;l<m;l++){var a=h.shift(),e;try{if(a.context&&a.context.osfControl)e=a.context.osfControl._appCorrelationId;c&&c.failureInfo&&Telemetry.RuntimeTelemetryHelper.LogProxyFailure(e,a.methodName,c.failureInfo);a.onCompleted({statusCode:i,value:k,context:a.context})}catch(g){var j="_invokeProxyMethodAsync failed.";OfficeExt.WACUtils.logExceptionToBrowserConsole(j,g);Telemetry.RuntimeTelemetryHelper.LogExceptionTag(j,g,e,18420425)}}},l=c.clientEndPoint;if(a.clientEndPoint){l=a.clientEndPoint;delete a.clientEndPoint}if(c.referenceInUse&&c.referenceInUse.storeType===OSF.StoreType.OMEX)a.officeVersion=OSF.Constants.ThreePartsFileVersion;l.invoke(g,n,a)}else h.push(i)},removeOmexCacheAsync:function(b,e){OSF.OUtil.validateParamObject(b,{osfControl:{type:Object,mayBeNull:a},referenceInUse:{type:Object,mayBeNull:a},clientEndPoint:{type:Object,mayBeNull:a}},e);var d=b.referenceInUse,c={applicationName:b.hostType,assetID:d.id,officeExtentionTarget:b.osfControl.getOsfControlType(),clearEntitlement:b.clearEntitlement||a,clearToken:b.clearToken||a,clearAppState:b.clearAppState||a,clearManifest:b.clearManifest||a,appVersion:b.appVersion};if(b.anonymous)c.contentMarket=d.storeLocator;else{c.assetContentMarket=b.osfControl._omexEntitlement.contentMarket;c.userContentMarket=d.storeLocator}this._invokeProxyMethodAsync(b,"OMEX_removeCacheAsync",e,c)},purgeManifest:function(j,i){var c=Function._validateParams(arguments,[{name:d,type:String,mayBeNull:a},{name:e,type:String,mayBeNull:a}]);if(c)throw c;var b=g(j,i);if(typeof f[b]!=h)delete f[b]},cacheManifestFromXml:function(f,c,g,h){var b=Function._validateParams(arguments,[{name:d,type:String,mayBeNull:a},{name:e,type:String,mayBeNull:a},{name:"manifestXml",type:String,mayBeNull:a},{name:"uiLocale",type:String,mayBeNull:a}]);if(b)throw b;this.cacheManifest(f,c,new OSF.Manifest.Manifest(g,h))},cacheManifest:function(j,h,b){var c=Function._validateParams(arguments,[{name:d,type:String,mayBeNull:a},{name:e,type:String,mayBeNull:a},{name:"manifest",type:Object,mayBeNull:a}]);if(c)throw c;var k=g(j,h);b._UILocale=b._UILocale||i;f[k]=b},hasManifest:function(j,i){var b=Function._validateParams(arguments,[{name:d,type:String,mayBeNull:a},{name:e,type:String,mayBeNull:a}]);if(b)throw b;var k=g(j,i);if(typeof f[k]!=h)return c;return a},hasManifestForControl:function(c){OSF.OUtil.validateParamObject(c,{referenceInUse:{type:Object,mayBeNull:a}},b);return this.hasManifest(c.referenceInUse.id,c.referenceInUse.version)},getCachedManifest:function(h,c){var b=Function._validateParams(arguments,[{name:d,type:String,mayBeNull:a},{name:e,type:String,mayBeNull:a}]);if(b)throw b;var i=g(h,c);return f[i]},getSharedRuntimeManifestCacheKey:function(e,c){var b=Function._validateParams(arguments,[{name:d,type:String,mayBeNull:a},{name:"sharedRuntimeId",type:String,mayBeNull:a}]);if(b)throw b;return e+c},versionLessThan:function(j,k){for(var e=j.split("."),d=k.split("."),g=Math.min(e.length,d.length),f,c,b=0;b<g;b++)try{f=parseFloat(e[b]);c=parseFloat(d[b]);if(f!=c)return f<c}catch(i){}if(e.length>=d.length)return a;else{g=d.length;var h=0;for(b=e.length;b<g;b++){try{c=parseFloat(d[b])}catch(i){c=0}h+=c}return h>0}},_setUILocale:function(a){i=a}}}();var OfficeExt;(function(a){(function(a){var c="invalidExtendedOverride",b="tokenError";a[a["Invalid"]=0]="Invalid";a[a[b]=1]=b;a[a[c]=2]=c})(a.OsfRuntimeErrorCode||(a.OsfRuntimeErrorCode={}));var c=a.OsfRuntimeErrorCode,b=function(b){__extends(a,b);function a(e,d){var c=this;b.call(c,d);Object.setPrototypeOf(c,a.prototype);c.code=e;c.name="OsfRuntimeError"}return a}(Error);a.OsfRuntimeError=b})(OfficeExt||(OfficeExt={}));OSF.ManifestSchemaVersion={"1.0":"1.0","1.1":"1.1"};OSF.ManifestNamespaces={"1.0":'xmlns="http://schemas.microsoft.com/office/appforoffice/1.0" xmlns:o="http://schemas.microsoft.com/office/appforoffice/1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"',"1.1":'xmlns="http://schemas.microsoft.com/office/appforoffice/1.1" xmlns:o="http://schemas.microsoft.com/office/appforoffice/1.1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:bt="http://schemas.microsoft.com/office/officeappbasictypes/1.0" xmlns:ov="http://schemas.microsoft.com/office/taskpaneappversionoverrides" xmlns:c="http://schemas.microsoft.com/office/contentappversionoverrides"'};OSF.OsfNavigationMode={DefaultMode:0,CategoryMode:1,TrustPageMode:2,QueryResultMode:3};OSF.RequirementsChecker=function(d,f,e,c,b){var a=this;a.setCapabilities(d);a.setHosts(f);a.setRequirements(e);a.setSupportedControlTargets(c);a.setSupportedOmexAppVersions(b);a.setFilteringEnabled(false)};OSF.RequirementsChecker.prototype={defaultMinMaxVersion:"1.1",isManifestSupported:function(a){if(!this.isFilteringEnabled())return true;if(!a)return false;var b=a.getManifestSchemaVersion()||OSF.ManifestSchemaVersion["1.0"];switch(b){case OSF.ManifestSchemaVersion["1.0"]:return this._checkManifest1_0(a);case OSF.ManifestSchemaVersion["1.1"]:return this._checkManifest1_1(a);default:return false}},isEntitlementFromOmexSupported:function(a){var c=this;if(!c.isFilteringEnabled())return true;if(!a)return false;var d;switch(a.appSubType){case "1":d=OSF.OsfControlTarget.TaskPane;break;case "2":d=OSF.OsfControlTarget.InContent;break;case "3":d=OSF.OsfControlTarget.Contextual;break;case "4":d=OSF.OsfControlTarget.TaskPane;break;default:return false}if(!c._checkControlTarget(d))return false;if(!a.requirements&&!a.hosts){if(!a.hasOwnProperty("appVersions")||a.appVersions===undefined)return true;return c._checkOmexAppVersions(a.appVersions)}var b=new OSF.Manifest.Manifest(function(){}),e,f,h,g;if(a.requirements){b._xmlProcessor=new OSF.XmlProcessor(a.requirements,OSF.ManifestNamespaces["1.1"]);f=b._xmlProcessor.getDocumentElement()}e=b._parseRequirements(f);if(a.hosts){b._xmlProcessor=new OSF.XmlProcessor(a.hosts,OSF.ManifestNamespaces["1.1"]);g=b._xmlProcessor.getDocumentElement()}h=b._parseHosts(g);return c._checkHosts(h)&&c._checkSets(e.sets)&&c._checkMethods(e.methods)},isEntitlementFromCorpCatalogSupported:function(c){var a=this;if(!a.isFilteringEnabled())return true;if(!c)return false;var i=OSF.OfficeAppType[c.OEType];if(!a._checkControlTarget(i))return false;var b=new OSF.Manifest.Manifest(function(){}),g,h,f;if(c.OfficeExtensionCapabilitiesXML){b._xmlProcessor=new OSF.XmlProcessor(c.OfficeExtensionCapabilitiesXML,OSF.ManifestNamespaces["1.1"]);var e,d;e=b._xmlProcessor.getDocumentElement();d=b._parseRequirements(e);h=d.sets;f=d.methods;g=b._parseHosts(e)}return a._checkHosts(g)&&a._checkSets(h)&&a._checkMethods(f)},setCapabilities:function(a){this._supportedCapabilities=this._scalarArrayToObject(a)},setHosts:function(a){this._supportedHosts=this._scalarArrayToObject(a)},setRequirements:function(a){var b=this;b._supportedSets=a&&b._arrayToSetsObject(a.sets)||{};b._supportedMethods=a&&b._scalarArrayToObject(a.methods)||{}},setSupportedControlTargets:function(a){this._supportedControlTargets=this._scalarArrayToObject(a)},setSupportedOmexAppVersions:function(a){this._supportedOmexAppVersions=a&&a.slice?a.slice(0):[]},setFilteringEnabled:function(a){this._filteringEnabled=a?true:false},isFilteringEnabled:function(){return this._filteringEnabled},_checkManifest1_0:function(a){return this._checkCapabilities(a.getCapabilities())},_checkCapabilities:function(a){if(!a||a.length===0)return true;for(var b=0;b<a.length;b++)if(this._supportedCapabilities[a[b]])return true;return false},_checkManifest1_1:function(b){var a=b.getRequirements()||{};return this._checkHosts(b.getHosts())&&this._checkSets(a.sets)&&this._checkMethods(a.methods)},_checkHosts:function(a){if(!a||a.length===0)return true;for(var b=0;b<a.length;b++)if(this._supportedHosts[a[b]])return true;return false},_checkSets:function(b){var a=this;if(!b||b.length===0)return true;for(var e=0;e<b.length;e++){var c=b[e],d=a._supportedSets[c.name.toLowerCase()];if(!d)return false;if(c.version)if(a._compareVersionStrings(d.minVersion||a.defaultMinMaxVersion,c.version)>0||a._compareVersionStrings(d.maxVersion||a.defaultMinMaxVersion,c.version)<0)return false}return true},_checkMethods:function(a){if(!a||a.length===0)return true;for(var b=0;b<a.length;b++)if(!this._supportedMethods[a[b]])return false;return true},_checkControlTarget:function(a){return a!=undefined&&this._supportedControlTargets[a]},_checkOmexAppVersions:function(b){if(!b)return false;for(var a=0;a<this._supportedOmexAppVersions.length;a++)if(b.indexOf(this._supportedOmexAppVersions[a])>=0)return true;return false},_scalarArrayToObject:function(a){var c={};if(a&&a.length)for(var b=0;b<a.length;b++)if(a[b]!=undefined)c[a[b]]=true;return c},_arrayToSetsObject:function(a){var d={};if(a&&a.length)for(var c=0;c<a.length;c++){var b=a[c];if(b&&b.name!=undefined)d[b.name.toLowerCase()]=b}return d},_getSupportedSet:function(){for(var a={},c=Object.getOwnPropertyNames(this._supportedSets),b=0;b<c.length;b++){var d=this._supportedSets[c[b]];a[d.name.toLowerCase()]=d.maxVersion||this.defaultMinMaxVersion}if(typeof JSON!=="undefined")return JSON.stringify(a);return a},_getSupportedSetAsDmsCapabilities:function(){var a=this;return Object.getOwnPropertyNames(this._supportedSets).map(function(c){var b=a._supportedSets[c];return {Name:b.name.toLowerCase(),Version:b.maxVersion||a.defaultMinMaxVersion}})},_compareVersionStrings:function(b,a){b=b.split(".");a=a.split(".");for(var f=Math.max(b.length,a.length),c=0;c<f;c++){var e=parseInt(b[c],10)||0,d=parseInt(a[c],10)||0;if(e===d)continue;return e-d}return 0}};OSF.RequirementSetNames={ActiveView:"ActiveView",AddinCommands:"AddinCommands",BindingEvents:"BindingEvents",biplatVisualRichApi:"biplatVisualRichApi",CompressedFile:"CompressedFile",CustomFunctions:"CustomFunctions",CustomFunctionsRuntime:"CustomFunctionsRuntime",CustomXmlParts:"CustomXmlParts",DelayForCellEdit:"DelayForCellEdit",DialogApi:"DialogApi",DocumentEvents:"DocumentEvents",ExcelApi:"ExcelApi",ExcelApiOnline:"ExcelApiOnline",ExcelApiUndo:"ExcelApiUndo",File:"File",FirstPartyAuthentication:"FirstPartyAuthentication",HtmlCoercion:"HtmlCoercion",IdentityApi:"IdentityApi",ImageCoercion:"ImageCoercion",Mailbox:"Mailbox",MatrixBindings:"MatrixBindings",MatrixCoercion:"MatrixCoercion",NumberFormatting:"NumberFormatting",OneNoteApi:"OneNoteApi",OoxmlCoercion:"OoxmlCoercion",PartialTableBindings:"PartialTableBindings",PdfFile:"PdfFile",Pivot:"Pivot",PivotFilters:"PivotFilters",PowerPointApi:"PowerPointApi",Selection:"Selection",RedirectV1Api:"RedirectV1Api",RibbonApi:"RibbonApi",RichApiRuntime:"RichApiRuntime",RichApiRuntimeFlag:"RichApiRuntimeFlag",Settings:"Settings",SharedRuntime:"SharedRuntime",TableBindings:"TableBindings",TableCoercion:"TableCoercion",TableStyle:"TableStyle",TextBindings:"TextBindings",TextCoercion:"TextCoercion",TextFile:"TextFile",VisioApi:"VisioApi",WordApi:"WordApi",WebAuth:"WebAuth"};OSF.RequirementMethodNames={"Application.createDocumentAsync":"Application.createDocumentAsync","Auth.getAccessTokenAsync":"Auth.getAccessTokenAsync","Binding.addHandlerAsync":"Binding.addHandlerAsync","Binding.removeHandlerAsync":"Binding.removeHandlerAsync","Bindings.addFromNamedItemAsync":"Bindings.addFromNamedItemAsync","Bindings.addFromPromptAsync":"Bindings.addFromPromptAsync","Bindings.addFromSelectionAsync":"Bindings.addFromSelectionAsync","Bindings.getAllAsync":"Bindings.getAllAsync","Bindings.getByIdAsync":"Bindings.getByIdAsync","Bindings.releaseByIdAsync":"Bindings.releaseByIdAsync","CustomXmlNode.getNodesAsync":"CustomXmlNode.getNodesAsync","CustomXmlNode.getNodeValueAsync":"CustomXmlNode.getNodeValueAsync","CustomXmlNode.getTextAsync":"CustomXmlNode.getTextAsync","CustomXmlNode.getXmlAsync":"CustomXmlNode.getXmlAsync","CustomXmlNode.setNodeValueAsync":"CustomXmlNode.setNodeValueAsync","CustomXmlNode.setTextAsync":"CustomXmlNode.setTextAsync","CustomXmlNode.setXmlAsync":"CustomXmlNode.setXmlAsync","CustomXmlPart.deleteAsync":"CustomXmlPart.deleteAsync","CustomXmlPart.getNodesAsync":"CustomXmlPart.getNodesAsync","CustomXmlPart.getXmlAsync":"CustomXmlPart.getXmlAsync","CustomXmlParts.addAsync":"CustomXmlParts.addAsync","CustomXmlParts.getByIdAsync":"CustomXmlParts.getByIdAsync","CustomXmlParts.getByNamespaceAsync":"CustomXmlParts.getByNamespaceAsync","CustomXmlPrefixMappings.addNamespaceAsync":"CustomXmlPrefixMappings.addNamespaceAsync","CustomXmlPrefixMappings.getNamespaceAsync":"CustomXmlPrefixMappings.getNamespaceAsync","CustomXmlPrefixMappings.getPrefixAsync":"CustomXmlPrefixMappings.getPrefixAsync","Dialog.addEventHandler":"Dialog.addEventHandler","Dialog.close":"Dialog.close","Dialog.sendMessage":"Dialog.sendMessage","Document.addHandlerAsync":"Document.addHandlerAsync","Document.getActiveViewAsync":"Document.getActiveViewAsync","Document.getFileAsync":"Document.getFileAsync","Document.getFilePropertiesAsync":"Document.getFilePropertiesAsync","Document.getSelectedDataAsync":"Document.getSelectedDataAsync","Document.goToByIdAsync":"Document.goToByIdAsync","Document.insertFormAsync":"Document.insertFormAsync","Document.removeHandlerAsync":"Document.removeHandlerAsync","Document.setSelectedDataAsync":"Document.setSelectedDataAsync","File.closeAsync":"File.closeAsync","File.getSliceAsync":"File.getSliceAsync","MatrixBinding.getDataAsync":"MatrixBinding.getDataAsync","MatrixBinding.setDataAsync":"MatrixBinding.setDataAsync","Settings.addHandlerAsync":"Settings.addHandlerAsync","Settings.get":"Settings.get","Settings.refreshAsync":"Settings.refreshAsync","Settings.remove":"Settings.remove","Settings.removeHandlerAsync":"Settings.removeHandlerAsync","Settings.saveAsync":"Settings.saveAsync","Settings.set":"Settings.set","TableBinding.addColumnsAsync":"TableBinding.addColumnsAsync","TableBinding.addRowsAsync":"TableBinding.addRowsAsync","TableBinding.clearFormatsAsync":"TableBinding.clearFormatsAsync","TableBinding.deleteAllDataValuesAsync":"TableBinding.deleteAllDataValuesAsync","TableBinding.getDataAsync":"TableBinding.getDataAsync","TableBinding.setDataAsync":"TableBinding.setDataAsync","TableBinding.setFormatsAsync":"TableBinding.setFormatsAsync","TableBinding.setTableOptionsAsync":"TableBinding.setTableOptionsAsync","TextBinding.getDataAsync":"TextBinding.getDataAsync","TextBinding.setDataAsync":"TextBinding.setDataAsync","CustomXmlPart.addHandlerAsync":"CustomXmlPart.addHandlerAsync","CustomXmlPart.removeHandlerAsync":"CustomXmlPart.removeHandlerAsync","Ui.displayDialogAsync":"Ui.displayDialogAsync","Ui.messageParent":"Ui.messageParent","Ui.addEventHandler":"Ui.addEventHandler","WebAuth.getAuthContextAsync":"WebAuth.getAuthContextAsync"};OSF.DataPointNames={AppManagementMenu:"appmanagementmenu",InsertionDialogSession:"insertiondialogsession",UploadFileDevCatelog:"uploadfiledevcatelog",UploadFileDevCatalogUsage:"uploadfiledevcatalogusage"};OSF.AppManagementAction={Cancel:0,AppDetails:1,RateReview:2,Remove:3};OSF.RLID={Recommend:"rlidMktplcOSFRecs",Landing:"rlidMktplcOSFRedirect",ManageApps:"rlidMktplcBillingMgmt"};OSF.UploadFileDevCatelogAction={OpenUploadFileDialog:0,Install:1,Cancel:2};OSF.OUtil.normalizeAppVersion=function(b){for(var d=b.split("."),a=b,c=0;c<4-d.length;c++)a+=".0";return a};OSF.OUtil.getTargetType=function(b){var a=0;switch(b){case "1":a=1;break;case "2":a=0;break;case "4":a=1;break;default:OsfMsAjaxFactory.msAjaxDebug.trace("targetType value is invalid.")}return a};OSF.OneDriveOAuth=function(){var c="We had a problem connecting to OneDrive. Please try again.",a=null,l="000000004C16753E",j="https://login.live.com/oauth20_authorize.srf";if(window.location.href.indexOf("live-int.com")!=-1){l="00000000604C4E61";j="https://login.live-int.com/oauth20_authorize.srf"}var s="onedrive.readonly wl.signin",i="onedrive_appcatalog_access_token",r="http://datatest1.azurewebsites.net/odauth/callback-redirect.html",g=["http://datatest1.azurewebsites.net"],h=a,k=a,b=a,d=a,e=false;function f(){for(var e=i+"=",d=document.cookie.split(";"),c=0;c<d.length;++c){var b=d[c];while(b.charAt(0)==" ")b=b.substring(1);if(b.indexOf(e)==0)return b.substring(e.length,b.length)}return a}function m(b){var a=document.createElement("iframe");a.setAttribute("src",b);a.setAttribute("height","0");a.setAttribute("width","0");document.body.appendChild(a)}function p(){var a=document.createElement("script");a.setAttribute("type","text/javascript");a.text="OSF.OUtil.addEventListener(window, 'message', OSF.OneDriveOAuth.receiveToken)";document.getElementsByTagName("head")[0].appendChild(a)}function n(){d=window.setTimeout(function(){OSF.OneDriveOAuth.getAccessTokenFromCookie()==a&&b()},1e4);p();var c=j+"?client_id="+l+"&scope="+encodeURIComponent(s)+"&response_type=token&redirect_uri="+encodeURIComponent(r+"?host_callback_uri="+h);m(c)}function o(h){var g=a;try{g=JSON.parse('{"'+h.replace(/&/g,'","').replace(/=/g,'":"')+'"}',function(b,a){return b===""?a:decodeURIComponent(a)})}catch(j){b("We encountered a problem getting auth response from live.com.");return}var f=g["access_token"];if(f===""||f==a){b(c);return}clearTimeout(d);var i=parseInt(g["expires_in"]);q(f,i);e=false;k(f)}function q(d,c){var a=new Date;a.setTime(a.getTime()+c*1e3);var b=i+"="+d+"; path=/; expires="+a.toUTCString();if(document.location.protocol.toLowerCase()=="https")b=b+";secure";document.cookie=b}return {setHostCallbackUri:function(a){h=a},getAccessTokenFromCookie:function(){return f()},getAccessToken:function(c,h){k=c;b=h;var g=f();if(g!=a){c(g);return}if(e==false){e=true;n()}else d=window.setTimeout(function(){if(OSF.OneDriveOAuth.getAccessTokenFromCookie()==a)b();else c()},1e4)},receiveToken:function(f){for(var e=0;e<g.length;++e)if(f.origin==g[e]){var d=f.data;if(d===""||d==a||d===undefined){b(c);return}o(d);break}}}}();var OsfRuntime;(function(a){var b;(function(g){var b=null,c;(function(c){var b="NoCapability",a="InternalError";c[c[a]=5001]=a;c[c[b]=7e3]=b})(c||(c={}));var a=function(){function a(){}a.SendingId="sId";a.RespondingId="rId";a.CommandKey="command";a.SessionInfoKey="sessionInfo";a.ParamsKey="params";a.ApiReadyCommand="apiready";a.ExecuteMethodCommand="executeMethod";a.GetAppContextCommand="getAppContext";a.RegisterEventCommand="registerEvent";a.UnregisterEventCommand="unregisterEvent";a.FireEventCommand="fireEvent";return a}(),f=b;function k(a){f=a}g.setPolicyManager=k;var d=b;function i(a){d=a}g.setContextActivationManager=i;var j=function(){function e(e,f,c,d){var a=this;a._control=e;a._origin=f;a._sessionInfo=c;a._canWrite=d;a._notifiedParents=[];a._enabled=true;a._destinationWindow=b;a._sentMessageId=0;a._incomingOriginParser=document.createElement("a");a._originParser=document.createElement("a");a._onMessageHandler=a._onMessage.bind(a);a._ddaHandlersByEventByTarget={};a._originParser.href=a._origin}e.prototype.init=function(){OSF.OUtil.addEventListener(window,"message",this._onMessageHandler);this._notifyParents()};e.prototype.dispose=function(){OSF.OUtil.removeEventListener(window,"message",this._onMessageHandler)};e.prototype._notifyParents=function(){var d=this,b=window,e=window.top,c={};do{b=b.parent;c[a.SendingId]=d._sentMessageId++;c[a.CommandKey]=a.ApiReadyCommand;c[a.SessionInfoKey]=d._sessionInfo;b.postMessage(c,d._origin);d._notifiedParents.push(b)}while(b!=e)};e.prototype._onMessage=function(j){var g=this,l=g;if(!g._enabled)return;if(!g._checkOrigin(j.origin)||g._destinationWindow&&g._destinationWindow!==j.source)return;var h=j.data;try{h=JSON.parse(h)}catch(q){return}if(h&&h.hasOwnProperty(a.SendingId))switch(h[a.CommandKey]){case a.ExecuteMethodCommand:if(h.hasOwnProperty(a.ParamsKey)){var o=h[a.ParamsKey];if(f&&f.checkPermissionForEmbeddingEndpoint(a.ExecuteMethodCommand,o,g._canWrite))g._control.invokeDdaMethod(o,function(b){l._sendIdentifiedMessage(h[a.SendingId],b)});else g._sendIdentifiedMessage(h[a.SendingId],e._createErrorResponse(c.NoCapability))}break;case a.GetAppContextCommand:if(g._destinationWindow===b)if(g._notifiedParents.indexOf(j.source)!==-1)g._destinationWindow=j.source;else return;if(d)g._sendIdentifiedMessage(h[a.SendingId],d.getContextForEmbeddingPage());else g._sendIdentifiedMessage(h[a.SendingId],e._createErrorResponse(c.InternalError));break;case a.RegisterEventCommand:case a.UnregisterEventCommand:var p=h[a.ParamsKey],k=p["EventId"],i=p["TargetId"];if(typeof i==="undefined"||i===b)i="";var n="",m=g._getDdaEventHandler(k,i);if(h[a.CommandKey]===a.RegisterEventCommand)g._control.registerDdaEventAsync(k,n,i,m,function(b){l._sendIdentifiedMessage(h[a.SendingId],b)});else{g._removeDdaEventHandler(k,i);g._control.unregisterDdaEventAsync(k,n,i,m,function(b){l._sendIdentifiedMessage(h[a.SendingId],b)})}}};e.prototype._getDdaEventHandler=function(e,d){var f=this,b=this._ddaHandlersByEventByTarget[e];if(!b){b={};this._ddaHandlersByEventByTarget[e]=b}var c=b[d];if(!c){c=function(c){if(f._destinationWindow){var b={};b[a.CommandKey]=a.FireEventCommand;b[a.ParamsKey]={EventId:e,TargetId:d,Data:c};f._destinationWindow.postMessage(b,f._origin)}};b[d]=c}return c};e.prototype._removeDdaEventHandler=function(c,b){var a=this._ddaHandlersByEventByTarget[c];if(a)delete a[b]};e.prototype._checkOrigin=function(b){var a=this;if(b===a._origin)return true;a._incomingOriginParser.href=b;return a._incomingOriginParser.protocol===a._originParser.protocol&&a._incomingOriginParser.host===a._originParser.host};e.prototype._sendIdentifiedMessage=function(d,c){var b={};b[a.RespondingId]=d;b[a.ParamsKey]=c;this._destinationWindow.postMessage(b,this._origin)};e._createErrorResponse=function(a){return {Error:a}};return e}(),e=b;function h(c,d,a,b){e&&e.dispose();return e=new j(c,d,a,b)}g.createOrReplaceEmbeddingEndpoint=h})(b=a.Embedded||(a.Embedded={}))})(OsfRuntime||(OsfRuntime={}));Microsoft.Office.WebExtension.FULSSupported=true;OSF.OUtil.setNamespace("Marshaling",OSF.DDA);var OSF_DDA_Marshaling_FilePropertiesKeys;(function(a){var b="Properties";a[a[b]=0]=b;a[a["Url"]=1]="Url"})(OSF_DDA_Marshaling_FilePropertiesKeys||(OSF_DDA_Marshaling_FilePropertiesKeys={}));OSF.DDA.Marshaling.FilePropertiesKeys=OSF_DDA_Marshaling_FilePropertiesKeys;OSF.OUtil.setNamespace("Marshaling",OSF.DDA);OSF.OUtil.setNamespace("File",OSF.DDA.Marshaling);var OSF_DDA_Marshaling_File_FilePropertiesKeys;(function(a){var b="FileSize";a[a["Handle"]=0]="Handle";a[a[b]=1]=b})(OSF_DDA_Marshaling_File_FilePropertiesKeys||(OSF_DDA_Marshaling_File_FilePropertiesKeys={}));OSF.DDA.Marshaling.File.FilePropertiesKeys=OSF_DDA_Marshaling_File_FilePropertiesKeys;var OSF_DDA_Marshaling_File_SlicePropertiesKeys;(function(a){var b="SliceSize";a[a["Data"]=0]="Data";a[a[b]=1]=b})(OSF_DDA_Marshaling_File_SlicePropertiesKeys||(OSF_DDA_Marshaling_File_SlicePropertiesKeys={}));OSF.DDA.Marshaling.File.SlicePropertiesKeys=OSF_DDA_Marshaling_File_SlicePropertiesKeys;var OSF_DDA_Marshaling_File_FileType;(function(a){var b="Compressed";a[a["Text"]=0]="Text";a[a[b]=1]=b;a[a["Pdf"]=2]="Pdf"})(OSF_DDA_Marshaling_File_FileType||(OSF_DDA_Marshaling_File_FileType={}));OSF.DDA.Marshaling.File.FileType=OSF_DDA_Marshaling_File_FileType;var OSF_DDA_Marshaling_File_ParameterKeys;(function(a){var d="SliceIndex",c="SliceSize",b="FileType";a[a[b]=0]=b;a[a[c]=1]=c;a[a["Handle"]=2]="Handle";a[a[d]=3]=d})(OSF_DDA_Marshaling_File_ParameterKeys||(OSF_DDA_Marshaling_File_ParameterKeys={}));OSF.DDA.Marshaling.File.ParameterKeys=OSF_DDA_Marshaling_File_ParameterKeys;OSF.OUtil.setNamespace("Marshaling",OSF.DDA);OSF.OUtil.setNamespace("Dialog",OSF.DDA.Marshaling);OSF.DDA.Marshaling.Dialog.DialogMessageReceivedEventKeys={MessageType:"messageType",MessageContent:"messageContent"};OSF.DDA.Marshaling.Dialog.DialogParentMessageReceivedEventKeys={MessageType:"messageType",MessageContent:"messageContent"};OSF.DDA.Marshaling.MessageParentKeys={MessageToParent:"messageToParent"};OSF.DDA.Marshaling.DialogNotificationShownEventType={DialogNotificationShown:"dialogNotificationShown"};OSF.DDA.Marshaling.SendMessageKeys={MessageContent:"messageContent"};OSF.OUtil.setNamespace("Marshaling",OSF.DDA);OSF.OUtil.setNamespace("SingleSignOn",OSF.DDA.Marshaling);OSF.DDA.Marshaling.SingleSignOn.GetAccessTokenKeys={ForceConsent:"forceConsent",ForceAddAccount:"forceAddAccount",AuthChallenge:"authChallenge",AllowConsentPrompt:"allowConsentPrompt",ForMSGraphAccess:"forMSGraphAccess",AllowSignInPrompt:"allowSignInPrompt",EnableNewHosts:"enableNewHosts",AccountTypeFilter:"accountTypeFilter"};OSF.DDA.Marshaling.SingleSignOn.AccessTokenResultKeys={AccessToken:"accessToken"};OSF.OUtil.setNamespace("Marshaling",OSF.DDA);OSF.OUtil.setNamespace("WebAuth",OSF.DDA.Marshaling);OSF.DDA.Marshaling.WebAuth.GetAuthContextKeys={};OSF.DDA.Marshaling.WebAuth.GetAuthContextResultKeys={AuthContext:"authContext",AppId:"appId",MsaAppId:"msaAppId",Upn:"upn",UserId:"userId",Authority:"authority",AuthorityType:"authorityType",IsAnonymous:"isAnonymous",TenantId:"tenantId",Error:"error",SupportsAuthToken:"supportsAuthToken"};OSF.OUtil.augmentList(Microsoft.Office.WebExtension.FilterType,{OnlyVisible:"onlyVisible"});var OfficeExt;(function(a){(function(a){var d="RemoveEventListenersForDialog",c="SetHostThemeButtonStyle",b="TakeSnapshot";a[a[b]=1]=b;a[a[c]=2]=c;a[a[d]=3]=d})(a.AddinNativeActionIds||(a.AddinNativeActionIds={}));var b=a.AddinNativeActionIds,c=function(){function a(){this.actionDict={}}a.getInstance=function(){if(a.instance==null)a.instance=new a;return a.instance};a.prototype.getNativeActionName=function(a){return this.actionDict[a]};a.prototype.registerNativeAction=function(b,a){this.actionDict[b]=a};return a}();a.AddinNativeActionRuntimeManager=c;a.AddinNativeActionRuntimeManager.getInstance().registerNativeAction(b.TakeSnapshot,"OfficeExt.AddinNativeAction.Snapshot.generateLatestSnapshot");a.AddinNativeActionRuntimeManager.getInstance().registerNativeAction(b.SetHostThemeButtonStyle,"OfficeExt.AddinNativeAction.Dialog.setHostThemeButtonStyle");a.AddinNativeActionRuntimeManager.getInstance().registerNativeAction(b.RemoveEventListenersForDialog,"OfficeExt.AddinNativeAction.Dialog.removeEventListenersForDialog")})(OfficeExt||(OfficeExt={}));Microsoft.Office.WebExtension.EventType={BindingSelectionChanged:"bindingSelectionChanged",BindingDataChanged:"bindingDataChanged"};Microsoft.Office.WebExtension.CoercionType={Text:"text",Matrix:"matrix",Table:"table"};OSF.DDA.PropertyDescriptors.Subset="subset";OSF.ExcelWebAppPolicyManager=function(h,d){var e="registeredActions",c=this,g=Function._validateParams(arguments,[{name:"contextActivationMgr",type:Object,mayBeNull:false},{name:e,type:Object,mayBeNull:false}]);if(g)throw g;c._contextActivationManager=h;c._registeredActions={};var b,a;for(var f in d){b=true;a=d[f];if(typeof a==="object")for(var i in a){b=c._validatePermissionInput(a[i]);if(!b)break}else b=c._validatePermissionInput(a);if(!b)throw OsfMsAjaxFactory.msAjaxError.argument(e);c._registeredActions[f]=a}};OSF.ExcelWebAppPolicyManager.prototype={checkPermission:function(a,b,c){var d=this;return this._checkPermissionInternal(b,c,function(c){var b=d._contextActivationManager._getManifestAndTargetByConversationId(a);if(b&&b.manifest)return b.manifest.hasPermission(c);return false})},checkPermissionForEmbeddingEndpoint:function(b,a,c){return this._checkPermissionInternal(b,a,function(d){if(!a||!a.DdaMethod||!a.DdaMethod.DispatchId||a.DdaMethod.DispatchId!==OSF.DDA.MethodDispId.dispidExecuteRichApiRequestMethod)return false;if(c)return true;var b=OSF.OsfControlPermission,e=b.Restricted|b.ReadDocument|b.ReadItem|b.ReadAllDocument;return !(d&~e)})},_checkPermissionInternal:function(f,b,d){var a=this._registeredActions[f];if(!a)return false;if(typeof a==="object")if(b&&b.DdaMethod&&b.DdaMethod.DispatchId&&a[b.DdaMethod.DispatchId])a=a[b.DdaMethod.DispatchId];else return false;if(a===OSF.OsfControlPermission.Restricted)return true;if(b.DdaMethod&&b.DdaMethod.DispatchId==OSF.DDA.MethodDispId.dispidExecuteRichApiRequestMethod){var c=b["ArrayData"];if(!OSF.OUtil.isArray(c))return false;var e=c[6];if((e&1)==1)a=a|OSF.OsfControlPermission.ReadWriteDocument}return d(a)},_validatePermissionInput:function(c){var a=false;for(var b in OSF.OsfControlPermission)if(OSF.OsfControlPermission[b]===c){a=true;break}return a}};OSF.AppSpecificSetup.ExcelFacade=function(k,j,i){var d="targetId",c="controlId",b="eventDispId",f=this,e=j,g=i,a=f,h=function(b){if(e!=undefined)return true;for(var a=0;a<b.frames.length;a++){var c=h(b.frames[a]);if(c)return true}return false};f.executeMethod=function(b,n){var k="ControlId",j="ColCount",i="RowCount",f="DispatchId",c="DdaMethod";if(b){var h=b[c][f];if(h===OSF.DDA.MethodDispId.dispidGetBindingDataMethod){var d=b["DdaGetBindingData"];if(d&&d[i]===0)delete d[i];if(d&&d[j]===0)delete d[j]}else if(h==OSF.DDA.MethodDispId.dispidAddRowsMethod||h==OSF.DDA.MethodDispId.dispidAddColumnsMethod){var l=b["DdaAddRowsColumns"];if(OSF.OUtil.isArray(l.Data))l.Data={Rows:l.Data,Headers:null}}else if(h==OSF.DDA.MethodDispId.dispidSaveSettingsMethod){var o=g.getOsfControl(b[c][k]);o.setSettings(b["DdaSettingsMethod"]["Properties"])}else if(h==OSF.DDA.MethodDispId.dispidExecuteRichApiRequestMethod){var m=b["ArrayData"];if(OSF.OUtil.isArray(m)){var p=g.getOsfControl(b[c][k]);m[5]=p.getPermission()}}}e.invokeDdaMethod(b,function(h){var d="Bindings";if(h["Error"]==0){var e=b[c][f];if(e==OSF.DDA.MethodDispId.dispidAddBindingFromSelectionMethod||e==OSF.DDA.MethodDispId.dispidAddBindingFromPromptMethod||e==OSF.DDA.MethodDispId.dispidAddBindingFromNamedItemMethod||e==OSF.DDA.MethodDispId.dispidGetBindingMethod||e==OSF.DDA.MethodDispId.dispidGetAllBindingsMethod){var g=a.serviceEndpoint._policyManager._registeredActions;for(var l in h[d]){var k=h[d][l]["Name"],i=OSF.DDA.getXdmEventName(k,Microsoft.Office.WebExtension.EventType.BindingSelectionChanged);if(!g[i]){a.serviceEndpoint.registerEventEx(i,a.registerEvent,Microsoft.Office.Common.InvokeType.asyncRegisterEvent,a.unregisterEvent,Microsoft.Office.Common.InvokeType.asyncUnregisterEvent);g[i]=OSF.OsfControlPermission.Restricted}var j=OSF.DDA.getXdmEventName(k,Microsoft.Office.WebExtension.EventType.BindingDataChanged);if(!g[j]){a.serviceEndpoint.registerEventEx(j,a.registerEvent,Microsoft.Office.Common.InvokeType.asyncRegisterEvent,a.unregisterEvent,Microsoft.Office.Common.InvokeType.asyncUnregisterEvent);g[j]=OSF.OsfControlPermission.Restricted}}}}n&&n(h)},null)};f.registerEvent=function(a,h,f){var g=function(b){if(b.dispid==OSF.DDA.EventDispId.dispidBindingSelectionChangedEvent){var c={};c[Microsoft.Office.WebExtension.Parameters.StartRow]=b[Microsoft.Office.WebExtension.Parameters.StartRow];c[Microsoft.Office.WebExtension.Parameters.StartColumn]=b[Microsoft.Office.WebExtension.Parameters.StartColumn];c[Microsoft.Office.WebExtension.Parameters.RowCount]=b[Microsoft.Office.WebExtension.Parameters.RowCount];c[Microsoft.Office.WebExtension.Parameters.ColumnCount]=b[Microsoft.Office.WebExtension.Parameters.ColumnCount];b[OSF.DDA.PropertyDescriptors.Subset]=c}a&&a(b)};if(a)a._ddaHandler=g;e.registerDdaEventAsync(f[b],f[c],f[d],g,function(a){h&&h(a)})};f.unregisterEvent=function(a,h,f){var g=a;if(a)g=a._ddaHandler;e.unregisterDdaEventAsync(f[b],f[c],f[d],g,function(a){h&&h(a)})};h(k)};OSF.AppSpecificSetup.BuildRequirementsChecker=function(e){var b="1.2",d="1.1",h=[OSF.Capability.Workbook],k=[OSF.Capability.Workbook],c=[{name:OSF.RequirementSetNames.AddinCommands,maxVersion:d},{name:OSF.RequirementSetNames.BindingEvents},{name:OSF.RequirementSetNames.biplatVisualRichApi,maxVersion:"1.8"},{name:OSF.RequirementSetNames.CustomFunctions,maxVersion:"1.8"},{name:OSF.RequirementSetNames.CustomFunctionsRuntime,maxVersion:b},{name:OSF.RequirementSetNames.CompressedFile},{name:OSF.RequirementSetNames.PivotFilters,maxVersion:b},{name:OSF.RequirementSetNames.PdfFile},{name:OSF.RequirementSetNames.DialogApi,maxVersion:b},{name:OSF.RequirementSetNames.DocumentEvents},{name:OSF.RequirementSetNames.ExcelApi,maxVersion:"1.12"},{name:OSF.RequirementSetNames.ExcelApiOnline,maxVersion:d},{name:OSF.RequirementSetNames.ExcelApiUndo,maxVersion:"1.3"},{name:OSF.RequirementSetNames.FirstPartyAuthentication},{name:OSF.RequirementSetNames.IdentityApi,maxVersion:"1.3"},{name:OSF.RequirementSetNames.MatrixBindings},{name:OSF.RequirementSetNames.MatrixCoercion},{name:OSF.RequirementSetNames.NumberFormatting,maxVersion:b},{name:OSF.RequirementSetNames.Pivot,maxVersion:"1.5"},{name:OSF.RequirementSetNames.RichApiRuntime,maxVersion:b},{name:OSF.RequirementSetNames.RichApiRuntimeFlag,maxVersion:b},{name:OSF.RequirementSetNames.Selection},{name:OSF.RequirementSetNames.Settings},{name:OSF.RequirementSetNames.SharedRuntime,maxVersion:d},{name:OSF.RequirementSetNames.TableBindings},{name:OSF.RequirementSetNames.TableCoercion},{name:OSF.RequirementSetNames.TableStyle,maxVersion:d},{name:OSF.RequirementSetNames.TextBindings},{name:OSF.RequirementSetNames.TextCoercion},{name:OSF.RequirementSetNames.File},{name:OSF.RequirementSetNames.WebAuth}];if(e!=null){e._enableV1RedirectApis&&c.push({name:OSF.RequirementSetNames.RedirectV1Api});e._enableRichApiCellEditDelay&&c.push({name:OSF.RequirementSetNames.DelayForCellEdit});c.push({name:OSF.RequirementSetNames.RibbonApi,maxVersion:b})}var a=OSF.RequirementMethodNames,j=[a["Auth.getAccessTokenAsync"],a["Binding.addHandlerAsync"],a["Binding.removeHandlerAsync"],a["Bindings.addFromNamedItemAsync"],a["Bindings.addFromPromptAsync"],a["Bindings.addFromSelectionAsync"],a["Bindings.getAllAsync"],a["Bindings.getByIdAsync"],a["Bindings.releaseByIdAsync"],a["Dialog.addEventHandler"],a["Dialog.close"],a["Dialog.sendMessage"],a["Document.addHandlerAsync"],a["Document.getFilePropertiesAsync"],a["Document.getFileAsync"],a["File.getSliceAsync"],a["File.closeAsync"],a["Document.getSelectedDataAsync"],a["Document.goToByIdAsync"],a["Document.removeHandlerAsync"],a["Document.setSelectedDataAsync"],a["MatrixBinding.getDataAsync"],a["MatrixBinding.setDataAsync"],a["Settings.addHandlerAsync"],a["Settings.get"],a["Settings.refreshAsync"],a["Settings.remove"],a["Settings.removeHandlerAsync"],a["Settings.saveAsync"],a["Settings.set"],a["TableBinding.addColumnsAsync"],a["TableBinding.addRowsAsync"],a["TableBinding.clearFormatsAsync"],a["TableBinding.deleteAllDataValuesAsync"],a["TableBinding.getDataAsync"],a["TableBinding.setDataAsync"],a["TableBinding.setFormatsAsync"],a["TableBinding.setTableOptionsAsync"],a["TextBinding.getDataAsync"],a["TextBinding.setDataAsync"],a["Ui.displayDialogAsync"],a["Ui.messageParent"],a["Ui.addEventHandler"],a["WebAuth.getAuthContextAsync"]],g=[OSF.OsfControlTarget.TaskPane,OSF.OsfControlTarget.InContent],i=["WAE150","WAE151","WAE160"],f=new OSF.RequirementsChecker(h,k,{sets:c,methods:j},g,i);f.setFilteringEnabled(true);return f};OSF.AppSpecificSetup._setupFacade=function(k,b,d,h){var c=new OSF.AppSpecificSetup.ExcelFacade(window,k,b);c.serviceEndpoint=d;var a={ContextActivationManager_getAppContextAsync:OSF.OsfControlPermission.Restricted,ContextActivationManager_notifyHost:OSF.OsfControlPermission.Restricted,Office_sendMessageToHost:OSF.OsfControlPermission.Restricted,ContextActivationManager_openWindowInHost:OSF.OsfControlPermission.Restricted,documentSelectionChanged:OSF.OsfControlPermission.ReadDocument,richApiMessage:OSF.OsfControlPermission.Restricted,settingsChanged:OSF.OsfControlPermission.Restricted,appCommandInvoked:OSF.OsfControlPermission.Restricted,dialogMessageReceived:OSF.OsfControlPermission.Restricted,dialogNotificationShown:OSF.OsfControlPermission.Restricted,dialogParentMessageReceived:OSF.OsfControlPermission.Restricted,executeMethod:{}};a.executeMethod[OSF.DDA.MethodDispId.dispidGetSelectedDataMethod]=OSF.OsfControlPermission.ReadDocument;a.executeMethod[OSF.DDA.MethodDispId.dispidSetSelectedDataMethod]=OSF.OsfControlPermission.WriteDocument;a.executeMethod[OSF.DDA.MethodDispId.dispidAddBindingFromNamedItemMethod]=OSF.OsfControlPermission.ReadDocument;a.executeMethod[OSF.DDA.MethodDispId.dispidAddBindingFromSelectionMethod]=OSF.OsfControlPermission.ReadDocument;a.executeMethod[OSF.DDA.MethodDispId.dispidAddBindingFromPromptMethod]=OSF.OsfControlPermission.ReadDocument;a.executeMethod[OSF.DDA.MethodDispId.dispidGetBindingMethod]=OSF.OsfControlPermission.ReadDocument;a.executeMethod[OSF.DDA.MethodDispId.dispidGetAllBindingsMethod]=OSF.OsfControlPermission.ReadDocument;a.executeMethod[OSF.DDA.MethodDispId.dispidReleaseBindingMethod]=OSF.OsfControlPermission.ReadDocument;a.executeMethod[OSF.DDA.MethodDispId.dispidGetBindingDataMethod]=OSF.OsfControlPermission.ReadDocument;a.executeMethod[OSF.DDA.MethodDispId.dispidSetBindingDataMethod]=OSF.OsfControlPermission.ReadWriteDocument;a.executeMethod[OSF.DDA.MethodDispId.dispidLoadSettingsMethod]=OSF.OsfControlPermission.Restricted;a.executeMethod[OSF.DDA.MethodDispId.dispidSaveSettingsMethod]=OSF.OsfControlPermission.Restricted;a.executeMethod[OSF.DDA.MethodDispId.dispidAddRowsMethod]=OSF.OsfControlPermission.ReadWriteDocument;a.executeMethod[OSF.DDA.MethodDispId.dispidClearAllRowsMethod]=OSF.OsfControlPermission.ReadWriteDocument;a.executeMethod[OSF.DDA.MethodDispId.dispidAddColumnsMethod]=OSF.OsfControlPermission.ReadWriteDocument;a.executeMethod[OSF.DDA.MethodDispId.dispidGetFilePropertiesMethod]=OSF.OsfControlPermission.ReadDocument;a.executeMethod[OSF.DDA.MethodDispId.dispidNavigateToMethod]=OSF.OsfControlPermission.ReadDocument;a.executeMethod[OSF.DDA.MethodDispId.dispidClearFormatsMethod]=OSF.OsfControlPermission.ReadWriteDocument;a.executeMethod[OSF.DDA.MethodDispId.dispidSetTableOptionsMethod]=OSF.OsfControlPermission.ReadWriteDocument;a.executeMethod[OSF.DDA.MethodDispId.dispidSetFormatsMethod]=OSF.OsfControlPermission.ReadWriteDocument;a.executeMethod[OSF.DDA.MethodDispId.dispidExecuteRichApiRequestMethod]=OSF.OsfControlPermission.ReadDocument;a.executeMethod[OSF.DDA.MethodDispId.dispidGetDocumentCopyMethod]=OSF.OsfControlPermission.ReadAllDocument;a.executeMethod[OSF.DDA.MethodDispId.dispidGetDocumentCopyChunkMethod]=OSF.OsfControlPermission.ReadAllDocument;a.executeMethod[OSF.DDA.MethodDispId.dispidReleaseDocumentCopyMethod]=OSF.OsfControlPermission.ReadDocument;a.executeMethod[OSF.DDA.MethodDispId.dispidAppCommandInvocationCompletedMethod]=OSF.OsfControlPermission.Restricted;a.executeMethod[OSF.DDA.MethodDispId.dispidMessageParentMethod]=OSF.OsfControlPermission.Restricted;a.executeMethod[OSF.DDA.MethodDispId.dispidSendMessageMethod]=OSF.OsfControlPermission.Restricted;a.executeMethod[OSF.DDA.MethodDispId.dispidGetAccessTokenMethod]=OSF.OsfControlPermission.ReadDocument;a.executeMethod[OSF.DDA.MethodDispId.dispidGetAuthContextMethod]=OSF.OsfControlPermission.ReadDocument;var f=new OSF.ExcelWebAppPolicyManager(b,a);OsfRuntime.Embedded.setPolicyManager(f);OsfRuntime.Embedded.setContextActivationManager(b);d.setPolicyManager(f);d.registerMethod("executeMethod",c.executeMethod,Microsoft.Office.Common.InvokeType.async,false);d.registerEventEx("documentSelectionChanged",c.registerEvent,Microsoft.Office.Common.InvokeType.asyncRegisterEvent,c.unregisterEvent,Microsoft.Office.Common.InvokeType.asyncUnregisterEvent);d.registerEventEx("richApiMessage",c.registerEvent,Microsoft.Office.Common.InvokeType.asyncRegisterEvent,c.unregisterEvent,Microsoft.Office.Common.InvokeType.asyncUnregisterEvent);d.registerEventEx("settingsChanged",c.registerEvent,Microsoft.Office.Common.InvokeType.asyncRegisterEvent,c.unregisterEvent,Microsoft.Office.Common.InvokeType.asyncUnregisterEvent);d.registerEventEx("appCommandInvoked",OfficeExt.AddinCommandsRuntimeManager.registerEvent,Microsoft.Office.Common.InvokeType.asyncRegisterEvent,OfficeExt.AddinCommandsRuntimeManager.unregisterEvent,Microsoft.Office.Common.InvokeType.asyncUnregisterEvent);d.registerEventEx("dialogMessageReceived",c.registerEvent,Microsoft.Office.Common.InvokeType.asyncRegisterEvent,c.unregisterEvent,Microsoft.Office.Common.InvokeType.asyncUnregisterEvent);d.registerEventEx("dialogNotificationShown",c.registerEvent,Microsoft.Office.Common.InvokeType.asyncRegisterEvent,c.unregisterEvent,Microsoft.Office.Common.InvokeType.asyncUnregisterEvent);d.registerEventEx("dialogParentMessageReceived",c.registerEvent,Microsoft.Office.Common.InvokeType.asyncRegisterEvent,c.unregisterEvent,Microsoft.Office.Common.InvokeType.asyncUnregisterEvent);var g={ContextActivationManager_onClickInsertOsfControl:OSF.OsfControlPermission.Restricted,ContextActivationManager_onClickInstallOsfControl:OSF.OsfControlPermission.Restricted,ContextActivationManager_onClickRefreshAddinCommands:OSF.OsfControlPermission.Restricted,ContextActivationManager_onClickCancelDialog:OSF.OsfControlPermission.Restricted,ContextActivationManager_getEntitlementsForInsertDialog:OSF.OsfControlPermission.Restricted,ContextActivationManager_invokeSignIn:OSF.OsfControlPermission.Restricted,ContextActivationManager_invokeSignOut:OSF.OsfControlPermission.Restricted,ContextActivationManager_invokeWindowOpen:OSF.OsfControlPermission.Restricted,ContextActivationManager_removeAppForInsertDialog:OSF.OsfControlPermission.Restricted,ContextActivationManager_logTelemetryDataForInsertDialog:OSF.OsfControlPermission.Restricted,ContextActivationManager_getOmexData:OSF.OsfControlPermission.Restricted,ContextActivationManager_removeAppCommandsAddin:OSF.OsfControlPermission.Restricted},i=new OSF.ExcelWebAppPolicyManager(b,g);h.setPolicyManager(i);b.getLocalizedImageFilePath=function(a){return this.getLocalizedImagesUrl()+a};b.getLocalizedCSSFilePath=function(a){return this.getLocalizedStylesUrl()+a};b._hostType=OSF.HostType.Excel;b._hostPlatform=OSF.HostPlatform.Web;b._hostSpecificFileVersion=OSF.HostSpecificFileVersionMap["excel"]["web"];if(b._enableMyOrg&&b._docUrl){var e=b._docUrl.split("/");b._spBaseUrl=e.length>2?e[0]+"//"+e[2]:null}if(b._pageBaseUrl)if(!b._localizedImagesUrl||b._localizedImagesUrl=="null/")b._localizedImagesUrl=b._pageBaseUrl+"/Resources/"+b.getLcid();var j=OSF.AppSpecificSetup.BuildRequirementsChecker(b);b.setRequirementsChecker(j)};OSF.DDA.ErrorCodeManager=OSF.DDA.ErrorCodeManager||{errorCodes:{ooeSuccess:0,ooeInternalError:5001,ooeBrowserAPINotSupported:5009,ooeInvalidWidth:12000,ooeInvalidHeight:12001,ooeNavigationError:12002,ooeInvalidScheme:12003,ooeAppDomains:12004,ooeRequireHTTPS:12005,ooeWebDialogClosed:12006,ooeDialogAlreadyOpened:12007,ooeEndUserAllow:12008,ooeEndUserIgnore:12009,ooeNotUILessDialog:12010,ooeCrossZone:12011,ooeNotSSOAgave:13000,ooeSSOUserNotSignedIn:13001,ooeSSOUserAborted:13002,ooeSSOUnsupportedUserIdentity:13003,ooeSSOInvalidResourceUrl:13004,ooeSSOInvalidGrant:13005,ooeSSOClientError:13006,ooeSSOServerError:13007,ooeAddinIsAlreadyRequestingToken:13008,ooeSSOConnectionLost:13010,ooeResourceNotAllowed:13011,ooeSSOUnsupportedPlatform:13012,ooeSSOCallThrottled:13013,ooeAccessDenied:13990,ooeGeneralException:13991}};typeof NotifyScriptLoadedAndExecuteWaitingJobs==="function"&&NotifyScriptLoadedAndExecuteWaitingJobs("OSFRuntimeExcelWAC.js")