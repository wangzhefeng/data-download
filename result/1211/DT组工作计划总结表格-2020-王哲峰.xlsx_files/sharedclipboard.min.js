var sharedClipboard=function(e){var t={};function r(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(o,n,function(t){return e[t]}.bind(null,n));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=3)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r(4);t.utils=o;var n=r(1);t.ULS=n.ULS,t.TraceLevel=n.TraceLevel,t.LogCategory=n.LogCategory,t.NulLogger=n.NulLogger,t.ConsoleLogger=n.ConsoleLogger;var i=r(5);t.browserSupport=i;var a=r(6);t.perfWatch=a;var s=r(7);t.initEwaUtils=s.initEwaUtils,t.ewaUtils=s.ewaUtils;var l=r(8);t.initStopwatchFactory=l.initStopwatchFactory;var c=r(9);t.getNewGuid=c.getNewGuid;var d=r(10);t.TextAreaVirtualKeyboardPolicy=d.TextAreaVirtualKeyboardPolicy,t.TextAreaInputMode=d.TextAreaInputMode},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Error=10]="Error",e[e.Warning=15]="Warning",e[e.Info=50]="Info",e[e.Verbose=100]="Verbose",e[e.Spam=200]="Spam"}(t.TraceLevel||(t.TraceLevel={})),function(e){e[e.msoulscat_ES_EWAJS=0]="msoulscat_ES_EWAJS"}(t.LogCategory||(t.LogCategory={})),t.ULS={getFromExternalLogger:function(e){var t=e;return{ULS:{trace:function(e,r,o){return t.traceTag(0,e,r,o)},traceTag:function(e,r,o,n){return t.traceTag(e,r,o,n)},debugTrace:function(e,r,o){return t.debugTraceTag(0,e,r,o)},debugTraceTag:function(e,r,o,n){return t.debugTraceTag(e,r,o,n)},assert:function(e,r,o){return t.assertTag(0,e,r,o)},assertTag:function(e,r,o,n){return t.assertTag(e,r,o,n)},shipAssert:function(e,r,o){return t.shipAssertTag(0,e,r,o)},shipAssertTag:function(e,r,o,n){return t.shipAssertTag(e,r,o,n)}}}}};var o=function(){function e(){}return e.prototype.shipAssertTag=function(e,t,r,o){console.assert(r,"shipAssertTag:",e,t,o)},e.prototype.assertTag=function(e,t,r,o){console.assert(r,"assertTag",e,t,o)},e.prototype.traceTag=function(e,t,r,o){console.log("traceTag",e,o,t,r)},e.prototype.debugTraceTag=function(e,t,r,o){console.log("debugTraceTag",e,o,t,r)},e}();t.ConsoleLogger=o;var n=function(){function e(){}return e.prototype.shipAssertTag=function(){},e.prototype.assertTag=function(){},e.prototype.traceTag=function(){},e.prototype.debugTraceTag=function(){},e}();t.NulLogger=n},function(e,t,r){"use strict";var o={};r.r(o),r.d(o,"sharedClipboardSettingsVariableName",(function(){return O})),r.d(o,"defaultPromiseTimeoutInMinutes",(function(){return F})),r.d(o,"getSharedClipboardSettings",(function(){return N})),r.d(o,"initializeSharedClipboardSettingsFromWindow",(function(){return H})),r.d(o,"initializeSharedClipboardSettings",(function(){return J})),r.d(o,"createEmptySharedClipboardSettings",(function(){return V}));var n,i=r(0);function a(){return n}function s(e){if(!e)throw new Error("The 'logger' argument is missing");n=i.ULS.getFromExternalLogger(e)}
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var l=function(e,t){return(l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function c(e,t){function r(){this.constructor=e}l(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var d,u,g,p,f;!function(e){e[e.SystemClipboard=0]="SystemClipboard",e[e.FullAccessClipboardAndInMemory=3]="FullAccessClipboardAndInMemory",e[e.InMemory=4]="InMemory",e[e.LocalStorage=5]="LocalStorage",e[e.SystemClipboardAndLocalStorage=6]="SystemClipboardAndLocalStorage",e[e.SystemClipboardAndInMemory=7]="SystemClipboardAndInMemory"}(d||(d={})),function(e){e[e.UnsupportedClipboardStrategyType=0]="UnsupportedClipboardStrategyType",e[e.UnsupportedClipboardStorageType=1]="UnsupportedClipboardStorageType",e[e.ClipboardIsInaccessible=2]="ClipboardIsInaccessible",e[e.SetClipboardItems=3]="SetClipboardItems",e[e.GetClipboardItems=5]="GetClipboardItems",e[e.NoGetOperationResultMessage=7]="NoGetOperationResultMessage",e[e.NoSetOperationResultMessage=8]="NoSetOperationResultMessage",e[e.ClearClipboardItems=9]="ClearClipboardItems",e[e.MissingBrowserExtensionCapability=10]="MissingBrowserExtensionCapability",e[e.NoBrowserExtensionsInConfiguration=11]="NoBrowserExtensionsInConfiguration",e[e.NoAvailableBrowserExtensions=12]="NoAvailableBrowserExtensions",e[e.UnavailableBrowserExtension=13]="UnavailableBrowserExtension",e[e.NoBrowserExtensionWithGetClipboardDataCommand=14]="NoBrowserExtensionWithGetClipboardDataCommand",e[e.SelectClipboardStrategy=15]="SelectClipboardStrategy",e[e.IframeInitialization=16]="IframeInitialization",e[e.UnsupportedOperationCode=26]="UnsupportedOperationCode",e[e.RejectingPendingPastePromiseDueToNewPasteOperation=27]="RejectingPendingPastePromiseDueToNewPasteOperation",e[e.RejectingPendingCutCopyPromiseDueToNewCutCopyOperation=28]="RejectingPendingCutCopyPromiseDueToNewCutCopyOperation",e[e.RejectingBlockedSyncCutCopyPromise=29]="RejectingBlockedSyncCutCopyPromise",e[e.IframeInitializationTimeout=30]="IframeInitializationTimeout",e[e.ClipboardStrategyNotInitialized=33]="ClipboardStrategyNotInitialized",e[e.UnexpectedClipboardTextHtmlContentLength=34]="UnexpectedClipboardTextHtmlContentLength",e[e.InvalidClipboardStrategyType=35]="InvalidClipboardStrategyType",e[e.CreateWindowRPCServer=36]="CreateWindowRPCServer",e[e.RefreshMetadata=37]="RefreshMetadata",e[e.DeserializedMetadata=38]="DeserializedMetadata",e[e.SerializedMetadata=39]="SerializedMetadata",e[e.LocalStorageInitilizationInaccessible=40]="LocalStorageInitilizationInaccessible",e[e.LocalStorageInitilizationNoKey=41]="LocalStorageInitilizationNoKey",e[e.IframeProxyGeneralError=42]="IframeProxyGeneralError",e[e.IframeProxyEmptyResultMessage=43]="IframeProxyEmptyResultMessage"}(u||(u={})),function(e){e[e.MissingArgumentError=0]="MissingArgumentError",e[e.CopyFlowHandlerNotFound=1]="CopyFlowHandlerNotFound",e[e.FetchCopyFlowHandlerFailed=2]="FetchCopyFlowHandlerFailed",e[e.FetchSourceItemFailed=3]="FetchSourceItemFailed",e[e.BeforeSerializeFailed=4]="BeforeSerializeFailed",e[e.SerializeFailed=5]="SerializeFailed",e[e.SerializeResultNotValid=6]="SerializeResultNotValid",e[e.AsyncSerializeFailed=7]="AsyncSerializeFailed",e[e.SaveToTheClipboardFailed=8]="SaveToTheClipboardFailed",e[e.InspectClipboardFailed=9]="InspectClipboardFailed",e[e.ClipboardIsInaccessible=10]="ClipboardIsInaccessible",e[e.SuccessiveCutCopyOverridingPendingCutCopy=11]="SuccessiveCutCopyOverridingPendingCutCopy",e[e.BlockedSynchronousCutCopy=12]="BlockedSynchronousCutCopy",e[e.CopyOperationCancelled=13]="CopyOperationCancelled",e[e.UnknownCopyErrorType=14]="UnknownCopyErrorType"}(g||(g={})),function(e){e[e.MissingArgumentError=0]="MissingArgumentError",e[e.PasteFlowHandlerNotFound=1]="PasteFlowHandlerNotFound",e[e.FetchPasteFlowHandlerFailed=2]="FetchPasteFlowHandlerFailed",e[e.FailedToReadFromClipboard=3]="FailedToReadFromClipboard",e[e.InspectClipboardFailed=4]="InspectClipboardFailed",e[e.ReadFromClipboardReturnNullOrUndefined=5]="ReadFromClipboardReturnNullOrUndefined",e[e.ClipboardIsEmpty=6]="ClipboardIsEmpty",e[e.DeserializeOperationFailed=7]="DeserializeOperationFailed",e[e.ClipboardIsInaccessible=8]="ClipboardIsInaccessible",e[e.SuccessivePasteOverridingPendingPaste=9]="SuccessivePasteOverridingPendingPaste",e[e.FileReaderResultIsEmpty=10]="FileReaderResultIsEmpty",e[e.FileReaderFailed=11]="FileReaderFailed",e[e.UnknownPasteError=12]="UnknownPasteError",e[e.DeferredPasteRejectedBecauseOtherCopyCompleted=13]="DeferredPasteRejectedBecauseOtherCopyCompleted",e[e.DeferredPasteRejectedBecauseOtherCopyStarted=14]="DeferredPasteRejectedBecauseOtherCopyStarted",e[e.DeferredPasteRejectedBecauseMetadataUpdateWithoutCopyContext=15]="DeferredPasteRejectedBecauseMetadataUpdateWithoutCopyContext"}(p||(p={})),function(e){e[e.FailedToClearClipboard=0]="FailedToClearClipboard"}(f||(f={}));var h=function(e){function t(r,o,n){var s=this,l=t.augmentParameterValue(r);if((s=e.call(this,l)||this).name=t.augmentParameterValue(o),s.errorName=s.name,s.name?a().ULS.traceTag(596456211,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"Error '"+s.name+"': "+l):a().ULS.traceTag(596456212,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"Error message: "+l),n){s.innerError=n;var c=s.innerError.message;c||(c=s.innerError.name);var d=t.augmentParameterValue(c);d.length>0&&a().ULS.traceTag(596456213,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"Inner error message: "+d)}return s.stack||(s.stack=(new Error).stack),s}return c(t,e),t.augmentParameterValue=function(e){return e&&"string"==typeof e?e.trim():""},t}(Error),m=function(e){function t(r,o,n){var i=this,a=h.augmentParameterValue(o),s=t.getDefaultMessage(a),l=h.augmentParameterValue(r);return 0===l.length&&(l=s),(i=e.call(this,l,"MissingArgumentError",n)||this).name=a,i}return c(t,e),t.getDefaultMessage=function(e){var t="Missing argument";return e.length>0&&(t="Missing argument: '"+e+"'"),t},t}(h),S=function(e){function t(r,o,n,i){var a=this,s=h.augmentParameterValue(o),l=n;l||(l="");var c=t.getDefaultMessage(s,l),d=h.augmentParameterValue(r);return 0===r.length&&(d=c),(a=e.call(this,d,"InvalidArgumentError",i)||this).name=s,a.value=l,a}return c(t,e),t.getDefaultMessage=function(e,t){return e.length>0?"Invalid '"+e+"' argument: '"+t+"'":"Invalid argument"},t}(h),w=function(e){function t(t,r){return e.call(this,t,"InvalidOperationError",r)||this}return c(t,e),t}(h);(function(e){function t(t,r){return e.call(this,t,"UnsupportedError",r)||this}c(t,e)})(h),function(e){function t(t,r,o,n,i){return e.call(this,t+". Data version: "+r+", Infra version: "+o+", blockMismatchDataVersion: "+n,"MismatchVersionError",i)||this}c(t,e)}(h),function(e){function t(t,r,o,n){return e.call(this,t+". Duration in clipboard (ms) : "+r+", TTL (ms): "+o,"TTLClipboardDataError",n)||this}c(t,e)}(h),function(e){function t(t,r,o,n){return e.call(this,t+". Data User Hash : "+r+", infra User Hash: "+o,"UserHashMismatchError",n)||this}c(t,e)}(h),function(e){function t(t,r){return e.call(this,t,"UnexpectedError",r)||this}c(t,e)}(h);function C(e,t){return function(e,t){return void 0!==e&&"number"==typeof e&&e>=0&&e<Object.keys(t).length/2}(e,t)?t[e]:""}var v=function(e){function t(t,r,o,n,i){var a=e.call(this,r||"reason="+t,o,n)||this;return a.reason=t,i&&(a.errorName=i),a}return c(t,e),t}(h),y=(function(e){function t(t,r,o){return e.call(this,t,r,"CopyError",o,C(t,g))||this}c(t,e)}(v),function(e){function t(t,r,o){return e.call(this,t,r,"PasteError",o,C(t,p))||this}c(t,e)}(v),function(e){function t(t,r,o){return e.call(this,t,r,"CancelError",o,C(t,f))||this}c(t,e)}(v),function(e){function t(t,r,o){return e.call(this,t,r,"ClipboardPlatformError",o,C(t,u))||this}return c(t,e),t}(v));!function(e){function t(t,r,o){return e.call(this,t,r,"SharedClipboardError",o,C(t,u))||this}c(t,e)}(v);new RegExp("(\\bTrident/| MSIE )"),new RegExp("\\bEdge/(\\d+\\.\\d+)\\b");var b={postMessage:function(e,t,r,o){e.postMessage(t,r,o)}};var E,T,L,_,I=(E={items:{}},{getData:function(){return E},getItem:function(e){},setItem:function(e,t){throw new w("Cannot set an item with clipboard data format '"+e+"' in an immutable empty clipboard (content is "+(t&&t.length>0?"not ":"")+"empty)")},hasDeferredItem:function(e){return!1},getDeferredItem:function(e){},get:function(){return U(void 0)}});function P(){return I}function A(e){return e&&e.items?Object.keys(e.items).length:0}function W(e){return A(e&&e.getData())}function M(e){void 0===e&&(e=void 0);var t=e;t||(t={items:{}});var r=function(e){return x(t,e)};return{getItem:r,setItem:function(e,r){!function(e,t,r){if(!e)throw new m("","clipboardItemsData");if(!e.items)throw new S("","clipboardItemsData.items");e.items[t]=r}(t,e,r)},hasDeferredItem:function(e){var t=r(e);return t&&t.length>0},getDeferredItem:function(e){return Promise.resolve(r(e))},getData:function(){return t},get:function(){return U(t)}}}function x(e,t){if(!e)throw new m("","clipboardItemsData");if(!e.items)throw new S("","clipboardItemsData.items");return e.items[t]}function U(e){var t=[];if(0===A(e))return t;for(var r in e.items){var o=x(e,r);o||(o="");var n={clipboardDataFormat:r,data:o,deferred:!1};t.push(n)}return t}!function(e){e[e.SystemClipboard=0]="SystemClipboard",e[e.InMemory=2]="InMemory",e[e.LocalStorage=3]="LocalStorage"}(T||(T={})),function(e){e[e.None=0]="None",e[e.Cut=1]="Cut",e[e.Copy=2]="Copy",e[e.Paste=4]="Paste",e[e.Values=16]="Values",e[e.Formatting=32]="Formatting",e[e.Formulas=64]="Formulas",e[e.DragDropCells=128]="DragDropCells",e[e.DragDropNoErrMsg=256]="DragDropNoErrMsg",e[e.Transpose=512]="Transpose",e[e.Link=1024]="Link",e[e.PasteValues=20]="PasteValues",e[e.PasteFormatting=36]="PasteFormatting",e[e.PasteFormulas=68]="PasteFormulas",e[e.PasteTranspose=516]="PasteTranspose",e[e.PasteLink=1028]="PasteLink"}(L||(L={})),function(e){e[e.NoError=0]="NoError",e[e.LocalStorageInaccessible=1]="LocalStorageInaccessible"}(_||(_={}));var O="sharedClipboardSettings",D=V(),R=!1,F=2;function N(){if(!R)throw new w("First initialize the settings via initializeSharedClipboardSettingsFromWindow() or initializeSharedClipboardSettings()");return D}function H(){R=!1,function(){if(!window||!(O in window))return D=V(),void(R=!0);var e=window[O];if(!e||"object"!=typeof e)return D=V(),void(R=!0);z(e)}()}function J(e){R=!1,z(e)}function z(e){if(!e)throw new m("","sharedClipboardSettingsCandidate");var t=V();if("number"!=typeof e.sharedClipboardSchemaVersion||isNaN(e.sharedClipboardSchemaVersion)||(t.sharedClipboardSchemaVersion=e.sharedClipboardSchemaVersion),"number"!=typeof e.sharedClipboardExpirationInMinutes||isNaN(e.sharedClipboardExpirationInMinutes)||(t.sharedClipboardExpirationInMinutes=e.sharedClipboardExpirationInMinutes),"number"!=typeof e.clipboardPromiseTimeoutInMinutes||isNaN(e.clipboardPromiseTimeoutInMinutes)||(t.clipboardPromiseTimeoutInMinutes=e.clipboardPromiseTimeoutInMinutes),"string"==typeof e.remoteLoggerPath&&e.remoteLoggerPath&&e.remoteLoggerPath.trim()&&(t.remoteLoggerPath=e.remoteLoggerPath),"number"!=typeof e.whitelistOriginComponents||1!==e.whitelistOriginComponents)return D=t,void(R=!0);if("string"!=typeof e.sharedClipboardHostingApp||!e.sharedClipboardHostingApp||!e.sharedClipboardHostingApp.trim())return a().ULS.traceTag(596124181,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Error,"sharedClipboardSettings.initialize: sharedClipboardHostingApp should be a non empty string"),D=t,void(R=!0);t.sharedClipboardHostingApp=e.sharedClipboardHostingApp.trim();var r=t.sharedClipboardHostingApp,o=r.indexOf("-");o>=0&&(r=r.substr(o+1));try{t.sharedClipboardHostingApps=e.sharedClipboardHostingApps?JSON.parse(e.sharedClipboardHostingApps):void 0}catch(t){a().ULS.traceTag(579737680,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Error,"sharedClipboardSettings.initialize: sharedClipboardHostingApps JSON parsing failed. String : "+e.sharedClipboardHostingApps)}if(!t.sharedClipboardHostingApps||!Array.isArray(t.sharedClipboardHostingApps)||0===t.sharedClipboardHostingApps.length||t.sharedClipboardHostingApps.some((function(e){return!e||!e.trim()})))return a().ULS.traceTag(596124182,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Error,"sharedClipboardSettings.initialize: sharedClipboardHostingApps should be a JSON string representing an array with at list one app"),t.sharedClipboardHostingApp="",t.sharedClipboardHostingApps=[],D=t,void(R=!0);try{t.sharedClipboardHostingEnvironments=e.sharedClipboardHostingEnvironments?JSON.parse(e.sharedClipboardHostingEnvironments):void 0}catch(t){a().ULS.traceTag(579737681,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Error,"sharedClipboardSettings.initialize: sharedClipboardHostingEnvironments JSON parsing failed. String : "+e.sharedClipboardHostingEnvironments)}if(!t.sharedClipboardHostingEnvironments||!Array.isArray(t.sharedClipboardHostingEnvironments)||0===t.sharedClipboardHostingEnvironments.length||t.sharedClipboardHostingEnvironments.some((function(e){return!e||!e.trim()})))return a().ULS.traceTag(596124183,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Error,"sharedClipboardSettings.initialize: sharedClipboardHostingEnvironments should be a JSON string representing an array with at list one environment"),t.sharedClipboardHostingApp="",t.sharedClipboardHostingApps=[],t.sharedClipboardHostingEnvironments=[],D=t,void(R=!0);if(t.sharedClipboardHostingApps.indexOf(t.sharedClipboardHostingApp)<0){if(t.sharedClipboardHostingApp===r)return a().ULS.traceTag(596124184,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Error,"sharedClipboardSettings.initialize: when sharedClipboardHostingApp is defined, then its app name component '"+t.sharedClipboardHostingApp+"' should be listed in sharedClipboardHostingApps"),t.sharedClipboardHostingApp="",t.sharedClipboardHostingApps=[],t.sharedClipboardHostingEnvironments=[],D=t,void(R=!0);if(t.sharedClipboardHostingApps.indexOf(r)<0)return a().ULS.traceTag(596124185,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Error,"sharedClipboardSettings.initialize: when sharedClipboardHostingApp is defined, then its app name component '"+t.sharedClipboardHostingApp+"' or '"+r+"' should be listed in sharedClipboardHostingApps"),t.sharedClipboardHostingApp="",t.sharedClipboardHostingApps=[],t.sharedClipboardHostingEnvironments=[],D=t,void(R=!0)}t.whitelistOriginComponents=!0,D=t,R=!0}function V(){return{whitelistOriginComponents:!1,sharedClipboardHostingApp:"",sharedClipboardHostingApps:[],sharedClipboardHostingEnvironments:[],sharedClipboardSchemaVersion:1,sharedClipboardExpirationInMinutes:3600,clipboardPromiseTimeoutInMinutes:F,remoteLoggerPath:""}}var k,j,B=new RegExp("^\\d+$"),K=!1;function G(e){if(!e)throw new m("","origin");var t="",r=e.trim().toLowerCase().split("://",3);if(!r||0===r.length||!r[0]||"http"!==r[0]&&"https"!==r[0])throw new S("Missing protocol","origin",e);if(1===r.length)throw new S("Missing domain","origin",e);if(r.length>2)throw new S("'://' should appear once","origin",e);var o=r[1];if(!o)throw new S("Missing domain","origin",e);if(t=r[0]+"://",!(r=(o=o.trim()).trim().split("/",3))||0===r.length||!r[0]||!r[0].trim())throw new S("Missing domain","origin",e);if(r.length>2)throw new S("The last part of the origin should be the domain","origin",e);if(2===r.length&&r[1])throw new S("The last part of the origin should be the domain","origin",e);if(!(r=o.split(":",3))||0===r.length||!r[0]||!r[0].trim())throw new S("Missing domain","origin",e);if(r.length>2||2===r.length&&(!r[1]||!r[1].trim()))throw new S("The last part of the origin should be the domain and an optional port number","origin",e);if(t+=o=r[0].trim(),2===r.length){var n=r[1].trim(),s=B.exec(n);if(!s||1!==s.length)throw new S("Invalid port number","origin",e);var l=Number(n);if(isNaN(l))throw new S("Invalid port number","origin",e);t+=":"+n}return a().ULS.traceTag(596452423,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"getValidatedOrigin: origin = '"+e+"'; validated origin = '"+t+"'"),t}function q(e){Y();var t,r=G(e),o=G((t="",window&&window.location&&window.location.origin?(t=window.location.origin)||(t=""):(a().ULS.traceTag(595932950,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Warning,"windowLocation.getWindowLocation: is window exist: "+!!window+". is window.location exist: "+(window&&!!window.location)+". is window.location.origin exist "+(window&&window.location&&!!window.location.origin)+". is window.location.protocol exist "+(window&&window.location&&!!window.location.protocol)+". is window.location.hostname exist "+(window&&window.location&&!!window.location.hostname)+". is window.location.port exist "+(window&&window.location&&!!window.location.port)),window&&window.location&&window.location.protocol&&window.location.hostname&&(t=window.location.protocol+"//"+window.location.hostname,window.location.origin=t)),{origin:t}).origin);if(r===o)return r;if(!N().whitelistOriginComponents)throw new w("validateOriginForReceivedMessage: Caller origin '"+e+"' doesn't match the current window's origin '"+o+"'");var n=Q(r),s=Q(o);if(n.protocol!==s.protocol)throw new w("validateRemoteWindowOrigin: Caller origin's protocol '"+n.protocol+"' doesn't match the current window origin's protocol '"+s.protocol+"'");if(n.environment!==s.environment)throw new w("validateRemoteWindowOrigin: Caller origin's environment '"+n.environment+"' doesn't match the current window origin's environment '"+s.environment+"'");return r}function Q(e){Y();var t=e.split("://",2),r=t[0],o=X(t[1]),n={protocol:r};if(n.environment=$(e,o,j),o.length<=n.environment.length+1)throw new S("Missing app component","origin",e);if("."!==o.charAt(n.environment.length))throw new S("Missing a domain separator after the environment component","origin",e);var i=o.substr(n.environment.length+".".length);if(n.app=$(e,i,k),n.app.length<i.length&&"-"!==i.charAt(n.app.length))throw new S("When the Office Online app name is not the domain prefix, '-' should precede it","origin",e);return n}function X(e){if(!e)throw new m("","stringToReverse");for(var t="",r=e.length-1;r>=0;r-=1)t+=e.charAt(r);return t}function $(e,t,r){if(!t)throw new m("","reversedValidatedHostname");if(!r)throw new m("","reversedStringsToLengthMap");var o=t.length,n=Object.keys(r).filter((function(e){var n=r[e];return n<=o&&t.substr(0,n)===e}));if(n&&n.length>0)return X(n[0]);throw new S("Invalid origin","validatedOrigin",e)}function Y(){if(!K){var e=N();e.whitelistOriginComponents&&(k=Z(e.sharedClipboardHostingApps),j=Z(e.sharedClipboardHostingEnvironments),K=!0)}}function Z(e){var t={};return e&&Array.isArray(e)&&0!==e.length?(e.forEach((function(e){t[X(e)]=e.length})),t):t}function ee(){return re()}function te(e){if(!e)throw new m("","id");var t=e.trim().toLowerCase();if(0===t.length)throw new S("","id");return t}function re(){return(Math.random()+1).toString(36).substring(7)}var oe=function(){function e(){}return e.localStorageData="localStorage/data",e.localStorageMetadata="localStorage/metadata",e.initIframe="initIframe",e}();function ne(e){return"get"===e||"set"===e||"init"===e}var ie=function(e){if(!e)throw new m("","clipboardOperationMessage");if(!e.id||0===e.id.trim().length)throw new m("","id");if(!e.operationCode)throw new m("","operationCode");if(!e.destination)throw new m("","destination");if(!ne(e.operationCode))throw new S("","operationCode",e.operationCode);if("set"!==e.operationCode&&e.clipboardItemsData)throw new S("'"+e.operationCode+"' expects no clipboard items","clipboardItemsData")};function ae(e,t,r,o,n){var i={id:e,operationCode:t,failed:r,error:o,clipboardItemsData:n};return se(i),i}var se=function(e){if(!e)throw new m("","clipboardOperationResultMessage");if(!e.id||0===e.id.trim().length)throw new m("","id");if(!e.operationCode)throw new m("","operationCode");if("getresult"!==e.operationCode&&"setresult"!==e.operationCode&&"initresult"!==e.operationCode&&"unknownresult"!==e.operationCode&&"getMetadata_longPollingresult"!==e.operationCode)throw new S("","operationCode",e.operationCode);if(e.failed){if(!e.error)throw new S("A failed '"+e.operationCode+"' operation expects a non-empty error argument","error");if(e.clipboardItemsData)throw new S("A failed '"+e.operationCode+"' operation does not expect a clipboardItemsData argument","clipboardItemsData")}else{if(e.error)throw new S("'"+e.operationCode+"' expects an empty error argument","error");if("unknownresult"===e.operationCode)throw new S("'"+e.operationCode+"' can only be used with a failure message","operationCode")}if("getresult"===e.operationCode||"getMetadata_longPollingresult"===e.operationCode){if(!e.failed&&!e.clipboardItemsData)throw new S("'"+e.operationCode+"' expects a clipboardItems argument","clipboardItemsData")}else if(e.clipboardItemsData)throw new S("'"+e.operationCode+"' expects no clipboardItemsData argument","clipboardItemsData")};function le(e){if(!e||0===e.trim().length)throw new S("","className",e);return function(){var t=!1;function r(t){return e+":"+t+": already disposed"}return{dispose:function(){t=!0},logIfDisposed:function(e){return t&&a().ULS.traceTag(596456217,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Warning,r(e)),t},throwIfDisposed:function(e){if(t)throw new w(r(e))}}}()}var ce=function(){function e(e,t,r){this.clipboardStrategyType=e,this.clipboardCapabilities=t,this.clipboardDataProcessor=r,this.disposableImplementationExtension=le(""+e)}return e.prototype.initialize=function(e){var t=this;return e.then((function(e){return t.clipboardStorage=e,a().ULS.traceTag(596453007,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"Clipboard strategy type '"+t.clipboardStrategyType+"' was initialized."),Promise.resolve(t)}),(function(e){return a().ULS.traceTag(596453008,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Error,"Failed to initialize clipboard strategy type '"+t.clipboardStrategyType+"'. Error: "+i.utils.getStringifiedError(e)),Promise.reject(e)}))},e.prototype.set=function(e,t){try{if(this.disposableImplementationExtension.throwIfDisposed("set"),!this.clipboardStorage){return a().ULS.shipAssertTag(596121485,i.LogCategory.msoulscat_ES_EWAJS,!1,"ClipboardStrategyBase.set: this.clipboardStorage should be defined"),Promise.reject(new y(u.ClipboardStrategyNotInitialized))}return this.clipboardDataProcessor&&this.clipboardDataProcessor.preSetProcess(e),this.clipboardStorage.set(e,t)}catch(e){return Promise.reject(new y(u.SetClipboardItems,"Failed in (clipboard "+this.clipboardStrategyType+").set",e))}},e.prototype.get=function(e){var t=this;try{if(this.disposableImplementationExtension.throwIfDisposed("get"),!this.clipboardStorage){return a().ULS.shipAssertTag(596121486,i.LogCategory.msoulscat_ES_EWAJS,!1,"ClipboardStrategyBase.get: this.clipboardStorage should be defined"),Promise.reject(new y(u.ClipboardStrategyNotInitialized))}return this.clipboardStorage.get(e).then((function(e){return t.clipboardDataProcessor&&t.clipboardDataProcessor.postGetProcess(e),Promise.resolve(e)}))}catch(e){return Promise.reject(new y(u.GetClipboardItems,"Failed in (clipboard "+this.clipboardStrategyType+").get",e))}},e.prototype.onSystemClipboardChangedExternally=function(e){try{return this.disposableImplementationExtension.throwIfDisposed("onSystemClipboardChangedExternally"),this.clipboardStorage?this.clipboardCapabilities.systemClipboard?Promise.resolve():this.clipboardStorage.set(P(),e):(a().ULS.shipAssertTag(595882508,i.LogCategory.msoulscat_ES_EWAJS,!1,"ClipboardStrategyBase.onSystemClipboardChangedExternally: this.clipboardStorage should be defined"),Promise.reject(new y(u.ClipboardStrategyNotInitialized)))}catch(e){return Promise.reject(new y(u.ClearClipboardItems,"Failed in (clipboard "+this.clipboardStrategyType+").onSystemClipboardChangedExternally",e))}},e.prototype.dispose=function(){this.disposableImplementationExtension.logIfDisposed("dispose")||(this.clipboardStorage&&this.clipboardStorage.dispose(),this.disposableImplementationExtension.dispose())},e}(),de=!!window.performance&&!!window.performance.now&&!!window.performance.timing;function ue(e){var t=e;return t&&0!==t.trim().length||(t=ee()),new he(t)}function ge(){return de?window.performance.now():Date.now()}function pe(e){return de?new Date(e+window.performance.timing.navigationStart):new Date(e)}function fe(e,t,r){if(!r)throw new m("","creationTimestamp");return(e?"Fulfilled":"Still unfulfilled")+" after "+(e?t?t-r:"?":ge()-r)+"ms"}var he=function(){function e(t){var r=this;this.isFulfilled=!1,this.fulfillmentTimestamp=void 0,this.rejected=!1,this.id=te(t),e.sequenceId+=1,this.sequenceId=e.sequenceId,this.creationTimestamp=ge(),a().ULS.traceTag(596456225,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"Deferred promise: creating deferred promise #"+this.sequenceId+" with id '"+this.id+"' on "+pe(this.creationTimestamp)),this.promise=new Promise((function(e,t){a().ULS.traceTag(596456226,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"Deferred promise: registering callback for promise #"+r.sequenceId+" with id '"+r.id+"' on "+pe(ge())),r.internalResolve=e,r.internalReject=t}))}return e.prototype.fulfilled=function(){return this.isFulfilled},e.prototype.resolve=function(e){this.markAsFulfilled("resolve"),this.internalResolve?this.internalResolve(e):a().ULS.traceTag(596456257,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Warning,"Deferred promise - resolve: the resolve for deferred promise #"+this.sequenceId+" with id '"+this.id+"' is not tracked with a callback")},e.prototype.reject=function(e){this.markAsFulfilled("reject"),this.internalReject?this.internalReject(e):a().ULS.traceTag(596456260,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Warning,"Deferred promise - reject: the reject for deferred promise #"+this.sequenceId+" with id '"+this.id+"' is not tracked with a callback")},e.prototype.markAsFulfilled=function(e){this.fulfillmentCheck(e)||(this.isFulfilled=!0,this.rejected="resolve"!==e,this.fulfillmentTimestamp=ge(),a().ULS.traceTag(596456261,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"Deferred promise: marking promise #"+this.sequenceId+" with id '"+this.id+"' as fulfilled ("+(this.rejected?"rejected":"resolved")+"). "+fe(this.isFulfilled,this.fulfillmentTimestamp,this.creationTimestamp)))},e.prototype.fulfillmentCheck=function(e){return a().ULS.traceTag(596456258,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"Deferred promise: asked to "+e+" deferred promise #"+this.sequenceId+" with id '"+this.id+"'"),this.isFulfilled&&a().ULS.traceTag(596456259,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Warning,"Deferred promise: cannot "+e+" deferred promise #"+this.sequenceId+" with id '"+this.id+"' since it was "+(this.rejected?"rejected":"resolved")+" already on "+pe(this.fulfillmentTimestamp)+". "+fe(this.isFulfilled,this.fulfillmentTimestamp,this.creationTimestamp)),this.isFulfilled},e.sequenceId=0,e}();!function(){function e(){this.deferredResultMessagePromiseCache={}}e.prototype.getDeferredPromise=function(e){var t=te(e);return this.deferredResultMessagePromiseCache[t]},e.prototype.getPromise=function(e){var t=this.getDeferredPromise(e);if(t)return a().ULS.traceTag(596456218,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"Deferred promise cache: found a deferred promise with id '"+e+"'."),t.promise;a().ULS.traceTag(596456219,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"Deferred promise cache: there is no deferred promise with id '"+e+"'.")},e.prototype.addNewPromise=function(e){var t=ue(e);if(this.getDeferredPromise(t.id))throw new S("A deferred promise already exists in the cache for the specified id","id",t.id);var r=te(t.id);return this.deferredResultMessagePromiseCache[r]=t,a().ULS.traceTag(596456220,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"Deferred promise cache: added a new deferred promise with id '"+t.id+"'."),t},e.prototype.getLength=function(){var e=0;for(var t in this.deferredResultMessagePromiseCache)e+=1;return e},e.prototype.delete=function(e){if(this.getDeferredPromise(e)){var t=te(e);delete this.deferredResultMessagePromiseCache[t],a().ULS.traceTag(596456222,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"Deferred promise cache: deleted id '"+e+"'.")}else a().ULS.traceTag(596456221,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"Deferred promise cache: no need to delete an item with id '"+e+"' since this id is not associated with an existing deferred promise.")},e.prototype.clear=function(){if(a().ULS.traceTag(596456223,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"Deferred promise cache: clearing "+this.getLength()+" items from the cache"),this.deferredResultMessagePromiseCache)for(var e in this.deferredResultMessagePromiseCache){var t=this.deferredResultMessagePromiseCache[e];if(t)try{t.reject()}catch(t){a().ULS.traceTag(596456224,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Warning,"Deferred promise cache: clear failed to reject promise id '"+e+"' with this exception: "+t.message+". Ignoring.")}}this.deferredResultMessagePromiseCache={}}}();function me(e){if(!e)throw new m("","validator");return{deserialize:function(t){return function(e,t){if(!e)throw new m("","incomingMessage");if(!t)throw new m("","validator");if(0===e.length)throw new S("An empty message is invalid","incomingMessage");var r,o=e.trim();if(0===o.length)throw new S("A message cannot contain only spaces","incomingMessage");try{r=JSON.parse(o)}catch(t){throw new S("Deserialization failed","incomingMessage","Contains "+e.length.toString()+" characters",t)}if(!r)throw new S("Deserialization returned nothing","incomingMessage");return t(r),r}(t,e)}}}function Se(e){if(!e)throw new m("","validator");return{serialize:function(t){return function(e,t){if(!e)throw new m("","outgoingMessage");if(!t)throw new m("","validator");return t(e),function(e){var t;try{t=JSON.stringify(e)}catch(t){throw new S("Serialization failed","outgoingMessage",Object.keys(e).length+" properties",t)}return a().ULS.traceTag(596452375,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"The length of the serialized message is "+t.length),t}(e)}(t,e)}}}function we(e){if(!e)throw new m("","remoteWindow");if(!("window"in e)||!e.window)throw new m("","remoteWindow.window");if(!("windowOrigin"in e)||!e.windowOrigin)throw new m("","remoteWindow.windowOrigin");var t=q(e.windowOrigin);return{window:e.window,windowOrigin:t}}var Ce=function(){function e(e,t,r,o){this.serializer=e,this.deserializer=t,this.remoteWindow=r,this.remoteWindow=r,this._disposableImplementationExtension=le(o)}return Object.defineProperty(e.prototype,"disposableImplementationExtension",{get:function(){return this._disposableImplementationExtension},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){var e=this;this.disposableImplementationExtension.logIfDisposed("dispose")||(!function(e){if(e&&Array.isArray(e)&&0!==e.length){var t=0,r=void 0;if(e.forEach((function(e){if(t+=1,e)try{e()}catch(e){a().ULS.traceTag(596456216,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Warning,"rethrowAfterAllActions: callback action #"+t+" threw an exception: "+e.message),r||(r=new w(e.message,e))}else a().ULS.traceTag(596456215,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Warning,"rethrowAfterAllActions: callback action #"+t+" is empty")})),r)throw r}else a().ULS.traceTag(596456214,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Warning,"rethrowAfterAllActions: no actions to execute")}([function(){e.sender&&e.sender.dispose()},function(){e.receiver&&e.receiver.dispose()}]),this.disposableImplementationExtension.dispose())},e.prototype.postMessage=function(e){if(this.disposableImplementationExtension.throwIfDisposed("postMessage"),!e)throw new m("","outgoingMessage");if(!this.sender){var t="WindowRPCBase::postMessage - this.sender should be defined";throw a().ULS.shipAssertTag(596121484,i.LogCategory.msoulscat_ES_EWAJS,!1,t),new w(t)}this.sender.postMessage(e)},e}();function ve(){return ye}var ye={addEventListener:function(e,t){return window.addEventListener(e,t)},removeEventListener:function(e,t){return window.removeEventListener(e,t)}};var be=function(){function e(e,t,r){var o=this;if(this.deserializer=e,this.handler=t,this.windowMessageHandler=function(e){return o.onMessageReceived(e)},!e)throw new m("","deserializer");if(!t)throw new m("","handler");if(!r)throw new m("","windowRPC");this.disposableImplementationExtension=le("WindowRPCReceiverInternal"),this.remoteWindow=we(r.remoteWindow),ve().addEventListener("message",this.windowMessageHandler)}return e.prototype.dispose=function(){this.disposableImplementationExtension.logIfDisposed("dispose")||(ve().removeEventListener("message",this.windowMessageHandler),this.disposableImplementationExtension.dispose())},e.prototype.shouldFilterMessageEvent=function(e){try{if(!e.origin||!e.source)return a().ULS.traceTag(596452370,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"Window RPC Receiver: ignoring messages from unspecified window sources."),!0;if(e.source===window)return a().ULS.traceTag(596452371,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Verbose,"Window RPC Receiver: ignoring messages from this window to itself."),!0;if(this.remoteWindow.window&&e.source!==this.remoteWindow.window)return a().ULS.traceTag(596452372,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Verbose,"Window RPC Receiver: ignoring messages from windows other than the assigned remote window."),!0;if(e.origin.toLowerCase()!==this.remoteWindow.windowOrigin)return a().ULS.traceTag(596452373,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Verbose,"Window RPC Receiver: ignoring messages from windows with an origin that differs from remote window origin."),!0}catch(e){return!0}return!1},e.prototype.onMessageReceived=function(e){if(!this.shouldFilterMessageEvent(e)){var t=void 0;try{t=this.deserializer.deserialize(e.data)}catch(e){a().ULS.traceTag(596452374,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Error,"Window RPC Receiver: unable to deserialize incoming message. "+i.utils.getStringifiedError(e));try{this.handler.handleDeserializationError(i.utils.getStringifiedError(e))}catch(e){a().ULS.traceTag(596452184,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Error,"Window RPC Receiver: unable to handle deserialization error. "+i.utils.getStringifiedError(e))}return}if(t)try{this.handler.handleMessage(t).catch((function(e){a().ULS.traceTag(595985880,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Error,"Window RPC Receiver: unable to process incoming message. "+i.utils.getStringifiedError(e))}))}catch(e){a().ULS.traceTag(596452186,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Error,"Window RPC Receiver: unable to process incoming message. "+i.utils.getStringifiedError(e))}else a().ULS.traceTag(596452185,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Error,"Window RPC Receiver: the incoming message is empty")}},e}();var Ee=function(){function e(e,t,r){if(void 0===r&&(r=!1),this.serializer=e,this.delayedQueueEnabled=r,!e)throw new m("","serializer");if(!t)throw new m("","windowRPC");this.disposableImplementationExtension=le("WindowRPCSenderInternal"),this.remoteWindow=we(t.remoteWindow)}return e.prototype.postMessage=function(e){if(!e)throw new m("","outgoingMessage");if(!this.remoteWindow.window)throw new w("Configure the remote window");if(!this.remoteWindow.window.postMessage)throw new w("The remote window does not support postMessage");var t=this.serializer.serialize(e);b.postMessage(this.remoteWindow.window,t,this.remoteWindow.windowOrigin)},e.prototype.dispose=function(){this.disposableImplementationExtension.logIfDisposed("dispose")||this.disposableImplementationExtension.dispose()},e}();function Te(e){return"OfficeOnlineCCP_Metadata_"+e}var Le;!function(){function e(){this.startTime=i.perfWatch.timeStamp()}e.prototype.profilingMessage=function(e){var t=i.perfWatch.timeStamp()-this.startTime;return"onPasteProfiling: "+e+", pasteId: "+this.id+", timeMS: "+t.toFixed()}}();!function(e){e[e.Started=1]="Started",e[e.SynchronousPhaseCompleted=2]="SynchronousPhaseCompleted",e[e.Completed=3]="Completed"}(Le||(Le={}));var _e=function(){function e(e){this.localStorageKey=e;try{if(!localStorage)throw new Error("LocalStorageClipboardStorage.ctor: localStorage == null")}catch(e){throw new y(u.LocalStorageInitilizationInaccessible,"LocalStorageClipboardStorage.ctor: filed access to localStorage",e)}if(!e)throw new y(u.LocalStorageInitilizationNoKey,"LocalStorageClipboardStorage.ctor: localStorageKey must be defined");this.clipboardStorageType=T.LocalStorage,this.disposableImplementationExtension=le("LocalStorageClipboardStorage")}return e.prototype.get=function(e){this.disposableImplementationExtension.throwIfDisposed("get"),a().ULS.traceTag(595716238,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"localStorageClipboardStorage.get: commandParameters.id='"+(e?e.id:"")+"'");var t=localStorage.getItem(this.localStorageKey);if(!t)return Promise.resolve(P());try{var r=JSON.parse(t);if(!r||0===A(r))return Promise.resolve(P());var o=M(r);return Promise.resolve(o)}catch(e){return Promise.resolve(P())}},e.prototype.set=function(e,t){this.disposableImplementationExtension.throwIfDisposed("set"),a().ULS.traceTag(595716239,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"localStorageClipboardStorage.set: item count="+W(e)+"'; commandParameters.id='"+(t?t.id:"")+"'"),0===W(e)?localStorage.removeItem(this.localStorageKey):localStorage.setItem(this.localStorageKey,JSON.stringify(e.getData()));var r=this.localStorageKey+"_LocalStorageChangedFlag",o=ee();return a().ULS.traceTag(595654546,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"localStorageClipboardStorage.set: set local storage value. eventFalgKey = "+r+". eventFlagValue = "+o),localStorage.setItem(r,o),Promise.resolve()},e.prototype.getSupportedDataFormats=function(){return this.disposableImplementationExtension.throwIfDisposed("getSupportedDataFormats"),["text/plain","text/html","data/shadow-workbook"]},e.prototype.dispose=function(){this.disposableImplementationExtension.logIfDisposed("dispose")||this.disposableImplementationExtension.dispose()},e}();function Ie(e){return a().ULS.traceTag(595716236,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"Attempting to create clipboard strategy type '"+d.LocalStorage+"' with localStorageKey: '"+e+"'"),(new Pe).initialize(function(e){try{a().ULS.traceTag(595716237,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"Attempting to create clipboard storage type '"+T.LocalStorage+"'");var t=new _e(e);return Promise.resolve(t)}catch(e){return Promise.reject(e)}}(e))}var Pe=function(e){function t(t){return e.call(this,d.LocalStorage,{browserStorage:!0,systemClipboard:!1,inMemory:!1},t)||this}return c(t,e),t}(ce),Ae=function(){function e(e,t,r){this.localStorageKeyToWatch=e,this.clipboardStrategy=t,this.listener=r,this.maxTimeToWaitInMilliseconds=2e3,this.lastLocalStorageValue=null,window.addEventListener("storage",this.onStorageChanged.bind(this)),this.raiseMetadataChangedEvent()}return e.prototype.onStorageChanged=function(e){var t=this;a().ULS.shipAssertTag(595716249,i.LogCategory.msoulscat_ES_EWAJS,null!=e,"e should not be null"),a().ULS.traceTag(595716288,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"LocalStorageKeyChangeTracker.onStorageChanged:got storage change event. e.key = "+e.key+". localStorageKeyToWatch = "+this.localStorageKeyToWatch+". lastLocalStorageValue = "+this.lastLocalStorageValue),e.key===this.localStorageKeyToWatch&&(this.raiseMetadataChangedEvent(),a().ULS.traceTag(595716289,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"LocalStorageKeyChangeTracker.onStorageChanged: raised metadata change event. lastLocalStorageValue = "+this.lastLocalStorageValue),this.isLocalStorageValueChanged()||this.waitForLocalStorageValueToChange(this.maxTimeToWaitInMilliseconds).then((function(){t.raiseMetadataChangedEvent()}),(function(){a().ULS.traceTag(595716295,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Warning,"LocalStorageKeyChangeTracker.onStorageChanged: got rejected promise.")})))},e.prototype.raiseMetadataChangedEvent=function(){var e=this;return a().ULS.traceTag(595715525,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"LocalStorageKeyChangeTracker.raiseMetadataChangedEvent: starting raiseMetadataChangedEvent. lastLocalStorageValue = "+this.lastLocalStorageValue),this.clipboardStrategy.get({userHash:0}).then((function(t){e.listener(t),a().ULS.traceTag(595716232,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"LocalStorageKeyChangeTracker.raiseMetadataChangedEvent: sent message. lastLocalStorageValue = "+e.lastLocalStorageValue)}),(function(e){a().ULS.traceTag(595716233,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Warning,"LocalStorageKeyChangeTracker.raiseMetadataChangedEvent: failed to get metadata from clipboardStorage")}))},e.prototype.isLocalStorageValueChanged=function(){var e=localStorage.getItem(this.localStorageKeyToWatch),t=this.lastLocalStorageValue!==e;return a().ULS.traceTag(595715526,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"LocalStorageKeyChangeTracker.isLocalStorageValueChanged: lastLocalStorageValue = "+this.lastLocalStorageValue+". currentLocalStorageValue = "+e),this.lastLocalStorageValue=e,t},e.prototype.waitForLocalStorageValueToChange=function(e){var t=this;if(a().ULS.traceTag(595715527,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"LocalStorageKeyChangeTracker.waitForLocalStorageValueToChange: start waitForLocalStorageValueToChange. lastLocalStorageValue = "+this.lastLocalStorageValue),this.isLocalStorageValueChanged())return a().ULS.traceTag(595715528,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"LocalStorageKeyChangeTracker.waitForLocalStorageValueToChange: resolving because value was changed. lastLocalStorageValue = "+this.lastLocalStorageValue),Promise.resolve();var r=ue(),o=new Date,n=setInterval((function(){var s=(new Date).getTime()-o.getTime();a().ULS.traceTag(595715529,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"LocalStorageKeyChangeTracker.waitForLocalStorageValueToChange: call by setInterval. startTime = "+o+". elapseTime = "+s+". lastLocalStorageValue = "+t.lastLocalStorageValue),t.isLocalStorageValueChanged()?(clearInterval(n),a().ULS.traceTag(595716234,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"LocalStorageKeyChangeTracker.waitForLocalStorageValueToChange: resolving. startTime = "+o+". elapseTime = "+s+". lastLocalStorageValue = "+t.lastLocalStorageValue),r.resolve()):s>e&&(clearInterval(n),a().ULS.traceTag(595716235,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"LocalStorageKeyChangeTracker.waitForLocalStorageValueToChange: rejecting. startTime = "+o+". elapseTime = "+s+". lastLocalStorageValue = "+t.lastLocalStorageValue),r.reject())}),200);return r.promise},e}();new RegExp("(\n\r)|(\r\n)|(\r)","g"),new RegExp("(\t)","g"),new RegExp("<","g"),new RegExp(">","g");var We,Me,xe=r(1),Ue=function(){function e(){}return e.prototype.sendTraceTag=function(){},e.prototype.shipAssertTag=function(){},e.prototype.debugAssertTag=function(){},e}();!function(e){e[e.Error=10]="Error",e[e.Warning=15]="Warning",e[e.Info=50]="Info",e[e.Verbose=100]="Verbose",e[e.Spam=200]="Spam"}(We||(We={})),function(e){e[e.msoulscat_ES_EWAJS=0]="msoulscat_ES_EWAJS",e[e.msoulscat_ES_EWAJSGrid=1]="msoulscat_ES_EWAJSGrid",e[e.msoulscat_ES_EWAJSChart=6]="msoulscat_ES_EWAJSChart",e[e.msoulscat_MSOSP_FileMenuCommands=202]="msoulscat_MSOSP_FileMenuCommands",e[e.msoulscat_Wac_WordViewer=301]="msoulscat_Wac_WordViewer",e[e.msoulscat_Wac_BrowserGeneral=306]="msoulscat_Wac_BrowserGeneral",e[e.msoulscat_Wac_TaskPane=320]="msoulscat_Wac_TaskPane",e[e.msoulscat_Wac_OneNoteGeneral=339]="msoulscat_Wac_OneNoteGeneral",e[e.msoulscat_Wac_Ribbon=340]="msoulscat_Wac_Ribbon",e[e.msoulscat_Wac_WopiPendingApplication=379]="msoulscat_Wac_WopiPendingApplication",e[e.msoulscat_Wac_Telemetry=383]="msoulscat_Wac_Telemetry",e[e.msoulscat_Wac_WacCatchUpActivities=391]="msoulscat_Wac_WacCatchUpActivities",e[e.msoulscat_Wac_Dictation=394]="msoulscat_Wac_Dictation",e[e.msoulscat_Wac_OneNoteSync=395]="msoulscat_Wac_OneNoteSync",e[e.msoulscat_Wac_VisioApp=700]="msoulscat_Wac_VisioApp",e[e.msoulscat_OneNoteOnline_EditableCache=1601]="msoulscat_OneNoteOnline_EditableCache",e[e.msoulscat_Wac_PptAnimation=800]="msoulscat_Wac_PptAnimation",e[e.msoulscat_Wac_PptLive=833]="msoulscat_Wac_PptLive",e[e.msoulscat_Wac_PptMWeb=834]="msoulscat_Wac_PptMWeb",e[e.msoulscat_Wac_PptShape=815]="msoulscat_Wac_PptShape",e[e.msoulscat_Wac_PptSession=817]="msoulscat_Wac_PptSession",e[e.msoulscat_Wac_PptSlideshow=830]="msoulscat_Wac_PptSlideshow",e[e.msoulscat_Wac_VersionHistory=2300]="msoulscat_Wac_VersionHistory",e[e.msoulscat_Wac_WordPresence=302]="msoulscat_Wac_WordPresence",e[e.msoulscat_Wac_WordVersionHistory=3005]="msoulscat_Wac_WordVersionHistory",e[e.msoulscat_Wac_LivePersonaCard=3006]="msoulscat_Wac_LivePersonaCard",e[e.msoulscat_Wac_CatchUpFlyout=3012]="msoulscat_Wac_CatchUpFlyout",e[e.msoulscat_Wac_ModernFontPicker=3021]="msoulscat_Wac_ModernFontPicker"}(Me||(Me={}));var Oe;(function(){function e(){}e.tagIntToString=function(t){return t<=e.maxNumericTag?t.toString():t>>24>=this.minOldSchemeHighByteValue?String.fromCharCode(t>>24&255,t>>16&255,t>>8&255,255&t):e.map.charAt(t>>24&63)+e.map.charAt(t>>18&63)+e.map.charAt(t>>12&63)+e.map.charAt(t>>6&63)+e.map.charAt(63&t)},e.getLogMessage=function(t,r,o){return"tag_"+e.tagIntToString(t)+" ["+Me[r]+"] "+o},e.prototype.sendTraceTag=function(t,r,o,n){var i=this.logMessage;switch(o){case We.Error:i=this.logError;break;case We.Warning:i=this.logWarning;break;case We.Info:i=this.logInfo;break;case We.Verbose:i=this.logVerbose;break;case We.Spam:default:i=this.logMessage}try{i(e.getLogMessage(t,r,n))}catch(e){var a="undefined"!=typeof navigator?navigator:void 0;if(a&&!/rv:11.0/i.test(a.userAgent))throw e}},e.prototype.shipAssertTag=function(t,r,o,n){console.assert(o,e.getLogMessage(t,r,n))},e.prototype.debugAssertTag=function(e,t,r,o){this.shipAssertTag(e,t,r,o)},e.prototype.logMessage=function(e){"log"in console&&console.log(e)},e.prototype.logError=function(e){"error"in console&&console.error(e)},e.prototype.logWarning=function(e){"warn"in console&&console.warn(e)},e.prototype.logInfo=function(e){"info"in console&&console.info(e)},e.prototype.logVerbose=function(e){"debug"in console&&console.debug(e)},e.maxNumericTag=65535,e.minOldSchemeHighByteValue=36,e.map="abcdefghijklmnopqrstuvwxyz0123456789"})(),new(function(){function e(){this.externalLogger=new Ue}return e.prototype.setLogger=function(e){this.externalLogger=e},e.prototype.sendTraceTag=function(e,t,r,o){this.externalLogger.sendTraceTag(e,t,r,o)},e.prototype.debugAssertTag=function(e,t,r,o){this.externalLogger.debugAssertTag(e,t,r,o)},e.prototype.shipAssertTag=function(e,t,r,o){this.externalLogger.shipAssertTag(e,t,r,o)},e}());function De(e,t,r,o){var n=e.map((function(e){return function(e,t){var r={};r.G=e.tag,r.T=e.timestamp-t,r.M=e.message,r.C=e.category;var o=1e3*e.type+e.level;return r.D=o,r}(e,o)})),i=function(e,t,r,o){var n={};return n.T=e,n.L=t,n.S=r,n.I=o,n.V=1,n}(o,n,t,r);return JSON.stringify(i)}!function(e){e[e.Trace=0]="Trace",e[e.Assert=1]="Assert"}(Oe||(Oe={}));var Re=function(){function e(t,r){var o=this;this.uploadId=0,this.logCache=[],this.timestampBase=Date.now(),this.userSessionId="00000000-0000-0000-0000-000000000000",this.flushOnClose=function(){o.triggerUpload(!1,!1)},this.flush=function(){o.triggerUploadAsync()},this.triggerUploadAsync=function(){window.setTimeout((function(){return o.triggerUpload(!0,!0)}),0)},this.triggerUpload=function(t,r){(window.clearTimeout(o.timeoutId),o.logCache.length>0)&&(o.uploadId+=1,function(e,t,r){if(""!==t)if(navigator&&navigator.sendBeacon)navigator.sendBeacon(t,e);else{var o=new XMLHttpRequest;o.readyState!==XMLHttpRequest.UNSENT&&o.readyState!==XMLHttpRequest.DONE||(o.open("POST",t,r),o.send(e))}}(De(o.logCache,o.userSessionId,o.uploadId,o.timestampBase),o.remoteUrlEndpoint,r),o.logCache=[],o.timestampBase=Date.now());t&&(o.timeoutId=window.setTimeout(o.triggerUploadAsync,e.uploadCadenceInMsSec))},this.userSessionId=t,this.remoteUrlEndpoint=r+"?usid="+t,window.setTimeout((function(){return o.triggerUpload(!0,!0)}),0)}return e.prototype.handleTrace=function(t){t.message.length>e.messageMaxChars&&(t.message=t.message.substr(0,e.messageMaxChars-e.trimmedMessage.length)+e.trimmedMessage),this.logCache.push(t),(this.logCache.length>e.uploadTriggerSize||t.level===We.Error)&&this.triggerUploadAsync()},e.messageMaxChars=3072,e.uploadCadenceInMsSec=3e4,e.uploadTriggerSize=30,e.trimmedMessage="... [Trimmed]",e}();var Fe=We.Info;function Ne(e,t,r,o,n){if(!(o>Fe)){var i={timestamp:Date.now(),category:r,tag:t,level:o,type:Oe.Trace,message:n};e.handleTrace(i)}}!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}c(t,e)}(Ue);function He(e,t){var r=function(e,t){var r=new Re(e,t);return{sendTraceTag:function(e,t,o,n){return Ne(r,e,t,o,n)},shipAssertTag:function(e,t,o,n){o&&Ne(r,e,t,We.Error,n)},debugAssertTag:function(){throw new Error("Debug Asserts not Implemented in the TypeScript bULS module")},flush:r.flush,flushOnClose:r.flushOnClose}}(t,e);return{assertTag:function(e,t,o,n){return r.shipAssertTag(e,t,!o,n)},shipAssertTag:function(e,t,o,n){return r.shipAssertTag(e,t,!o,n)},debugTraceTag:r.sendTraceTag,traceTag:r.sendTraceTag}}var Je=function(e){function t(t){var r=e.call(this)||this;return r.clipboardStrategy=t,r.nameForTelemetry="ClipboardStrategyMessageHandler_StrategyType_"+t.clipboardStrategyType,r.addMessageHandler("get",{handleMessage:r.get.bind(r)}),r.addMessageHandler("set",{handleMessage:r.set.bind(r)}),r}return c(t,e),t.prototype.get=function(e,t){var r={userHash:e.userHash};return this.clipboardStrategy.get(r).then((function(e){return t.clipboardItemsData=e.getData(),Promise.resolve(t)}),(function(e){return ze(t,e)}))},t.prototype.set=function(e,t){var r={userHash:e.userHash},o=void 0;return e.clipboardItemsData&&(o=e.clipboardItemsData),this.clipboardStrategy.set(M(o),r).then((function(){return Promise.resolve(t)}),(function(e){return ze(t,e)}))},t}(function(){function e(){this._handlers={}}return e.prototype.handleMessage=function(e,t){return e&&e.operationCode in this._handlers?this._handlers[e.operationCode].handleMessage(e,t):ze(t,new y(u.UnsupportedOperationCode,"Operation code '"+(e?e.operationCode:"incomingMessage is null")+"' is unsupported"))},e.prototype.addMessageHandler=function(e,t){e?e in this._handlers?a().ULS.shipAssertTag(595944464,i.LogCategory.msoulscat_ES_EWAJS,!1,"BaseMessageHandler.addMessageHandler: handle for operation: "+e+" already exist"):this._handlers[e]=t:a().ULS.shipAssertTag(595944463,i.LogCategory.msoulscat_ES_EWAJS,!1,"BaseMessageHandler.addMessageHandler: expected operationCode to be defined")},e}());function ze(e,t){return Ve(e,t),Promise.resolve(e)}function Ve(e,t){e.failed=!0,e.error=i.utils.getStringifiedError(t)}var ke=function(e){function t(t,r,o,n){var i=e.call(this,r,t,o,"WindowRPCServerInternal")||this;if(i.windowRPCServerState=n,!n)throw new y(u.CreateWindowRPCServer,"windowRPCServerState is undefined.");return i.receiver=function(e,t,r){return new be(e,t,r)}(t,i,i),i.sender=function(e,t){return new Ee(e,t)}(r,i),i}return c(t,e),t.prototype.handleMessage=function(e){var t=this;if(a().ULS.traceTag(596452360,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"RPC Server - handleMessage: incomingMessage.id='"+(e&&e.id)+"'; incomingMessage.operationCode='"+(e&&e.operationCode)+"'; incomingMessage.clipboardItems.length="+A(e&&e.clipboardItemsData)),this.windowRPCServerState.isInitializationPending()&&e&&"init"===e.operationCode)return a().ULS.traceTag(596129562,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"The clipboard strategy is not initialized yet. Once it's done, it'll send an 'initresult' message."),Promise.resolve();var r=e&&e.id?e.id:"unknownmessageid",o=!e||!e.operationCode||!ne(e.operationCode),n={id:r,failed:o,error:void 0,operationCode:o?"unknownresult":e.operationCode+"result"};return this.routeOperation(e,n).then((function(e){return t.postMessage(e)})).catch((function(e){return a().ULS.traceTag(596452182,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Error,"RPC Server - handleMessage: unable to send result message. Sending a failure message. "+i.utils.getStringifiedError(e)),n.clipboardItemsData=void 0,Ve(n,e),t.postMessage(n)})).catch((function(e){return a().ULS.traceTag(596452183,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Error,"RPC Server - handleMessage: unable to send failure result message. "+i.utils.getStringifiedError(e)),Promise.reject(e)}))},t.prototype.routeOperation=function(e,t){if(this.windowRPCServerState.isInitializationPending())return ze(t,new y(u.SelectClipboardStrategy,"A clipboard strategy had not been selected and initialized yet"));if(!this.windowRPCServerState.isInitializedSuccessfully())return ze(t,this.windowRPCServerState.getClipboardInitError());if("init"===e.operationCode)return Promise.resolve(t);var r=this.windowRPCServerState.getMessageHandler(e.destination);return r?r.handleMessage(e,t):ze(t,new y(u.SelectClipboardStrategy,"messageHandler does not exist"))},t.prototype.handleDeserializationError=function(e){return this.postMessage({id:"unknownmessageid",failed:!0,error:e,operationCode:"unknownresult"}).catch((function(e){a().ULS.traceTag(596451867,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Error,"RPC Server - handleDeserializationError: unable to send failure result message. "+i.utils.getStringifiedError(e))}))},t.prototype.postMessage=function(t){try{return e.prototype.postMessage.call(this,t),Promise.resolve()}catch(e){return Promise.reject(new w("Unable to post message for operation '"+(t&&t.operationCode?t.operationCode:"")+"'",e))}},t}(Ce),je=function(e){function t(t,r,o){var n=e.call(this,o,"getMetadata_longPollingresult")||this;return n.localStorageKeyChangeTracker=new Ae(r,t,n.raiseMetadataChangedEvent.bind(n)),n}return c(t,e),t.prototype.raiseMetadataChangedEvent=function(e){this.sendMessage(e.getData())},t}(function(){function e(e,t){this.windowRPCServer=e,this.operationCode=t}return e.prototype.sendMessage=function(e){if(this.windowRPCServer){var t=ae(ee(),this.operationCode,!1,void 0,e);this.windowRPCServer.postMessage(t)}},e}());function Be(e,t){if(!t)return Promise.resolve(!1);var r=function(e,t){try{var r=window.parent,o=e;if(!o)throw new m("remoteWindowOrigin is undefined","remoteWindowOrigin");return new ke(me(ie),Se(se),{window:r,windowOrigin:o},t)}catch(e){return void a().ULS.shipAssertTag(595981475,i.LogCategory.msoulscat_ES_EWAJS,!1,"createWindowRPCServer failed with exception: "+i.utils.getStringifiedError(e))}}(e,Ke);if(!r)return a().ULS.traceTag(595947554,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Error,"initModuleState: Failed to create windowRPCServer"),Promise.resolve(!1);var o=ue("initmessageid");return(Ge={initMessageIdUniqueRunningSuffix:1,initializationDeferredPromise:o,windowRPCServer:r}).initializationDeferredPromise.promise.then((function(){return function(){var e=Qe();if(a().ULS.shipAssertTag(595947555,i.LogCategory.msoulscat_ES_EWAJS,!!e,"sendClipboardInitializationSuccessResult: windowRPCServer must be defined"),!e)return Promise.reject(new w("sendClipboardInitializationSuccessResult cannot post a message since WindowRPCServer could not be created"));var t=ae(Xe(),"initresult",!1);return e.postMessage(t)}()}),(function(e){return function(e){var t=Qe();if(a().ULS.shipAssertTag(595947584,i.LogCategory.msoulscat_ES_EWAJS,!!t,"sendClipboardInitializationFailureResult: windowRPCServer must be defined"),!t)return Promise.reject(new w("sendClipboardInitializationFailureResult cannot post a message since WindowRPCServer could not be created"));var r=ae(Xe(),"initresult",!0,i.utils.getStringifiedError(e));return t.postMessage(r)}(e)})).catch((function(){})),t.then((function(e){return Ge&&(Ge.metadataDataChangedMessageSender=new je(e.metadataClipboardStrategy,e.localStorageMetadataKeyToWatch,r)),function(e){var t=Object.keys(e).map((function(t){return"Name: "+t+", handlerName: "+(e[t]&&e[t].nameForTelemetry)})).join(", ");if(a().ULS.traceTag(595947585,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Info,"markInitializationSuccess: Created and initialized ClipboardStrategies '"+t+"'"),a().ULS.shipAssertTag(595947586,i.LogCategory.msoulscat_ES_EWAJS,!!Ge,"markInitializationSuccess: windowRPCServerInternalState must be defined"),!Ge)return;Ge.clipboardOperationMessageHandlerMap=e,Ge.clipboardInitError=void 0,Ge.clipboardInitTimestamp=Date.now(),Ge.initializationDeferredPromise&&Ge.initializationDeferredPromise.resolve()}(e.messageHandlers),Promise.resolve(!0)}),(function(e){return function(e){if(a().ULS.traceTag(595947587,i.LogCategory.msoulscat_ES_EWAJS,i.TraceLevel.Error,"markInitializationFailure: Failed to initialize ClipboardStrategies"),a().ULS.shipAssertTag(595947588,i.LogCategory.msoulscat_ES_EWAJS,!!Ge,"markInitializationFailure: windowRPCServerInternalState must be defined"),!Ge)return;Ge.clipboardOperationMessageHandlerMap=void 0,Ge.clipboardInitError=e,Ge.clipboardInitTimestamp=Date.now(),Ge.initializationDeferredPromise&&Ge.initializationDeferredPromise.reject(Ge.clipboardInitError)}(e),Promise.resolve(!1)}))}var Ke={getMessageHandler:function(e){if(!Ge)return;if(!e)return void a().ULS.shipAssertTag(595945235,i.LogCategory.msoulscat_ES_EWAJS,!1,"getMessageHandler: expected destination to be defined");if(!Ge.clipboardOperationMessageHandlerMap)return void a().ULS.shipAssertTag(595945236,i.LogCategory.msoulscat_ES_EWAJS,!1,"getMessageHandler: clipboardOperationMessageHandlerMap is not initialized");if(!(e in Ge.clipboardOperationMessageHandlerMap))return void a().ULS.shipAssertTag(595945237,i.LogCategory.msoulscat_ES_EWAJS,!1,"getMessageHandler: "+e+" is not part of ClipboardStrategyMap");return Ge.clipboardOperationMessageHandlerMap[e]},isInitializationPending:qe,isInitializedSuccessfully:function(){if(Ge)return!qe()&&!!Ge.clipboardOperationMessageHandlerMap;return!1},getClipboardInitError:function(){if(Ge)return Ge.clipboardInitError;return}},Ge=void 0;function qe(){return!Ge||!Ge.initializationDeferredPromise||!Ge.initializationDeferredPromise.fulfilled()}function Qe(){if(Ge)return Ge.windowRPCServer}function Xe(){if(!Ge)return"";var e=Ge.initMessageIdUniqueRunningSuffix;return Ge.initMessageIdUniqueRunningSuffix+=1,"initmessageid"+e}function $e(e){return-1===decodeURIComponent(window.location.href).indexOf(e)}function Ye(){s(new xe.ConsoleLogger),Object(i.initEwaUtils)({isChangeGateEnabled:$e}),o.initializeSharedClipboardSettingsFromWindow();var e=i.utils.getQueryParameterByName(window.location.href,"CreatorOrigin")||"";if(!e)throw new m("remoteWindowOrigin is undefined","remoteWindowOrigin");e=q(e);try{var t=i.utils.getQueryParameterByName(window.location.href,"usid")||"",r=o.getSharedClipboardSettings().remoteLoggerPath;if(r&&t)s(He(""+e+r,t))}catch(e){}var n=o.getSharedClipboardSettings().sharedClipboardSchemaVersion;return Be(e,Ie(function(e){return"OfficeOnlineCCP_Data_"+e}(n)).then((function(e){var t=Te(n),r=function(e){return Te(e)+"_LocalStorageChangedFlag"}(n);return Ie(t).then((function(t){var o={};return o[oe.localStorageData]=new Je(e),o[oe.localStorageMetadata]=new Je(t),{messageHandlers:o,localStorageMetadataKeyToWatch:r,dataClipboardStrategy:e,metadataClipboardStrategy:t}}))})))}r.d(t,"a",(function(){return Ye}))},function(e,t,r){"use strict";r.r(t);var o=r(0);for(var n in o)"default"!==n&&function(e){r.d(t,e,(function(){return o[e]}))}(n);var i=r(2);r.d(t,"initialize",(function(){return i.a}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.forEachPromise=function(e,t,r){return e.reduce((function(e,o){return e.then((function(){return r&&r.stop?Promise.resolve(void 0):t(o,r)}))}),Promise.resolve(void 0))},t.defaultToJSONResultWhenStringifyFails="...",t.getStringifiedError=function(e){if(0===e)return"0";if(!e)return"";try{return JSON.stringify(function e(t,r){void 0===r&&(r=0);if(r<0||r>5)return t;if(null==t||"object"!=typeof t)return t;var o={};Object.getOwnPropertyNames(t).forEach((function(e){"stack"!==e&&e.toUpperCase()!==e&&(o[e]=t[e])}));var n=Object.getPrototypeOf(t);n&&"object"==typeof n&&Object.keys(n).forEach((function(e){"stack"!==e&&e.toUpperCase()!==e&&(o[e]=t[e])}));var i={};return Object.keys(o).forEach((function(t){i[t]=e(o[t],r+1)})),i}(e))}catch(e){return t.defaultToJSONResultWhenStringifyFails}};var o=new RegExp("\\W+","g");t.getPerfWatchMarkName=function(e){if(!e)return"";var t=e.trim().substring(0,200).trim().replace(o,"_").substring(0,80);return t&&t.length>0&&"_"===t.substr(t.length-1,1)&&(t=t.substr(0,t.length-1)),t&&t.length>0&&"_"===t.substr(0,1)&&(t=t.substr(1)),t},t.retry=function(e,t){if(!e)return Promise.reject(new Error("utils.retry: action can't be null or undefined"));if(t<1)return Promise.reject(new Error("utils.retry: attempts expected to be greater than 0 but got "+t));for(var r=Promise.reject(),o=function(t){r=r.catch((function(r){return e(t,r)}))},n=1;n<=t;n+=1)o(n);return r},t.chainFallbackPromises=function(e,t){if(!e||0===e.length)return Promise.reject();for(var r=t(e[0]),o=function(o){var n=e[o];r=r.catch((function(){return t(n)}))},n=1;n<e.length;n+=1)o(n);return r},t.getQueryParameterByName=function(e,t){var r=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)").exec(e);if(r)return r[2]?decodeURIComponent(r[2].replace(/\+/g," ")):""},t.decodeHtml=function(e){return"string"==typeof e?(new DOMParser).parseFromString(e,"text/html").documentElement.textContent:e},t.calcHashCode=function(e){if(!e)return 0;for(var t=5381,r=t,o=e.length,n=0;n<o&&(t=4294967295&((t<<5)+t^e.charCodeAt(n)),n!==o-1);n+=2)r=4294967295&((r<<5)+r^e.charCodeAt(n+1));var i=t+35685*r+(23896*r<<16)&4294967295;return i<0&&(i+=4294967296),i},t.getCharIndexInTextFromPoint=function(e,t,r){void 0===r&&(r=!1);var o=-1,n=null;if(void 0!==document.caretPositionFromPoint)null!==(i=document.caretPositionFromPoint(e,t))&&(o=i.offset,n=null!=i.offsetNode&&null!=i.offsetNode.parentElement&&"SPAN"===i.offsetNode.parentElement.nodeName?i.offsetNode.parentElement:i.offsetNode);else if(void 0!==document.caretRangeFromPoint){null!==(i=document.caretRangeFromPoint(e,t))&&(o=i.startOffset,n=null!=i.startContainer&&null!=i.startContainer.parentElement&&"SPAN"===i.startContainer.parentElement.nodeName?i.startContainer.parentElement:i.startContainer)}else try{var i;n=document.elementFromPoint(e,t),(i=document.body.createTextRange()).moveToPoint(e,t);var a=document.body.createTextRange();a.moveToElementText(n),a.setEndPoint("EndToStart",i),o=a.text.length}catch(e){return o}if(r)for(var s=!1;null!=n;)null===n.previousSibling&&null!==n.parentNode&&null!==n.parentNode.parentNode&&n.parentNode.parentNode.childNodes.length>1&&!s?(n=n.parentNode,s=!0):null!=(n=n.previousSibling)&&null!=n.textContent&&(o+=n.textContent.length,s&&(o+=1));else for(;null!=n;)null!=(n=n.previousSibling)&&null!=n.textContent&&(o+=n.textContent.length);return o},t.getBoundingRectForText=function(e,t,r,o){function n(e,t,r){if(!e||!e.textContent)return t;if(o&&(t<0||t>e.textContent.length&&(0===e.childNodes.length||"DIV"!==e.childNodes[0].nodeName)))return t-e.textContent.length;if(t<0||t>e.textContent.length)return t-e.textContent.length;if(!e.hasChildNodes())return r(e,t),t-e.textContent.length;for(var i=e.childNodes,a=0;a<i.length&&t>=0;a+=1)t=n(i[a],t,r),o&&"DIV"===i[a].nodeName&&(t-=1);return t}void 0===o&&(o=!1);var i=document.createRange();return n(e,t,(function(e,t){return i.setStart(e,t)})),n(e,r,(function(e,t){return i.setEnd(e,t)})),i.getBoundingClientRect()}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o={};t.promises=function(){return void 0===o.promises&&(o.promises="undefined"!=typeof Promise&&"function"==typeof Promise.resolve&&Promise.resolve(0)&&"function"==typeof Promise.resolve(0).then),o.promises}},function(e,t,r){"use strict";function o(){return window.performance&&window.performance.now?window.performance.now():Date.now()}function n(e,t,r){e[t]=o()-r}Object.defineProperty(t,"__esModule",{value:!0}),t.start=function(e){var t=o(),r=e,i=t,a={},s=function(e,t,o){return function(e,t,r,o,i,a){n(e,"end",r);var s={sessionName:t,result:o?"success":"failure",message:a,marks:e},l=JSON.stringify(s);i(l)}(a,r,i,e,t,o)};return a.start=0,{mark:function(e){return function(e){return n(a,e,i)}(e)},end:function(e){return s(!0,e)},success:function(e,t){return s(!0,e,t)},failure:function(e,t){return s(!1,e,t)}}},t.mark=function(e,t){void 0!==e&&e.mark(t)},t.end=function(e,t){void 0!==e&&e.end(t)},t.success=function(e,t,r){void 0!==e&&e.success(t,r)},t.failure=function(e,t,r){void 0!==e&&e.failure(t,r)},t.timeStamp=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o={isChangeGateEnabled:function(e){return!1}};t.ewaUtils=function(){return o},t.initEwaUtils=function(e){if(!e)throw new Error("the 'ewaUtils' argument is missing");o=e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){return Date.now()};t.initStopwatchFactory=function(e,t){return void 0===t&&(t=1),"undefined"!=typeof self&&self.performance&&self.performance.now&&(o=function(){return self.performance.now()}),function(r){var n=o(),i=r;return{reset:function(e){null!=e&&(i=e),n=o()},stop:function(r){var a=o()-n,s=JSON.stringify({Target:i,Duration:a.toFixed(t),StopInfo:r});e(s)}}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getNewGuid=function(){var e=new Uint8Array(31),t=function(e){var t={crypto:!1,perfNow:!1,exceptions:[]},r=window.crypto||window.msCrypto;if(r){t.crypto=!0;try{return r.getRandomValues(e),t}catch(e){t.exceptions.push("crypto: "+JSON.stringify(e))}}var o=!1,n=window.performance;try{n&&n.now&&n.now()!==1/0&&(o=!0)}catch(e){t.exceptions.push("perfNow: "+JSON.stringify(e))}for(var i=0;i<e.length;i+=1){try{if(o){t.perfNow=!0;var a=Math.floor(100*n.now())%10;(a<0||a>9)&&(a=0);for(var s=0;s<a;s+=1)Math.random()}}catch(e){t.exceptions.push("Math.random: "+JSON.stringify(e))}e[i]=Math.floor(16*Math.random())}return t}(e),r=0;return["xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var o=15&e[r];return r+=1,("x"===t?o:3&o|8).toString(16)})),t]}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Auto="auto",e.Manual="manual"}(t.TextAreaVirtualKeyboardPolicy||(t.TextAreaVirtualKeyboardPolicy={})),function(e){e.None="none",e.Text="text",e.Tel="tel",e.Url="url",e.Email="email",e.Numeric="numeric",e.Decimal="decimal",e.Search="search"}(t.TextAreaInputMode||(t.TextAreaInputMode={}))}]);
//# sourceMappingURL=sharedClipboard.min.js.map